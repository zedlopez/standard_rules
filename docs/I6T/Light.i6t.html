<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Light</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 0 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 50rem; }
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: 1rem; margin-bottom: 2rem; }
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Index</a> &bull; <a href="./Introduction.html">Introduction</a></div><hr></header>
<div id="front_matter">
<h2><a href="./Light.i6t">Light.i6t</a></h2><h3 id="#light-darkness">Darkness.</h3><p><p> &quot;Darkness&quot; is not really a place: but in I6 it has to be an object so that the location-name on the status line can be &quot;Darkness&quot;. In I7 we use it as little as possible: note that it has no properties.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line13">13</span><span class="td">Object&nbsp;thedark&nbsp;&quot;(darkness&nbsp;object)&quot;;</span></span>
</div><div class='text'>
<h3 id="#light-light-measurement">Light Measurement.</h3><p><p> These two routines, <span class="fixed"><a href="./Light.i6t.html#line23">OffersLight</a></span> and <span class="fixed"><a href="./Light.i6t.html#line36">HasLightSource</a></span>, are largely unchanged from their I6 definitions; see the <em> Inform Designer&#39;s Manual</em>, 4th edition, for a commentary. In terms of how they are used in I7, <span class="fixed"><a href="./Light.i6t.html#line23">OffersLight</a></span> is called only by the two rules below; <span class="fixed"><a href="./Light.i6t.html#line36">HasLightSource</a></span> is called also in determining the scope, that is, what is visible to the player.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line23">23</span><span class="td">[&nbsp;OffersLight&nbsp;obj&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line24">24</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(obj)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line25">25</span><span class="td">&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;light)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line26">26</span><span class="td">&nbsp;&nbsp;objectloop&nbsp;(j&nbsp;in&nbsp;obj)&nbsp;if&nbsp;(HasLightSource(j))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line27">27</span><span class="td">&nbsp;&nbsp;if&nbsp;((obj&nbsp;has&nbsp;container)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;hasnt&nbsp;open)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;hasnt&nbsp;transparent))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line28">28</span><span class="td">&nbsp;&nbsp;if&nbsp;((obj&nbsp;provides&nbsp;component_parent)&nbsp;&amp;&amp;&nbsp;(obj.component_parent))</span></span>
<span class="tr"><span class="th" id="line29">29</span><span class="td">&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;obj.component_parent;</span></span>
<span class="tr"><span class="th" id="line30">30</span><span class="td">&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line31">31</span><span class="td">&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;parent(obj);</span></span>
<span class="tr"><span class="th" id="line32">32</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line33">33</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line34">34</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line35">35</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line36">36</span><span class="td">[&nbsp;HasLightSource&nbsp;i&nbsp;j&nbsp;ad&nbsp;sr&nbsp;po;</span></span>
<span class="tr"><span class="th" id="line37">37</span><span class="td">&nbsp;if&nbsp;(i&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line38">38</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;has&nbsp;light)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line39">39</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((IsSeeThrough(i))&nbsp;&amp;&amp;&nbsp;(~~(HidesLightSource(i))))</span></span>
<span class="tr"><span class="th" id="line40">40</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objectloop&nbsp;(j&nbsp;in&nbsp;i)</span></span>
<span class="tr"><span class="th" id="line41">41</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(HasLightSource(j))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line42">42</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ad&nbsp;=&nbsp;i.&amp;add_to_scope;</span></span>
<span class="tr"><span class="th" id="line43">43</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parent(i)&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;ad&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line44">44</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(metaclass(ad--&gt;0)&nbsp;==&nbsp;Routine)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line45">45</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ats_hls&nbsp;=&nbsp;0;&nbsp;ats_flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line46">46</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sr&nbsp;=&nbsp;scope_reason;&nbsp;po&nbsp;=&nbsp;parser_one;</span></span>
<span class="tr"><span class="th" id="line47">47</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_reason&nbsp;=&nbsp;LOOPOVERSCOPE_REASON;&nbsp;parser_one&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line48">48</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunRoutines(i,&nbsp;add_to_scope);</span></span>
<span class="tr"><span class="th" id="line49">49</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_reason&nbsp;=&nbsp;sr;&nbsp;parser_one&nbsp;=&nbsp;po;</span></span>
<span class="tr"><span class="th" id="line50">50</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ats_flag&nbsp;=&nbsp;0;&nbsp;if&nbsp;(ats_hls&nbsp;==&nbsp;1)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line51">51</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line52">52</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line53">53</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=0&nbsp;:&nbsp;(WORDSIZE*j)&lt;i.#add_to_scope&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line54">54</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ad--&gt;j)&nbsp;&amp;&amp;&nbsp;(HasLightSource(ad--&gt;j)&nbsp;==&nbsp;1))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line55">55</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line56">56</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line57">57</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ComponentHasLight(i))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line58">58</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line59">59</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line60">60</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line61">61</span><span class="td">[&nbsp;ComponentHasLight&nbsp;o&nbsp;obj&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line62">62</span><span class="td">&nbsp;if&nbsp;(o&nbsp;provides&nbsp;component_child)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line63">63</span><span class="td">&nbsp;&nbsp;obj&nbsp;=&nbsp;o.component_child;</span></span>
<span class="tr"><span class="th" id="line64">64</span><span class="td">&nbsp;&nbsp;while&nbsp;(obj)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line65">65</span><span class="td">&nbsp;&nbsp;&nbsp;next_obj&nbsp;=&nbsp;obj.component_sibling;</span></span>
<span class="tr"><span class="th" id="line66">66</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;light)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line67">67</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(HasLightSource(obj))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line68">68</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;provides&nbsp;component_child)&nbsp;&amp;&amp;&nbsp;(ComponentHasLight(obj)))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line69">69</span><span class="td">&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line70">70</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line71">71</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line72">72</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line73">73</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line74">74</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line75">75</span><span class="td">[&nbsp;HidesLightSource&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line76">76</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;player)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line77">77</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;transparent&nbsp;or&nbsp;supporter)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line78">78</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;animate)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line79">79</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;container)&nbsp;return&nbsp;(obj&nbsp;hasnt&nbsp;open);</span></span>
<span class="tr"><span class="th" id="line80">80</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(obj&nbsp;hasnt&nbsp;enterable);</span></span>
<span class="tr"><span class="th" id="line81">81</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-invariant">Invariant.</h3><p><p> The following routines maintain two variables about the light condition of the player:<p></p><p>(a) If on the most recent check the player was in light, then <span class="fixed"><a href="./Output.i6t.html#line169">location</a></span><br> equals <span class="fixed"><a href="./Output.i6t.html#line229">real_location</a></span> and <span class="fixed"><a href="./Light.i6t.html#line96">lightflag</a></span> is false.(b) If on the most recent check the player was in darkness, then <span class="fixed"><a href="./Output.i6t.html#line169">location</a></span><br> equals <span class="fixed">thedark</span> and <span class="fixed"><a href="./Light.i6t.html#line96">lightflag</a></span> is true.<p></p><p> Note that they are not allowed to alter <span class="fixed"><a href="./Output.i6t.html#line229">real_location</a></span>, whose definition has nothing to do with light.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line96">96</span><span class="td">Global&nbsp;lightflag&nbsp;=&nbsp;false;</span></span>
</div><div class='text'>
<h3 id="#light-adjust-light-rule">Adjust Light Rule.</h3><p><p> This rule fires at least once a turn, and more often when the player moves location, since that&#39;s likely to invalidate any previous assumptions. It compares the state of light now with the last time it ran, and gives instructions on what to do in each of the four possibilities.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line105">105</span><span class="td">[&nbsp;ADJUST_LIGHT_R&nbsp;previous_light_condition;</span></span>
<span class="tr"><span class="th" id="line106">106</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;previous_light_condition&nbsp;=&nbsp;lightflag;</span></span>
<span class="tr"><span class="th" id="line107">107</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;lightflag&nbsp;=&nbsp;OffersLight(parent(player));</span></span>
<span class="tr"><span class="th" id="line108">108</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line109">109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((previous_light_condition&nbsp;==&nbsp;false)&nbsp;&amp;&amp;&nbsp;(lightflag&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line110">110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;=&nbsp;thedark;</span></span>
<span class="tr"><span class="th" id="line111">111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line112">112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line113">113</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line114">114</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((previous_light_condition&nbsp;==&nbsp;false)&nbsp;&amp;&amp;&nbsp;(lightflag&nbsp;==&nbsp;true))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line115">115</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;=&nbsp;real_location;</span></span>
<span class="tr"><span class="th" id="line116">116</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CarryOutActivity(PRINTING_NEWS_OF_LIGHT_ACT);</span></span>
<span class="tr"><span class="th" id="line117">117</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line118">118</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line119">119</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line120">120</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((previous_light_condition&nbsp;==&nbsp;true)&nbsp;&amp;&amp;&nbsp;(lightflag&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line121">121</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;=&nbsp;thedark;</span></span>
<span class="tr"><span class="th" id="line122">122</span><span class="td">&nbsp;&nbsp;DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line123">123</span><span class="td">&nbsp;&nbsp;BeginActivity(PRINTING_NEWS_OF_DARKNESS_ACT);</span></span>
<span class="tr"><span class="th" id="line124">124</span><span class="td">&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_NEWS_OF_DARKNESS_ACT)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line125">125</span><span class="td">&nbsp;&nbsp;&nbsp;ADJUST_LIGHT_RM(&#39;A&#39;);&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line126">126</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line127">127</span><span class="td">&nbsp;&nbsp;EndActivity(PRINTING_NEWS_OF_DARKNESS_ACT);</span></span>
<span class="tr"><span class="th" id="line128">128</span><span class="td">&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line129">129</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line130">130</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line131">131</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((previous_light_condition&nbsp;==&nbsp;true)&nbsp;&amp;&amp;&nbsp;(lightflag&nbsp;==&nbsp;true))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line132">132</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;=&nbsp;real_location;</span></span>
<span class="tr"><span class="th" id="line133">133</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line134">134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line135">135</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line136">136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line137">137</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-silent-light-consideration">Silent Light Consideration.</h3><p><p> The Adjust Light Rule makes a fuss when light changes: it prints messages, for instance. This rule is silent instead, and simply does the minimum necessary to maintain the light invariant. It is used in only four circumstances:<p></p><p> (a) To determine the initial light condition at start of play. (b) When the player moves from one room to another via the &quot;going&quot; action. (c) When the player moves via <span class="fixed"><a href="./WorldModel.i6t.html#line345">PlayerTo</a></span>, which is used by &quot;now the player is in ...&quot;. (d) When the player changes from one persona to another.<p></p><p> Perhaps case (b) is surprising. Why not simply use the adjust light rule, as we do on an instance of &quot;move player to ...&quot;, for instance? The answer is that the going action is just about to print details of the new location anyway, so it would be redundant to have the adjust light rule print out details as well.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line157">157</span><span class="td">[&nbsp;SilentlyConsiderLight;</span></span>
<span class="tr"><span class="th" id="line158">158</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;lightflag&nbsp;=&nbsp;OffersLight(parent(player));</span></span>
<span class="tr"><span class="th" id="line159">159</span><span class="td">&nbsp;if&nbsp;(lightflag)&nbsp;location&nbsp;=&nbsp;real_location;&nbsp;else&nbsp;location&nbsp;=&nbsp;thedark;</span></span>
<span class="tr"><span class="th" id="line160">160</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line161">161</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-translucency">Translucency.</h3><p><p> <span class="fixed"><a href="./Light.i6t.html#line169">IsSeeThrough</a></span> is used at various places: roughly speaking, it determineswhether <span class="fixed">obj</span> being in scope means that the object-tree contents of <span class="fixed">obj</span><br> are in scope.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line169">169</span><span class="td">[&nbsp;IsSeeThrough&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;has&nbsp;supporter)</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;(obj&nbsp;has&nbsp;transparent)</span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;(obj&nbsp;has&nbsp;animate)</span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;((obj&nbsp;has&nbsp;container)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;has&nbsp;open)))</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-visibility-parent">Visibility Parent.</h3><p><p> The idea of <span class="fixed"><a href="./Light.i6t.html#line189">VisibilityParent</a></span> is that it takes us from a given position in the object tree, <span class="fixed">o</span>, to the next visible position above. Note that (1) A container has an inside and an outside: this routine calculates from the &quot;inside of <span class="fixed">o</span>&quot;, which is why it returns <span class="fixed">nothing</span> from an opaque closed container; (2) Component parts are (for purposes of this routine) attached to the outside surface of a container, so that if <span class="fixed">o</span> is part of a closed opaque container then the visibility parent of <span class="fixed">o</span> is its actual parent.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line189">189</span><span class="td">[&nbsp;VisibilityParent&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line190">190</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;&amp;&amp;&nbsp;(o&nbsp;has&nbsp;container)&nbsp;&amp;&amp;&nbsp;(o&nbsp;hasnt&nbsp;open)&nbsp;&amp;&amp;&nbsp;(o&nbsp;hasnt&nbsp;transparent))&nbsp;return&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line191">191</span><span class="td">&nbsp;if&nbsp;(o)&nbsp;o&nbsp;=&nbsp;CoreOfParentOfCoreOf(o);</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-find-visibility-levels">Find Visibility Levels.</h3><p><p> The following routine sets the pair of variables <span class="fixed"><a href="./Output.i6t.html#line230">visibility_ceiling</a></span>, thehighest visible point in the object tree above the player &ndash; or <span class="fixed">thedark</span><br> if the player cannot see at all &ndash; and <span class="fixed"><a href="./Output.i6t.html#line231">visibility_levels</a></span>, the number of steps of <span class="fixed"><a href="./Light.i6t.html#line189">VisibilityParent</a></span> needed to reach this ceiling; or 0 if the player cannot see at all.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line203">203</span><span class="td">[&nbsp;FindVisibilityLevels&nbsp;lc&nbsp;up;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;if&nbsp;(location&nbsp;==&nbsp;thedark)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;&nbsp;visibility_ceiling&nbsp;=&nbsp;thedark;</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">&nbsp;&nbsp;visibility_levels&nbsp;=&nbsp;0;&nbsp;</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">&nbsp;&nbsp;visibility_ceiling&nbsp;=&nbsp;player;</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;&nbsp;while&nbsp;(true)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;&nbsp;&nbsp;up&nbsp;=&nbsp;VisibilityParent(visibility_ceiling);</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(up&nbsp;==&nbsp;0)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">&nbsp;&nbsp;&nbsp;visibility_ceiling&nbsp;=&nbsp;up;</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">&nbsp;&nbsp;&nbsp;lc++;</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">&nbsp;&nbsp;visibility_levels&nbsp;=&nbsp;lc;</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-touchability-ceiling">Touchability Ceiling.</h3><p><p> Analogously:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line223">223</span><span class="td">[&nbsp;TouchabilityCeiling&nbsp;original&nbsp;o&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;o&nbsp;=&nbsp;original;</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;while&nbsp;(o)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;CoreOfParentOfCoreOf(o);</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(p&nbsp;ofclass&nbsp;K1_room)&nbsp;return&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(p&nbsp;==&nbsp;nothing)&nbsp;return&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((FollowRulebook(REACHING_OUTSIDE_RB,&nbsp;p))&nbsp;&amp;&amp;&nbsp;(RulebookFailed()))</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">&nbsp;return&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-scope-ceiling">Scope Ceiling.</h3><p><p> Scope is almost the same thing as visibility, but not quite, and the following routine does not quite duplicate the calculation of <span class="fixed"><a href="./Light.i6t.html#line203">FindVisibilityLevels</a></span>. The difference arises in the first step, where we take the <span class="fixed">parent</span> of <span class="fixed">pos</span>, not the core of the <span class="fixed">parent</span> of the core of <span class="fixed">pos</span>: this makes a difference if <span class="fixed">pos</span> is inside a container which is itself part of something else.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line245">245</span><span class="td">[&nbsp;ScopeCeiling&nbsp;pos&nbsp;c;</span></span>
<span class="tr"><span class="th" id="line246">246</span><span class="td">&nbsp;if&nbsp;(pos&nbsp;==&nbsp;player&nbsp;&amp;&amp;&nbsp;location&nbsp;==&nbsp;thedark)&nbsp;return&nbsp;thedark;</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">&nbsp;c&nbsp;=&nbsp;parent(pos);</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td">&nbsp;if&nbsp;(c&nbsp;==&nbsp;0)&nbsp;return&nbsp;pos;</span></span>
<span class="tr"><span class="th" id="line249">249</span><span class="td">&nbsp;while&nbsp;(VisibilityParent(c))&nbsp;c&nbsp;=&nbsp;VisibilityParent(c);</span></span>
<span class="tr"><span class="th" id="line250">250</span><span class="td">&nbsp;return&nbsp;c;</span></span>
<span class="tr"><span class="th" id="line251">251</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-object-is-untouchable">Object Is Untouchable.</h3><p><p> The following routine imitates the I6 library one of the same name, but works instead by delegating the decision to the accessibility rulebook.<p></p><p> It is not easy to answer the question of whether someone other than the player, but in another room, can touch a multiply-present object (a two-sided door or a backdrop) and we err on the side of caution by saying yes in such cases. The question would only be asked in the case of a &quot;try&quot; action deliberately caused by the author, or by an instruction made by the player to someone not in the same room: in the first case, we will assume that the author knows what he is doing, and in the second case, the circumstances in which saying yes would be a wrong call are <em> highly</em> improbable.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line268">268</span><span class="td">[&nbsp;ObjectIsUntouchable&nbsp;item&nbsp;silent_flag&nbsp;p&nbsp;save_sp&nbsp;decision&nbsp;moving&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line269">269</span><span class="td">&nbsp;if&nbsp;(LocationOf(p)&nbsp;~=&nbsp;real_location)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line270">270</span><span class="td">&nbsp;&nbsp;for&nbsp;(x&nbsp;=&nbsp;CoreOf(item):&nbsp;x:&nbsp;x&nbsp;=&nbsp;CoreOfParentOfCoreOf(x))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line271">271</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(x&nbsp;ofclass&nbsp;K4_door&nbsp;or&nbsp;K7_backdrop)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line272">272</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;moving&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MoveFloatingObjects(LocationOf(p));</span></span>
<span class="tr"><span class="th" id="line274">274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line275">275</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">&nbsp;untouchable_object&nbsp;=&nbsp;item;&nbsp;untouchable_silence&nbsp;=&nbsp;silent_flag;</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">&nbsp;touch_persona&nbsp;=&nbsp;p;&nbsp;if&nbsp;(p&nbsp;==&nbsp;actor)&nbsp;touch_persona&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">&nbsp;save_sp&nbsp;=&nbsp;say__p;&nbsp;say__p&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">&nbsp;@push&nbsp;actor;&nbsp;actor&nbsp;=&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;if&nbsp;(FollowRulebook(ACCESSIBILITY_RB,&nbsp;0,&nbsp;true))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;if&nbsp;(RulebookSucceeded())&nbsp;decision&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">&nbsp;&nbsp;else&nbsp;decision&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td">&nbsp;}&nbsp;else&nbsp;decision&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">&nbsp;@pull&nbsp;actor;</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;if&nbsp;(say__p&nbsp;==&nbsp;false)&nbsp;say__p&nbsp;=&nbsp;save_sp;</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;if&nbsp;(moving)&nbsp;MoveFloatingObjects();</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">&nbsp;untouchable_silence&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;return&nbsp;decision;</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-access-through-barriers-rule">Access Through Barriers Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line296">296</span><span class="td">[&nbsp;ACCESS_THROUGH_BARRIERS_R&nbsp;ancestor&nbsp;i&nbsp;j&nbsp;external&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line297">297</span><span class="td">&nbsp;p&nbsp;=&nbsp;touch_persona;&nbsp;if&nbsp;(p&nbsp;==&nbsp;0)&nbsp;p&nbsp;=&nbsp;actor;</span></span>
<span class="tr"><span class="th" id="line298">298</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line299">299</span><span class="td">&nbsp;ancestor&nbsp;=&nbsp;CommonAncestor(p,&nbsp;untouchable_object);</span></span>
<span class="tr"><span class="th" id="line300">300</span><span class="td">&nbsp;if&nbsp;((ancestor&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(LocationOf(untouchable_object)&nbsp;==&nbsp;nothing)</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">&nbsp;&nbsp;&amp;&amp;&nbsp;((untouchable_object&nbsp;ofclass&nbsp;K4_door&nbsp;or&nbsp;K7_backdrop)&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">&nbsp;&nbsp;if&nbsp;(touch_persona&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((actor&nbsp;==&nbsp;player)&nbsp;&amp;&amp;&nbsp;(untouchable_silence&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ACCESS_THROUGH_BARRIERS_RM(&#39;A&#39;,&nbsp;untouchable_object);</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td">&nbsp;!&nbsp;First,&nbsp;a&nbsp;barrier&nbsp;between&nbsp;the&nbsp;player&nbsp;and&nbsp;the&nbsp;ancestor.</span></span>
<span class="tr"><span class="th" id="line313">313</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line314">314</span><span class="td">&nbsp;if&nbsp;(CoreOf(p)&nbsp;~=&nbsp;ancestor)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line315">315</span><span class="td">&nbsp;&nbsp;i&nbsp;=&nbsp;parent(CoreOf(p));&nbsp;j&nbsp;=&nbsp;CoreOf(i);&nbsp;external&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line316">316</span><span class="td">&nbsp;&nbsp;if&nbsp;(j&nbsp;~=&nbsp;i)&nbsp;{&nbsp;i&nbsp;=&nbsp;j;&nbsp;external&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line317">317</span><span class="td">&nbsp;&nbsp;while&nbsp;(i~=ancestor&nbsp;&amp;&amp;&nbsp;i)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line318">318</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((external&nbsp;==&nbsp;false)</span></span>
<span class="tr"><span class="th" id="line319">319</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;(FollowRulebook(REACHING_OUTSIDE_RB,&nbsp;i))</span></span>
<span class="tr"><span class="th" id="line320">320</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;(RulebookFailed()))&nbsp;rtrue;&nbsp;!&nbsp;Barrier</span></span>
<span class="tr"><span class="th" id="line321">321</span><span class="td">&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;parent(CoreOf(i));&nbsp;external&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line322">322</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(~~(i&nbsp;ofclass&nbsp;K5_container))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line323">323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;CoreOf(i);</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;~=&nbsp;i)&nbsp;{&nbsp;i&nbsp;=&nbsp;j;&nbsp;external&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">&nbsp;!&nbsp;Second,&nbsp;a&nbsp;barrier&nbsp;between&nbsp;the&nbsp;item&nbsp;and&nbsp;the&nbsp;ancestor.</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;if&nbsp;(CoreOf(untouchable_object)&nbsp;~=&nbsp;ancestor)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">&nbsp;&nbsp;!&nbsp;We&nbsp;can&nbsp;always&nbsp;get&nbsp;to&nbsp;the&nbsp;core&nbsp;of&nbsp;the&nbsp;item.</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;&nbsp;i&nbsp;=&nbsp;CoreOf(untouchable_object);</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;&nbsp;!&nbsp;This&nbsp;will&nbsp;be&nbsp;on&nbsp;the&nbsp;inside&nbsp;of&nbsp;its&nbsp;parent,&nbsp;if&nbsp;its&nbsp;parent&nbsp;is&nbsp;a</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;!&nbsp;container,&nbsp;so&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;exemption.</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;i&nbsp;=&nbsp;parent(i);&nbsp;external&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;&nbsp;while&nbsp;(i~=ancestor&nbsp;&amp;&amp;&nbsp;i)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((external&nbsp;==&nbsp;false)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(FollowRulebook(REACHING_INSIDE_RB,&nbsp;i))&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(RulebookFailed()))&nbsp;rtrue;&nbsp;!&nbsp;Barrier</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;CoreOf(i);</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;ancestor)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;parent(i);&nbsp;external&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(~~(i&nbsp;ofclass&nbsp;K5_container))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;CoreOf(i);</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;~=&nbsp;i)&nbsp;{&nbsp;i&nbsp;=&nbsp;j;&nbsp;external&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">&nbsp;RulebookSucceeds();&nbsp;!&nbsp;No&nbsp;barrier</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-cant-reach-inside-closed-containers-rule">Can't Reach Inside Closed Containers Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line358">358</span><span class="td">[&nbsp;CANT_REACH_INSIDE_CLOSED_R;</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td">&nbsp;if&nbsp;(parameter_value&nbsp;has&nbsp;container&nbsp;&amp;&amp;&nbsp;parameter_value&nbsp;hasnt&nbsp;open)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">&nbsp;&nbsp;if&nbsp;(touch_persona&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((actor&nbsp;==&nbsp;player)&nbsp;&amp;&amp;&nbsp;(untouchable_silence&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;CANT_REACH_INSIDE_CLOSED_RM(&#39;A&#39;,&nbsp;parameter_value);</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line365">365</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td">&nbsp;&nbsp;RulebookFails();&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-cant-reach-outside-closed-containers-rule">Can't Reach Outside Closed Containers Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line374">374</span><span class="td">[&nbsp;CANT_REACH_OUTSIDE_CLOSED_R;</span></span>
<span class="tr"><span class="th" id="line375">375</span><span class="td">&nbsp;if&nbsp;(parameter_value&nbsp;has&nbsp;container&nbsp;&amp;&amp;&nbsp;parameter_value&nbsp;hasnt&nbsp;open)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;&nbsp;if&nbsp;(touch_persona&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((actor&nbsp;==&nbsp;player)&nbsp;&amp;&amp;&nbsp;(untouchable_silence&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;CANT_REACH_OUTSIDE_CLOSED_RM(&#39;A&#39;,&nbsp;parameter_value);</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line382">382</span><span class="td">&nbsp;&nbsp;RulebookFails();&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line383">383</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line384">384</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line385">385</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#light-cant-reach-inside-rooms-rule">Can't Reach Inside Rooms Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line390">390</span><span class="td">[&nbsp;CANT_REACH_INSIDE_ROOMS_R;</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;if&nbsp;(parameter_value&nbsp;&amp;&amp;&nbsp;parameter_value&nbsp;ofclass&nbsp;K1_room)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;if&nbsp;(touch_persona&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((actor&nbsp;==&nbsp;player)&nbsp;&amp;&amp;&nbsp;(untouchable_silence&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;CANT_REACH_INSIDE_ROOMS_RM(&#39;A&#39;,&nbsp;parameter_value);</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;RulebookFails();&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td"></span></span>
</div><footer><hr><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
