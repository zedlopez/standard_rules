<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>ListWriter</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}

.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 50rem; }
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: 1rem; margin-bottom: 2rem; }
    </style>
</head>
<body>
<div id="front_matter">
<h1><a href="./ListWriter.i6t">ListWriter</a></h1><h2>Specification.</h2><p><p> The list-writer is called by one of the following function calls:<p></p><p> (1) <span class="fixed">WriteListOfMarkedObjects(style)</span>, where the set of objects listed is understood to be exactly those with the <span class="fixed">workflag2</span> attribute set, and (-a) the <span class="fixed">style</span> is a sum of <span class="fixed">*_BIT</span> constants as defined in <a href="./Definitions.i6t.html">Definitions.i6t</a>.<p></p><p> (2) |WriteListFrom(obj, style, depth, noactivity, iterator)|, where only the first two parameters are compulsory: (-a) the set of objects listed begins with <span class="fixed">obj</span>; (-b) the <span class="fixed">style</span> is a sum of <span class="fixed">*_BIT</span> constants as defined in <a href="./Definitions.i6t.html">Definitions.i6t</a>; (-c) the <span class="fixed">depth</span> is the recursion depth within the list &ndash; ordinarily 0, but by supplying a higher value, we can simulate a sublist of another list; (-d) <span class="fixed">noactivity</span> is a flag which forces the list-writer to ignore the &quot;listing the contents of&quot; activity (in cases where it would otherwise consult this): by default this is <span class="fixed">false</span>; (-e) <span class="fixed">iterator</span> is an iterator function which provides the objects in sequence.<p></p><p> <a href="./ListWriter.i6t.html#line154">WriteListOfMarkedObjects</a> is simply a front-end which supplies suitable parameters for <a href="./ListWriter.i6t.html#line467">WriteListFrom</a>.<p></p><p> The iterator function is by default <a href="./ListWriter.i6t.html#line411">ObjectTreeIterator</a>. This defines the sequence of objects as being the children of the parent of <span class="fixed">obj</span>, in object tree sequence (that is: <span class="fixed">child(parent(obj))</span> is first). Moreover, when using <a href="./ListWriter.i6t.html#line411">ObjectTreeIterator</a>, the &quot;listing the contents of&quot; activity is carried out, unless <span class="fixed">noactivity</span> is set.<p></p><p> We also provide the iterator function <a href="./ListWriter.i6t.html#line334">MarkedListIterator</a>, which defines the sequence of objects as being the list in the word array <a href="./ListWriter.i6t.html#line151">MarkedObjectArray</a> with length <a href="./ListWriter.i6t.html#line152">MarkedObjectLength</a>. Here the &quot;listing the contents of&quot; activity is never used, since the objects are not necessarily the contents of any single thing. This of course is the iterator used by <span class="fixed">WriteListOfMarkedObjects(style)</span>: it works by filling this array with all the objects having <span class="fixed">workflag2</span> set.<p></p><p> The full specification for iterator functions is given below.<p></p><p> The list-writer automatically groups adjacent and indistinguishable terms in the sequence into plurals, and carries out the &quot;printing the plural name&quot; activity to handle these. Doing this alone would result in text such as &quot;You can see a cake, three coins, an onion, and two coins here&quot;, where the five coins are mentioned in two clauses because they happen not to be adjacent in the list. The list-writer therefore carries out the activity &quot;grouping together&quot; to see if the user would like to tie certain objects together into a single entry: what this does is to set suitable <span class="fixed">list_together</span> properties for the objects. NI has already given plural objects a similar <span class="fixed">list_together</span> property. The net effect is that any entries in the list with a non-blank value of <span class="fixed">list_together</span> must be adjacent to each other.<p></p><p> We could achieve that by sorting the list in order of <span class="fixed">list_together</span> value, but that would result in drastic movements, whereas we want to upset the original ordering as little as possible. So instead we use a process called <strong> coalescing</strong> the list. This is such that for every value $L\neq 0$ of <span class="fixed">list_together</span>, every entry with that value is moved back in the list to follow the first entry with that value. Thus if the original order is $x_1, x_2, ..., x_N$ then $x_j$ still precedes $x_k$ in coalesced order unless there exists $i&lt;j&lt;k$ such that $L(i) = L(k) \neq 0$ and $L(j)\neq L(i)$. This is as stable as it can be while achieving the &quot;interval&quot; property that non-zero $L$ values occur in contiguous runs.<p></p><p> We therefore obtain text such as &quot;You can see a cake, five coins, the tiles W, X, Y and Z from a Scrabble set, and an onion here.&quot; where the coins and the Scrabble tiles have been coalesced together in the list.<p></p><p> It&#39;s important to note that the default <a href="./ListWriter.i6t.html#line411">ObjectTreeIterator</a> has the side-effect of actually reordering the object tree: it rearranges the children being listed so that they appear in the tree in coalesced order. The <a href="./ListWriter.i6t.html#line334">MarkedListIterator</a> used by <a href="./ListWriter.i6t.html#line154">WriteListOfMarkedObjects</a> has the same side-effect if the marked objects all happen to share a common parent. It might seem odd for a list-writer to have side effects at all, but the idea is that occasional coalescing improves the quality of play in many small ways &ndash; for instance, the sequence of matches to TAKE ALL is tidier &ndash; and that coalescing has a small speed cost, so we want to do it as little as possible. (The latter was more of a consideration for I6: interpreters are faster nowadays.)<p></p><p> This specification is somewhat stronger than that of the I6 library&#39;s traditional list-writer, because (i) it supports arbitrary lists of objects, not just children of specific parents, while still allowing coalesced and grouped lists, (ii) it can be used recursively in all cases, (iii) it uses its own memory, rather than borrowing memory from the parser, so that it can safely be used while the parser is working, and (iv) it manages this memory more flexibly and without silently failing by buffer overruns on unexpectedly large lists.<p></p><p> The I7 version of <a href="./ListWriter.i6t.html#line467">WriteListFrom</a>, when using <a href="./ListWriter.i6t.html#line411">ObjectTreeIterator</a>, differs from the I6 version in that the object <span class="fixed">o</span> is required to be the <span class="fixed">child</span> of its <span class="fixed">parent</span>, that is, to be the eldest child. (So in effect it&#39;s a function of parents, not children, but we retain the form for familiarity&#39;s sake.) In practice this was invariably the way <a href="./ListWriter.i6t.html#line467">WriteListFrom</a> was used even in I6 days.<p></p><p> Finally, the <a href="./Definitions.i6t.html#line568">ISARE_BIT</a> is differently interpreted in I7: instead of printing something like &quot; are ducks and drakes&quot;, as it would have done in I6, the initial space is now suppressed and we instead print &quot;are ducks and drakes&quot;.<p></p><p><h2>Memory.</h2><p><p> The list-writer needs to dynamically allocate temporary array space of a known size, in such a way that the array is effectively on the local stack frame: if only either the Z-machine or Glulx supported a stack in memory, this would be no problem, but they do not and we must therefore use the following.<p></p><p> The size of the stack is such that it can support a list which includes every object and recurses in turn to most other objects: in practice, this never happens. It would be nice to allocate more just in case, but the Z-machine is desperately short of array memory.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line116">116</span><span class="td">Constant&nbsp;REQUISITION_STACK_SIZE&nbsp;=&nbsp;3*{-value:Instances::count(K_object)};</span></span>
<span class="tr"><span class="th" id="line117">117</span><span class="td">Array&nbsp;requisition_stack&nbsp;--&gt;&nbsp;REQUISITION_STACK_SIZE;</span></span>
<span class="tr"><span class="th" id="line118">118</span><span class="td">Global&nbsp;requisition_stack_pointer&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line119">119</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line120">120</span><span class="td">[&nbsp;RequisitionStack&nbsp;len&nbsp;top&nbsp;addr;</span></span>
<span class="tr"><span class="th" id="line121">121</span><span class="td">&nbsp;top&nbsp;=&nbsp;requisition_stack_pointer&nbsp;+&nbsp;len;</span></span>
<span class="tr"><span class="th" id="line122">122</span><span class="td">&nbsp;if&nbsp;(top&nbsp;&gt;&nbsp;REQUISITION_STACK_SIZE)&nbsp;return&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line123">123</span><span class="td">&nbsp;addr&nbsp;=&nbsp;requisition_stack&nbsp;+&nbsp;requisition_stack_pointer*WORDSIZE;</span></span>
<span class="tr"><span class="th" id="line124">124</span><span class="td">&nbsp;!&nbsp;print&nbsp;&quot;Allocating&nbsp;&quot;,&nbsp;addr,&nbsp;&quot;&nbsp;at&nbsp;pointer&nbsp;&quot;,&nbsp;requisition_stack_pointer,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line125">125</span><span class="td">&nbsp;requisition_stack_pointer&nbsp;=&nbsp;top;</span></span>
<span class="tr"><span class="th" id="line126">126</span><span class="td">&nbsp;return&nbsp;addr;</span></span>
<span class="tr"><span class="th" id="line127">127</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line128">128</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line129">129</span><span class="td">[&nbsp;FreeStack&nbsp;addr;</span></span>
<span class="tr"><span class="th" id="line130">130</span><span class="td">&nbsp;if&nbsp;(addr&nbsp;==&nbsp;0)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line131">131</span><span class="td">&nbsp;requisition_stack_pointer&nbsp;=&nbsp;(addr&nbsp;-&nbsp;requisition_stack)/WORDSIZE;</span></span>
<span class="tr"><span class="th" id="line132">132</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line133">133</span><span class="td"></span></span>
</div><div class='text'>
<h2>WriteListOfMarkedObjects.</h2><p><p> This routine will use the <a href="./ListWriter.i6t.html#line334">MarkedListIterator</a>. That means it has to create an array containing the object numbers of every object with the <span class="fixed">workflag2</span> attribute set, placing the address of this array in <a href="./ListWriter.i6t.html#line151">MarkedObjectArray</a> and the length in <a href="./ListWriter.i6t.html#line152">MarkedObjectLength</a>. Note that we preserve any existing marked list on the stack (using the assembly-language instructions <span class="fixed">@push</span> and <span class="fixed">@pull</span>) for the duration of our use.<p></p><p> While the final order of this list will depend on what it looks like after coalescing, the initial order is also important. If all of the objects have a common parent in the object tree, then we coalesce those objects and place the list in object tree order. But if not, we place the list in object number order (which is essentially the order of traversal of the initial state of the object tree: thus objects in Room A will all appear before objects in Room B if A was created before B in the source text).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line151">151</span><span class="td">Global&nbsp;MarkedObjectArray&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line152">152</span><span class="td">Global&nbsp;MarkedObjectLength&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line153">153</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line154">154</span><span class="td">[&nbsp;WriteListOfMarkedObjects&nbsp;style</span></span>
<span class="tr"><span class="th" id="line155">155</span><span class="td">&nbsp;obj&nbsp;common_parent&nbsp;first&nbsp;mixed_parentage&nbsp;length&nbsp;g&nbsp;gc;</span></span>
<span class="tr"><span class="th" id="line156">156</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line157">157</span><span class="td">&nbsp;gc&nbsp;=&nbsp;-2;</span></span>
<span class="tr"><span class="th" id="line158">158</span><span class="td">&nbsp;objectloop&nbsp;(obj&nbsp;ofclass&nbsp;Object&nbsp;&amp;&amp;&nbsp;obj&nbsp;has&nbsp;workflag2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line159">159</span><span class="td">&nbsp;&nbsp;length++;</span></span>
<span class="tr"><span class="th" id="line160">160</span><span class="td">&nbsp;&nbsp;if&nbsp;(first&nbsp;==&nbsp;nothing)&nbsp;{&nbsp;first&nbsp;=&nbsp;obj;&nbsp;common_parent&nbsp;=&nbsp;parent(obj);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line161">161</span><span class="td">&nbsp;&nbsp;else&nbsp;{&nbsp;if&nbsp;(parent(obj)&nbsp;~=&nbsp;common_parent)&nbsp;mixed_parentage&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line162">162</span><span class="td">&nbsp;&nbsp;g&nbsp;=&nbsp;GetGNAOfObject(obj);&nbsp;g&nbsp;=&nbsp;g%3;</span></span>
<span class="tr"><span class="th" id="line163">163</span><span class="td">&nbsp;&nbsp;if&nbsp;(gc&nbsp;==&nbsp;-2)&nbsp;gc&nbsp;=&nbsp;g;</span></span>
<span class="tr"><span class="th" id="line164">164</span><span class="td">&nbsp;&nbsp;else&nbsp;if&nbsp;(gc&nbsp;~=&nbsp;g)&nbsp;gc&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line165">165</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line166">166</span><span class="td">&nbsp;if&nbsp;(mixed_parentage)&nbsp;common_parent&nbsp;=&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line167">167</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td">&nbsp;if&nbsp;(length&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(style&nbsp;&amp;&nbsp;ISARE_BIT&nbsp;~=&nbsp;0)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;W&#39;);</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(style&nbsp;&amp;&nbsp;CFIRSTART_BIT&nbsp;~=&nbsp;0)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;X&#39;);</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td">&nbsp;&nbsp;else&nbsp;LIST_WRITER_INTERNAL_RM(&#39;Y&#39;);</span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">&nbsp;&nbsp;@push&nbsp;MarkedObjectArray;&nbsp;@push&nbsp;MarkedObjectLength;</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;&nbsp;MarkedObjectArray&nbsp;=&nbsp;RequisitionStack(length);</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">&nbsp;&nbsp;MarkedObjectLength&nbsp;=&nbsp;length;</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">&nbsp;&nbsp;if&nbsp;(MarkedObjectArray&nbsp;==&nbsp;0)&nbsp;return&nbsp;RunTimeProblem(RTP_LISTWRITERMEMORY);&nbsp;</span></span>
<span class="tr"><span class="th" id="line177">177</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line178">178</span><span class="td">&nbsp;&nbsp;if&nbsp;(common_parent)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line179">179</span><span class="td">&nbsp;&nbsp;&nbsp;ObjectTreeCoalesce(child(common_parent));</span></span>
<span class="tr"><span class="th" id="line180">180</span><span class="td">&nbsp;&nbsp;&nbsp;length&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line181">181</span><span class="td">&nbsp;&nbsp;&nbsp;objectloop&nbsp;(obj&nbsp;in&nbsp;common_parent)&nbsp;!&nbsp;object&nbsp;tree&nbsp;order</span></span>
<span class="tr"><span class="th" id="line182">182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;workflag2)&nbsp;MarkedObjectArray--&gt;length++&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line183">183</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line184">184</span><span class="td">&nbsp;&nbsp;&nbsp;length&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line185">185</span><span class="td">&nbsp;&nbsp;&nbsp;objectloop&nbsp;(obj&nbsp;ofclass&nbsp;Object)&nbsp;!&nbsp;object&nbsp;number&nbsp;order</span></span>
<span class="tr"><span class="th" id="line186">186</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;workflag2)&nbsp;MarkedObjectArray--&gt;length++&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line187">187</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line188">188</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line189">189</span><span class="td">&nbsp;&nbsp;WriteListFrom(first,&nbsp;style,&nbsp;0,&nbsp;false,&nbsp;MarkedListIterator);</span></span>
<span class="tr"><span class="th" id="line190">190</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line191">191</span><span class="td">&nbsp;&nbsp;FreeStack(MarkedObjectArray);</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td">&nbsp;&nbsp;@pull&nbsp;MarkedObjectLength;&nbsp;@pull&nbsp;MarkedObjectArray;</span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td">&nbsp;prior_named_list&nbsp;=&nbsp;length;</span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">&nbsp;prior_named_list_gender&nbsp;=&nbsp;gc;</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td"></span></span>
</div><div class='text'>
<h2>List Number and Gender.</h2><p><p> As a brief parenthesis, the same algorithm can be used to work out the prior named list number and gender for everything matching a description.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line204">204</span><span class="td">[&nbsp;RegardingMarkedObjects</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;obj&nbsp;length&nbsp;g&nbsp;gc;</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">&nbsp;gc&nbsp;=&nbsp;-2;</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td">&nbsp;objectloop&nbsp;(obj&nbsp;ofclass&nbsp;Object&nbsp;&amp;&amp;&nbsp;obj&nbsp;has&nbsp;workflag2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">&nbsp;&nbsp;length++;</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;&nbsp;g&nbsp;=&nbsp;GetGNAOfObject(obj);&nbsp;g&nbsp;=&nbsp;g%3;</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;&nbsp;if&nbsp;(gc&nbsp;==&nbsp;-2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">&nbsp;&nbsp;&nbsp;gc&nbsp;=&nbsp;g;</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">&nbsp;&nbsp;&nbsp;prior_named_noun&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(gc&nbsp;~=&nbsp;g)&nbsp;gc&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">&nbsp;prior_named_list&nbsp;=&nbsp;length;</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;prior_named_list_gender&nbsp;=&nbsp;gc;</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;if&nbsp;(length&nbsp;==&nbsp;0)&nbsp;{&nbsp;prior_named_noun&nbsp;=&nbsp;nothing;&nbsp;prior_named_list_gender&nbsp;=&nbsp;-1;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;return;&nbsp;</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">[&nbsp;RegardingSingleObject&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;prior_named_list&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;prior_named_list_gender&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;prior_named_noun&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">[&nbsp;RegardingNumber&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">&nbsp;prior_named_list&nbsp;=&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">&nbsp;prior_named_list_gender&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;prior_named_noun&nbsp;=&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">[&nbsp;PNToVP&nbsp;gna;</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">&nbsp;if&nbsp;(prior_named_noun&nbsp;==&nbsp;player)&nbsp;return&nbsp;story_viewpoint;</span></span>
<span class="tr"><span class="th" id="line235">235</span><span class="td">&nbsp;if&nbsp;(prior_named_noun)&nbsp;gna&nbsp;=&nbsp;GetGNAOfObject(prior_named_noun);</span></span>
<span class="tr"><span class="th" id="line236">236</span><span class="td">&nbsp;if&nbsp;(((gna%6)/3&nbsp;==&nbsp;1)&nbsp;||&nbsp;(prior_named_list&nbsp;&gt;=&nbsp;2))&nbsp;return&nbsp;6;</span></span>
<span class="tr"><span class="th" id="line237">237</span><span class="td">&nbsp;return&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line238">238</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line239">239</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line240">240</span><span class="td">[&nbsp;PrintVerbAsValue&nbsp;vb;</span></span>
<span class="tr"><span class="th" id="line241">241</span><span class="td">&nbsp;if&nbsp;(vb&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;(no&nbsp;verb)&quot;;</span></span>
<span class="tr"><span class="th" id="line242">242</span><span class="td">&nbsp;else&nbsp;{&nbsp;print&nbsp;&quot;verb&nbsp;&quot;;&nbsp;vb(1);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line245">245</span><span class="td">[&nbsp;VerbIsMeaningful&nbsp;vb;</span></span>
<span class="tr"><span class="th" id="line246">246</span><span class="td">&nbsp;if&nbsp;((vb)&nbsp;&amp;&amp;&nbsp;(BlkValueCompare(vb(CV_MEANING),&nbsp;Rel_Record_0)&nbsp;~=&nbsp;0))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line249">249</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line250">250</span><span class="td">[&nbsp;VerbIsModal&nbsp;vb;</span></span>
<span class="tr"><span class="th" id="line251">251</span><span class="td">&nbsp;if&nbsp;((vb)&nbsp;&amp;&amp;&nbsp;(vb(CV_MODAL)))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line252">252</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line253">253</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line254">254</span><span class="td"></span></span>
</div><div class='text'>
<h2>List Writer Regard Storage.</h2><p><p> This is somewhat hacky, but enables &quot;[regarding list writer internals]&quot;.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line259">259</span><span class="td">Array&nbsp;LWI_Storage&nbsp;--&gt;&nbsp;1&nbsp;(-1)&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line260">260</span><span class="td">[&nbsp;SetLWI&nbsp;a&nbsp;b&nbsp;c;</span></span>
<span class="tr"><span class="th" id="line261">261</span><span class="td">&nbsp;LWI_Storage--&gt;0&nbsp;=&nbsp;a;</span></span>
<span class="tr"><span class="th" id="line262">262</span><span class="td">&nbsp;LWI_Storage--&gt;1&nbsp;=&nbsp;b;</span></span>
<span class="tr"><span class="th" id="line263">263</span><span class="td">&nbsp;LWI_Storage--&gt;2&nbsp;=&nbsp;c;</span></span>
<span class="tr"><span class="th" id="line264">264</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line265">265</span><span class="td">[&nbsp;RegardingLWI;</span></span>
<span class="tr"><span class="th" id="line266">266</span><span class="td">&nbsp;prior_named_list&nbsp;=&nbsp;LWI_Storage--&gt;0;</span></span>
<span class="tr"><span class="th" id="line267">267</span><span class="td">&nbsp;prior_named_list_gender&nbsp;=&nbsp;LWI_Storage--&gt;1;</span></span>
<span class="tr"><span class="th" id="line268">268</span><span class="td">&nbsp;prior_named_noun&nbsp;=&nbsp;LWI_Storage--&gt;2;</span></span>
<span class="tr"><span class="th" id="line269">269</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line270">270</span><span class="td"></span></span>
</div><div class='text'>
<h2>Response Printing.</h2><p><p> From which:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line275">275</span><span class="td">[&nbsp;ResponseViaActivity&nbsp;R;</span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td">&nbsp;@push&nbsp;prior_named_noun;&nbsp;@push&nbsp;prior_named_list;&nbsp;@push&nbsp;prior_named_list_gender;</span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">&nbsp;RegardingSingleObject(nothing);</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">&nbsp;CarryOutActivity(PRINTING_RESPONSE_ACT,&nbsp;R);</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">&nbsp;@pull&nbsp;prior_named_list_gender;&nbsp;@pull&nbsp;prior_named_list;&nbsp;@pull&nbsp;prior_named_noun;</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td"></span></span>
</div><div class='text'>
<h2>About Iterator Functions.</h2><p><p> Suppose <span class="fixed">Iter</span> is an iterator function and that we have a &quot;raw list&quot; $x_1, x_2, ..., x_n$ of objects. Of these, the iterator function will choose a sublist of &quot;qualifying&quot; objects. It is called with arguments<p></p><p> 	|Iter(obj, depth, L, function)|<p></p><p> where the <span class="fixed">obj</span> is required to be $x_j$ for some $j$ and the function is one of the <span class="fixed">*_ITF</span> constants defined below:<p></p><p> (a) On <a href="./ListWriter.i6t.html#line320">START_ITF</a>, we return $x_1$, or <span class="fixed">nothing</span> if the list is empty.<p></p><p> (b) On <a href="./ListWriter.i6t.html#line317">SEEK_ITF</a>, we return the smallest $k\geq j$ such that $x_k$ qualifies, or <span class="fixed">nothing</span> if none of $x_j, x_{j+1}, ..., x_n$ qualify.<p></p><p> (c) On <a href="./ListWriter.i6t.html#line318">ADVANCE_ITF</a>, we return the smallest $k &gt; j$ such that $x_k$ qualifies, or <span class="fixed">nothing</span> if none of $x_{j+1}, x_{j+2} ..., x_n$ qualify.<p></p><p> (d) On <a href="./ListWriter.i6t.html#line319">COALESCE_ITF</a>, we coalesce the entire list (not merely the qualifying entries) and return the new $x_1$, or <span class="fixed">nothing</span> if the list is empty.<p></p><p> Thus, given any $x_i$, we can produce the sublist of qualifying entries by performing <a href="./ListWriter.i6t.html#line320">START_ITF</a> on $x_i$, then <a href="./ListWriter.i6t.html#line317">SEEK_ITF</a>, to produce $q_1$; then <a href="./ListWriter.i6t.html#line318">ADVANCE_ITF</a> to produce $q_2$, and so on until <span class="fixed">nothing</span> is returned, when there are no more qualifying entries. <a href="./ListWriter.i6t.html#line317">SEEK_ITF</a> and <a href="./ListWriter.i6t.html#line318">ADVANCE_ITF</a> always return qualifying objects, or <span class="fixed">nothing</span>; but <a href="./ListWriter.i6t.html#line320">START_ITF</a> and <a href="./ListWriter.i6t.html#line319">COALESCE_ITF</a> may return a non-qualifying object, since there&#39;s no reason why $x_1$ should qualify in any ordering.<p></p><p> The iterator can make its own choice of which entries qualify, and of what the raw list is; <span class="fixed">depth</span> is supplied to help in that decision. But if <span class="fixed">L</span> is non-zero then the iterator is required to disqualify any entry whose <span class="fixed">list_together</span> value is not <span class="fixed">L</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line317">317</span><span class="td">Constant&nbsp;SEEK_ITF&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line318">318</span><span class="td">Constant&nbsp;ADVANCE_ITF&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line319">319</span><span class="td">Constant&nbsp;COALESCE_ITF&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line320">320</span><span class="td">Constant&nbsp;START_ITF&nbsp;=&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line321">321</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line322">322</span><span class="td">!&nbsp;Constant&nbsp;DBLW;&nbsp;!&nbsp;Uncomment&nbsp;this&nbsp;to&nbsp;provide&nbsp;debugging&nbsp;information&nbsp;at&nbsp;run-time</span></span>
<span class="tr"><span class="th" id="line323">323</span><span class="td"></span></span>
</div><div class='text'>
<h2>Marked List Iterator.</h2><p><p> Here the raw list is provided by the <a href="./ListWriter.i6t.html#line151">MarkedObjectArray</a>, which is convenient for coalescing, but not so helpful for translating the <span class="fixed">obj</span> parameter into the $i$ such that it is $x_i$. We simply search from the beginning to do this, which combined with other code using the iterator makes for some unnecessary $O(n^2)$ calculations. But it saves memory and nuisance, and the iterator is used only with printing to the screen, which never needs to be very rapid anyway (because the player can only read very slowly).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line334">334</span><span class="td">[&nbsp;MarkedListIterator&nbsp;obj&nbsp;depth&nbsp;required_lt&nbsp;function&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;nothing)&nbsp;return&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(required_lt&nbsp;==&nbsp;0)&nbsp;required_lt&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;switch(function)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_ITF:&nbsp;return&nbsp;MarkedObjectArray--&gt;0;</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COALESCE_ITF:&nbsp;return&nbsp;MarkedListCoalesce();</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEEK_ITF,&nbsp;ADVANCE_ITF:</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=0:&nbsp;i&lt;MarkedObjectLength:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(MarkedObjectArray--&gt;i&nbsp;==&nbsp;obj)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(function&nbsp;==&nbsp;ADVANCE_ITF)&nbsp;i++;</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(:i&lt;MarkedObjectLength:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;MarkedObjectArray--&gt;i;</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((LT_Compare(required_lt,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LT_Compare(obj.list_together,&nbsp;required_lt)&nbsp;~=&nbsp;0))&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((c_style&nbsp;&amp;&nbsp;WORKFLAG_BIT)&nbsp;&amp;&amp;&nbsp;(depth==0)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;hasnt&nbsp;workflag))</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((c_style&nbsp;&amp;&nbsp;CONCEAL_BIT)&nbsp;&amp;&amp;&nbsp;(ConcealedFromLists(obj)))&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line354">354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line355">355</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line356">356</span><span class="td">&nbsp;return&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line357">357</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line358">358</span><span class="td"></span></span>
</div><div class='text'>
<h2>Concealment.</h2><p><p> This is the definition of concealment used by the list-writer, and means that, for example, the &quot;deciding the concealed possessions&quot; activity is taken into account.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line365">365</span><span class="td">[&nbsp;ConcealedFromLists&nbsp;obj&nbsp;c;</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td">&nbsp;if&nbsp;((obj&nbsp;has&nbsp;concealed)&nbsp;||&nbsp;(obj&nbsp;has&nbsp;scenery))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">&nbsp;c&nbsp;=&nbsp;parent(obj);</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;if&nbsp;((c)&nbsp;&amp;&amp;&nbsp;(c&nbsp;ofclass&nbsp;K5_container&nbsp;or&nbsp;K6_supporter)&nbsp;&amp;&amp;&nbsp;(TestConcealment(c,&nbsp;obj)))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line370">370</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line371">371</span><span class="td"></span></span>
</div><div class='text'>
<h2>Coalesce Marked List.</h2><p><p> The return value is the new first entry in the raw list.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line376">376</span><span class="td">[&nbsp;MarkedListCoalesce&nbsp;o&nbsp;i&nbsp;lt&nbsp;l&nbsp;swap&nbsp;m;</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;for&nbsp;(i=0:&nbsp;i&lt;MarkedObjectLength:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;&nbsp;lt&nbsp;=&nbsp;(MarkedObjectArray--&gt;i).list_together;</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">&nbsp;&nbsp;if&nbsp;(LT_Compare(lt,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Find&nbsp;first&nbsp;object&nbsp;in&nbsp;list&nbsp;after&nbsp;contiguous&nbsp;run&nbsp;with&nbsp;this&nbsp;list_together&nbsp;value:</span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i++:&nbsp;(i&lt;MarkedObjectLength)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line382">382</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(LT_Compare((MarkedObjectArray--&gt;i).list_together,&nbsp;lt)&nbsp;==&nbsp;0):&nbsp;i++)&nbsp;;</span></span>
<span class="tr"><span class="th" id="line383">383</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;contiguous&nbsp;run&nbsp;extends&nbsp;to&nbsp;end&nbsp;of&nbsp;list,&nbsp;the&nbsp;list&nbsp;is&nbsp;now&nbsp;perfect:</span></span>
<span class="tr"><span class="th" id="line384">384</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;MarkedObjectLength)&nbsp;return&nbsp;MarkedObjectArray--&gt;0;</span></span>
<span class="tr"><span class="th" id="line385">385</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;otherwise&nbsp;we&nbsp;look&nbsp;to&nbsp;see&nbsp;if&nbsp;any&nbsp;future&nbsp;entries&nbsp;belong&nbsp;in&nbsp;the&nbsp;earlier&nbsp;run:</span></span>
<span class="tr"><span class="th" id="line386">386</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(l=i+1:&nbsp;l&lt;MarkedObjectLength:&nbsp;l++)</span></span>
<span class="tr"><span class="th" id="line387">387</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LT_Compare((MarkedObjectArray--&gt;l).list_together,&nbsp;lt)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line388">388</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Yes,&nbsp;they&nbsp;do:&nbsp;so&nbsp;we&nbsp;perform&nbsp;a&nbsp;rotation&nbsp;to&nbsp;insert&nbsp;it&nbsp;before&nbsp;element&nbsp;i:</span></span>
<span class="tr"><span class="th" id="line389">389</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;swap&nbsp;=&nbsp;MarkedObjectArray--&gt;l;</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(m=l:&nbsp;m&gt;i:&nbsp;m--)&nbsp;MarkedObjectArray--&gt;m&nbsp;=&nbsp;MarkedObjectArray--&gt;(m-1);</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarkedObjectArray--&gt;i&nbsp;=&nbsp;swap;</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;now&nbsp;the&nbsp;run&nbsp;is&nbsp;longer:</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++;</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;MarkedObjectLength)&nbsp;return&nbsp;MarkedObjectArray--&gt;0;</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;&nbsp;i--;</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;return&nbsp;MarkedObjectArray--&gt;0;</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td"></span></span>
</div><div class='text'>
<h2>Object Tree Iterator.</h2><p><p> Here the raw list is the list of all children of a given parent: since the argument <span class="fixed">obj</span> is required to be a member of the raw list, we can use <span class="fixed">parent(obj)</span> to find it. Now seeking and advancing are fast, but coalescing is slower.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line409">409</span><span class="td">Global&nbsp;list_filter_routine;</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">[&nbsp;ObjectTreeIterator&nbsp;obj&nbsp;depth&nbsp;required_lt&nbsp;function;</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;==&nbsp;nothing)&nbsp;||&nbsp;(parent(obj)&nbsp;==&nbsp;nothing))&nbsp;return&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td">&nbsp;if&nbsp;(function&nbsp;==&nbsp;START_ITF)&nbsp;obj&nbsp;=&nbsp;child(parent(obj));</span></span>
<span class="tr"><span class="th" id="line414">414</span><span class="td">&nbsp;if&nbsp;(function&nbsp;==&nbsp;COALESCE_ITF)&nbsp;return&nbsp;ObjectTreeCoalesce(obj);</span></span>
<span class="tr"><span class="th" id="line415">415</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(function&nbsp;==&nbsp;ADVANCE_ITF)&nbsp;obj&nbsp;=&nbsp;sibling(obj);</span></span>
<span class="tr"><span class="th" id="line416">416</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(required_lt&nbsp;==&nbsp;0)&nbsp;required_lt&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line417">417</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(::&nbsp;obj&nbsp;=&nbsp;sibling(obj))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line418">418</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;nothing)&nbsp;return&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line419">419</span><span class="td">!if&nbsp;(function&nbsp;==&nbsp;ADVANCE_ITF)&nbsp;print&nbsp;&quot;Considering&nbsp;&quot;,&nbsp;(the)&nbsp;obj,&nbsp;&quot;:&nbsp;&quot;,&nbsp;(TEXT_TY_Say)&nbsp;obj.list_together,&nbsp;&quot;:&nbsp;&quot;,&nbsp;(TEXT_TY_Say)&nbsp;required_lt,&nbsp;&quot;:&nbsp;&quot;,&nbsp;&quot;:&nbsp;&quot;,&nbsp;(TEXT_TY_Say)&nbsp;lt_value,&nbsp;&quot;:&nbsp;&quot;,&nbsp;LT_Compare(obj.list_together,&nbsp;required_lt),&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line420">420</span><span class="td">&nbsp;&nbsp;if&nbsp;((LT_Compare(required_lt,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line421">421</span><span class="td">&nbsp;&nbsp;&nbsp;(LT_Compare(obj.list_together,&nbsp;required_lt)&nbsp;~=&nbsp;0))&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line422">422</span><span class="td">&nbsp;&nbsp;if&nbsp;((c_style&nbsp;&amp;&nbsp;WORKFLAG_BIT)&nbsp;&amp;&amp;&nbsp;(depth==0)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;hasnt&nbsp;workflag))&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line423">423</span><span class="td">&nbsp;&nbsp;if&nbsp;(obj&nbsp;hasnt&nbsp;list_filter_permits)&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line424">424</span><span class="td">&nbsp;&nbsp;if&nbsp;((c_style&nbsp;&amp;&nbsp;CONCEAL_BIT)&nbsp;&amp;&amp;&nbsp;(ConcealedFromLists(obj)))&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line425">425</span><span class="td">&nbsp;&nbsp;return&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line426">426</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line427">427</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line428">428</span><span class="td"></span></span>
</div><div class='text'>
<h2>Coalesce Object Tree.</h2><p><p> Again, the return value is the new first entry in the raw list.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line433">433</span><span class="td">[&nbsp;ObjectTreeCoalesce&nbsp;obj&nbsp;memb&nbsp;lt&nbsp;later;</span></span>
<span class="tr"><span class="th" id="line434">434</span><span class="td">&nbsp;#Ifdef&nbsp;DBLW;&nbsp;print&nbsp;&quot;^^Sorting&nbsp;out:&nbsp;&quot;;&nbsp;DiagnoseSortList(obj);&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line435">435</span><span class="td">&nbsp;.StartAgain;</span></span>
<span class="tr"><span class="th" id="line436">436</span><span class="td">&nbsp;for&nbsp;(memb=obj:&nbsp;memb~=nothing:&nbsp;memb=sibling(memb))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line437">437</span><span class="td">&nbsp;&nbsp;lt&nbsp;=&nbsp;memb.list_together;</span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;&nbsp;if&nbsp;(LT_Compare(lt,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Find&nbsp;first&nbsp;object&nbsp;in&nbsp;list&nbsp;after&nbsp;contiguous&nbsp;run&nbsp;with&nbsp;this&nbsp;list_together&nbsp;value:</span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(memb=sibling(memb):</span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(memb)&nbsp;&amp;&amp;&nbsp;(LT_Compare(memb.list_together,&nbsp;lt)&nbsp;==&nbsp;0):&nbsp;memb&nbsp;=&nbsp;sibling(memb))&nbsp;;</span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;contiguous&nbsp;run&nbsp;extends&nbsp;to&nbsp;end&nbsp;of&nbsp;list,&nbsp;the&nbsp;list&nbsp;is&nbsp;now&nbsp;perfect:</span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(memb&nbsp;==&nbsp;0)&nbsp;return&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line444">444</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;otherwise&nbsp;we&nbsp;look&nbsp;to&nbsp;see&nbsp;if&nbsp;any&nbsp;future&nbsp;entries&nbsp;belong&nbsp;in&nbsp;the&nbsp;earlier&nbsp;run:</span></span>
<span class="tr"><span class="th" id="line445">445</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(later=sibling(memb):&nbsp;later:&nbsp;later=sibling(later))</span></span>
<span class="tr"><span class="th" id="line446">446</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LT_Compare(later.list_together,&nbsp;lt)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line447">447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Yes,&nbsp;they&nbsp;do:&nbsp;so&nbsp;we&nbsp;perform&nbsp;a&nbsp;regrouping&nbsp;of&nbsp;the&nbsp;list&nbsp;and&nbsp;start&nbsp;again:</span></span>
<span class="tr"><span class="th" id="line448">448</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;GroupChildren(parent(obj),&nbsp;lt);</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DBLW;&nbsp;print&nbsp;&quot;^^Sorted&nbsp;to:&nbsp;&quot;;&nbsp;DiagnoseSortList(obj);&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./ListWriter.i6t.html#line435">StartAgain</a>;</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">&nbsp;return&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">#Ifdef&nbsp;DBLW;</span></span>
<span class="tr"><span class="th" id="line457">457</span><span class="td">[&nbsp;DiagnoseSortList&nbsp;obj&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line458">458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(memb=child(obj):&nbsp;memb~=nothing:&nbsp;memb=sibling(memb))&nbsp;print&nbsp;memb,&nbsp;&quot;&nbsp;--&gt;&nbsp;&quot;;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line459">459</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line460">460</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td"></span></span>
</div><div class='text'>
<h2>WriteListFrom.</h2><p><p> And here we go at last. Or at any rate we initialise the quartet of global variables detailing the current list-writing process, and begin.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line467">467</span><span class="td">[&nbsp;WriteListFrom&nbsp;first&nbsp;style&nbsp;depth&nbsp;noactivity&nbsp;iter&nbsp;a&nbsp;ol;</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;@push&nbsp;c_iterator;&nbsp;@push&nbsp;c_style;&nbsp;@push&nbsp;c_depth;&nbsp;@push&nbsp;c_margin;</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(iter)&nbsp;c_iterator&nbsp;=&nbsp;iter;&nbsp;else&nbsp;c_iterator&nbsp;=&nbsp;ObjectTreeIterator;</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;c_style&nbsp;=&nbsp;style;&nbsp;c_depth&nbsp;=&nbsp;depth;</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;c_margin&nbsp;=&nbsp;0;&nbsp;if&nbsp;(style&nbsp;&amp;&nbsp;EXTRAINDENT_BIT)&nbsp;c_margin&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;objectloop&nbsp;(a&nbsp;ofclass&nbsp;Object)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;&nbsp;give&nbsp;a&nbsp;list_filter_permits;</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td">&nbsp;&nbsp;if&nbsp;((list_filter_routine)&nbsp;&amp;&amp;&nbsp;(list_filter_routine(a)&nbsp;==&nbsp;false))</span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;&nbsp;give&nbsp;a&nbsp;~list_filter_permits;</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line478">478</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line479">479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;=&nbsp;c_iterator(first,&nbsp;depth,&nbsp;0,&nbsp;START_ITF);</span></span>
<span class="tr"><span class="th" id="line480">480</span><span class="td">&nbsp;if&nbsp;(first&nbsp;==&nbsp;nothing)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line481">481</span><span class="td">&nbsp;&nbsp;if&nbsp;(style&nbsp;&amp;&nbsp;ISARE_BIT&nbsp;~=&nbsp;0)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;W&#39;);</span></span>
<span class="tr"><span class="th" id="line482">482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;LIST_WRITER_INTERNAL_RM(&#39;Y&#39;);</span></span>
<span class="tr"><span class="th" id="line483">483</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(style&nbsp;&amp;&nbsp;NEWLINE_BIT&nbsp;~=&nbsp;0)&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line484">484</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line485">485</span><span class="td">&nbsp;&nbsp;if&nbsp;((noactivity)&nbsp;||&nbsp;(iter))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line486">486</span><span class="td">&nbsp;&nbsp;&nbsp;WriteListR(first,&nbsp;c_depth,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line487">487</span><span class="td">&nbsp;&nbsp;&nbsp;say__p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line488">488</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line489">489</span><span class="td">&nbsp;&nbsp;&nbsp;objectloop&nbsp;(ol&nbsp;provides&nbsp;list_together)</span></span>
<span class="tr"><span class="th" id="line490">490</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BlkValueCopy(ol.list_together,&nbsp;EMPTY_TEXT_VALUE);</span></span>
<span class="tr"><span class="th" id="line491">491</span><span class="td">&nbsp;&nbsp;&nbsp;CarryOutActivity(LISTING_CONTENTS_ACT,&nbsp;parent(first));</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line494">494</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line495">495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;c_margin;&nbsp;@pull&nbsp;c_depth;&nbsp;@pull&nbsp;c_style;&nbsp;@pull&nbsp;c_iterator;</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line497">497</span><span class="td"></span></span>
</div><div class='text'>
<h2>Standard Contents Listing Rule.</h2><p><p> The default for the listing contents activity is to call this rule in its &quot;for&quot; stage: note that this suppresses the use of the activity, to avoid an infinite regress. The activity is used only for the default <a href="./ListWriter.i6t.html#line411">ObjectTreeIterator</a>, so there is no need to specify which is used.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line505">505</span><span class="td">[&nbsp;STANDARD_CONTENTS_LISTING_R;</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td">&nbsp;WriteListFrom(child(parameter_value),&nbsp;c_style,&nbsp;c_depth,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td"></span></span>
</div><div class='text'>
<h2>Partitioning.</h2><p><p> Given qualifying objects $x_1, ..., x_j$, we partition them into classes of the equivalence relation $x_i\sim x_j$ if and only <p></p><p> (i) they both have a <span class="fixed">plural</span> property (not necessarily the same), and (ii) neither will cause the list-maker to recurse downwards to show the objects inside or on top of them, and (iii) if they cause the list-maker to add information about whether they are worn, lighted or open, then it will add the same information about both, and (iv) they are considered identical by the parser, in that they respond to the same syntaxes of name: so that it is impossible to find a TAKE X command such that X matches one and not the other.<p></p><p> The equivalence classes are numbered consecutively upwards from 1 to $n$, in order of first appearance in the list. For each object $x_i$, <span class="fixed">partition_classes-&gt;(i-1)</span> is the number of its equivalence class. For each equivalence class number $c$, <span class="fixed">partition_class_sizes-&gt;c</span> is the number of objects in this class.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line529">529</span><span class="td">#Ifdef&nbsp;DBLW;</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">Global&nbsp;DBLW_no_classes;&nbsp;Global&nbsp;DBLW_no_objs;</span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">[&nbsp;DebugPartition&nbsp;partition_class_sizes&nbsp;partition_classes&nbsp;first&nbsp;depth&nbsp;i&nbsp;k&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">&nbsp;print&nbsp;&quot;[Length&nbsp;of&nbsp;list&nbsp;is&nbsp;&quot;,&nbsp;DBLW_no_objs,&nbsp;&quot;&nbsp;with&nbsp;&quot;,&nbsp;k,&nbsp;&quot;&nbsp;plural.]^&quot;;</span></span>
<span class="tr"><span class="th" id="line533">533</span><span class="td">&nbsp;print&nbsp;&quot;[Partitioned&nbsp;into&nbsp;&quot;,&nbsp;DBLW_no_classes,&nbsp;&quot;&nbsp;equivalence&nbsp;classes.]^&quot;;</span></span>
<span class="tr"><span class="th" id="line534">534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=1:&nbsp;i&lt;=DBLW_no_classes&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line535">535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Class&nbsp;&quot;,&nbsp;i,&nbsp;&quot;&nbsp;has&nbsp;size&nbsp;&quot;,&nbsp;partition_class_sizes-&gt;i,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line536">536</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line537">537</span><span class="td">&nbsp;for&nbsp;(k=0,&nbsp;o=first:&nbsp;k&lt;DBLW_no_objs&nbsp;:&nbsp;k++,&nbsp;o&nbsp;=&nbsp;c_iterator(o,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line538">538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Entry&nbsp;&quot;,&nbsp;k,&nbsp;&quot;&nbsp;has&nbsp;class&nbsp;&quot;,&nbsp;partition_classes-&gt;k,</span></span>
<span class="tr"><span class="th" id="line539">539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;represented&nbsp;by&nbsp;&quot;,&nbsp;o,&nbsp;&quot;&nbsp;with&nbsp;L=&quot;,&nbsp;o.list_together,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td"></span></span>
</div><div class='text'>
<h2>Partition List.</h2><p><p> The following creates the <span class="fixed">partition_classes</span> and <span class="fixed">partition_class_sizes</span> accordingly. We return $n$, the number of classes.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line549">549</span><span class="td">[&nbsp;PartitionList&nbsp;first&nbsp;no_objs&nbsp;depth&nbsp;partition_classes&nbsp;partition_class_sizes</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;i&nbsp;k&nbsp;l&nbsp;n&nbsp;m;</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0:&nbsp;i&lt;no_objs:&nbsp;i++)&nbsp;partition_classes-&gt;i&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=first,&nbsp;k=0:&nbsp;k&lt;no_objs:&nbsp;i=c_iterator(i,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF),&nbsp;k++)</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(partition_classes-&gt;k&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partition_classes-&gt;k&nbsp;=&nbsp;n;&nbsp;partition_class_sizes-&gt;n&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(l=c_iterator(i,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF),&nbsp;m=k+1:</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(l~=0)&nbsp;&amp;&amp;&nbsp;(m&lt;no_objs):</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l=c_iterator(l,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF),&nbsp;m++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((partition_classes-&gt;m&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(ListEqual(i,&nbsp;l)))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(partition_class_sizes-&gt;n&nbsp;&lt;&nbsp;255)&nbsp;(partition_class_sizes-&gt;n)++;</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partition_classes-&gt;m&nbsp;=&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;&lt;&nbsp;255)&nbsp;n++;</span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;n--;</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;#Ifdef&nbsp;DBLW;</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;DBLW_no_classes&nbsp;=&nbsp;n;&nbsp;DBLW_no_objs&nbsp;=&nbsp;no_objs;</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">&nbsp;DebugPartition(partition_class_sizes,&nbsp;partition_classes,&nbsp;first,&nbsp;depth);</span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td"></span></span>
</div><div class='text'>
<h2>Equivalence Relation.</h2><p><p> The above algorithm will fail unless <a href="./ListWriter.i6t.html#line581">ListEqual</a> is indeed reflexive, symmetric and transitive, which ultimately depends on the care with which <a href="./Parser.i6t.html#line3001">Identical</a> is implemented, which in turn hangs on the <span class="fixed">parse_noun</span> properties compiled by NI. But this seems to be sound.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line581">581</span><span class="td">[&nbsp;ListEqual&nbsp;o1&nbsp;o2;</span></span>
<span class="tr"><span class="th" id="line582">582</span><span class="td">&nbsp;if&nbsp;((o1.plural&nbsp;==&nbsp;0)&nbsp;||&nbsp;(o2.plural&nbsp;==&nbsp;0))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line583">583</span><span class="td">&nbsp;&nbsp;if&nbsp;(child(o1)&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;WillRecurs(o1)&nbsp;~=&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line584">584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(child(o2)&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;WillRecurs(o2)&nbsp;~=&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line585">585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;(FULLINV_BIT&nbsp;+&nbsp;PARTINV_BIT)&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line586">586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((o1&nbsp;hasnt&nbsp;worn&nbsp;&amp;&amp;&nbsp;o2&nbsp;has&nbsp;worn)&nbsp;||&nbsp;(o2&nbsp;hasnt&nbsp;worn&nbsp;&amp;&amp;&nbsp;o1&nbsp;has&nbsp;worn))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line587">587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((o1&nbsp;hasnt&nbsp;light&nbsp;&amp;&amp;&nbsp;o2&nbsp;has&nbsp;light)&nbsp;||&nbsp;(o2&nbsp;hasnt&nbsp;light&nbsp;&amp;&amp;&nbsp;o1&nbsp;has&nbsp;light))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line588">588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o1&nbsp;has&nbsp;container)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line589">589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o2&nbsp;hasnt&nbsp;container)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line590">590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((o1&nbsp;has&nbsp;open&nbsp;&amp;&amp;&nbsp;o2&nbsp;hasnt&nbsp;open)&nbsp;||&nbsp;(o2&nbsp;has&nbsp;open&nbsp;&amp;&amp;&nbsp;o1&nbsp;hasnt&nbsp;open))</span></span>
<span class="tr"><span class="th" id="line591">591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line592">592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line593">593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(o2&nbsp;has&nbsp;container)</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line596">596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Identical(o1,&nbsp;o2);</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">[&nbsp;WillRecurs&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ALWAYS_BIT&nbsp;~=&nbsp;0)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;RECURSE_BIT&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((o&nbsp;has&nbsp;supporter)&nbsp;||&nbsp;((o&nbsp;has&nbsp;container)&nbsp;&amp;&amp;&nbsp;(o&nbsp;has&nbsp;open&nbsp;or&nbsp;transparent)))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td"></span></span>
</div><div class='text'>
<h2>Grouping.</h2><p><p> A &quot;group&quot; is a maximally-sized run of one or more adjacent partition classes in the list whose first members have a common value of <span class="fixed">list_together</span> which is a routine or string, and which is not equal to <a href="./Output.i6t.html#line321">lt_value</a>, the current grouping value. (As we see below, it&#39;s by setting <a href="./Output.i6t.html#line321">lt_value</a> that we restrict attention to a particular group: if we reacted to that as a <span class="fixed">list_together</span> value here, then we would simply go around in circles, and never be able to see the individual objects in the group.)<p></p><p> For instance, suppose we have objects with <span class="fixed">list_together</span> values as follows, where $R_1$ and $R_2$ are addresses of routines:<p></p><p> 	<span class="fixed">coin</span> ($R_1$), <span class="fixed">coin</span> ($R_1$), <span class="fixed">box</span> ($R_2$), <span class="fixed">statuette</span> (0), <span class="fixed">coin</span> ($R_1$), <span class="fixed">box</span> ($R_2$)<p></p><p> Then the partition is 1, 1, 2, 3, 1, 2, so that the final output will be something like &quot;three coins, two boxes and a statuette&quot; &ndash; with three grouped terms. Here each partition class is the only member in its group, so the number of groups is the same as the number of classes. (The above list is not coalesced, so the $R_1$ values, for instance, are not contiguous: we need to work in general with non-coalesced lists because not every iterator function will be able to coalesce fully.)<p></p><p> But if we have something like this:<p></p><p> 	<span class="fixed">coin</span> ($R_1$), <span class="fixed">Q</span> ($R_2$), <span class="fixed">W</span> ($R_2$), <span class="fixed">coin</span> ($R_1$), <span class="fixed">statuette</span> (0), <span class="fixed">E</span> ($R_2$), <span class="fixed">R</span> ($R_2$)<p></p><p> then the partition is 1, 2, 3, 1, 4, 5, 6 and we have six classes in all. But classes 2 and 3 are grouped together, as are classes 5 and 6, so we end up with a list having just four groups: &quot;two coins, the letters Q and W from a Scrabble set, a statuette and the letters E and R from a Scrabble set&quot;. (Again, this list has not been fully coalesced: if it had been, it would be reordered <span class="fixed">coin</span>, <span class="fixed">coin</span>, <span class="fixed">Q</span>, <span class="fixed">W</span>, <span class="fixed">E</span>, <span class="fixed">R</span>, <span class="fixed">statuette</span>, with partition 1, 1, 2, 3, 4, 5, 6, and three groups: &quot;two coins, the letters Q, W, E and R from a Scrabble set and a statuette&quot;.)<p></p><p> The reason we do not group together classes with a common non-zero <span class="fixed">list_together</span> which is <strong> not</strong> a routine or string is that low values of <span class="fixed">list_together</span> are used in coalescing the list into a pleasing order (say, moving all of the key-like items together) but not in grouping: see <span class="fixed">list_together</span> in the <strong> Inform Designer&#39;s Manual</strong>, 4th edition.<p></p><p> We calculate the number of groups by starting with the number of classes and then subtracting one each time two adjacent classes share <span class="fixed">list_together</span> in the above sense.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line652">652</span><span class="td">[&nbsp;NumberOfGroupsInList&nbsp;o&nbsp;no_classes&nbsp;depth&nbsp;partition_classes&nbsp;partition_class_sizes</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;no_groups&nbsp;cl&nbsp;memb&nbsp;k&nbsp;current_lt&nbsp;lt;</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;current_lt&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">&nbsp;lt&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line656">656</span><span class="td">&nbsp;no_groups&nbsp;=&nbsp;no_classes;</span></span>
<span class="tr"><span class="th" id="line657">657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(cl=1,&nbsp;memb=o,&nbsp;k=0:&nbsp;cl&lt;=no_classes:&nbsp;cl++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line658">658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Advance&nbsp;to&nbsp;first&nbsp;member&nbsp;of&nbsp;class&nbsp;number&nbsp;cl</span></span>
<span class="tr"><span class="th" id="line659">659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(partition_classes-&gt;k&nbsp;~=&nbsp;cl)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line660">660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k++;&nbsp;memb&nbsp;=&nbsp;c_iterator(memb,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF);</span></span>
<span class="tr"><span class="th" id="line661">661</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(memb)&nbsp;{&nbsp;!&nbsp;In&nbsp;case&nbsp;of&nbsp;accidents,&nbsp;but&nbsp;should&nbsp;always&nbsp;happen</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt&nbsp;=&nbsp;memb.list_together;</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((LT_Compare(lt,&nbsp;lt_value)&nbsp;~=&nbsp;0)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LT_Compare(lt,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LT_Compare(lt,&nbsp;current_lt)&nbsp;==&nbsp;0))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_groups--;</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_lt&nbsp;=&nbsp;lt;</span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line671">671</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line672">672</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;DBLW;&nbsp;print&nbsp;&quot;[There&nbsp;are&nbsp;&quot;,&nbsp;no_groups,&nbsp;&quot;&nbsp;groups.]^&quot;;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">&nbsp;return&nbsp;no_groups;</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">[&nbsp;LT_Compare&nbsp;lt1&nbsp;lt2;</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td">&nbsp;if&nbsp;(lt1&nbsp;==&nbsp;lt2)&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;if&nbsp;(lt1&nbsp;==&nbsp;0)&nbsp;lt1&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;if&nbsp;(lt2&nbsp;==&nbsp;0)&nbsp;lt2&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;if&nbsp;(TEXT_TY_IsSubstituted(lt1)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_IsSubstituted(lt2)&nbsp;==&nbsp;false)&nbsp;return&nbsp;(lt1--&gt;1)-(lt2--&gt;1);</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;if&nbsp;(TEXT_TY_IsSubstituted(lt2)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td">&nbsp;return&nbsp;BlkValueCompare(lt1,&nbsp;lt2);</span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td"></span></span>
</div><div class='text'>
<h2>Write List Recursively.</h2><p><p> The big one: <a href="./ListWriter.i6t.html#line694">WriteListR</a> is the heart of the list-writer.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line694">694</span><span class="td">[&nbsp;WriteListR&nbsp;o&nbsp;depth&nbsp;from_start</span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;partition_classes&nbsp;partition_class_sizes</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;cl&nbsp;memb&nbsp;index&nbsp;k2&nbsp;l&nbsp;m&nbsp;no_classes&nbsp;q&nbsp;groups_to_do&nbsp;current_lt;</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;nothing)&nbsp;return;&nbsp;!&nbsp;An&nbsp;empty&nbsp;list:&nbsp;no&nbsp;output</span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(from_start)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;c_iterator(o,&nbsp;depth,&nbsp;0,&nbsp;COALESCE_ITF);&nbsp;!&nbsp;Coalesce&nbsp;list&nbsp;and&nbsp;choose&nbsp;new&nbsp;start</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;c_iterator(o,&nbsp;depth,&nbsp;0,&nbsp;SEEK_ITF);&nbsp;!&nbsp;Find&nbsp;first&nbsp;entry&nbsp;in&nbsp;list&nbsp;from&nbsp;o</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;nothing)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;!&nbsp;Count&nbsp;index&nbsp;=&nbsp;length&nbsp;of&nbsp;list</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(memb=o,&nbsp;index=0:&nbsp;memb:&nbsp;memb=c_iterator(memb,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF))&nbsp;index++;</span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ISARE_BIT&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetLWI(index,&nbsp;-1,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;V&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;NEWLINE_BIT&nbsp;~=&nbsp;0)&nbsp;&nbsp;&nbsp;print&nbsp;&quot;:^&quot;;</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(char)&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_style&nbsp;=&nbsp;c_style&nbsp;-&nbsp;ISARE_BIT;</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;partition_classes&nbsp;=&nbsp;RequisitionStack(index/WORDSIZE&nbsp;+&nbsp;2);</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;partition_class_sizes&nbsp;=&nbsp;RequisitionStack(index/WORDSIZE&nbsp;+&nbsp;2);</span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((partition_classes&nbsp;==&nbsp;0)&nbsp;||&nbsp;(partition_class_sizes&nbsp;==&nbsp;0))</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;RunTimeProblem(RTP_LISTWRITERMEMORY);</span></span>
<span class="tr"><span class="th" id="line720">720</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line721">721</span><span class="td">&nbsp;no_classes&nbsp;=</span></span>
<span class="tr"><span class="th" id="line722">722</span><span class="td">&nbsp;&nbsp;PartitionList(o,&nbsp;index,&nbsp;depth,&nbsp;partition_classes,&nbsp;partition_class_sizes);</span></span>
<span class="tr"><span class="th" id="line723">723</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line724">724</span><span class="td">&nbsp;groups_to_do&nbsp;=</span></span>
<span class="tr"><span class="th" id="line725">725</span><span class="td">&nbsp;&nbsp;NumberOfGroupsInList(o,&nbsp;no_classes,&nbsp;depth,&nbsp;partition_classes,&nbsp;partition_class_sizes);</span></span>
<span class="tr"><span class="th" id="line726">726</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(cl=1,&nbsp;memb=o,&nbsp;index=0,&nbsp;current_lt=EMPTY_TEXT_VALUE:&nbsp;groups_to_do&gt;0:&nbsp;cl++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">&nbsp;&nbsp;!&nbsp;Set&nbsp;memb&nbsp;to&nbsp;first&nbsp;object&nbsp;of&nbsp;partition&nbsp;class&nbsp;cl</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(partition_classes-&gt;index&nbsp;~=&nbsp;cl)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index++;&nbsp;memb=c_iterator(memb,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF);</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(memb==0)&nbsp;{&nbsp;print&nbsp;&quot;***&nbsp;Error&nbsp;in&nbsp;list-writer&nbsp;***^&quot;;&nbsp;return;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DBLW;</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;&nbsp;!&nbsp;DebugPartition(partition_class_sizes,&nbsp;partition_classes,&nbsp;o,&nbsp;depth);</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;^[Class&nbsp;&quot;,&nbsp;cl,&nbsp;&quot;&nbsp;of&nbsp;&quot;,&nbsp;no_classes,&nbsp;&quot;:&nbsp;first&nbsp;object&nbsp;&quot;,&nbsp;memb,</span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;&nbsp;&nbsp;&quot;&nbsp;(&quot;,&nbsp;memb.list_together,&nbsp;&quot;);&nbsp;groups_to_do&nbsp;&quot;,&nbsp;groups_to_do,&nbsp;&quot;,</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td">&nbsp;&nbsp;&nbsp;current_lt=&quot;,&nbsp;current_lt,&nbsp;&quot;&nbsp;listing_size=&quot;,&nbsp;listing_size,</span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">&nbsp;&nbsp;&nbsp;&quot;&nbsp;lt_value=&quot;,&nbsp;lt_value,&nbsp;&quot;&nbsp;memb.list_together=&quot;,&nbsp;memb.list_together,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;&nbsp;if&nbsp;((LT_Compare(memb.list_together,&nbsp;lt_value)&nbsp;==&nbsp;0)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LT_Compare(memb.list_together,&nbsp;EMPTY_TEXT_VALUE)&nbsp;==&nbsp;0))&nbsp;current_lt&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LT_Compare(memb.list_together,&nbsp;current_lt)&nbsp;==&nbsp;0)&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Otherwise&nbsp;this&nbsp;class&nbsp;begins&nbsp;a&nbsp;new&nbsp;group</span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push&nbsp;listing_size;</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;q&nbsp;=&nbsp;memb;&nbsp;listing_size&nbsp;=&nbsp;1;&nbsp;l&nbsp;=&nbsp;index;&nbsp;m&nbsp;=&nbsp;cl;</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;&nbsp;&nbsp;while&nbsp;(m&nbsp;&lt;&nbsp;no_classes&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(LT_Compare(q.list_together,&nbsp;memb.list_together)&nbsp;==&nbsp;0))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;m++;</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(partition_classes-&gt;l&nbsp;~=&nbsp;m)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l++;&nbsp;q&nbsp;=&nbsp;c_iterator(q,&nbsp;depth,&nbsp;lt_value,&nbsp;ADVANCE_ITF);</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LT_Compare(q.list_together,&nbsp;memb.list_together)&nbsp;==&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listing_size++;</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(listing_size&nbsp;&gt;&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;new&nbsp;group&nbsp;contains&nbsp;more&nbsp;than&nbsp;one&nbsp;partition&nbsp;class</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;WriteMultiClassGroup(cl,&nbsp;memb,&nbsp;depth,&nbsp;partition_class_sizes);</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;current_lt&nbsp;=&nbsp;memb.list_together;</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./ListWriter.i6t.html#line772">GroupComplete</a>;</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line766">766</span><span class="td">&nbsp;&nbsp;&nbsp;current_lt&nbsp;=&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line767">767</span><span class="td">&nbsp;&nbsp;&nbsp;@pull&nbsp;listing_size;</span></span>
<span class="tr"><span class="th" id="line768">768</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line769">769</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line770">770</span><span class="td">&nbsp;&nbsp;WriteSingleClassGroup(cl,&nbsp;memb,&nbsp;depth,&nbsp;partition_class_sizes-&gt;cl);</span></span>
<span class="tr"><span class="th" id="line771">771</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line772">772</span><span class="td">&nbsp;&nbsp;.GroupComplete;</span></span>
<span class="tr"><span class="th" id="line773">773</span><span class="td">&nbsp;&nbsp;groups_to_do--;</span></span>
<span class="tr"><span class="th" id="line774">774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ENGLISH_BIT&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line775">775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(groups_to_do&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line776">776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ifdef&nbsp;SERIAL_COMMA;&nbsp;if&nbsp;(cl&nbsp;&gt;&nbsp;1)&nbsp;print&nbsp;&quot;,&quot;;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line777">777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;C&#39;);</span></span>
<span class="tr"><span class="th" id="line778">778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line779">779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(groups_to_do&nbsp;&gt;&nbsp;1)&nbsp;print&nbsp;&quot;,&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line780">780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line781">781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line782">782</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line783">783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;FreeStack(partition_class_sizes);</span></span>
<span class="tr"><span class="th" id="line784">784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;FreeStack(partition_classes);</span></span>
<span class="tr"><span class="th" id="line785">785</span><span class="td">];&nbsp;!&nbsp;end&nbsp;of&nbsp;WriteListR</span></span>
<span class="tr"><span class="th" id="line786">786</span><span class="td"></span></span>
</div><div class='text'>
<h2>Write Multiple Class Group.</h2><p><p> The text of a single group which contains more than one partition class. We carry out the &quot;grouping together&quot; activity, so that the user can add text fore and aft &ndash; this is how groups of objects such as &quot;X, Y and Z&quot; can be fluffed up to &quot;the letters X, Y and Z from a Scrabble set&quot; &ndash; but the default is simple: we print the grouped items by calling <a href="./ListWriter.i6t.html#line694">WriteListR</a> once again, but this time starting from X, and where <a href="./Output.i6t.html#line321">lt_value</a> is set to the common <span class="fixed">list_together</span> value of X, Y and Z. (That restricts the list to just the objects in this group.) Because <a href="./Output.i6t.html#line321">lt_value</a> is set to this value, the grouping code won&#39;t then group X, Y and Z again, and they will instead be individual classes in the new list &ndash; so each will end up being sent, in turn, to <a href="./ListWriter.i6t.html#line867">WriteSingleClassGroup</a> below, and <strong> that</strong> is where they are printed.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line802">802</span><span class="td">[&nbsp;WriteMultiClassGroup&nbsp;cl&nbsp;memb&nbsp;depth&nbsp;partition_class_sizes&nbsp;pv&nbsp;q&nbsp;k2&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line803">803</span><span class="td">&nbsp;!&nbsp;Save&nbsp;the&nbsp;style,&nbsp;because&nbsp;the&nbsp;activity&nbsp;below&nbsp;is&nbsp;allowed&nbsp;to&nbsp;change&nbsp;it</span></span>
<span class="tr"><span class="th" id="line804">804</span><span class="td">&nbsp;q&nbsp;=&nbsp;c_style;</span></span>
<span class="tr"><span class="th" id="line805">805</span><span class="td">&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;INDENT_BIT&nbsp;~=&nbsp;0)&nbsp;PrintSpaces(2*(depth+c_margin));</span></span>
<span class="tr"><span class="th" id="line806">806</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line807">807</span><span class="td">&nbsp;BeginActivity(GROUPING_TOGETHER_ACT,&nbsp;memb);</span></span>
<span class="tr"><span class="th" id="line808">808</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line809">809</span><span class="td">&nbsp;if&nbsp;(ForActivity(GROUPING_TOGETHER_ACT,&nbsp;memb))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line810">810</span><span class="td">&nbsp;&nbsp;c_style&nbsp;=&nbsp;c_style&nbsp;&amp;~&nbsp;NEWLINE_BIT;</span></span>
<span class="tr"><span class="th" id="line811">811</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line812">812</span><span class="td">&nbsp;&nbsp;pv&nbsp;=&nbsp;memb.list_together;</span></span>
<span class="tr"><span class="th" id="line813">813</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_IsSubstituted(pv)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line814">814</span><span class="td">&nbsp;&nbsp;&nbsp;inventory_stage&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line815">815</span><span class="td">&nbsp;&nbsp;&nbsp;parser_one&nbsp;=&nbsp;memb;&nbsp;parser_two&nbsp;=&nbsp;depth&nbsp;+&nbsp;c_margin;</span></span>
<span class="tr"><span class="th" id="line816">816</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((pv--&gt;1)()&nbsp;==&nbsp;1)&nbsp;jump&nbsp;<a href="./ListWriter.i6t.html#line847">Omit__Sublist2</a>;</span></span>
<span class="tr"><span class="th" id="line817">817</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(pv)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line818">818</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Set&nbsp;k2&nbsp;to&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;covered&nbsp;by&nbsp;the&nbsp;group</span></span>
<span class="tr"><span class="th" id="line819">819</span><span class="td">&nbsp;&nbsp;&nbsp;k2&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line820">820</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(l=0&nbsp;:&nbsp;l&lt;listing_size&nbsp;:&nbsp;l++)&nbsp;k2&nbsp;=&nbsp;k2&nbsp;+&nbsp;partition_class_sizes-&gt;(l+cl);</span></span>
<span class="tr"><span class="th" id="line821">821</span><span class="td">&nbsp;&nbsp;&nbsp;EnglishNumber(k2);&nbsp;print&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line822">822</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;(TEXT_TY_Say)&nbsp;pv;</span></span>
<span class="tr"><span class="th" id="line823">823</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ENGLISH_BIT&nbsp;~=&nbsp;0)&nbsp;print&nbsp;&quot;&nbsp;(&quot;;</span></span>
<span class="tr"><span class="th" id="line824">824</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;INDENT_BIT&nbsp;~=&nbsp;0)&nbsp;&nbsp;print&nbsp;&quot;:^&quot;;</span></span>
<span class="tr"><span class="th" id="line825">825</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line826">826</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line827">827</span><span class="td">&nbsp;&nbsp;c_margin++;</span></span>
<span class="tr"><span class="th" id="line828">828</span><span class="td">&nbsp;&nbsp;@push&nbsp;lt_value;&nbsp;@push&nbsp;listing_together;&nbsp;@push&nbsp;listing_size;</span></span>
<span class="tr"><span class="th" id="line829">829</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line830">830</span><span class="td">&nbsp;&nbsp;lt_value&nbsp;=&nbsp;memb.list_together;&nbsp;listing_together&nbsp;=&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line831">831</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;DBLW;&nbsp;print&nbsp;&quot;^^DOWN&nbsp;lt_value&nbsp;=&nbsp;&quot;,&nbsp;lt_value,&nbsp;&quot;&nbsp;listing_together&nbsp;=&nbsp;&quot;,&nbsp;memb,&nbsp;&quot;^^&quot;;</span></span>
<span class="tr"><span class="th" id="line832">832</span><span class="td">&nbsp;&nbsp;@push&nbsp;DBLW_no_classes;&nbsp;@push&nbsp;DBLW_no_objs;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line833">833</span><span class="td">&nbsp;&nbsp;WriteListR(memb,&nbsp;depth,&nbsp;false);&nbsp;</span></span>
<span class="tr"><span class="th" id="line834">834</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;DBLW;&nbsp;print&nbsp;&quot;^^UP^^&quot;;&nbsp;@pull&nbsp;DBLW_no_objs;&nbsp;@pull&nbsp;DBLW_no_classes;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line835">835</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line836">836</span><span class="td">&nbsp;&nbsp;@pull&nbsp;listing_size;&nbsp;@pull&nbsp;listing_together;&nbsp;@pull&nbsp;lt_value;</span></span>
<span class="tr"><span class="th" id="line837">837</span><span class="td">&nbsp;&nbsp;c_margin--;</span></span>
<span class="tr"><span class="th" id="line838">838</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line839">839</span><span class="td">&nbsp;&nbsp;pv&nbsp;=&nbsp;memb.list_together;</span></span>
<span class="tr"><span class="th" id="line840">840</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_IsSubstituted(pv)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line841">841</span><span class="td">&nbsp;&nbsp;&nbsp;inventory_stage&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line842">842</span><span class="td">&nbsp;&nbsp;&nbsp;parser_one&nbsp;=&nbsp;memb;&nbsp;parser_two&nbsp;=&nbsp;depth+c_margin;</span></span>
<span class="tr"><span class="th" id="line843">843</span><span class="td">&nbsp;&nbsp;&nbsp;(pv--&gt;1)();</span></span>
<span class="tr"><span class="th" id="line844">844</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;if&nbsp;(LT_Compare(pv,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line845">845</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(q&nbsp;&amp;&nbsp;ENGLISH_BIT&nbsp;~=&nbsp;0)&nbsp;print&nbsp;&quot;)&quot;;</span></span>
<span class="tr"><span class="th" id="line846">846</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line847">847</span><span class="td">&nbsp;&nbsp;.Omit__Sublist2;</span></span>
<span class="tr"><span class="th" id="line848">848</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line849">849</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line850">850</span><span class="td">&nbsp;EndActivity(GROUPING_TOGETHER_ACT,&nbsp;memb);</span></span>
<span class="tr"><span class="th" id="line851">851</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line852">852</span><span class="td">&nbsp;!&nbsp;If&nbsp;the&nbsp;NEWLINE_BIT&nbsp;has&nbsp;been&nbsp;forced&nbsp;by&nbsp;the&nbsp;activity,&nbsp;act&nbsp;now</span></span>
<span class="tr"><span class="th" id="line853">853</span><span class="td">&nbsp;!&nbsp;before&nbsp;it&nbsp;vanishes...</span></span>
<span class="tr"><span class="th" id="line854">854</span><span class="td">&nbsp;if&nbsp;(q&nbsp;&amp;&nbsp;NEWLINE_BIT&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;c_style&nbsp;&amp;&nbsp;NEWLINE_BIT&nbsp;==&nbsp;0)&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line855">855</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line856">856</span><span class="td">&nbsp;!&nbsp;...when&nbsp;the&nbsp;original&nbsp;style&nbsp;is&nbsp;restored&nbsp;again:</span></span>
<span class="tr"><span class="th" id="line857">857</span><span class="td">&nbsp;c_style&nbsp;=&nbsp;q;</span></span>
<span class="tr"><span class="th" id="line858">858</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line859">859</span><span class="td"></span></span>
</div><div class='text'>
<h2>Write Single Class Group.</h2><p><p> The text of a single group which contains exactly one partition class. Because of the way the multiple-class case recurses, every class ends up in this routine sooner or later; this is the place where the actual name of an object is printed, at long last.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line867">867</span><span class="td">[&nbsp;WriteSingleClassGroup&nbsp;cl&nbsp;memb&nbsp;depth&nbsp;size&nbsp;q;</span></span>
<span class="tr"><span class="th" id="line868">868</span><span class="td">&nbsp;q&nbsp;=&nbsp;c_style;</span></span>
<span class="tr"><span class="th" id="line869">869</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;INDENT_BIT)&nbsp;PrintSpaces(2*(depth+c_margin));</span></span>
<span class="tr"><span class="th" id="line870">870</span><span class="td">&nbsp;if&nbsp;(size&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line871">871</span><span class="td">&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;NOARTICLE_BIT&nbsp;~=&nbsp;0)&nbsp;print&nbsp;(name)&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line872">872</span><span class="td">&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line873">873</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;DEFART_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line874">874</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((cl&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(c_style&nbsp;&amp;&nbsp;CFIRSTART_BIT))&nbsp;print&nbsp;(The)&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line875">875</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;(the)&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line876">876</span><span class="td">&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line877">877</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((cl&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(c_style&nbsp;&amp;&nbsp;CFIRSTART_BIT))&nbsp;print&nbsp;(CIndefArt)&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line878">878</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;(a)&nbsp;memb;</span></span>
<span class="tr"><span class="th" id="line879">879</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line880">880</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line881">881</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line882">882</span><span class="td">&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;DEFART_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line883">883</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((cl&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(c_style&nbsp;&amp;&nbsp;CFIRSTART_BIT))&nbsp;PrefaceByArticle(memb,&nbsp;0,&nbsp;size);</span></span>
<span class="tr"><span class="th" id="line884">884</span><span class="td">&nbsp;&nbsp;&nbsp;else&nbsp;PrefaceByArticle(memb,&nbsp;1,&nbsp;size);</span></span>
<span class="tr"><span class="th" id="line885">885</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line886">886</span><span class="td">&nbsp;&nbsp;@push&nbsp;listing_size;&nbsp;listing_size&nbsp;=&nbsp;size;</span></span>
<span class="tr"><span class="th" id="line887">887</span><span class="td">&nbsp;&nbsp;CarryOutActivity(PRINTING_A_NUMBER_OF_ACT,&nbsp;memb);</span></span>
<span class="tr"><span class="th" id="line888">888</span><span class="td">&nbsp;&nbsp;@pull&nbsp;listing_size;</span></span>
<span class="tr"><span class="th" id="line889">889</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line890">890</span><span class="td">&nbsp;if&nbsp;((size&nbsp;&gt;&nbsp;1)&nbsp;&amp;&amp;&nbsp;(memb&nbsp;hasnt&nbsp;pluralname))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line891">891</span><span class="td">&nbsp;&nbsp;give&nbsp;memb&nbsp;pluralname;</span></span>
<span class="tr"><span class="th" id="line892">892</span><span class="td">&nbsp;&nbsp;WriteAfterEntry(memb,&nbsp;depth);</span></span>
<span class="tr"><span class="th" id="line893">893</span><span class="td">&nbsp;&nbsp;give&nbsp;memb&nbsp;~pluralname;</span></span>
<span class="tr"><span class="th" id="line894">894</span><span class="td">&nbsp;}&nbsp;else&nbsp;WriteAfterEntry(memb,&nbsp;depth);</span></span>
<span class="tr"><span class="th" id="line895">895</span><span class="td">&nbsp;c_style&nbsp;=&nbsp;q;</span></span>
<span class="tr"><span class="th" id="line896">896</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line897">897</span><span class="td"></span></span>
</div><div class='text'>
<h2>Write After Entry.</h2><p><p> Each entry can be followed by supplementary, usually parenthetical, information: exactly what, depends on the style. The extreme case is when the style, and the object, call for recursion to list the object-tree contents: this is achieved by calling <a href="./ListWriter.i6t.html#line694">WriteListR</a>, using the <a href="./ListWriter.i6t.html#line411">ObjectTreeIterator</a> (whatever the iterator used at the top level) and increasing the depth by 1.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line906">906</span><span class="td">[&nbsp;WriteAfterEntry&nbsp;o&nbsp;depth</span></span>
<span class="tr"><span class="th" id="line907">907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;recurse_flag&nbsp;parenth_flag&nbsp;eldest_child&nbsp;child_count&nbsp;combo;</span></span>
<span class="tr"><span class="th" id="line908">908</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line909">909</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;inventory_stage&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line910">910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;PARTINV_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line911">911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(PRINTING_ROOM_DESC_DETAILS_ACT,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line912">912</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_ROOM_DESC_DETAILS_ACT,&nbsp;o)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line913">913</span><span class="td">&nbsp;&nbsp;&nbsp;combo&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line914">914</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;light&nbsp;&amp;&amp;&nbsp;location&nbsp;hasnt&nbsp;light)&nbsp;combo=combo+1;</span></span>
<span class="tr"><span class="th" id="line915">915</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;container&nbsp;&amp;&amp;&nbsp;o&nbsp;hasnt&nbsp;open)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;combo=combo+2;</span></span>
<span class="tr"><span class="th" id="line916">916</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((o&nbsp;has&nbsp;container&nbsp;&amp;&amp;&nbsp;(o&nbsp;has&nbsp;open&nbsp;||&nbsp;o&nbsp;has&nbsp;transparent))</span></span>
<span class="tr"><span class="th" id="line917">917</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;(child(o)==0))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;combo=combo+4;</span></span>
<span class="tr"><span class="th" id="line918">918</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(combo)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;);&nbsp;!&nbsp;space&nbsp;and&nbsp;open&nbsp;bracket</span></span>
<span class="tr"><span class="th" id="line919">919</span><span class="td">&nbsp;&nbsp;&nbsp;switch&nbsp;(combo)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line920">920</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;D&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line921">921</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;E&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line922">922</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;H&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line923">923</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;F&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line924">924</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;5:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;I&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line925">925</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;6:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;G&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line926">926</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;7:&nbsp;LIST_WRITER_INTERNAL_RM(&#39;J&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line927">927</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line928">928</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(combo)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;B&#39;);&nbsp;!&nbsp;close&nbsp;bracket</span></span>
<span class="tr"><span class="th" id="line929">929</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line930">930</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(PRINTING_ROOM_DESC_DETAILS_ACT,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line931">931</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;!&nbsp;end&nbsp;of&nbsp;PARTINV_BIT&nbsp;processing</span></span>
<span class="tr"><span class="th" id="line932">932</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line933">933</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;FULLINV_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line934">934</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(PRINTING_INVENTORY_DETAILS_ACT,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line935">935</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_INVENTORY_DETAILS_ACT,&nbsp;o)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line936">936</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;light&nbsp;&amp;&amp;&nbsp;o&nbsp;has&nbsp;worn)&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;);&nbsp;LIST_WRITER_INTERNAL_RM(&#39;K&#39;,&nbsp;o);&nbsp;&nbsp;parenth_flag&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line937">937</span><span class="td">&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line938">938</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;light)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;);&nbsp;LIST_WRITER_INTERNAL_RM(&#39;D&#39;,&nbsp;o);&nbsp;&nbsp;parenth_flag&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line939">939</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;worn)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;);&nbsp;LIST_WRITER_INTERNAL_RM(&#39;L&#39;,&nbsp;o);&nbsp;parenth_flag&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line940">940</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line941">941</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line942">942</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;container)</span></span>
<span class="tr"><span class="th" id="line943">943</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;openable)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line944">944</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parenth_flag)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line945">945</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;SERIAL_COMMA;&nbsp;print&nbsp;&quot;,&quot;;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line946">946</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;C&#39;);</span></span>
<span class="tr"><span class="th" id="line947">947</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line948">948</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;open)</span></span>
<span class="tr"><span class="th" id="line949">949</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(child(o))&nbsp;LIST_WRITER_INTERNAL_RM(&#39;M&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line950">950</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;N&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line951">951</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line952">952</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;lockable&nbsp;&amp;&amp;&nbsp;o&nbsp;has&nbsp;locked)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;P&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line953">953</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;O&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line954">954</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parenth_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line955">955</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line956">956</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line957">957</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(child(o)==0&nbsp;&amp;&amp;&nbsp;o&nbsp;has&nbsp;transparent)</span></span>
<span class="tr"><span class="th" id="line958">958</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parenth_flag)&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;C&#39;);&nbsp;LIST_WRITER_INTERNAL_RM(&#39;F&#39;);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line959">959</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;);&nbsp;LIST_WRITER_INTERNAL_RM(&#39;F&#39;);&nbsp;LIST_WRITER_INTERNAL_RM(&#39;B&#39;);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line960">960</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line961">961</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(parenth_flag)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line962">962</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line963">963</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(PRINTING_INVENTORY_DETAILS_ACT,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line964">964</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;!&nbsp;end&nbsp;of&nbsp;FULLINV_BIT&nbsp;processing</span></span>
<span class="tr"><span class="th" id="line965">965</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line966">966</span><span class="td">&nbsp;child_count&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line967">967</span><span class="td">&nbsp;eldest_child&nbsp;=&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line968">968</span><span class="td">&nbsp;objectloop&nbsp;(p&nbsp;in&nbsp;o)</span></span>
<span class="tr"><span class="th" id="line969">969</span><span class="td">&nbsp;&nbsp;if&nbsp;((c_style&nbsp;&amp;&nbsp;CONCEAL_BIT&nbsp;==&nbsp;0)&nbsp;||&nbsp;(ConcealedFromLists(p)&nbsp;==&nbsp;false))</span></span>
<span class="tr"><span class="th" id="line970">970</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(p&nbsp;has&nbsp;list_filter_permits)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line971">971</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;child_count++;</span></span>
<span class="tr"><span class="th" id="line972">972</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(eldest_child&nbsp;==&nbsp;nothing)&nbsp;eldest_child&nbsp;=&nbsp;p;</span></span>
<span class="tr"><span class="th" id="line973">973</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line974">974</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line975">975</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(child_count&nbsp;&amp;&amp;&nbsp;(c_style&nbsp;&amp;&nbsp;ALWAYS_BIT))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line976">976</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ENGLISH_BIT)&nbsp;{&nbsp;print&nbsp;&quot;&nbsp;&quot;;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;Q&#39;,&nbsp;o);&nbsp;print&nbsp;&quot;&nbsp;&quot;;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line977">977</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recurse_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line978">978</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line979">979</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line980">980</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(child_count&nbsp;&amp;&amp;&nbsp;(c_style&nbsp;&amp;&nbsp;RECURSE_BIT))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line981">981</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;supporter)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line982">982</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ENGLISH_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line983">983</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;TERSE_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line984">984</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line985">985</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;R&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line986">986</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;LIST_WRITER_INTERNAL_RM(&#39;S&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line987">987</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line988">988</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recurse_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line989">989</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line990">990</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;has&nbsp;container&nbsp;&amp;&amp;&nbsp;(o&nbsp;has&nbsp;open&nbsp;||&nbsp;o&nbsp;has&nbsp;transparent))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line991">991</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;ENGLISH_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line992">992</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;TERSE_BIT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line993">993</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;A&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line994">994</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;T&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line995">995</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;LIST_WRITER_INTERNAL_RM(&#39;U&#39;,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line996">996</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line997">997</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recurse_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line998">998</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line999">999</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1000">1000</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1001">1001</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(recurse_flag&nbsp;&amp;&amp;&nbsp;(c_style&nbsp;&amp;&nbsp;ENGLISH_BIT))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1002">1002</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetLWI(child_count,&nbsp;-1,&nbsp;eldest_child);</span></span>
<span class="tr"><span class="th" id="line1003">1003</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;V&#39;,&nbsp;o);&nbsp;print&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1004">1004</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1005">1005</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1006">1006</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;NEWLINE_BIT)&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line1007">1007</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1008">1008</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(recurse_flag)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1009">1009</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;child(o);</span></span>
<span class="tr"><span class="th" id="line1010">1010</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push&nbsp;lt_value;&nbsp;@push&nbsp;listing_together;&nbsp;@push&nbsp;listing_size;</span></span>
<span class="tr"><span class="th" id="line1011">1011</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push&nbsp;c_iterator;</span></span>
<span class="tr"><span class="th" id="line1012">1012</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_iterator&nbsp;=&nbsp;ObjectTreeIterator;</span></span>
<span class="tr"><span class="th" id="line1013">1013</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lt_value&nbsp;=&nbsp;EMPTY_TEXT_VALUE;&nbsp;listing_together&nbsp;=&nbsp;0;&nbsp;listing_size&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1014">1014</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteListR(o,&nbsp;depth+1,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1015">1015</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;c_iterator;</span></span>
<span class="tr"><span class="th" id="line1016">1016</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;listing_size;&nbsp;@pull&nbsp;listing_together;&nbsp;@pull&nbsp;lt_value;</span></span>
<span class="tr"><span class="th" id="line1017">1017</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c_style&nbsp;&amp;&nbsp;TERSE_BIT)&nbsp;LIST_WRITER_INTERNAL_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line1018">1018</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1019">1019</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1020">1020</span><span class="td"></span></span>
</div><div class='text'>
<h2>Internal Rule.</h2><p><p> This rule does nothing in itself; it exists as a placeholder for the response texts used by the list-writer.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1026">1026</span><span class="td">[&nbsp;LIST_WRITER_INTERNAL_R;</span></span>
<span class="tr"><span class="th" id="line1027">1027</span><span class="td">];</span></span>
</div><footer><hr><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
