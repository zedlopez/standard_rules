<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Tables</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
.pre-lines { font-family: monospace; margin-left: 3rem; line-height: 1.5rem; }
/*span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}*/
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 3rem 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 48rem; }
/* h3 { margin-top: 1.5rem; padding-top: 1.5rem; }*/
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: .5rem; margin-bottom: 1.5rem; margin-top: 1.75rem; padding-top: .25rem;}
footer { margin-top: 3rem; padding-top: 1rem; border-top: .5px solid black; margin-bottom: 0;}
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Index</a> &bull; <a href="./Introduction.i6t.html">Introduction</a></div><hr></header>
<div id="front_matter">
<h2><a href="./Tables.i6t.txt">Tables.i6t</a></h2><h3 id="#tables-format">Format.</h3><p><p> The I7 Table structure is not to be confused with the I6 <span class="fixed">table</span> form of array: it is essentially a two-dimensional array which has some metadata at the top of each column.<p></p><p> The run-time representation for a Table is the address <span class="fixed">T</span> of an I6 <span class="fixed">table</span> array: that is, <span class="fixed">T--&gt;0</span> holds the number of columns (which is at most 99) and <span class="fixed">T--&gt;i</span> is the address of column number <span class="fixed">i</span>. Columns are therefore numbered from 1 to <span class="fixed">T--&gt;0</span>, but they are also identified by an ID number of 100 or more, with each different column name having its own ID number. (This is so that multiple tables can share columns with the same name, and correlate them: it also means that NI&#39;s type-checking machinery can know the kind of value of a table entry from the name of the column alone.)<p></p><p> Each column <span class="fixed">C</span> is also a <span class="fixed">table</span> array, with <span class="fixed">C--&gt;1</span> holding the unique ID number for the column&#39;s name, <span class="fixed">C--&gt;2</span> holding the blank entry flags offset and <span class="fixed">C--&gt;3</span> up to <span class="fixed">C--&gt;</span> holding the entries.<p></p><p> <span class="fixed">C--&gt;1</span> also contains seven upper bit flags. These are also defined in &quot;Tables.w&quot; in the NI source, and the values must agree.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line29">29</span><span class="td">Constant TB_COLUMN_REAL        $8000;</span></span>
<span class="tr"><span class="th" id="line30">30</span><span class="td">Constant TB_COLUMN_SIGNED      $4000;</span></span>
<span class="tr"><span class="th" id="line31">31</span><span class="td">Constant TB_COLUMN_TOPIC       $2000;</span></span>
<span class="tr"><span class="th" id="line32">32</span><span class="td">Constant TB_COLUMN_DONTSORTME  $1000;</span></span>
<span class="tr"><span class="th" id="line33">33</span><span class="td">Constant TB_COLUMN_NOBLANKBITS $0800;</span></span>
<span class="tr"><span class="th" id="line34">34</span><span class="td">Constant TB_COLUMN_CANEXCHANGE $0400;</span></span>
<span class="tr"><span class="th" id="line35">35</span><span class="td">Constant TB_COLUMN_ALLOCATED   $0200;</span></span>
<span class="tr"><span class="th" id="line36">36</span><span class="td">Constant TB_COLUMN_NUMBER      $01ff; ! Mask to remove upper bit flags</span></span>
<span class="tr"><span class="th" id="line37">37</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line38">38</span><span class="td">Constant COL_HSIZE 2; ! Column header size: two words (ID/flags, blank bits)</span></span>
</div><div class='text'>
<h3 id="#tables-find-column">Find Column.</h3><p><p> Columns can be referenced either by their physical column numbers &ndash; from 1 to, potentially, 99 &ndash; or else by unique ID numbers associated with column names. For instance, if a table has a column called &quot;liquid capacity&quot;, then all references to its &quot;liquid capacity entry&quot; are via the ID number associated with this column name, which will be <em> &ge; 100</em> and on the other hand <em> &le; </em> <span class="fixed"><a href="./Tables.i6t.html#line36">TB_COLUMN_NUMBER</a></span>. At present, this is only 511, so there can be at most 411 different column names across all the tables present in the source text. (It is just about possible to imagine this being a problem on a very large work, so we will probably one day revise the above to make use of the larger word-size in Glulx and so raise this limit. But so far nobody has got even close to it.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line54">54</span><span class="td">[ TableFindCol tab col f i no_cols n;</span></span>
<span class="tr"><span class="th" id="line55">55</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    no_cols = tab--&gt;0;</span></span>
<span class="tr"><span class="th" id="line56">56</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1: i&lt;=no_cols: i++)</span></span>
<span class="tr"><span class="th" id="line57">57</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (col == ((tab--&gt;i)--&gt;1) &amp; TB_COLUMN_NUMBER) return i;</span></span>
<span class="tr"><span class="th" id="line58">58</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (f) { RunTimeProblem(RTP_TABLE_NOCOL, tab); return 0; }</span></span>
<span class="tr"><span class="th" id="line59">59</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return 0;</span></span>
<span class="tr"><span class="th" id="line60">60</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-number-of-rows">Number of Rows.</h3><p><p> The columns in a table can be assumed all to have the same height (i.e., number of rows): thus the number of rows in <span class="fixed">T</span> can be calculated by looking at column 1, thus...<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line68">68</span><span class="td">[ TableRows tab first_col;</span></span>
<span class="tr"><span class="th" id="line69">69</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    first_col = tab--&gt;1; if (first_col == 0) return 0;</span></span>
<span class="tr"><span class="th" id="line70">70</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return (first_col--&gt;0) - COL_HSIZE;</span></span>
<span class="tr"><span class="th" id="line71">71</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-blanks">Blanks.</h3><p><p> Each table entry is stored in a single word in memory: indeed, column <span class="fixed">C</span> row <span class="fixed">R</span> is at address <span class="fixed">(T--&gt;C)--&gt;(R+COL_HSIZE)</span>.<p></p><p> But this is not sufficient storage in all cases, because each entry can be either a value or can be designated &quot;blank&quot;. Since, for some columns at least, the possible values include every number, we find that we have to store <em>2<sup>16</sup>+1</em> possibilities given only a 16-bit memory word. (Well, or <em>2<sup>32</sup>+1</em> with a 32-bit word, depending on the virtual machine.) This cannot be done.<p></p><p> We therefore need, at least in some cases, an additional bit of storage for each table entry which indicates whether or not it is blank. If we provided such a bit for every table entry, that would be a fairly simple system to implement, but it would also be wasteful of memory, with an overhead of about 5% in practice: and memory in the virtual machine is in very short supply. The reason such a system would be wasteful is that many columns are known to hold values which are in a narrow range; for instance, a time of day cannot exceed 1440, and there will never be more than 10,000 rulebooks or scenes, and so on. For such columns it would be more efficient and indeed faster to indicate blankness by using an exceptional value in the memory cell which is such that it cannot be valid for the kind of value stored in the column. We therefore provide a &quot;blanks bitmap&quot; for only some columns.<p></p><p> This leads us to define the following dummy value, chosen so that it is both impossible for most kinds of value &ndash; which is easy to arrange &ndash; and also unlikely for even those kinds of value where it is legal. For instance, <em>-1</em> would be impossible for enumerative kinds of value such as rulebooks and scenes, but it would be a poor choice for the dummy value because it occurs pretty often as an integer. Instead we use the constant <span class="fixed"><a href="./Definitions.i6t.html#line74">IMPROBABLE_VALUE</a></span>, whose value depends on the word size of the virtual machine, and which is declared in <a href="./Definitions.i6t.html">Definitions.i6t</a>.<p></p><p> An entry is therefore blank if and only if either (a) its column has no blanks bitmap and the stored entry is <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span>, or (b) its column does have a blanks bitmap, the blanks bit for this entry is set, and the stored entry is also <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span>.<p></p><p> To look up the blanks bitmap is a little slower than to access the stored entry directly. Most of the time, entries accessed will be non-blank: so it is efficient to have a system where we can quickly determine this. If we look at the entry and find that it is not <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span>, then we know it is not a blank. If we find that it is <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span>, on the other hand, then quite often the column has no blanks bitmap and again we have a quick answer: it&#39;s blank. Only if the column also has a blanks bitmap do we need to check that we haven&#39;t got a false negative. (The more improbable <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span> is as a stored value, the rarer it is that we have to check the blanks bitmap for a non-blank entry.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line124">124</span><span class="td">Constant TABLE_NOVALUE = IMPROBABLE_VALUE;</span></span>
</div><div class='text'>
<h3 id="#tables-masks">Masks.</h3><p><p> The blanks bitmaps are stored as bytes; we therefore need a quick way to test or set whether bit number <em>i</em> of a byte is zero, where <em>0 &le; i &le; 7</em>. I6 provides no very useful operators here, whereas memory lookup is cheap, so we use two arrays of bitmaps:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line133">133</span><span class="td">Array CheckTableEntryIsBlank_LU</span></span>
<span class="tr"><span class="th" id="line134">134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    -&gt;    $$00000001</span></span>
<span class="tr"><span class="th" id="line135">135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$00000010</span></span>
<span class="tr"><span class="th" id="line136">136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$00000100</span></span>
<span class="tr"><span class="th" id="line137">137</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$00001000</span></span>
<span class="tr"><span class="th" id="line138">138</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$00010000</span></span>
<span class="tr"><span class="th" id="line139">139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$00100000</span></span>
<span class="tr"><span class="th" id="line140">140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$01000000</span></span>
<span class="tr"><span class="th" id="line141">141</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$10000000;</span></span>
<span class="tr"><span class="th" id="line142">142</span><span class="td">Array CheckTableEntryIsNonBlank_LU</span></span>
<span class="tr"><span class="th" id="line143">143</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    -&gt;    $$11111110</span></span>
<span class="tr"><span class="th" id="line144">144</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$11111101</span></span>
<span class="tr"><span class="th" id="line145">145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$11111011</span></span>
<span class="tr"><span class="th" id="line146">146</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$11110111</span></span>
<span class="tr"><span class="th" id="line147">147</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$11101111</span></span>
<span class="tr"><span class="th" id="line148">148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$11011111</span></span>
<span class="tr"><span class="th" id="line149">149</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$10111111</span></span>
<span class="tr"><span class="th" id="line150">150</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        $$01111111;</span></span>
</div><div class='text'>
<h3 id="#tables-testing-blankness">Testing Blankness.</h3><p><p> The following routine is the one which checks that there is no false negative: it should be used when we know that the table entry is <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span> and we need to check the blank bit, if there is one, to make sure the entry is indeed blank.<p></p><p> The second word in the column table header, <span class="fixed">C--&gt;2</span>, holds the address of the blanks bitmap: this in turn contains one bit for each row, starting with the least significant bit of the first byte. If the table contains a number of rows which isn&#39;t a multiple of 8, the spare bits at the end of the last byte in the blanks bitmap are wasted, but this is an acceptable overhead in practice.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line166">166</span><span class="td">[ CheckTableEntryIsBlank tab col row i at;</span></span>
<span class="tr"><span class="th" id="line167">167</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col = TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rtrue;</span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((tab--&gt;col)--&gt;(row+COL_HSIZE) ~= TABLE_NOVALUE) {</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;*** CTEIB on nonblank value &quot;, tab, &quot; &quot;, col, &quot; &quot;, row, &quot; ***^&quot;;</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NOBLANKBITS) rtrue;</span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    row--;</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at = ((tab--&gt;col)--&gt;2) + (row/8);</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((TB_Blanks-&gt;at) &amp; (CheckTableEntryIsBlank_LU-&gt;(row%8))) rtrue;</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rfalse;</span></span>
<span class="tr"><span class="th" id="line177">177</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-force-entry-blank">Force Entry Blank.</h3><p><p> We blank a table cell by storing <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span> in its entry word and also setting the relevant bit in the blanks bitmap, if there is one.<p></p><p> We need to be careful if the column holds a kind of value where values are pointers to blocks of allocated memory, because if so then overwriting such a value might lead to a memory leak. So in such cases we call <span class="fixed"><a href="./BlockValues.i6t.html#line633">BlkValueFree</a></span> to free the memory block. (Note that each memory block is pointed to by one and only one I7 value at any given time: we are using them as values, not pointers to values. So if this reference is deleted, it&#39;s by definition the only one.) <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span> is chosen such that it cannot be an address of a memory block, which is convenient here. (The value 0 means &quot;no memory block allocated yet&quot;.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line194">194</span><span class="td">[ ForceTableEntryBlank tab col row i at oldv flags;</span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col = TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rtrue;</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    flags = (tab--&gt;col)--&gt;1;</span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    oldv = (tab--&gt;col)--&gt;(row+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((flags &amp; TB_COLUMN_ALLOCATED) &amp;&amp; (oldv ~= 0 or TABLE_NOVALUE))</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        BlkValueFree(oldv);</span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    (tab--&gt;col)--&gt;(row+COL_HSIZE) = TABLE_NOVALUE;</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (flags &amp; TB_COLUMN_NOBLANKBITS) return;</span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    row--;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at = ((tab--&gt;col)--&gt;2) + (row/8);</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    (TB_Blanks-&gt;at) = (TB_Blanks-&gt;at) | (CheckTableEntryIsBlank_LU-&gt;(row%8));</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-force-entry-non-blank">Force Entry Non-Blank.</h3><p><p> To unblank a cell, we need to clear the relevant bit in the bitmap. We then go on to write a new value in to the entry &ndash; thus overwriting the <span class="fixed"><a href="./Tables.i6t.html#line124">TABLE_NOVALUE</a></span> value &ndash; but that isn&#39;t done here; the expectation is that whoever calls this routine is just about to write a new entry anyway.<p></p><p> The exception is again for columns holding a kind of value pointing to a memory block, where we create a suitable initialised but uninteresting memory block for the KOV in question, and set the entry to that.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line219">219</span><span class="td">[ ForceTableEntryNonBlank tab col row i at oldv flags tc kov;</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rtrue;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NOBLANKBITS) return;</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    flags = (tab--&gt;col)--&gt;1;</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    oldv = (tab--&gt;col)--&gt;(row+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((flags &amp; TB_COLUMN_ALLOCATED) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (oldv == 0 or TABLE_NOVALUE)) {</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        kov = UNKNOWN_TY;</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        tc = ((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NUMBER;</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        kov = TC_KOV(tc);</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (kov ~= UNKNOWN_TY) {</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            (tab--&gt;col)--&gt;(row+COL_HSIZE) = BlkValueCreate(kov);</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    row--;</span></span>
<span class="tr"><span class="th" id="line235">235</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at = ((tab--&gt;col)--&gt;2) + (row/8);</span></span>
<span class="tr"><span class="th" id="line236">236</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    (TB_Blanks-&gt;at) = (TB_Blanks-&gt;at) &amp; (CheckTableEntryIsNonBlank_LU-&gt;(row%8));</span></span>
<span class="tr"><span class="th" id="line237">237</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-swapping-blank-bits">Swapping Blank Bits.</h3><p><p> When sorting a table, we obviously need to swap rows from time to time; if any of its columns have blanks bitmaps, then the relevant bits in them need to be swapped to match, and the following routine performs this operation for two rows in a given column.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line246">246</span><span class="td">[ TableSwapBlankBits tab row1 row2 col at1 at2 bit1 bit2;</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rtrue;</span></span>
<span class="tr"><span class="th" id="line249">249</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NOBLANKBITS) return;</span></span>
<span class="tr"><span class="th" id="line250">250</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    row1--;</span></span>
<span class="tr"><span class="th" id="line251">251</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at1 = ((tab--&gt;col)--&gt;2) + (row1/8);</span></span>
<span class="tr"><span class="th" id="line252">252</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    row2--;</span></span>
<span class="tr"><span class="th" id="line253">253</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at2 = ((tab--&gt;col)--&gt;2) + (row2/8);</span></span>
<span class="tr"><span class="th" id="line254">254</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    bit1 = ((TB_Blanks-&gt;at1) &amp; (CheckTableEntryIsBlank_LU-&gt;(row1%8)));</span></span>
<span class="tr"><span class="th" id="line255">255</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    bit2 = ((TB_Blanks-&gt;at2) &amp; (CheckTableEntryIsBlank_LU-&gt;(row2%8)));</span></span>
<span class="tr"><span class="th" id="line256">256</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bit1) bit1 = true; </span></span>
<span class="tr"><span class="th" id="line257">257</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bit2) bit2 = true;</span></span>
<span class="tr"><span class="th" id="line258">258</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bit1 == bit2) return;</span></span>
<span class="tr"><span class="th" id="line259">259</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bit1) {</span></span>
<span class="tr"><span class="th" id="line260">260</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (TB_Blanks-&gt;at1)</span></span>
<span class="tr"><span class="th" id="line261">261</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            = (TB_Blanks-&gt;at1) &amp; (CheckTableEntryIsNonBlank_LU-&gt;(row1%8));</span></span>
<span class="tr"><span class="th" id="line262">262</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (TB_Blanks-&gt;at2)</span></span>
<span class="tr"><span class="th" id="line263">263</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            = (TB_Blanks-&gt;at2) | (CheckTableEntryIsBlank_LU-&gt;(row2%8));</span></span>
<span class="tr"><span class="th" id="line264">264</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line265">265</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (TB_Blanks-&gt;at1)</span></span>
<span class="tr"><span class="th" id="line266">266</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            = (TB_Blanks-&gt;at1) | (CheckTableEntryIsBlank_LU-&gt;(row1%8));</span></span>
<span class="tr"><span class="th" id="line267">267</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (TB_Blanks-&gt;at2)</span></span>
<span class="tr"><span class="th" id="line268">268</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            = (TB_Blanks-&gt;at2) &amp; (CheckTableEntryIsNonBlank_LU-&gt;(row2%8));</span></span>
<span class="tr"><span class="th" id="line269">269</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line270">270</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-moving-blank-bits-down">Moving Blank Bits Down.</h3><p><p> Another common table operation is to compress it by moving all the blank rows down to the bottom, so that non-blank rows occur in a contiguous block at the top: this means table sorting can be done without having to refer continually to the blanks bitmaps. The following operation is useful for keeping the blanks bitmaps up to date when blank rows are moved down.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line280">280</span><span class="td">[ TableMoveBlankBitsDown tab row1 row2 col at atp1 bit rx;</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rtrue;</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NOBLANKBITS) return;</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    row1--; row2--;</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ! Read blank bit for row1:</span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at = ((tab--&gt;col)--&gt;2) + (row1/8);</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    bit = ((TB_Blanks-&gt;at) &amp; (CheckTableEntryIsBlank_LU-&gt;(row1%8)));</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bit) bit = true;</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ! Loop through, setting each blank bit to the next:</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (rx=row1:rx&lt;row2:rx++) {</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        atp1 = ((tab--&gt;col)--&gt;2) + ((rx+1)/8);</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        at = ((tab--&gt;col)--&gt;2) + (rx/8);</span></span>
<span class="tr"><span class="th" id="line293">293</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((TB_Blanks-&gt;atp1) &amp; (CheckTableEntryIsBlank_LU-&gt;((rx+1)%8))) {</span></span>
<span class="tr"><span class="th" id="line294">294</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            (TB_Blanks-&gt;at)</span></span>
<span class="tr"><span class="th" id="line295">295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                = (TB_Blanks-&gt;at) | (CheckTableEntryIsBlank_LU-&gt;(rx%8));</span></span>
<span class="tr"><span class="th" id="line296">296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</span></span>
<span class="tr"><span class="th" id="line297">297</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            (TB_Blanks-&gt;at)</span></span>
<span class="tr"><span class="th" id="line298">298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                = (TB_Blanks-&gt;at) &amp; (CheckTableEntryIsNonBlank_LU-&gt;(rx%8));</span></span>
<span class="tr"><span class="th" id="line299">299</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line300">300</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ! Write bit to blank bit for row2:</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    at = ((tab--&gt;col)--&gt;2) + (row2/8);</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bit) {</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (TB_Blanks-&gt;at)</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            = (TB_Blanks-&gt;at) | (CheckTableEntryIsBlank_LU-&gt;(row2%8));</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (TB_Blanks-&gt;at)</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            = (TB_Blanks-&gt;at) &amp; (CheckTableEntryIsNonBlank_LU-&gt;(row2%8));</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-table-row-corresponding">Table Row Corresponding.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line322">TableRowCorr(T, C, V)</a></span> returns the first row on which value <span class="fixed">V</span> appears in column <span class="fixed">C</span> of table <span class="fixed">T</span>, or prints an error if it doesn&#39;t.<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line345">ExistsTableRowCorr(T, C, V)</a></span> returns the first row on which <span class="fixed">V</span> appears in column <span class="fixed">C</span> of table <span class="fixed">T</span>, or 0 if <span class="fixed">V</span> does not occur at all. If the column is a topic, then we match the entry as a snippet against the value as a general parsing routine.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line322">322</span><span class="td">[ TableRowCorr tab col lookup_value lookup_col i j f v;</span></span>
<span class="tr"><span class="th" id="line323">323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col, true);</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    lookup_col = tab--&gt;col;</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    j = lookup_col--&gt;0 - COL_HSIZE;</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_ALLOCATED) f=1;</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (f) {</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=1:i&lt;=j:i++) {</span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = lookup_col--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((v == TABLE_NOVALUE) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                (CheckTableEntryIsBlank(tab,col,i))) continue;</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (BlkValueCompare(v, lookup_value) == 0)</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                return i;</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=1:i&lt;=j:i++) {</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((lookup_value == TABLE_NOVALUE) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                (CheckTableEntryIsBlank(tab,col,i))) continue;</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (lookup_col--&gt;(i+COL_HSIZE) == lookup_value) return i;</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return RunTimeProblem(RTP_TABLE_NOCORR, tab);</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">[ ExistsTableRowCorr tab col entry i k v f kov;</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rfalse;</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    f=0;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_TOPIC) f=1;</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    else if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_ALLOCATED) f=2;</span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1:i&lt;=k:i++) {</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v = (tab--&gt;col)--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line354">354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,i))) continue;</span></span>
<span class="tr"><span class="th" id="line355">355</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        switch (f) {</span></span>
<span class="tr"><span class="th" id="line356">356</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            1: if ((v)(entry/100, entry%100) ~= GPR_FAIL) return i;</span></span>
<span class="tr"><span class="th" id="line357">357</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            2: if (BlkValueCompare(v, entry) == 0) return i;</span></span>
<span class="tr"><span class="th" id="line358">358</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            default: if (v == entry) return i;</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ! print &quot;Giving up^&quot;;</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return 0;</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-table-look-up-corresponding-row">Table Look Up Corresponding Row.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line375">TableLookUpCorr(T, C1, C2, V)</a></span> finds the first row on which value <span class="fixed">V</span> appears in column <span class="fixed">C2</span>, and returns the corresponding value in <span class="fixed">C1</span>, or prints an error if the value <span class="fixed">V</span> cannot be found or has no corresponding value in <span class="fixed">C1</span>.<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line414">ExistsTableLookUpCorr(T, C1, C2, V)</a></span> returns <span class="fixed">true</span> if the operation <span class="fixed"><a href="./Tables.i6t.html#line375">TableLookUpCorr(T, C1, C2, V)</a></span> can be done, <span class="fixed">false</span> otherwise.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line375">375</span><span class="td">[ TableLookUpCorr tab col1 col2 lookup_value write_flag write_value cola1 cola2 i j v f;</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col1 &gt;= 100) col1=TableFindCol(tab, col1, true);</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col2 &gt;= 100) col2=TableFindCol(tab, col2, true);</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    cola1 = tab--&gt;col1;</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    cola2 = tab--&gt;col2;</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    j = cola2--&gt;0;</span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    f=0;</span></span>
<span class="tr"><span class="th" id="line382">382</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col2)--&gt;1) &amp; TB_COLUMN_ALLOCATED) f=1;</span></span>
<span class="tr"><span class="th" id="line383">383</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col2)--&gt;1) &amp; TB_COLUMN_TOPIC) f=2;</span></span>
<span class="tr"><span class="th" id="line384">384</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1+COL_HSIZE:i&lt;=j:i++) {</span></span>
<span class="tr"><span class="th" id="line385">385</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v = cola2--&gt;i;</span></span>
<span class="tr"><span class="th" id="line386">386</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line387">387</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col2,i-COL_HSIZE))) continue;</span></span>
<span class="tr"><span class="th" id="line388">388</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (f == 1) {</span></span>
<span class="tr"><span class="th" id="line389">389</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (BlkValueCompare(v, lookup_value) ~= 0) continue;</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else if (f == 2) {</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((v)(lookup_value/100, lookup_value%100) == GPR_FAIL) continue;</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (v ~= lookup_value) continue;</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (write_flag) {</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (write_flag == 4) ForceTableEntryBlank(tab,col1,i-COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            else ForceTableEntryNonBlank(tab,col1,i-COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            switch (write_flag) {</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                1: cola1--&gt;i = write_value;</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                2: cola1--&gt;i = cola1--&gt;i + write_value;</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                3: cola1--&gt;i = cola1--&gt;i - write_value;</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                5: return cola1--&gt;i;</span></span>
<span class="tr"><span class="th" id="line403">403</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line404">404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            rfalse;</span></span>
<span class="tr"><span class="th" id="line405">405</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line406">406</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v = cola1--&gt;i;</span></span>
<span class="tr"><span class="th" id="line407">407</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((v == TABLE_NOVALUE) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line408">408</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            (CheckTableEntryIsBlank(tab,col1,i-COL_HSIZE))) continue;</span></span>
<span class="tr"><span class="th" id="line409">409</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return v;</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return RunTimeProblem(RTP_TABLE_NOCORR, tab);</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line414">414</span><span class="td">[ ExistsTableLookUpCorr tab col1 col2 lookup_value cola1 cola2 i j f;</span></span>
<span class="tr"><span class="th" id="line415">415</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col1 &gt;= 100) col1=TableFindCol(tab, col1, false);</span></span>
<span class="tr"><span class="th" id="line416">416</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col2 &gt;= 100) col2=TableFindCol(tab, col2, false);</span></span>
<span class="tr"><span class="th" id="line417">417</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col1*col2 == 0) rfalse;</span></span>
<span class="tr"><span class="th" id="line418">418</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    cola1 = tab--&gt;col1; cola2 = tab--&gt;col2;</span></span>
<span class="tr"><span class="th" id="line419">419</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    j = cola2--&gt;0;</span></span>
<span class="tr"><span class="th" id="line420">420</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    f=0;</span></span>
<span class="tr"><span class="th" id="line421">421</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col2)--&gt;1) &amp; TB_COLUMN_ALLOCATED) f=1;</span></span>
<span class="tr"><span class="th" id="line422">422</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (((tab--&gt;col2)--&gt;1) &amp; TB_COLUMN_TOPIC) f=2;</span></span>
<span class="tr"><span class="th" id="line423">423</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1+COL_HSIZE:i&lt;=j:i++) {</span></span>
<span class="tr"><span class="th" id="line424">424</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((cola1--&gt;i == TABLE_NOVALUE) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line425">425</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            (CheckTableEntryIsBlank(tab,col1,i-COL_HSIZE))) continue;</span></span>
<span class="tr"><span class="th" id="line426">426</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (f == 1) {</span></span>
<span class="tr"><span class="th" id="line427">427</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (BlkValueCompare(cola2--&gt;i, lookup_value) ~= 0) continue;</span></span>
<span class="tr"><span class="th" id="line428">428</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else if (f == 2) {</span></span>
<span class="tr"><span class="th" id="line429">429</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((cola2--&gt;i)(lookup_value/100, lookup_value%100) == GPR_FAIL) continue;</span></span>
<span class="tr"><span class="th" id="line430">430</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</span></span>
<span class="tr"><span class="th" id="line431">431</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (cola2--&gt;i ~= lookup_value) continue;</span></span>
<span class="tr"><span class="th" id="line432">432</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line433">433</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        rtrue;</span></span>
<span class="tr"><span class="th" id="line434">434</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line435">435</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rfalse;</span></span>
<span class="tr"><span class="th" id="line436">436</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-table-look-up-entry">Table Look Up Entry.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line446">TableLookUpEntry(T, C, R)</a></span> returns the value at column <span class="fixed">C</span>, row <span class="fixed">R</span>, printing an error if that doesn&#39;t exist.<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line475">ExistsTableLookUpEntry(T, C, R)</a></span> returns true if a value exists at column <span class="fixed">C</span>, row <span class="fixed">R</span>, false otherwise.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line446">446</span><span class="td">[ TableLookUpEntry tab col index write_flag write_value v;</span></span>
<span class="tr"><span class="th" id="line447">447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (tab == 0) return RunTimeProblem(RTP_TABLE_NOTABLE2);</span></span>
<span class="tr"><span class="th" id="line448">448</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col, true);</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((index &lt; 1) || (index &gt; TableRows(tab))) {</span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        RunTimeProblem(RTP_TABLE_NOROW, tab, index); index = 1;</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (write_flag) {</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        switch(write_flag) {</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            1:    ForceTableEntryNonBlank(tab,col,index);</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                (tab--&gt;col)--&gt;(index+COL_HSIZE) = write_value;</span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            2:    ForceTableEntryNonBlank(tab,col,index);</span></span>
<span class="tr"><span class="th" id="line457">457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                (tab--&gt;col)--&gt;(index+COL_HSIZE) =</span></span>
<span class="tr"><span class="th" id="line458">458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    ((tab--&gt;col)--&gt;(index+COL_HSIZE)) + write_value;</span></span>
<span class="tr"><span class="th" id="line459">459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            3:    ForceTableEntryNonBlank(tab,col,index);</span></span>
<span class="tr"><span class="th" id="line460">460</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                (tab--&gt;col)--&gt;(index+COL_HSIZE) =</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    ((tab--&gt;col)--&gt;(index+COL_HSIZE)) - write_value;</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            4:    ForceTableEntryBlank(tab,col,index);</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            5:    ForceTableEntryNonBlank(tab,col,index);</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                return ((tab--&gt;col)--&gt;(index+COL_HSIZE));</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        rfalse;</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    v = ((tab--&gt;col)--&gt;(index+COL_HSIZE));</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,index))) {</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        RunTimeProblem(RTP_TABLE_NOENTRY, tab, col, index); rfalse;</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return v;</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td">[ ExistsTableLookUpEntry tab col index v;</span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col);</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col == 0) rfalse;</span></span>
<span class="tr"><span class="th" id="line478">478</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((index&lt;1) || (index &gt; TableRows(tab))) rfalse;</span></span>
<span class="tr"><span class="th" id="line479">479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    v = ((tab--&gt;col)--&gt;(index+COL_HSIZE));</span></span>
<span class="tr"><span class="th" id="line480">480</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,index)))</span></span>
<span class="tr"><span class="th" id="line481">481</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        rfalse;</span></span>
<span class="tr"><span class="th" id="line482">482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rtrue;</span></span>
<span class="tr"><span class="th" id="line483">483</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-blank-rows">Blank Rows.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line499">TableRowIsBlank(T, R)</a></span> returns true if row <span class="fixed">R</span> of table <span class="fixed">T</span> is blank. (<span class="fixed">R</span> must be a legal row number.)<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line507">TableBlankOutRow(T, R)</a></span> fills row <span class="fixed">R</span> of table <span class="fixed">T</span> with blanks. (<span class="fixed">R</span> must be a legal row number.)<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line527">TableBlankRows(T)</a></span> returns the number of blank rows in <span class="fixed">T</span>.<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line535">TableFilledRows(T)</a></span> returns the number of non-blank rows in <span class="fixed">T</span>.<p></p><p> <span class="fixed"><a href="./Tables.i6t.html#line539">TableBlankRow(T)</a></span> finds the first blank row in <span class="fixed">T</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line499">499</span><span class="td">[ TableRowIsBlank tab j k;</span></span>
<span class="tr"><span class="th" id="line500">500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=tab--&gt;0:k++) {</span></span>
<span class="tr"><span class="th" id="line501">501</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (((tab--&gt;k)--&gt;(j+COL_HSIZE)) ~= TABLE_NOVALUE) rfalse;</span></span>
<span class="tr"><span class="th" id="line502">502</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (CheckTableEntryIsBlank(tab, k, j) == false) rfalse;</span></span>
<span class="tr"><span class="th" id="line503">503</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rtrue;</span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td">[ TableBlankOutRow tab row k;</span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (tab==0) return RunTimeProblem(RTP_TABLE_NOTABLE);</span></span>
<span class="tr"><span class="th" id="line509">509</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=tab--&gt;0:k++)</span></span>
<span class="tr"><span class="th" id="line510">510</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ForceTableEntryBlank(tab, k, row);</span></span>
<span class="tr"><span class="th" id="line511">511</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line512">512</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line513">513</span><span class="td">[ TableBlankOutColumn tab col n k;</span></span>
<span class="tr"><span class="th" id="line514">514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (tab==0) return RunTimeProblem(RTP_TABLE_NOTABLE);</span></span>
<span class="tr"><span class="th" id="line515">515</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    n = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line516">516</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=n:k++)</span></span>
<span class="tr"><span class="th" id="line517">517</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ForceTableEntryBlank(tab, col, k);</span></span>
<span class="tr"><span class="th" id="line518">518</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line519">519</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line520">520</span><span class="td">[ TableBlankOutAll tab n k;</span></span>
<span class="tr"><span class="th" id="line521">521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (tab==0) return RunTimeProblem(RTP_TABLE_NOTABLE);</span></span>
<span class="tr"><span class="th" id="line522">522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    n = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line523">523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=n:k++)</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TableBlankOutRow(tab, k);</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">[ TableBlankRows tab i j c;</span></span>
<span class="tr"><span class="th" id="line528">528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = TableRows(tab); !print i, &quot; rows^&quot;;</span></span>
<span class="tr"><span class="th" id="line529">529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (j=1:j&lt;=i:j++)</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (TableRowIsBlank(tab, j)) c++;</span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    !print c, &quot; blank^&quot;;</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return c;</span></span>
<span class="tr"><span class="th" id="line533">533</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line534">534</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line535">535</span><span class="td">[ TableFilledRows tab;</span></span>
<span class="tr"><span class="th" id="line536">536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return TableRows(tab) - TableBlankRows(tab);</span></span>
<span class="tr"><span class="th" id="line537">537</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line538">538</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line539">539</span><span class="td">[ TableBlankRow tab i j;</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (j=1:j&lt;=i:j++)</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (TableRowIsBlank(tab, j)) return j;</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    RunTimeProblem(RTP_TABLE_NOMOREBLANKS, tab);</span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return i;</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-random-row">Random Row.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line551">TableRandomRow(T)</a></span> chooses a random non-blank row in <span class="fixed">T</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line551">551</span><span class="td">[ TableRandomRow tab i j k;</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    j = TableFilledRows(tab);</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (j==0) return RunTimeProblem(RTP_TABLE_NOROWS, tab);</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (j&gt;1) j = random(j);</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=i:k++) {</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (TableRowIsBlank(tab, k) == false) j--;</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (j==0) return k;</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-swap-rows">Swap Rows.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line566">TableSwapRows(T, R1, R2)</a></span> exchanges rows <span class="fixed">R1</span> and <span class="fixed">R2</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line566">566</span><span class="td">[ TableSwapRows tab i j k l v1 v2;</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (i==j) return;</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    l = tab--&gt;0;</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=l:k++) {</span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v1 = (tab--&gt;k)--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v2 = (tab--&gt;k)--&gt;(j+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (tab--&gt;k)--&gt;(i+COL_HSIZE) = v2;</span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (tab--&gt;k)--&gt;(j+COL_HSIZE) = v1;</span></span>
<span class="tr"><span class="th" id="line574">574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((v1 == TABLE_NOVALUE) || (v2 == TABLE_NOVALUE))</span></span>
<span class="tr"><span class="th" id="line575">575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            TableSwapBlankBits(tab, i, j, k);</span></span>
<span class="tr"><span class="th" id="line576">576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line577">577</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-compare-rows">Compare Rows.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line593">TableCompareRows(T, C, R1, R2, D)</a></span> returns:<p></p><p> (a) <em>+1</em> if the entry at row R1 of column C is <em>&gt;</em> the entry at row R2, (b) 0 if they are equal, and (c) <em>-1</em> if entry at R1 <em>&lt;</em> entry at R2.<p></p><p> When <em>D = +1</em>, a blank value is greater than all other values, so that in an ascending sort the blanks come last; when <em>D = -1</em>, a blank value is less than all others, so that once again blanks are last. Finally, a wholly blank row is always placed after a row in which the entry in C is blank but where other entries are not.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line593">593</span><span class="td">[ TableCompareRows tab col row1 row2 dir val1 val2 bl1 bl2 f;</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col, false);</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    val1 = (tab--&gt;col)--&gt;(row1+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line596">596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    val2 = (tab--&gt;col)--&gt;(row2+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (val1 == TABLE_NOVALUE) bl1 = CheckTableEntryIsBlank(tab,col,row1);</span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (val2 == TABLE_NOVALUE) bl2 = CheckTableEntryIsBlank(tab,col,row2);</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((val1 == val2) &amp;&amp; (bl1 == bl2)) {</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (val1 ~= TABLE_NOVALUE) return 0;</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (bl1 == false) return 0;</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ! The two entries are both blank:</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (TableRowIsBlank(tab, row1)) {</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (TableRowIsBlank(tab, row2)) return 0;</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return -1*dir;</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (TableRowIsBlank(tab, row2)) return dir;</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return 0;</span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bl1) return dir;</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (bl2) return -1*dir;</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    f = ((tab--&gt;col)--&gt;1);</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (f &amp; TB_COLUMN_ALLOCATED) {</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (BlkValueCompare(val2, val1) &lt; 0) return 1;</span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return -1;</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else if (f &amp; TB_COLUMN_REAL) {</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (REAL_NUMBER_TY_Compare(val1, val2) &gt; 0) return 1;</span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return -1;</span></span>
<span class="tr"><span class="th" id="line619">619</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else if (f &amp; TB_COLUMN_SIGNED) {</span></span>
<span class="tr"><span class="th" id="line620">620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (val1 &gt; val2) return 1;</span></span>
<span class="tr"><span class="th" id="line621">621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return -1;</span></span>
<span class="tr"><span class="th" id="line622">622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line623">623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (UnsignedCompare(val1, val2) &gt; 0) return 1;</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return -1;</span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-move-row-down">Move Row Down.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line631">631</span><span class="td">[ TableMoveRowDown tab r1 r2 rx k l m v f;</span></span>
<span class="tr"><span class="th" id="line632">632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (r1==r2) return;</span></span>
<span class="tr"><span class="th" id="line633">633</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    l = tab--&gt;0;</span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (k=1:k&lt;=l:k++) {</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        f = false;</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        m = (tab--&gt;k)--&gt;(r1+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (m == TABLE_NOVALUE) f = true;</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (rx=r1:rx&lt;r2:rx++) {</span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = (tab--&gt;k)--&gt;(rx+COL_HSIZE+1);</span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            (tab--&gt;k)--&gt;(rx+COL_HSIZE) = v;</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (v == TABLE_NOVALUE) f = true;</span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        (tab--&gt;k)--&gt;(r2+COL_HSIZE) = m;</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (f) TableMoveBlankBitsDown(tab, r1, r2, k);</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-shuffle">Shuffle.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line652">TableShuffle(T)</a></span> sorts <span class="fixed">T</span> into random row order.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line652">652</span><span class="td">[ TableShuffle tab i to;</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    TableMoveBlanksToBack(tab, 1, TableRows(tab));</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    to = TableFilledRows(tab);</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=2:i&lt;=to:i++) TableSwapRows(tab, i, random(i));</span></span>
<span class="tr"><span class="th" id="line656">656</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-next-row">Next Row.</h3><p><p> <span class="fixed"><a href="./Tables.i6t.html#line675">TableNextRow(T, C, R, D)</a></span> is used when scanning through a table in order of the values in column <span class="fixed">C</span>: ascending order if <span class="fixed">D = 1</span>, descending if <span class="fixed">D = -1</span>. The current position is row <span class="fixed">R</span> of column <span class="fixed">C</span>, or <span class="fixed">R = 0</span> if we have not yet found the first row. The return value is the row number for the next value, or 0 if we are already at the final value. Note that if there are several equal values in the column, they will be run through in turn, in order of their physical row numbers - ascending if <span class="fixed">D = 1</span>, descending if <span class="fixed">D = -1</span>, so that using the routine with <span class="fixed">D = -1</span> always produces the exact reverse ordering from using it with <span class="fixed">D = 1</span> and the same parameters. Rows with blank entries in <span class="fixed">C</span> are skipped.<p></p><p><div class="pre-lines">for (R=TableNextRow(T,C,0,D): R : R=TableNextRow(T,C,R,D)) ...</div><p></p><p> will perform a loop of valid row numbers in order of column <span class="fixed">C</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line675">675</span><span class="td">[ TableNextRow tab col row dir i k val v dv min_dv min_at signed_arithmetic f blk z;</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col, false);</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    f = ((tab--&gt;col)--&gt;1);</span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (f &amp; TB_COLUMN_ALLOCATED) blk = true;</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    signed_arithmetic = f &amp; TB_COLUMN_SIGNED;</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Iftrue (WORDSIZE == 2);</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (row == 0) {</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (signed_arithmetic) {</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (dir == 1) val = $8000; else val = $7fff;</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (dir == 1) val = 0; else val = $ffff;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else val = (tab--&gt;col)--&gt;(row+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (signed_arithmetic) min_dv = $7fff; else min_dv = $ffff;</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #ifnot; ! WORDSIZE == 4</span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (row == 0) {</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (signed_arithmetic) {</span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (dir == 1) val = $80000000; else val = $7fffffff;</span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (dir == 1) val = 0; else val = $ffffffff;</span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else val = (tab--&gt;col)--&gt;(row+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (signed_arithmetic) min_dv = $7fffffff; else min_dv = $ffffffff;</span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #endif;</span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (dir == 1) {</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=1:i&lt;=k:i++) {</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = (tab--&gt;col)--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,i)))</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                continue;</span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (blk) {</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                dv = v;</span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (row == 0) z = 1; else z = BlkValueCompare(v, val);</span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                f = (((z &gt; 0) || ((z == 0) &amp;&amp; (i &gt; row))) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    ((min_at == 0) || (BlkValueCompare(v, min_dv) &lt; 0)));</span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            } else {</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                dv = dir*v;</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (signed_arithmetic)</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                f = (((dv &gt; dir*val) || ((v == val) &amp;&amp; (i&gt;row))) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      (dv &lt; min_dv));</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                else</span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                f = (((UnsignedCompare(dv, dir*val) &gt; 0) || ((v == val) &amp;&amp; (i&gt;row))) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      (UnsignedCompare(dv, min_dv) &lt; 0));</span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (f) { min_dv = dv; min_at = i; }</span></span>
<span class="tr"><span class="th" id="line720">720</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line721">721</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line722">722</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=k:i&gt;=1:i--) {</span></span>
<span class="tr"><span class="th" id="line723">723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = (tab--&gt;col)--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line724">724</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,i)))</span></span>
<span class="tr"><span class="th" id="line725">725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                continue;</span></span>
<span class="tr"><span class="th" id="line726">726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (blk) {</span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                dv = v;</span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (row == 0) z = -1; else z = BlkValueCompare(v, val);</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                f = (((z &lt; 0) || ((z == 0) &amp;&amp; (i &lt; row))) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    ((min_at == 0) || (BlkValueCompare(v, min_dv) &gt; 0)));</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            } else {</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                dv = dir*v;</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (signed_arithmetic)</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                f = (((dv &gt; dir*val) || ((v == val) &amp;&amp; (i&lt;row))) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      (dv &lt; min_dv));</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                else</span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                f = (((UnsignedCompare(dv, dir*val) &gt; 0) || ((v == val) &amp;&amp; (i&lt;row))) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                      (UnsignedCompare(dv, min_dv) &lt; 0));</span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (f) { min_dv = dv; min_at = i; }</span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return min_at;</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-move-blanks-to-back">Move Blanks to Back.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line749">749</span><span class="td">[ TableMoveBlanksToBack tab fromrow torow i fbl lnbl blc;</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (torow &lt; fromrow) return;</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    fbl = 0; lnbl = 0;</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=fromrow: i&lt;=torow: i++)</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (TableRowIsBlank(tab, i)) {</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (fbl == 0) fbl = i;</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            blc++;</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        } else {</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            lnbl = i;</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((fbl&gt;0) &amp;&amp; (lnbl&gt;0) &amp;&amp; (fbl &lt; lnbl)) {</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TableMoveRowDown(tab, fbl, lnbl); ! Move first blank just past last nonblank</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TableMoveBlanksToBack(tab, fbl, lnbl-1);</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return torow-blc; ! Final non-blank row</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-sort">Sort.</h3><p><p> This is really only a front-end: it calls the sorting code at <a href="./Sort.i6t.html">Sort.i6t</a>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line770">770</span><span class="td">[ TableSort tab col dir test_flag algorithm i j k f;</span></span>
<span class="tr"><span class="th" id="line771">771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1:i&lt;=tab--&gt;0:i++) {</span></span>
<span class="tr"><span class="th" id="line772">772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        j = tab--&gt;i; ! Address of column table</span></span>
<span class="tr"><span class="th" id="line773">773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((j--&gt;1) &amp; TB_COLUMN_DONTSORTME)</span></span>
<span class="tr"><span class="th" id="line774">774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return RunTimeProblem(RTP_TABLE_CANTSORT, tab);</span></span>
<span class="tr"><span class="th" id="line775">775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line776">776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col, false);</span></span>
<span class="tr"><span class="th" id="line777">777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line778">778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableMoveBlanksToBack(tab, 1, k);</span></span>
<span class="tr"><span class="th" id="line779">779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (test_flag) {</span></span>
<span class="tr"><span class="th" id="line780">780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;After moving blanks to back:^&quot;; TableColumnDebug(tab, col);</span></span>
<span class="tr"><span class="th" id="line781">781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line782">782</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line783">783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    SetSortDomain(TableSwapRows, TableCompareRows);</span></span>
<span class="tr"><span class="th" id="line784">784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    SortArray(tab, col, dir, k, test_flag, algorithm);</span></span>
<span class="tr"><span class="th" id="line785">785</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line786">786</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (test_flag) {</span></span>
<span class="tr"><span class="th" id="line787">787</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;Final state:^&quot;; TableColumnDebug(tab, col);</span></span>
<span class="tr"><span class="th" id="line788">788</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line789">789</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-print-table-name">Print Table Name.</h3><p><p> NI fills this in: it&#39;s used to say the &quot;table&quot; kind of value.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line795">795</span><span class="td">[ PrintTableName T;</span></span>
<span class="tr"><span class="th" id="line796">796</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    switch(T) {</span></span>
<span class="tr"><span class="th" id="line797">797</span><span class="td">{-call:Tables::Support::compile_print_table_names}</span></span>
<span class="tr"><span class="th" id="line798">798</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        default: print &quot;** No such table **&quot;;</span></span>
<span class="tr"><span class="th" id="line799">799</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line800">800</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-print-table-to-file">Print Table to File.</h3><p><p> This is how we serialise a table to an external file, though the writing is done by printing characters in the standard way; it&#39;s just that the output stream will be an external file rather than the screen when this routine is called.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line809">809</span><span class="td">[ TablePrint tab i j k row col v tc kov;</span></span>
<span class="tr"><span class="th" id="line810">810</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1:i&lt;=tab--&gt;0:i++) {</span></span>
<span class="tr"><span class="th" id="line811">811</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        j = tab--&gt;i; ! Address of column table</span></span>
<span class="tr"><span class="th" id="line812">812</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (((j--&gt;1) &amp; TB_COLUMN_CANEXCHANGE) == 0)</span></span>
<span class="tr"><span class="th" id="line813">813</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            rtrue;</span></span>
<span class="tr"><span class="th" id="line814">814</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line815">815</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line816">816</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableMoveBlanksToBack(tab, 1, k);</span></span>
<span class="tr"><span class="th" id="line817">817</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    print &quot;! &quot;, (PrintTableName) tab, &quot; (&quot;, k, &quot;)^&quot;;</span></span>
<span class="tr"><span class="th" id="line818">818</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (row=1:row&lt;=k:row++) {</span></span>
<span class="tr"><span class="th" id="line819">819</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (col=1:col&lt;=tab--&gt;0:col++) {</span></span>
<span class="tr"><span class="th" id="line820">820</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            tc = ((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NUMBER;</span></span>
<span class="tr"><span class="th" id="line821">821</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            kov = KindAtomic(TC_KOV(tc));</span></span>
<span class="tr"><span class="th" id="line822">822</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (kov == UNKNOWN_TY) kov = NUMBER_TY;</span></span>
<span class="tr"><span class="th" id="line823">823</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = (tab--&gt;col)--&gt;(row+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line824">824</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,row)))</span></span>
<span class="tr"><span class="th" id="line825">825</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                print &quot;-- &quot;;</span></span>
<span class="tr"><span class="th" id="line826">826</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            else {</span></span>
<span class="tr"><span class="th" id="line827">827</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (BlkValueWriteToFile(v, kov) == false) print v;</span></span>
<span class="tr"><span class="th" id="line828">828</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                print &quot; &quot;;</span></span>
<span class="tr"><span class="th" id="line829">829</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line830">830</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line831">831</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line832">832</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line833">833</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rfalse;</span></span>
<span class="tr"><span class="th" id="line834">834</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-read-table-from-file">Read Table from File.</h3><p><p> And this is how we unserialise again. It makes sense only on Glulx.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line840">840</span><span class="td">#ifdef TARGET_GLULX;</span></span>
<span class="tr"><span class="th" id="line841">841</span><span class="td">[ TableRead tab auxf row maxrow col ch v sgn dg j tc kov;</span></span>
<span class="tr"><span class="th" id="line842">842</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (col=1:col&lt;=tab--&gt;0:col++) {</span></span>
<span class="tr"><span class="th" id="line843">843</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        j = tab--&gt;col; ! Address of column table</span></span>
<span class="tr"><span class="th" id="line844">844</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (((j--&gt;1) &amp; TB_COLUMN_CANEXCHANGE) == 0)</span></span>
<span class="tr"><span class="th" id="line845">845</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            return RunTimeProblem(RTP_TABLE_CANTSAVE, tab);</span></span>
<span class="tr"><span class="th" id="line846">846</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line847">847</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    maxrow = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line848">848</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    !print maxrow, &quot; rows available.^&quot;;</span></span>
<span class="tr"><span class="th" id="line849">849</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (row=1: row&lt;=maxrow: row++) {</span></span>
<span class="tr"><span class="th" id="line850">850</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TableBlankOutRow(tab, row);</span></span>
<span class="tr"><span class="th" id="line851">851</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line852">852</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (row=1: row&lt;=maxrow: row++) {</span></span>
<span class="tr"><span class="th" id="line853">853</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        !print &quot;Reading row &quot;, row, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line854">854</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line855">855</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (ch == &#39;!&#39;) {</span></span>
<span class="tr"><span class="th" id="line856">856</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            while (ch ~= -1 or 10 or 13) ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line857">857</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            while (ch == 10 or 13) ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line858">858</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line859">859</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (col=1: col&lt;=tab--&gt;0: col++) {</span></span>
<span class="tr"><span class="th" id="line860">860</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (ch == -1) { row++; jump <a href="./Tables.i6t.html#line909">NoMore</a>; }</span></span>
<span class="tr"><span class="th" id="line861">861</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (ch == 10 or 13) break;</span></span>
<span class="tr"><span class="th" id="line862">862</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            tc = ((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NUMBER;</span></span>
<span class="tr"><span class="th" id="line863">863</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            kov = KindAtomic(TC_KOV(tc));</span></span>
<span class="tr"><span class="th" id="line864">864</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (kov == UNKNOWN_TY) kov = NUMBER_TY;</span></span>
<span class="tr"><span class="th" id="line865">865</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            !print &quot;tc = &quot;, tc, &quot; kov = &quot;, kov, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line866">866</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            sgn = 1;</span></span>
<span class="tr"><span class="th" id="line867">867</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (ch == &#39;-&#39;) {</span></span>
<span class="tr"><span class="th" id="line868">868</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line869">869</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (ch == -1) jump <a href="./Tables.i6t.html#line914">NotTable</a>;</span></span>
<span class="tr"><span class="th" id="line870">870</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (ch == &#39;-&#39;) { ch = FileIO_GetC(auxf); jump <a href="./Tables.i6t.html#line899">EntryDone</a>; }</span></span>
<span class="tr"><span class="th" id="line871">871</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                sgn = -1;</span></span>
<span class="tr"><span class="th" id="line872">872</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line873">873</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_ALLOCATED)</span></span>
<span class="tr"><span class="th" id="line874">874</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                ForceTableEntryNonBlank(tab, col, row);</span></span>
<span class="tr"><span class="th" id="line875">875</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            !print &quot;A&quot;;</span></span>
<span class="tr"><span class="th" id="line876">876</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = BlkValueReadFromFile(0, 0, -1, kov);</span></span>
<span class="tr"><span class="th" id="line877">877</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (v) {</span></span>
<span class="tr"><span class="th" id="line878">878</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_ALLOCATED)</span></span>
<span class="tr"><span class="th" id="line879">879</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    v = BlkValueReadFromFile(TableLookUpEntry(tab, col, row),</span></span>
<span class="tr"><span class="th" id="line880">880</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                        auxf, ch, kov);</span></span>
<span class="tr"><span class="th" id="line881">881</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                else</span></span>
<span class="tr"><span class="th" id="line882">882</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    v = BlkValueReadFromFile(0, auxf, ch, kov);</span></span>
<span class="tr"><span class="th" id="line883">883</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                ch = 32;</span></span>
<span class="tr"><span class="th" id="line884">884</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            } else {</span></span>
<span class="tr"><span class="th" id="line885">885</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                dg = ch - &#39;0&#39;;</span></span>
<span class="tr"><span class="th" id="line886">886</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                if ((dg &lt; 0) || (dg &gt; 9)) jump <a href="./Tables.i6t.html#line914">NotTable</a>;</span></span>
<span class="tr"><span class="th" id="line887">887</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                v = dg;</span></span>
<span class="tr"><span class="th" id="line888">888</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                for (::) {</span></span>
<span class="tr"><span class="th" id="line889">889</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line890">890</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    dg = ch - &#39;0&#39;;</span></span>
<span class="tr"><span class="th" id="line891">891</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    if ((dg &lt; 0) || (dg &gt; 9)) break;</span></span>
<span class="tr"><span class="th" id="line892">892</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    v = 10*v + dg;</span></span>
<span class="tr"><span class="th" id="line893">893</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                }</span></span>
<span class="tr"><span class="th" id="line894">894</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                v = v*sgn;</span></span>
<span class="tr"><span class="th" id="line895">895</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line896">896</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            !print &quot;v=&quot;, v, &quot; &quot;;</span></span>
<span class="tr"><span class="th" id="line897">897</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_ALLOCATED == 0)</span></span>
<span class="tr"><span class="th" id="line898">898</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                TableLookUpEntry(tab, col, row, true, v);</span></span>
<span class="tr"><span class="th" id="line899">899</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            .EntryDone;</span></span>
<span class="tr"><span class="th" id="line900">900</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            !print &quot;First nd is &quot;, ch, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line901">901</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            while (ch == 9 or 32) ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line902">902</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line903">903</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        while (ch ~= -1 or 10 or 13) {</span></span>
<span class="tr"><span class="th" id="line904">904</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if ((ch ~= &#39;-&#39;) &amp;&amp; (((ch-&#39;0&#39;)&lt;0) || ((ch-&#39;0&#39;)&gt;9))) jump <a href="./Tables.i6t.html#line914">NotTable</a>;</span></span>
<span class="tr"><span class="th" id="line905">905</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (ch ~= 9 or 32) jump <a href="./Tables.i6t.html#line912">WontFit</a>;</span></span>
<span class="tr"><span class="th" id="line906">906</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line907">907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line908">908</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line909">909</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    .NoMore;</span></span>
<span class="tr"><span class="th" id="line910">910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    while (ch == 9 or 32 or 10 or 13) ch = FileIO_GetC(auxf);</span></span>
<span class="tr"><span class="th" id="line911">911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (ch == -1) return;</span></span>
<span class="tr"><span class="th" id="line912">912</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    .WontFit;</span></span>
<span class="tr"><span class="th" id="line913">913</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return RunTimeProblem(RTP_TABLE_WONTFIT, tab);</span></span>
<span class="tr"><span class="th" id="line914">914</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    .NotTable;</span></span>
<span class="tr"><span class="th" id="line915">915</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return RunTimeProblem(RTP_TABLE_BADFILE, tab);</span></span>
<span class="tr"><span class="th" id="line916">916</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line917">917</span><span class="td">#ENDIF; ! TARGET_GLULX</span></span>
</div><div class='text'>
<h3 id="#tables-print-rank">Print Rank.</h3><p><p> The table of scoring ranks is a residue from the ancient times of early IF: it gets a tiny amount of special treatment here, even though I7 works tend not to use these now dated conventions.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line925">925</span><span class="td">[ PrintRank i j v;</span></span>
<span class="tr"><span class="th" id="line926">926</span><span class="td">#ifdef RANKING_TABLE;</span></span>
<span class="tr"><span class="th" id="line927">927</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ANNOUNCE_SCORE_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line928">928</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    j = TableRows(RANKING_TABLE);</span></span>
<span class="tr"><span class="th" id="line929">929</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=j:i&gt;=1:i--)</span></span>
<span class="tr"><span class="th" id="line930">930</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (score &gt;= TableLookUpEntry(RANKING_TABLE, 1, i)) {</span></span>
<span class="tr"><span class="th" id="line931">931</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            v = TableLookUpEntry(RANKING_TABLE, 2, i);</span></span>
<span class="tr"><span class="th" id="line932">932</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            TEXT_TY_Say(v);</span></span>
<span class="tr"><span class="th" id="line933">933</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            &quot;.&quot;;</span></span>
<span class="tr"><span class="th" id="line934">934</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line935">935</span><span class="td">#endif;</span></span>
<span class="tr"><span class="th" id="line936">936</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    &quot;.&quot;;</span></span>
<span class="tr"><span class="th" id="line937">937</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#tables-debugging">Debugging.</h3><p><p> Routines to print the state of a table, for debugging purposes only.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line943">943</span><span class="td">[ TableColumnDebug tab col k i v tc kov;</span></span>
<span class="tr"><span class="th" id="line944">944</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (col &gt;= 100) col=TableFindCol(tab, col, false);</span></span>
<span class="tr"><span class="th" id="line945">945</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line946">946</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    tc = ((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NUMBER;</span></span>
<span class="tr"><span class="th" id="line947">947</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    kov = TC_KOV(tc);</span></span>
<span class="tr"><span class="th" id="line948">948</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1:i&lt;=k:i++) {</span></span>
<span class="tr"><span class="th" id="line949">949</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (i&gt;1) print &quot;, &quot;;</span></span>
<span class="tr"><span class="th" id="line950">950</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v = (tab--&gt;col)--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line951">951</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,i)))</span></span>
<span class="tr"><span class="th" id="line952">952</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            print &quot;--&quot;;</span></span>
<span class="tr"><span class="th" id="line953">953</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else {</span></span>
<span class="tr"><span class="th" id="line954">954</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            PrintKindValuePair(kov, v);</span></span>
<span class="tr"><span class="th" id="line955">955</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line956">956</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line957">957</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__p = 1;</span></span>
<span class="tr"><span class="th" id="line958">958</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line959">959</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line960">960</span><span class="td">[ TableRowDebug tab i col k v tc kov;</span></span>
<span class="tr"><span class="th" id="line961">961</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line962">962</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((i&lt;1) || (i&gt;k)) &quot;No such row&quot;;</span></span>
<span class="tr"><span class="th" id="line963">963</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    print &quot;(row &quot;, i, &quot;)  |&quot;;</span></span>
<span class="tr"><span class="th" id="line964">964</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (col=1: col&lt;=tab--&gt;0: col++) {</span></span>
<span class="tr"><span class="th" id="line965">965</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot; &quot;;</span></span>
<span class="tr"><span class="th" id="line966">966</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        tc = ((tab--&gt;col)--&gt;1) &amp; TB_COLUMN_NUMBER;</span></span>
<span class="tr"><span class="th" id="line967">967</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        kov = TC_KOV(tc);</span></span>
<span class="tr"><span class="th" id="line968">968</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v = (tab--&gt;col)--&gt;(i+COL_HSIZE);</span></span>
<span class="tr"><span class="th" id="line969">969</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if ((v == TABLE_NOVALUE) &amp;&amp; (CheckTableEntryIsBlank(tab,col,i)))</span></span>
<span class="tr"><span class="th" id="line970">970</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            print &quot;-- &quot;;</span></span>
<span class="tr"><span class="th" id="line971">971</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else {</span></span>
<span class="tr"><span class="th" id="line972">972</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            PrintKindValuePair(kov, v);</span></span>
<span class="tr"><span class="th" id="line973">973</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            print &quot; |&quot;;</span></span>
<span class="tr"><span class="th" id="line974">974</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line975">975</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line976">976</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__p = 1;</span></span>
<span class="tr"><span class="th" id="line977">977</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line978">978</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line979">979</span><span class="td">[ TableDebug tab i k;</span></span>
<span class="tr"><span class="th" id="line980">980</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    PrintTableName(tab); print &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line981">981</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    k = TableRows(tab);</span></span>
<span class="tr"><span class="th" id="line982">982</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=1:i&lt;=k:i++) { TableRowDebug(tab, i); print &quot;^&quot;; }</span></span>
<span class="tr"><span class="th" id="line983">983</span><span class="td">];</span></span>
</div><footer><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
