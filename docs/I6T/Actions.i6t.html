<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Actions</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
.pre-lines { font-family: monospace; margin-left: 3rem; line-height: 1.5rem; }
/*span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}*/
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 3rem 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 48rem; }
/* h3 { margin-top: 1.5rem; padding-top: 1.5rem; }*/
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: .5rem; margin-bottom: 1.5rem; margin-top: 1.75rem; padding-top: .25rem;}
footer { margin-top: 3rem; padding-top: 1rem; border-top: .5px solid black; margin-bottom: 0;}
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
.dstring { font-weight: bold;
  color: #095097; }
.sstring { font-weight: bold;
  color: #095097; }
.comment {  
  color: #156D15; } /* #207D20; */
td.content { padding-right: 2rem; vertical-align: top;}
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Contents</a> &bull; <a href="./Introduction.i6t.html">Introduction</a> 
&bull; <a href="fn_index.html">Function Index</a> 
&bull; <a href="rules_index.html">Rules Index</a> 
</div><hr></header>
<div id="front_matter">
<h2><a href="./Actions.i6t.txt">Actions.i6t</a></h2><h3 id="actions-summary">Summary.</h3><p><p> To review: an action is an impulse to do something by a person in the model world. Commands such as DROP POTATO are converted into actions (&quot;dropping the Idaho potato&quot;); sometimes they succeed, sometimes they fail. While they run, the fairly complicated details are stored in a suite of I6 global variables such as <span class="fixed"><a href="./Output.i6t.html#line237">actor</a></span>, <span class="fixed"><a href="./Output.i6t.html#line248">noun</a></span>, <span class="fixed"><a href="./Output.i6t.html#line242">inp1</a></span>, and so on (see <a href="./OrderOfPlay.i6t.html">OrderOfPlay.i6t</a> for details); the running of an action is mainly a matter of processing many rulebooks, chief among them they &quot;action processing rules&quot;.<p></p><p> In general, actions can come from five different sources:<p></p><p> (i) As a result of parsing the player&#39;s command: there are actually two ways this can happen, one if the command calls for a single action, and another if it calls for a whole run of them (like TAKE ALL). See the rules in <a href="./OrderOfPlay.i6t.html">OrderOfPlay.i6t</a>. (ii) From an I7 &quot;try&quot; phrase, in which case <span class="fixed"><a href="./Actions.i6t.html#line119">TryAction</a></span> is called. (iii) From an I6 angle-bracket-notation such as <span class="fixed">&lt;Wait&gt;</span>, though this is a syntax which is deprecated now, and is never normally used in I7. The I6 compiler converts such a syntax into a call to the <span class="fixed"><a href="./Actions.i6t.html#line171">R_Process</a></span> below. (iv) Through conversion of an existing action. For instance, &quot;removing the cup from the table&quot; is converted in the Standard Rules to &quot;taking the cup&quot;. This is done via a routine called <span class="fixed"><a href="./Actions.i6t.html#line182">GVS_Convert</a></span>. (v) When a request is successful, the &quot;carry out requested actions&quot; rule turns the original action &ndash; a request by the player, such as is produced by CHOPIN, PLAY POLONAISE &ndash; into an action by the person asked, such as &quot;Chopin playing the Polonaise&quot;.<p></p><p> Certain exceptional cases can arise for other reasons:<p></p><p> (vi) Implicit taking actions are generated by the &quot;carrying requirements rule&quot; when the actor tries something which requires him to be holding an item which he can see, but is not currently holding. (vii) A partial but intentionally incomplete form of the &quot;looking&quot; action is generated when describing the new location at the end of a &quot;going&quot; action.<p></p><p> In every case except (vii), the action is carried out by <span class="fixed"><a href="./Actions.i6t.html#line305">BeginAction</a></span>, the single routine which unifies all of these approaches. Except the last one.<p></p><p> This segment of the template is divided into two: first, the I6 code needed for (i) to (vii), the alternative ways for actions to begin; and secondly the common machinery into which all actions eventually pass.<p></p><p><h3 id="actions-action-data">Action Data.</h3><p><p> This is perhaps a good place to document the <span class="fixed">ActionData</span> array, a convenient table of metadata about the actions. Since this is compiled by NI, the following structure can&#39;t be modified here without making matching changes in NI. <span class="fixed">ActionData</span> is an I6 <span class="fixed">table</span> containing a series of fixed-length records, one on each action.<p></p><p> The routine <span class="fixed"><a href="./Actions.i6t.html#line72">FindAction</a></span> locates the record in this table for a given action number, returning its word offset within the table: the argument <em>-1</em> means &quot;the current action&quot;.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line63">63</span><span class="td">Constant AD_ACTION = 0; <span class="comment">! The I6 action number (0 to 4095)</span></span></span>
<span class="tr"><span class="th" id="line64">64</span><span class="td">Constant AD_REQUIREMENTS = 1; <span class="comment">! Such as requiring light; a bitmap, see below</span></span></span>
<span class="tr"><span class="th" id="line65">65</span><span class="td">Constant AD_NOUN_KOV = 2; <span class="comment">! Kind of value of the first noun</span></span></span>
<span class="tr"><span class="th" id="line66">66</span><span class="td">Constant AD_SECOND_KOV = 3; <span class="comment">! Kind of value of the second noun</span></span></span>
<span class="tr"><span class="th" id="line67">67</span><span class="td">Constant AD_VARIABLES_CREATOR = 4; <span class="comment">! Routine to initialise variables owned</span></span></span>
<span class="tr"><span class="th" id="line68">68</span><span class="td">Constant AD_VARIABLES_ID = 5; <span class="comment">! Frame ID for variables owned by action</span></span></span>
<span class="tr"><span class="th" id="line69">69</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line70">70</span><span class="td">Constant AD_RECORD_SIZE = 6;</span></span>
<span class="tr"><span class="th" id="line71">71</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line72">72</span><span class="td">[ FindAction fa t;</span></span>
<span class="tr"><span class="th" id="line73">73</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (fa == -1) fa = action;</span></span>
<span class="tr"><span class="th" id="line74">74</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;t = 1;</span></span>
<span class="tr"><span class="th" id="line75">75</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (t &lt;= ActionData--&gt;0) {</span></span>
<span class="tr"><span class="th" id="line76">76</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (fa == ActionData--&gt;t) return t;</span></span>
<span class="tr"><span class="th" id="line77">77</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t = t + AD_RECORD_SIZE;</span></span>
<span class="tr"><span class="th" id="line78">78</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line79">79</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line80">80</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line81">81</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line82">82</span><span class="td">[ ActionNumberIndexed i;</span></span>
<span class="tr"><span class="th" id="line83">83</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((i&gt;=0) &amp;&amp; (i &lt; AD_RECORDS)) return ActionData--&gt;(i*AD_RECORD_SIZE + AD_ACTION + 1);</span></span>
<span class="tr"><span class="th" id="line84">84</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</span></span>
<span class="tr"><span class="th" id="line85">85</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-requirements-bitmap">Requirements Bitmap.</h3><p><p> As noted above, the <span class="fixed"><a href="./Actions.i6t.html#line64">AD_REQUIREMENTS</a></span> field is a bitmap of flags for various possible action requirements:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line92">92</span><span class="td">Constant TOUCH_NOUN_ABIT   = $$00000001;</span></span>
<span class="tr"><span class="th" id="line93">93</span><span class="td">Constant TOUCH_SECOND_ABIT = $$00000010;</span></span>
<span class="tr"><span class="th" id="line94">94</span><span class="td">Constant LIGHT_ABIT        = $$00000100;</span></span>
<span class="tr"><span class="th" id="line95">95</span><span class="td">Constant NEED_NOUN_ABIT    = $$00001000;</span></span>
<span class="tr"><span class="th" id="line96">96</span><span class="td">Constant NEED_SECOND_ABIT  = $$00010000;</span></span>
<span class="tr"><span class="th" id="line97">97</span><span class="td">Constant OUT_OF_WORLD_ABIT = $$00100000;</span></span>
<span class="tr"><span class="th" id="line98">98</span><span class="td">Constant CARRY_NOUN_ABIT   = $$01000000;</span></span>
<span class="tr"><span class="th" id="line99">99</span><span class="td">Constant CARRY_SECOND_ABIT = $$10000000;</span></span>
<span class="tr"><span class="th" id="line100">100</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line101">101</span><span class="td">[ NeedToCarryNoun;       return TestActionMask(CARRY_NOUN_ABIT); ];</span></span>
<span class="tr"><span class="th" id="line102">102</span><span class="td">[ NeedToCarrySecondNoun; return TestActionMask(CARRY_SECOND_ABIT); ];</span></span>
<span class="tr"><span class="th" id="line103">103</span><span class="td">[ NeedToTouchNoun;       return TestActionMask(TOUCH_NOUN_ABIT); ];</span></span>
<span class="tr"><span class="th" id="line104">104</span><span class="td">[ NeedToTouchSecondNoun; return TestActionMask(TOUCH_SECOND_ABIT); ];</span></span>
<span class="tr"><span class="th" id="line105">105</span><span class="td">[ NeedLightForAction;    return TestActionMask(LIGHT_ABIT); ];</span></span>
<span class="tr"><span class="th" id="line106">106</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line107">107</span><span class="td">[ TestActionMask match mask at; </span></span>
<span class="tr"><span class="th" id="line108">108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;at = FindAction(-1); </span></span>
<span class="tr"><span class="th" id="line109">109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (at == 0) rfalse; </span></span>
<span class="tr"><span class="th" id="line110">110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;mask = ActionData--&gt;(at+AD_REQUIREMENTS); </span></span>
<span class="tr"><span class="th" id="line111">111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (mask &amp; match) rtrue; </span></span>
<span class="tr"><span class="th" id="line112">112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse; </span></span>
<span class="tr"><span class="th" id="line113">113</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-try-action">Try Action.</h3><p><p> This is method (ii) in the summary above.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line119">119</span><span class="td">[ TryAction req by ac n s stora smeta tbits saved_command text_of_command;</span></span>
<span class="tr"><span class="th" id="line120">120</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (stora) return STORED_ACTION_TY_New(ac, n, s, by, req, stora);</span></span>
<span class="tr"><span class="th" id="line121">121</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;tbits = req &amp; (16+32);</span></span>
<span class="tr"><span class="th" id="line122">122</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;req = req &amp; 1;</span></span>
<span class="tr"><span class="th" id="line123">123</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push actor; @push act_requester; @push inp1; @push inp2;</span></span>
<span class="tr"><span class="th" id="line124">124</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push parsed_number; smeta = meta;</span></span>
<span class="tr"><span class="th" id="line125">125</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actor = by; if (req) act_requester = player; else act_requester = 0;</span></span>
<span class="tr"><span class="th" id="line126">126</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line127">127</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;by = FindAction(ac);</span></span>
<span class="tr"><span class="th" id="line128">128</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (by) {</span></span>
<span class="tr"><span class="th" id="line129">129</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ActionData--&gt;(by+AD_NOUN_KOV) == OBJECT_TY) inp1 = n;</span></span>
<span class="tr"><span class="th" id="line130">130</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else { inp1 = 1; parsed_number = n; }</span></span>
<span class="tr"><span class="th" id="line131">131</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ActionData--&gt;(by+AD_SECOND_KOV) == OBJECT_TY) inp2 = s;</span></span>
<span class="tr"><span class="th" id="line132">132</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else { inp2 = 1; parsed_number = s; }</span></span>
<span class="tr"><span class="th" id="line133">133</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (((ActionData--&gt;(by+AD_NOUN_KOV) == UNDERSTANDING_TY) ||</span></span>
<span class="tr"><span class="th" id="line134">134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ActionData--&gt;(by+AD_SECOND_KOV) == UNDERSTANDING_TY)) &amp;&amp; (tbits)) {</span></span>
<span class="tr"><span class="th" id="line135">135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;saved_command = BlkValueCreate(TEXT_TY);</span></span>
<span class="tr"><span class="th" id="line136">136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueCast(saved_command, SNIPPET_TY, players_command);</span></span>
<span class="tr"><span class="th" id="line137">137</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_of_command = BlkValueCreate(TEXT_TY);</span></span>
<span class="tr"><span class="th" id="line138">138</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueCopy(text_of_command, parsed_number);</span></span>
<span class="tr"><span class="th" id="line139">139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetPlayersCommand(text_of_command);</span></span>
<span class="tr"><span class="th" id="line140">140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (tbits == 16) {</span></span>
<span class="tr"><span class="th" id="line141">141</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n = players_command; inp1 = 1; parsed_number = players_command;</span></span>
<span class="tr"><span class="th" id="line142">142</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line143">143</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s = players_command; inp2 = 1; parsed_number = players_command;</span></span>
<span class="tr"><span class="th" id="line144">144</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line145">145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueFree(text_of_command);</span></span>
<span class="tr"><span class="th" id="line146">146</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push consult_from; @push consult_words;</span></span>
<span class="tr"><span class="th" id="line147">147</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consult_from = 1; consult_words = parsed_number - 100;</span></span>
<span class="tr"><span class="th" id="line148">148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line149">149</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line150">150</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line151">151</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BeginAction(ac, n, s, 0, true);</span></span>
<span class="tr"><span class="th" id="line152">152</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line153">153</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (saved_command) {</span></span>
<span class="tr"><span class="th" id="line154">154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull consult_words; @pull consult_from;</span></span>
<span class="tr"><span class="th" id="line155">155</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetPlayersCommand(saved_command);</span></span>
<span class="tr"><span class="th" id="line156">156</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueFree(saved_command);</span></span>
<span class="tr"><span class="th" id="line157">157</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line158">158</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line159">159</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;meta = smeta; @pull parsed_number;</span></span>
<span class="tr"><span class="th" id="line160">160</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull inp2; @pull inp1; @pull act_requester; @pull actor;</span></span>
<span class="tr"><span class="th" id="line161">161</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TrackActions(true, smeta);</span></span>
<span class="tr"><span class="th" id="line162">162</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-i6-angle-brackets">I6 Angle Brackets.</h3><p><p> This is method (iii) in the summary above. The routine here has slightly odd conventions and a curious name which would take too long to explain: neither can be changed without amending the veneer code within the I6 compiler.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line171">171</span><span class="td">[ R_Process a i j;</span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push inp1; @push inp2;</span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;inp1 = i; inp2 = j; BeginAction(a, i, j);</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull inp2; @pull inp1;</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-conversion">Conversion.</h3><p><p> This is method (iv) in the summary above.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line181">181</span><span class="td">Global converted_action_outcome = -1;</span></span>
<span class="tr"><span class="th" id="line182">182</span><span class="td">[ GVS_Convert ac n s;</span></span>
<span class="tr"><span class="th" id="line183">183</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;converted_action_outcome = BeginAction(ac, n, s);</span></span>
<span class="tr"><span class="th" id="line184">184</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (converted_action_outcome == true) FollowRulebook( (+ after rules +), nothing, true );</span></span>
<span class="tr"><span class="th" id="line185">185</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line186">186</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line187">187</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line188">188</span><span class="td">[ ConvertToRequest X AN Y Z;</span></span>
<span class="tr"><span class="th" id="line189">189</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;WORK_OUT_DETAILS_OF_SPECIFIC_R();</span></span>
<span class="tr"><span class="th" id="line190">190</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (X == player) TryAction(false, X, AN, Y, Z);</span></span>
<span class="tr"><span class="th" id="line191">191</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else TryAction(true, X, AN, Y, Z);</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">[ ConvertToGoingWithPush i oldrm newrm infl;</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i=noun;</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (IndirectlyContains(noun, actor) == false) { move i to actor; infl = true; }</span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;move_pushing = i;</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;oldrm = LocationOf(noun);</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BeginAction(##Go, second);</span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;newrm = LocationOf(actor);</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;move_pushing = nothing; move i to newrm;</span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (newrm ~= oldrm) {</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (IndirectlyContains(i, player)) TryAction(0, player, ##Look, 0, 0);</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookSucceeds();</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;} else RulebookFails();</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-implicit-take">Implicit Take.</h3><p><p> This is method (vi) in the summary above.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line214">214</span><span class="td">[ ImplicitTake obj ks;</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { STANDARD_IMPLICIT_TAKING_RM(<span class="sstring">&#39;A&#39;</span>, obj); }</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else {</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TestVisibility(player, actor))</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STANDARD_IMPLICIT_TAKING_RM(<span class="sstring">&#39;B&#39;</span>, obj, actor);</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ClearParagraphing(3);</span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push keep_silent; keep_silent = true;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push say__p; @push say__pc; ClearParagraphing(4);</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (act_requester) TryAction(true, actor, ##Take, obj, nothing);</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else TryAction(false, actor, ##Take, obj, nothing);</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;DivideParagraphPoint(); @pull say__pc; @pull say__p; AdjustParagraphPoint(); @pull keep_silent;</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (obj in actor) rtrue;</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-look-after-going">Look After Going.</h3><p><p> This is method (vii) in the summary above.<p></p><p> Fundamentally, room descriptions arise through looking actions, but they are also printed after successful going actions, with a special form of paragraph break (see <a href="./Printing.i6t.html">Printing.i6t</a> for an explanation of this). Room descriptions through looking are always given in full, unless we have SUPERBRIEF mode set.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line240">240</span><span class="td">[ LookAfterGoing;</span></span>
<span class="tr"><span class="th" id="line241">241</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;GoingLookBreak();</span></span>
<span class="tr"><span class="th" id="line242">242</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;AbbreviatedRoomDescription();</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-abbreviated-room-description">Abbreviated Room Description.</h3><p><p> This is used when we want a room description with the same abbreviation conventions as after a going action, and we don&#39;t quite want a looking action fully to take place. We nevertheless want to be sure that the action variables for looking exist, and in particular, we want to set the &quot;room-describing action&quot; variable to the action which was prevailing when the room description was called for. We also set &quot;abbreviated form allowed&quot; to &quot;true&quot;: when the ordinary looking action is running, this is &quot;false&quot;.<p></p><p> The actual description occurs during <span class="fixed">LookSub</span>, which is the specific action processing stage for the &quot;looking&quot; action: thus, we use the check, carry out, after and report rules as if we were &quot;looking&quot;, but are unaffected by before or instead rules.<p></p><p> Uniquely, this pseudo-action does not use <span class="fixed"><a href="./Actions.i6t.html#line305">BeginAction</a></span>: it works only through the specific action processing rules, not the main action-processing ones, though that is not easy to see from the code below because it is hidden in the call to <span class="fixed">LookSub</span>. The <span class="fixed">-Sub</span> suffix is an I6 usage identifying this as the routine to go along with the action <span class="fixed">##Look</span>, and so it is, but it looks nothing like the <span class="fixed">LookSub</span> of the old I6 library. NI compiles <span class="fixed">-Sub</span> routines like so:<p></p><p><div class="pre-lines">[ LookSub; return GenericVerbSub(153,154,155); ];</div><p></p><p> (with whatever rulebook numbers are appropriate). <span class="fixed"><a href="./Actions.i6t.html#line684">GenericVerbSub</a></span> then runs through the specific action processing stage.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line274">274</span><span class="td">[ AbbreviatedRoomDescription  prior_action pos frame_id;</span></span>
<span class="tr"><span class="th" id="line275">275</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;prior_action = action; </span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action = ##Look;</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pos = FindAction(##Look);</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((pos) &amp;&amp; (ActionData--&gt;(pos+AD_VARIABLES_CREATOR))) {</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame_id = ActionData--&gt;(pos+AD_VARIABLES_ID);</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mstack_Create_Frame(ActionData--&gt;(pos+AD_VARIABLES_CREATOR), frame_id);</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FollowRulebook(SETTING_ACTION_VARIABLES_RB);</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(MStack--&gt;MstVO(frame_id, 0)) = prior_action; <span class="comment">! &quot;room-describing action&quot;</span></span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(MStack--&gt;MstVO(frame_id, 1)) = true; <span class="comment">! &quot;abbreviated form allowed&quot;</span></span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;LookSub(); <span class="comment">! The I6 verb routine for &quot;looking&quot;</span></span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (frame_id) Mstack_Destroy_Frame(ActionData--&gt;(pos+AD_VARIABLES_CREATOR), frame_id);</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action = prior_action;</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-begin-action">Begin Action.</h3><p><p> We now begin the second half of the segment: the machinery which handles all actions.<p></p><p> The significance of 4096 here is that this is how I6 distinguishes genuine actions &ndash; numbered upwards in order of creation &ndash; from what I6 calls &quot;fake actions&quot; &ndash; numbered upwards from 4096. Fake actions are hardly used at all in I7, and certainly shouldn&#39;t get here, but it&#39;s possible nonetheless using I6 angled-brackets, so... In other respects all we do is to save details of whatever current action is happening onto the stack, and then call <span class="fixed"><a href="./Actions.i6t.html#line337">ActionPrimitive</a></span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line305">305</span><span class="td">[ BeginAction a n s moi notrack  rv;</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ChronologyPoint();</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push action; @push noun; @push second; @push self; @push multiple_object_item;</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action = a; noun = n; second = s; self = noun; multiple_object_item = moi;</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (action &lt; 4096) rv = ActionPrimitive();</span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line313">313</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull multiple_object_item; @pull self; @pull second; @pull noun; @pull action;</span></span>
<span class="tr"><span class="th" id="line314">314</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line315">315</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (notrack == false) TrackActions(true, meta);</span></span>
<span class="tr"><span class="th" id="line316">316</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return rv;</span></span>
<span class="tr"><span class="th" id="line317">317</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-action-primitive">Action Primitive.</h3><p><p> This is somewhat different from the I6 library counterpart which gives it its name, but the idea is the same. It has no arguments at all: everything it needs to know is now stored in global variables. The routine looks long, but really contains little: it&#39;s all just book-keeping, printing debugging information if ACTIONS is in force, etc., with all of the actual work delegated to the action processing rulebook.<p></p><p> We use a rather sneaky device to handle out-of-world actions, those for which the <span class="fixed"><a href="./Output.i6t.html#line241">meta</a></span> flag is set: we make it look to the system as if the &quot;action processing rulebook&quot; is being followed, so that all its variables are created and placed in scope, but at the crucial moment we descend to the specific action processing rules directly instead of processing the main rulebook. This is what short-circuits out of world actions and protects them from before and instead rules: see the Standard Rules for more discussion of this.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line337">337</span><span class="td">[ ActionPrimitive  rv p1 p2 p3 p4 p5 frame_id;</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack_CreateRBVars(ACTION_PROCESSING_RB);</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((keep_silent == false) &amp;&amp; (multiflag == false)) DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = 0;</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;frame_id = -1;</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;p1 = FindAction(action);</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((p1) &amp;&amp; (ActionData--&gt;(p1+AD_VARIABLES_CREATOR))) {</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame_id = ActionData--&gt;(p1+AD_VARIABLES_ID);</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mstack_Create_Frame(ActionData--&gt;(p1+AD_VARIABLES_CREATOR), frame_id);</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (ActionVariablesNotTypeSafe()) {</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor ~= player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;K&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (frame_id ~= -1)</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mstack_Destroy_Frame(ActionData--&gt;(p1+AD_VARIABLES_CREATOR), frame_id);</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MStack_DestroyRBVars(ACTION_PROCESSING_RB);</span></span>
<span class="tr"><span class="th" id="line354">354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line355">355</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line356">356</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line357">357</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;FollowRulebook(SETTING_ACTION_VARIABLES_RB);</span></span>
<span class="tr"><span class="th" id="line358">358</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#IFDEF DEBUG;</span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((trace_actions) &amp;&amp; (FindAction(-1))) {</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;[&quot;</span>; p1=actor; p2=act_requester; p3=action; p4=noun; p5=second;</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DB_Action(p1,p2,p3,p4,p5);</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;]^&quot;</span>; ClearParagraphing(5);</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line365">365</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;++debug_rule_nesting;</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#ENDIF;</span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TrackActions(false, meta);</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((meta) &amp;&amp; (actor ~= player)) {</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;A&#39;</span>, actor); new_line; rv = RS_FAILS; }</span></span>
<span class="tr"><span class="th" id="line370">370</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else if (meta) { DESCEND_TO_SPECIFIC_ACTION_R(); rv = RulebookOutcome(); }</span></span>
<span class="tr"><span class="th" id="line371">371</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else { FollowRulebook(ACTION_PROCESSING_RB); rv = RulebookOutcome(); }</span></span>
<span class="tr"><span class="th" id="line372">372</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#IFDEF DEBUG;</span></span>
<span class="tr"><span class="th" id="line373">373</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;--debug_rule_nesting;</span></span>
<span class="tr"><span class="th" id="line374">374</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((trace_actions) &amp;&amp; (FindAction(-1))) {</span></span>
<span class="tr"><span class="th" id="line375">375</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;[&quot;</span>; DB_Action(p1,p2,p3,p4,p5); print <span class="dstring">&quot; - &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (rv) {</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_SUCCEEDS: print <span class="dstring">&quot;succeeded&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RS_FAILS: print <span class="dstring">&quot;failed&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#IFNDEF MEMORY_ECONOMY;</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (reason_the_action_failed)</span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot; the &quot;</span>,</span></span>
<span class="tr"><span class="th" id="line382">382</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RulePrintingRule) reason_the_action_failed;</span></span>
<span class="tr"><span class="th" id="line383">383</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ENDIF;</span></span>
<span class="tr"><span class="th" id="line384">384</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default: print <span class="dstring">&quot;ended without result&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line385">385</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line386">386</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;]^&quot;</span>; say__p = 1;</span></span>
<span class="tr"><span class="th" id="line387">387</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetRulebookOutcome(rv); <span class="comment">! In case disturbed by printing activities</span></span></span>
<span class="tr"><span class="th" id="line388">388</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line389">389</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#ENDIF;</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (rv == RS_SUCCEEDS) UpdateActionBitmap();</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (frame_id ~= -1) {</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p1 = FindAction(action);</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mstack_Destroy_Frame(ActionData--&gt;(p1+AD_VARIABLES_CREATOR), frame_id);</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack_DestroyRBVars(ACTION_PROCESSING_RB);</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((keep_silent == false) &amp;&amp; (multiflag == false)) DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (rv == RS_SUCCEEDS) rtrue;</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-internal-rule">Internal Rule.</h3><p><p> Provided only as a hook on which to hang responses.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line405">405</span><span class="td">[ ACTION_PROCESSING_INTERNAL_R; ];</span></span>
</div><div class='text'>
<h3 id="actions-type-safety">Type Safety.</h3><p><p> Some basic action requirements have to be met before we can go any further: if they aren&#39;t, then it isn&#39;t type-safe even to run the action processing rulebook.<p></p><p> (i) For an out of world action, we set the <span class="fixed"><a href="./Output.i6t.html#line241">meta</a></span> flag. Otherwise: (ii) If either the noun or second noun is a topic, then this is an action arising from parsing (such actions do not arise through the &quot;try&quot; phrase, unless by stored actions in which case this has all happened before and doesn&#39;t need to be done again) &ndash; the parser places details of which words make up the topic in the I6 global variables <span class="fixed"><a href="./Output.i6t.html#line260">consult_words</a></span> and <span class="fixed"><a href="./Output.i6t.html#line259">consult_from</a></span>. We convert them to a valid I7 snippet value. (iii) If either the first or second noun is supposed to be an object but seems here to be a value, or vice versa, we stop with a parser error. (This should be fairly difficult to provoke: NI&#39;s type-checking will make it difficult to arrange without I6 subterfuges.) (iv) If either the first or second noun is supposed to be an object and required to exist, yet is missing, we use the &quot;supplying a missing noun&quot; or &quot;supplying a missing second noun&quot; activities to fill the void.<p></p><p> We return <span class="fixed">true</span> if type safety is violated, <span class="fixed">false</span> if all is well.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line430">430</span><span class="td">[ ActionVariablesNotTypeSafe mask noun_kova second_kova at;</span></span>
<span class="tr"><span class="th" id="line431">431</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;at = FindAction(-1); if (at == 0) rfalse; <span class="comment">! For any I6-defined actions</span></span></span>
<span class="tr"><span class="th" id="line432">432</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line433">433</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;noun_kova = ActionData--&gt;(at+AD_NOUN_KOV);</span></span>
<span class="tr"><span class="th" id="line434">434</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;second_kova = ActionData--&gt;(at+AD_SECOND_KOV);</span></span>
<span class="tr"><span class="th" id="line435">435</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line436">436</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;at = &quot;, at, &quot; nst = &quot;, noun_kova, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line437">437</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;consult_from = &quot;, consult_from, &quot; consult_words = &quot;, consult_from, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;inp1 = &quot;, inp1, &quot; noun = &quot;, noun, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;inp2 = &quot;, inp2, &quot; second = &quot;, second, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;sst = &quot;, second_kova, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (noun_kova == SNIPPET_TY or UNDERSTANDING_TY) {</span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (inp1 ~= 1) { inp2 = inp1; second = noun; }</span></span>
<span class="tr"><span class="th" id="line444">444</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsed_number = 100*consult_from + consult_words;</span></span>
<span class="tr"><span class="th" id="line445">445</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inp1 = 1; noun = nothing; <span class="comment">! noun = parsed_number;</span></span></span>
<span class="tr"><span class="th" id="line446">446</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line447">447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (second_kova == SNIPPET_TY or UNDERSTANDING_TY) {</span></span>
<span class="tr"><span class="th" id="line448">448</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsed_number = 100*consult_from + consult_words;</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inp2 = 1; second = nothing; <span class="comment">! second = parsed_number;</span></span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;mask = ActionData--&gt;(at+AD_REQUIREMENTS);</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (mask &amp; OUT_OF_WORLD_ABIT) { meta = 1; rfalse; }</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;meta = 0;</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (inp1 == 1) {</span></span>
<span class="tr"><span class="th" id="line457">457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noun_kova == OBJECT_TY) {</span></span>
<span class="tr"><span class="th" id="line458">458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;B&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line459">459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line460">460</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noun_kova ~= OBJECT_TY) {</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;C&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; NEED_NOUN_ABIT) &amp;&amp; (noun == nothing)) {</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push act_requester; act_requester = nothing;</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CarryOutActivity(SUPPLYING_A_MISSING_NOUN_ACT);</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull act_requester;</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noun == nothing) {</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (say__p) rtrue;</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;D&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (((mask &amp; NEED_NOUN_ABIT) == 0) &amp;&amp; (noun ~= nothing)) {</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;E&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line478">478</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line479">479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line480">480</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line481">481</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line482">482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (inp2 == 1) {</span></span>
<span class="tr"><span class="th" id="line483">483</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (second_kova == OBJECT_TY) {</span></span>
<span class="tr"><span class="th" id="line484">484</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;F&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line485">485</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line486">486</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line487">487</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line488">488</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (second_kova ~= OBJECT_TY) {</span></span>
<span class="tr"><span class="th" id="line489">489</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;G&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line490">490</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line491">491</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; NEED_SECOND_ABIT) &amp;&amp; (second == nothing)) {</span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push act_requester; act_requester = nothing;</span></span>
<span class="tr"><span class="th" id="line494">494</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CarryOutActivity(SUPPLYING_A_MISSING_SECOND_ACT);</span></span>
<span class="tr"><span class="th" id="line495">495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull act_requester;</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (second == nothing) {</span></span>
<span class="tr"><span class="th" id="line497">497</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (say__p) rtrue;</span></span>
<span class="tr"><span class="th" id="line498">498</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;H&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line499">499</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line500">500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line501">501</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line502">502</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (((mask &amp; NEED_SECOND_ABIT) == 0) &amp;&amp; (second ~= nothing)) {</span></span>
<span class="tr"><span class="th" id="line503">503</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor == player) { ACTION_PROCESSING_INTERNAL_RM(<span class="sstring">&#39;I&#39;</span>); new_line; }</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line509">509</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-basic-visibility-rule">Basic Visibility Rule.</h3><p><p> This is one of the I6 primitive rules in the action processing rulebook: see the account in the Standard Rules for details.<p></p><p> Note that this rule only blocks the player from acting in darkness: this is because light is only reckoned from the player&#39;s perspective in any case, so that it would be unfair to apply the rule to any other person.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line520">520</span><span class="td">[ BASIC_VISIBILITY_R;</span></span>
<span class="tr"><span class="th" id="line521">521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (act_requester) rfalse;</span></span>
<span class="tr"><span class="th" id="line522">522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((NeedLightForAction()) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line523">523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(actor == player) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(FollowRulebook(VISIBLE_RB)) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RulebookSucceeded())) {</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(REFUSAL_TO_ACT_IN_DARK_ACT);</span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ForActivity(REFUSAL_TO_ACT_IN_DARK_ACT)==false) {</span></span>
<span class="tr"><span class="th" id="line528">528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BASIC_VISIBILITY_RM(<span class="sstring">&#39;A&#39;</span>); new_line;</span></span>
<span class="tr"><span class="th" id="line529">529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(REFUSAL_TO_ACT_IN_DARK_ACT);</span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_VISIBILITY_R;</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line533">533</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line534">534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line535">535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line536">536</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-basic-accessibility-rule">Basic Accessibility Rule.</h3><p><p> This is one of the I6 primitive rules in the action processing rulebook: see the account in the Standard Rules for details.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line543">543</span><span class="td">[ BASIC_ACCESSIBILITY_R mask at;</span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (act_requester) rfalse;</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;at = FindAction(-1);</span></span>
<span class="tr"><span class="th" id="line546">546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (at == 0) rfalse;</span></span>
<span class="tr"><span class="th" id="line547">547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;mask = ActionData--&gt;(at+AD_REQUIREMENTS);</span></span>
<span class="tr"><span class="th" id="line548">548</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line549">549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; TOUCH_NOUN_ABIT) &amp;&amp; noun &amp;&amp; (inp1 ~= 1)) {</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noun ofclass K3_direction) {</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_ACCESSIBILITY_R; </span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor~=player) rtrue;</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BASIC_ACCESSIBILITY_RM(<span class="sstring">&#39;A&#39;</span>); new_line;</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_ACCESSIBILITY_R; </span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ObjectIsUntouchable(noun, (actor~=player), actor)) {</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_ACCESSIBILITY_R;</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; TOUCH_SECOND_ABIT) &amp;&amp; second &amp;&amp; (inp2 ~= 1)) {</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (second ofclass K3_direction) {</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_ACCESSIBILITY_R;</span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (actor~=player) rtrue;</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BASIC_ACCESSIBILITY_RM(<span class="sstring">&#39;A&#39;</span>); new_line;</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_ACCESSIBILITY_R; </span></span>
<span class="tr"><span class="th" id="line574">574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line575">575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line576">576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ObjectIsUntouchable(second, (actor~=player), actor)) {</span></span>
<span class="tr"><span class="th" id="line577">577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line578">578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = BASIC_ACCESSIBILITY_R;</span></span>
<span class="tr"><span class="th" id="line579">579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line580">580</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line581">581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line582">582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line583">583</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-carrying-requirements-rule">Carrying Requirements Rule.</h3><p><p> This is one of the I6 primitive rules in the action processing rulebook: see the account in the Standard Rules for details.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line590">590</span><span class="td">[ CARRYING_REQUIREMENTS_R mask at;</span></span>
<span class="tr"><span class="th" id="line591">591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line592">592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;at = FindAction(-1);</span></span>
<span class="tr"><span class="th" id="line593">593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (at == 0) rfalse;</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;mask = ActionData--&gt;(at+AD_REQUIREMENTS);</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line596">596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; TOUCH_NOUN_ABIT) &amp;&amp; noun &amp;&amp; (inp1 ~= 1)) {</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; CARRY_NOUN_ABIT) &amp;&amp; (noun notin actor)) {</span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CarryOutActivity(IMPLICITLY_TAKING_ACT, noun);</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (noun notin actor) {</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = CARRYING_REQUIREMENTS_R;</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; TOUCH_SECOND_ABIT) &amp;&amp; second &amp;&amp; (inp2 ~= 1)) {</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((mask &amp; CARRY_SECOND_ABIT) &amp;&amp; (second notin actor)) {</span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CarryOutActivity(IMPLICITLY_TAKING_ACT, second);</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (second notin actor) {</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RulebookFails();</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reason_the_action_failed = CARRYING_REQUIREMENTS_R;</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-standard-implicit-taking-rule">Standard Implicit Taking Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line623">623</span><span class="td">[ STANDARD_IMPLICIT_TAKING_R;</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ImplicitTake(parameter_value);</span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-requested-actions-require-persuasion-rule">Requested Actions Require Persuasion Rule.</h3><p><p> This is one of the I6 primitive rules in the action processing rulebook: see the account in the Standard Rules for details.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line633">633</span><span class="td">[ REQUESTED_ACTIONS_REQUIRE_R rv;</span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((actor ~= player) &amp;&amp; (act_requester)) {</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push say__p;</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;say__p = 0;</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = FollowRulebook(PERSUADE_RB);</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (RulebookSucceeded() == false) {</span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((deadflag == false) &amp;&amp; (say__p == FALSE)) {</span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REQUESTED_ACTIONS_REQUIRE_RM(<span class="sstring">&#39;A&#39;</span>, actor);</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActRulebookFails(rv); rtrue;</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull say__p;</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-carry-out-requested-actions-rule">Carry Out Requested Actions Rule.</h3><p><p> This is one of the I6 primitive rules in the action processing rulebook: see the account in the Standard Rules for details.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line655">655</span><span class="td">[ CARRY_OUT_REQUESTED_ACTIONS_R rv;</span></span>
<span class="tr"><span class="th" id="line656">656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((actor ~= player) &amp;&amp; (act_requester)) {</span></span>
<span class="tr"><span class="th" id="line657">657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push act_requester; act_requester = nothing;</span></span>
<span class="tr"><span class="th" id="line658">658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = BeginAction(action, noun, second);</span></span>
<span class="tr"><span class="th" id="line659">659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (((meta) || (rv == false)) &amp;&amp; (deadflag == false)) {</span></span>
<span class="tr"><span class="th" id="line660">660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (FollowRulebook(UNSUCCESSFUL_ATTEMPT_RB) == false) {</span></span>
<span class="tr"><span class="th" id="line661">661</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CARRY_OUT_REQUESTED_ACTIONS_RM(<span class="sstring">&#39;A&#39;</span>, actor); new_line;</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull act_requester;</span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FollowRulebook(AFTER_RB);</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActRulebookSucceeds();</span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-generic-verb-subroutine">Generic Verb Subroutine.</h3><p><p> In I6, actions are carried out by routines with names like <span class="fixed">TakeSub</span>, consisting of <span class="fixed">-Sub</span> tacked on to the action name <span class="fixed">Take</span>. <span class="fixed">Sub</span> stands for &quot;subroutine&quot;: this is all a convention going back to Inform 1, which was in 1993 practically an assembler. In the I6 code generated by I7, every <span class="fixed">-Sub</span> routine corresponding to an I7 action consists only of a call to <span class="fixed"><a href="./Actions.i6t.html#line684">GenericVerbSub</a></span> which specifies the three rulebooks it owns: its check, carry out and report rulebooks.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line682">682</span><span class="td">Array Details_of_Specific_Action--&gt;5;</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">[ GenericVerbSub ch co re vis rv;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push converted_action_outcome;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;converted_action_outcome = -1;</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;Details_of_Specific_Action--&gt;0 = true;</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (meta) Details_of_Specific_Action--&gt;0 = false;</span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;Details_of_Specific_Action--&gt;1 = keep_silent;</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;Details_of_Specific_Action--&gt;2 = ch; <span class="comment">! Check rules for the action</span></span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;Details_of_Specific_Action--&gt;3 = co; <span class="comment">! Carry out rules for the action</span></span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;Details_of_Specific_Action--&gt;4 = re; <span class="comment">! Report rules for the action</span></span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;FollowRulebook(SPECIFIC_ACTION_PROCESSING_RB, 0, true);</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((RulebookFailed()) &amp;&amp; (converted_action_outcome == 1)) ActRulebookSucceeds();</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull converted_action_outcome;</span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-work-out-details-of-specific-action-rule">Work Out Details Of Specific Action Rule.</h3><p><p> This is one of the I6 primitive rules in the specific action processing rulebook, and it&#39;s basically a trick to allow information known to the <span class="fixed"><a href="./Actions.i6t.html#line684">GenericVerbSub</a></span> routine to be passed down as rulebook variables for the specific action-processing rules &ndash; in effect allowing us to pass not one but five parameters to the rulebook: the out-of-world and silence flags, plus the three specific rulebooks needed to process the action.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line711">711</span><span class="td">[ WORK_OUT_DETAILS_OF_SPECIFIC_R;</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack--&gt;MstVO(SPECIFIC_ACTION_PROCESSING_RB, 0) = Details_of_Specific_Action--&gt;0;</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack--&gt;MstVO(SPECIFIC_ACTION_PROCESSING_RB, 1) = Details_of_Specific_Action--&gt;1;</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack--&gt;MstVO(SPECIFIC_ACTION_PROCESSING_RB, 2) = Details_of_Specific_Action--&gt;2;</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack--&gt;MstVO(SPECIFIC_ACTION_PROCESSING_RB, 3) = Details_of_Specific_Action--&gt;3;</span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MStack--&gt;MstVO(SPECIFIC_ACTION_PROCESSING_RB, 4) = Details_of_Specific_Action--&gt;4;</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-actions-bitmap">Actions Bitmap.</h3><p><p> This is a fairly large bitmap recording which actions have succeeded thus far on which nouns. It was to some extent an early attempt at implementing a past-tense system; I&#39;m not at all sure it was successful, since it is hindered by certain restrictions &ndash; it only records action/noun combinations, for instance, and the notion of &quot;success&quot; is a vexed one for actions anyway. There is a clearly defined meaning, but it doesn&#39;t always correspond to what the user might expect, which is unfortunate.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line730">730</span><span class="td">[ TestActionBitmap obj act i j k bitmap;</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (obj == nothing) bitmap = ActionHappened;</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else {</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (~~(obj provides action_bitmap)) rfalse;</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitmap = obj.&amp;action_bitmap;</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (act == -1) return (((bitmap-&gt;0) &amp; 1) ~= 0); </span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (i=0, k=2: i&lt;ActionCount: i++) {</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (act == ActionCoding--&gt;i) {</span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (((bitmap-&gt;j) &amp; k) ~= 0);</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k = k*2; if (k == 256) { k = 1; j++; }</span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">[ UpdateActionBitmap;</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;SetActionBitmap(noun, action);</span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (action == ##Go) SetActionBitmap(location, ##Enter);</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">[ SetActionBitmap obj act i j k bitmap;</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (i=0, k=2: i&lt;ActionCount: i++) {</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (act == ActionCoding--&gt;i) {</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (obj provides action_bitmap) {</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitmap = obj.&amp;action_bitmap;</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitmap-&gt;0 = (bitmap-&gt;0) | 1;</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitmap-&gt;j = (bitmap-&gt;j) | k;</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionHappened-&gt;0 = (ActionHappened-&gt;0) | 1;</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionHappened-&gt;j = (ActionHappened-&gt;j) | k;</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k = k*2; if (k == 256) { k = 1; j++; }</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="actions-printing-actions">Printing Actions.</h3><p><p> This is really for debugging purposes, but also provides us with a way to print a stored action, for instance, or to print an action name value. (For instance, printing an action name might result in &quot;taking&quot;; printing a whole action might produce &quot;Henry taking the grapefruit&quot;.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line773">773</span><span class="td">[ SayActionName act; DB_Action(0, 0, act, 0, 0, 2); ];</span></span>
<span class="tr"><span class="th" id="line774">774</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line775">775</span><span class="td">[ DA_Name n; if (n ofclass K3_direction) print (name) n; else print (the) n; ];</span></span>
<span class="tr"><span class="th" id="line776">776</span><span class="td">[ DA_Topic x a b c d i cf cw;</span></span>
<span class="tr"><span class="th" id="line777">777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cw = x%100; cf = x/100;</span></span>
<span class="tr"><span class="th" id="line778">778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;~&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line779">779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (a=cf:d&lt;cw:d++,a++) {</span></span>
<span class="tr"><span class="th" id="line780">780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn = a; b = WordAddress(a); c = WordLength(a);</span></span>
<span class="tr"><span class="th" id="line781">781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=b:i&lt;b+c:i++) {</span></span>
<span class="tr"><span class="th" id="line782">782</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print (char) 0-&gt;i;</span></span>
<span class="tr"><span class="th" id="line783">783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line784">784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (d&lt;cw-1) print <span class="dstring">&quot; &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line785">785</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line786">786</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;~&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line787">787</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line788">788</span><span class="td">[ DA_Number n; print n; ];</span></span>
<span class="tr"><span class="th" id="line789">789</span><span class="td">[ DA_TruthState n; if (n==0) print <span class="dstring">&quot;false&quot;</span>; else print <span class="dstring">&quot;true&quot;</span>; ];</span></span>
<span class="tr"><span class="th" id="line790">790</span><span class="td">[ DB_Action ac acr act n s for_say t at l j v c clc;</span></span>
<span class="tr"><span class="th" id="line791">791</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((for_say == 0) &amp;&amp; (debug_rule_nesting &gt; 0))</span></span>
<span class="tr"><span class="th" id="line792">792</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;(&quot;</span>, debug_rule_nesting, <span class="dstring">&quot;) &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line793">793</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((ac ~= player) &amp;&amp; (for_say ~= 2)) {</span></span>
<span class="tr"><span class="th" id="line794">794</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (acr) print <span class="dstring">&quot;asking &quot;</span>, (the) ac, <span class="dstring">&quot; to try &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line795">795</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else print (the) ac, <span class="dstring">&quot; &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line796">796</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line797">797</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;DB_Action_Details(act, n, s, for_say);</span></span>
<span class="tr"><span class="th" id="line798">798</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((keep_silent) &amp;&amp; (for_say == 0)) print <span class="dstring">&quot; - silently&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line799">799</span><span class="td">];</span></span>
</div><footer><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
