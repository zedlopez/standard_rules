<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Parser</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 0 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 50rem; }
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: 1rem; margin-bottom: 2rem; }
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Index</a> &bull; <a href="./Introduction.html">Introduction</a></div><hr></header>
<div id="front_matter">
<h2><a href="./Parser.i6t">Parser.i6t</a></h2><h3>Grammar Line Variables.</h3><p><p> This is the I6 library parser in mostly untouched form: reformatted for template file use, and with paragraph divisions, but otherwise hardly changed at all. It is a complex algorithm but one which is known to produce good results for the most part, and it is well understood from (at time of writing) fifteen years of use. A few I7 additions have been made, but none disrupting the basic method. For instance, I7&#39;s system for resolving ambiguities is implemented by providing a <span class="fixed"><a href="./Parser.i6t.html#line3917">ChooseObjects</a></span> routine, just as a user of the I6 library would do.<p></p><p> The I6 parser uses a huge number of global variables, which is not to modern programming tastes: in the early days of Inform, the parser was essentially written in assembly-language only lightly structured by C-like syntaxes, and the Z-machine&#39;s 240 globals were more or less registers. The I6 library made no distinction between which were &quot;private&quot; to the parser and which allowed to be accessed by the user&#39;s code at large. The I7 template does impose that boundary, though not very strongly: the variables defined in <span class="fixed"><a href="./Output.i6t.html">Output.i6t</a></span> are for general access, while the ones below should only be read or written by the parser.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line29">29</span><span class="td">Global&nbsp;best_etype;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Preferred&nbsp;error&nbsp;number&nbsp;so&nbsp;far</span></span>
<span class="tr"><span class="th" id="line30">30</span><span class="td">Global&nbsp;nextbest_etype;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Preferred&nbsp;one,&nbsp;if&nbsp;ASKSCOPE_PE&nbsp;disallowed</span></span>
<span class="tr"><span class="th" id="line31">31</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line32">32</span><span class="td">Global&nbsp;parser_inflection;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;A&nbsp;property&nbsp;(usually&nbsp;&quot;name&quot;)&nbsp;to&nbsp;find&nbsp;object&nbsp;names&nbsp;in</span></span>
<span class="tr"><span class="th" id="line33">33</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line34">34</span><span class="td">Array&nbsp;pattern&nbsp;--&gt;&nbsp;32;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;For&nbsp;the&nbsp;current&nbsp;pattern&nbsp;match</span></span>
<span class="tr"><span class="th" id="line35">35</span><span class="td">Global&nbsp;pcount;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;a&nbsp;marker&nbsp;within&nbsp;it</span></span>
<span class="tr"><span class="th" id="line36">36</span><span class="td">Array&nbsp;pattern2&nbsp;--&gt;&nbsp;32;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;another,&nbsp;which&nbsp;stores&nbsp;the&nbsp;best&nbsp;match</span></span>
<span class="tr"><span class="th" id="line37">37</span><span class="td">Global&nbsp;pcount2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;so&nbsp;far</span></span>
<span class="tr"><span class="th" id="line38">38</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line39">39</span><span class="td">Array&nbsp;&nbsp;line_ttype--&gt;32;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;For&nbsp;storing&nbsp;an&nbsp;analysed&nbsp;grammar&nbsp;line</span></span>
<span class="tr"><span class="th" id="line40">40</span><span class="td">Array&nbsp;&nbsp;line_tdata--&gt;32;</span></span>
<span class="tr"><span class="th" id="line41">41</span><span class="td">Array&nbsp;&nbsp;line_token--&gt;32;</span></span>
<span class="tr"><span class="th" id="line42">42</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line43">43</span><span class="td">Global&nbsp;nsns;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Number&nbsp;of&nbsp;special_numbers&nbsp;entered&nbsp;so&nbsp;far</span></span>
<span class="tr"><span class="th" id="line44">44</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line45">45</span><span class="td">Global&nbsp;params_wanted;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Number&nbsp;of&nbsp;parameters&nbsp;needed&nbsp;(which&nbsp;may&nbsp;change&nbsp;in&nbsp;parsing)</span></span>
<span class="tr"><span class="th" id="line46">46</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line47">47</span><span class="td">Global&nbsp;inferfrom;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;point&nbsp;from&nbsp;which&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;command&nbsp;must&nbsp;be&nbsp;inferred</span></span>
<span class="tr"><span class="th" id="line48">48</span><span class="td">Global&nbsp;inferword;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;the&nbsp;preposition&nbsp;inferred</span></span>
<span class="tr"><span class="th" id="line49">49</span><span class="td">Global&nbsp;dont_infer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Another&nbsp;dull&nbsp;flag</span></span>
<span class="tr"><span class="th" id="line50">50</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line51">51</span><span class="td">Global&nbsp;cobj_flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line52">52</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line53">53</span><span class="td">Global&nbsp;oops_from;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;&quot;first&nbsp;mistake&quot;&nbsp;word&nbsp;number</span></span>
<span class="tr"><span class="th" id="line54">54</span><span class="td">Global&nbsp;saved_oops;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Used&nbsp;in&nbsp;working&nbsp;this&nbsp;out</span></span>
<span class="tr"><span class="th" id="line55">55</span><span class="td">Array&nbsp;&nbsp;oops_workspace&nbsp;-&gt;&nbsp;64;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Used&nbsp;temporarily&nbsp;by&nbsp;&quot;oops&quot;&nbsp;routine</span></span>
<span class="tr"><span class="th" id="line56">56</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line57">57</span><span class="td">Global&nbsp;held_back_mode;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Flag:&nbsp;is&nbsp;there&nbsp;some&nbsp;input&nbsp;from&nbsp;last&nbsp;time</span></span>
<span class="tr"><span class="th" id="line58">58</span><span class="td">Global&nbsp;hb_wn;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;left&nbsp;over?&nbsp;&nbsp;(And&nbsp;a&nbsp;save&nbsp;value&nbsp;for&nbsp;wn.)</span></span>
<span class="tr"><span class="th" id="line59">59</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(Used&nbsp;for&nbsp;full&nbsp;stops&nbsp;and&nbsp;&quot;then&quot;.)</span></span>
<span class="tr"><span class="th" id="line60">60</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line61">61</span><span class="td">Global&nbsp;usual_grammar_after;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Point&nbsp;from&nbsp;which&nbsp;usual&nbsp;grammar&nbsp;is&nbsp;parsed&nbsp;(it&nbsp;may&nbsp;vary&nbsp;from</span></span>
<span class="tr"><span class="th" id="line62">62</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;the&nbsp;above&nbsp;if&nbsp;user&#39;s&nbsp;routines&nbsp;match&nbsp;multi-word&nbsp;verbs)</span></span>
</div><div class='text'>
<h3>Grammar Token Variables.</h3><p><p> More globals, but dealing at the level of individual tokens now.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line68">68</span><span class="td">Constant&nbsp;PATTERN_NULL&nbsp;=&nbsp;$ffff;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Entry&nbsp;for&nbsp;a&nbsp;token&nbsp;producing&nbsp;no&nbsp;text</span></span>
<span class="tr"><span class="th" id="line69">69</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line70">70</span><span class="td">Global&nbsp;found_ttype;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Used&nbsp;to&nbsp;break&nbsp;up&nbsp;tokens&nbsp;into&nbsp;type</span></span>
<span class="tr"><span class="th" id="line71">71</span><span class="td">Global&nbsp;found_tdata;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;data&nbsp;(by&nbsp;AnalyseToken)</span></span>
<span class="tr"><span class="th" id="line72">72</span><span class="td">Global&nbsp;token_filter;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;For&nbsp;noun&nbsp;filtering&nbsp;by&nbsp;user&nbsp;routines</span></span>
<span class="tr"><span class="th" id="line73">73</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line74">74</span><span class="td">Global&nbsp;length_of_noun;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Set&nbsp;by&nbsp;NounDomain&nbsp;to&nbsp;no&nbsp;of&nbsp;words&nbsp;in&nbsp;noun</span></span>
<span class="tr"><span class="th" id="line75">75</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line76">76</span><span class="td">Global&nbsp;lookahead;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;token&nbsp;after&nbsp;the&nbsp;one&nbsp;now&nbsp;being&nbsp;matched</span></span>
<span class="tr"><span class="th" id="line77">77</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line78">78</span><span class="td">Global&nbsp;multi_mode;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Multiple&nbsp;mode</span></span>
<span class="tr"><span class="th" id="line79">79</span><span class="td">Global&nbsp;multi_wanted;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Number&nbsp;of&nbsp;things&nbsp;needed&nbsp;in&nbsp;multitude</span></span>
<span class="tr"><span class="th" id="line80">80</span><span class="td">Global&nbsp;multi_had;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Number&nbsp;of&nbsp;things&nbsp;actually&nbsp;found</span></span>
<span class="tr"><span class="th" id="line81">81</span><span class="td">Global&nbsp;multi_context;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;What&nbsp;token&nbsp;the&nbsp;multi-obj&nbsp;was&nbsp;accepted&nbsp;for</span></span>
<span class="tr"><span class="th" id="line82">82</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line83">83</span><span class="td">Global&nbsp;indef_mode;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&quot;Indefinite&quot;&nbsp;mode&nbsp;-&nbsp;ie,&nbsp;&quot;take&nbsp;a&nbsp;brick&quot;</span></span>
<span class="tr"><span class="th" id="line84">84</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;is&nbsp;in&nbsp;this&nbsp;mode</span></span>
<span class="tr"><span class="th" id="line85">85</span><span class="td">Global&nbsp;indef_type;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Bit-map&nbsp;holding&nbsp;types&nbsp;of&nbsp;specification</span></span>
<span class="tr"><span class="th" id="line86">86</span><span class="td">Global&nbsp;indef_wanted;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Number&nbsp;of&nbsp;items&nbsp;wanted&nbsp;(INDEF_ALL_WANTED&nbsp;for&nbsp;all)</span></span>
<span class="tr"><span class="th" id="line87">87</span><span class="td">Constant&nbsp;INDEF_ALL_WANTED&nbsp;=&nbsp;32767;</span></span>
<span class="tr"><span class="th" id="line88">88</span><span class="td">Global&nbsp;indef_guess_p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Plural-guessing&nbsp;flag</span></span>
<span class="tr"><span class="th" id="line89">89</span><span class="td">Global&nbsp;indef_owner;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Object&nbsp;which&nbsp;must&nbsp;hold&nbsp;these&nbsp;items</span></span>
<span class="tr"><span class="th" id="line90">90</span><span class="td">Global&nbsp;indef_cases;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Possible&nbsp;gender&nbsp;and&nbsp;numbers&nbsp;of&nbsp;them</span></span>
<span class="tr"><span class="th" id="line91">91</span><span class="td">Global&nbsp;indef_possambig;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Has&nbsp;a&nbsp;possibly&nbsp;dangerous&nbsp;assumption</span></span>
<span class="tr"><span class="th" id="line92">92</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;been&nbsp;made&nbsp;about&nbsp;meaning&nbsp;of&nbsp;a&nbsp;descriptor?</span></span>
<span class="tr"><span class="th" id="line93">93</span><span class="td">Global&nbsp;indef_nspec_at;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Word&nbsp;at&nbsp;which&nbsp;a&nbsp;number&nbsp;like&nbsp;&quot;two&quot;&nbsp;was&nbsp;parsed</span></span>
<span class="tr"><span class="th" id="line94">94</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(for&nbsp;backtracking)</span></span>
<span class="tr"><span class="th" id="line95">95</span><span class="td">Global&nbsp;allow_plurals;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Whether&nbsp;plurals&nbsp;presently&nbsp;allowed&nbsp;or&nbsp;not</span></span>
<span class="tr"><span class="th" id="line96">96</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line97">97</span><span class="td">Global&nbsp;take_all_rule;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Slightly&nbsp;different&nbsp;rules&nbsp;apply&nbsp;to&nbsp;&quot;take&nbsp;all&quot;&nbsp;than&nbsp;other&nbsp;uses</span></span>
<span class="tr"><span class="th" id="line98">98</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;of&nbsp;multiple&nbsp;objects,&nbsp;to&nbsp;make&nbsp;adjudication&nbsp;produce&nbsp;more</span></span>
<span class="tr"><span class="th" id="line99">99</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;pragmatically&nbsp;useful&nbsp;results</span></span>
<span class="tr"><span class="th" id="line100">100</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(Not&nbsp;a&nbsp;flag:&nbsp;possible&nbsp;values&nbsp;0,&nbsp;1,&nbsp;2)</span></span>
<span class="tr"><span class="th" id="line101">101</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line102">102</span><span class="td">Global&nbsp;dict_flags_of_noun;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Of&nbsp;the&nbsp;noun&nbsp;currently&nbsp;being&nbsp;parsed</span></span>
<span class="tr"><span class="th" id="line103">103</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(a&nbsp;bitmap&nbsp;in&nbsp;#dict_par1&nbsp;format)</span></span>
<span class="tr"><span class="th" id="line104">104</span><span class="td">Global&nbsp;pronoun__word;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Saved&nbsp;value</span></span>
<span class="tr"><span class="th" id="line105">105</span><span class="td">Global&nbsp;pronoun__obj;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Saved&nbsp;value</span></span>
<span class="tr"><span class="th" id="line106">106</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line107">107</span><span class="td">Constant&nbsp;comma_word&nbsp;=&nbsp;&#39;comma,&#39;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;An&nbsp;&quot;untypeable&nbsp;word&quot;&nbsp;used&nbsp;to&nbsp;substitute</span></span>
<span class="tr"><span class="th" id="line108">108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;for&nbsp;commas&nbsp;in&nbsp;parse&nbsp;buffers</span></span>
</div><div class='text'>
<h3>Match List Variables.</h3><p><p> The most difficult tokens to match are those which refer to objects, since there is such a variety of names which can be given to any individual object, and we don&#39;t of course know which object or objects are meant. We store the possibilities (up to <span class="fixed">MATCH_LIST_WORDS</span>, anyway) in a data structure called the match list.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line117">117</span><span class="td">Array&nbsp;&nbsp;match_list&nbsp;--&gt;&nbsp;MATCH_LIST_WORDS;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;An&nbsp;array&nbsp;of&nbsp;matched&nbsp;objects&nbsp;so&nbsp;far</span></span>
<span class="tr"><span class="th" id="line118">118</span><span class="td">Array&nbsp;&nbsp;match_classes&nbsp;--&gt;&nbsp;MATCH_LIST_WORDS;&nbsp;!&nbsp;An&nbsp;array&nbsp;of&nbsp;equivalence&nbsp;classes&nbsp;for&nbsp;them</span></span>
<span class="tr"><span class="th" id="line119">119</span><span class="td">Array&nbsp;&nbsp;match_scores&nbsp;--&gt;&nbsp;MATCH_LIST_WORDS;&nbsp;&nbsp;!&nbsp;An&nbsp;array&nbsp;of&nbsp;match&nbsp;scores&nbsp;for&nbsp;them</span></span>
<span class="tr"><span class="th" id="line120">120</span><span class="td">Global&nbsp;number_matched;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;How&nbsp;many&nbsp;items&nbsp;in&nbsp;it?&nbsp;&nbsp;(0&nbsp;means&nbsp;none)</span></span>
<span class="tr"><span class="th" id="line121">121</span><span class="td">Global&nbsp;number_of_classes;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;How&nbsp;many&nbsp;equivalence&nbsp;classes?</span></span>
<span class="tr"><span class="th" id="line122">122</span><span class="td">Global&nbsp;match_length;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;How&nbsp;many&nbsp;words&nbsp;long&nbsp;are&nbsp;these&nbsp;matches?</span></span>
<span class="tr"><span class="th" id="line123">123</span><span class="td">Global&nbsp;match_from;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;At&nbsp;what&nbsp;word&nbsp;of&nbsp;the&nbsp;input&nbsp;do&nbsp;they&nbsp;begin?</span></span>
</div><div class='text'>
<h3>Words.</h3><p><p> The player&#39;s command is broken down into a numbered sequence of words, which break at spaces or certain punctuation (see the DM4). The numbering runs upwards from 1 to <span class="fixed"><a href="./Parser.i6t.html#line157">WordCount()</a></span>. The following utility routines provide access to words in the current command; because buffers have different definitions in Z and Glulx, so these routines must vary also.<p></p><p> The actual text of each word is stored as a sequence of ZSCII values in a <span class="fixed">-&gt;</span> (byte) array, with address <span class="fixed"><a href="./Parser.i6t.html#line158">WordAddress(x)</a></span> and length <span class="fixed"><a href="./Parser.i6t.html#line159">WordLength(x)</a></span>.<p></p><p> We picture the command as a stream of words to be read one at a time, with the global variable <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> being the &quot;current word&quot; marker. <span class="fixed"><a href="./Parser.i6t.html#line172">NextWord</a></span>, which takes no arguments, returns: (a) 0 if the word at <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> is unrecognised by the dictionary or <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> is out of range, (b) <span class="fixed"><a href="./Parser.i6t.html#line107">comma_word</a></span> if the word was a comma, (c) <span class="fixed"><a href="./Language.i6t.html#line43">THEN1__WD</a></span> if it was a full stop (because of the Infocom tradition that a full stop abbreviates for the word &quot;then&quot;: e.g., TAKE BOX. EAST was read as two commands in succession), (d) or the dictionary address if the word was recognised.<p></p><p> The current word marker <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> is always advanced.<p></p><p> <span class="fixed"><a href="./Parser.i6t.html#line183">NextWordStopped</a></span> does the same, but returns <em></em> when <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> is out of range (e.g., by having advanced past the last word in the command).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line152">152</span><span class="td">#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line153">153</span><span class="td">[&nbsp;WordCount;&nbsp;return&nbsp;parse-&gt;1;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line154">154</span><span class="td">[&nbsp;WordAddress&nbsp;wordnum;&nbsp;return&nbsp;buffer&nbsp;+&nbsp;parse-&gt;(wordnum*4+1);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line155">155</span><span class="td">[&nbsp;WordLength&nbsp;wordnum;&nbsp;return&nbsp;parse-&gt;(wordnum*4);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line156">156</span><span class="td">#Ifnot;</span></span>
<span class="tr"><span class="th" id="line157">157</span><span class="td">[&nbsp;WordCount;&nbsp;return&nbsp;parse--&gt;0;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line158">158</span><span class="td">[&nbsp;WordAddress&nbsp;wordnum;&nbsp;return&nbsp;buffer&nbsp;+&nbsp;parse--&gt;(wordnum*3);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line159">159</span><span class="td">[&nbsp;WordLength&nbsp;wordnum;&nbsp;return&nbsp;parse--&gt;(wordnum*3-1);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line160">160</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line161">161</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line162">162</span><span class="td">[&nbsp;WordFrom&nbsp;w&nbsp;p&nbsp;i&nbsp;j&nbsp;wc;</span></span>
<span class="tr"><span class="th" id="line163">163</span><span class="td">&nbsp;#Ifdef&nbsp;TARGET_ZCODE;&nbsp;wc&nbsp;=&nbsp;p-&gt;1;&nbsp;i&nbsp;=&nbsp;w*2-1;</span></span>
<span class="tr"><span class="th" id="line164">164</span><span class="td">&nbsp;#Ifnot;&nbsp;wc&nbsp;=&nbsp;p--&gt;0;&nbsp;i&nbsp;=&nbsp;w*3-2;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line165">165</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((w&nbsp;&lt;&nbsp;1)&nbsp;||&nbsp;(w&nbsp;&gt;&nbsp;wc))&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line166">166</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;p--&gt;i;</span></span>
<span class="tr"><span class="th" id="line167">167</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;==&nbsp;&#39;,//&#39;)&nbsp;j&nbsp;=&nbsp;comma_word;</span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;==&nbsp;&#39;.//&#39;)&nbsp;j&nbsp;=&nbsp;THEN1__WD;</span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td">[&nbsp;NextWord&nbsp;i&nbsp;j&nbsp;wc;</span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">&nbsp;#Ifdef&nbsp;TARGET_ZCODE;&nbsp;wc&nbsp;=&nbsp;parse-&gt;1;&nbsp;i&nbsp;=&nbsp;wn*2-1;</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;#Ifnot;&nbsp;wc&nbsp;=&nbsp;parse--&gt;0;&nbsp;i&nbsp;=&nbsp;wn*3-2;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn++;</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((wn&nbsp;&lt;&nbsp;2)&nbsp;||&nbsp;(wn&nbsp;&gt;&nbsp;wc+1))&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line177">177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;parse--&gt;i;</span></span>
<span class="tr"><span class="th" id="line178">178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;==&nbsp;&#39;,//&#39;)&nbsp;j&nbsp;=&nbsp;comma_word;</span></span>
<span class="tr"><span class="th" id="line179">179</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;==&nbsp;&#39;.//&#39;)&nbsp;j&nbsp;=&nbsp;THEN1__WD;</span></span>
<span class="tr"><span class="th" id="line180">180</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line181">181</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line182">182</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line183">183</span><span class="td">[&nbsp;NextWordStopped&nbsp;wc;</span></span>
<span class="tr"><span class="th" id="line184">184</span><span class="td">&nbsp;#Ifdef&nbsp;TARGET_ZCODE;&nbsp;wc&nbsp;=&nbsp;parse-&gt;1;&nbsp;#Ifnot;&nbsp;wc&nbsp;=&nbsp;parse--&gt;0;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line185">185</span><span class="td">&nbsp;if&nbsp;((wn&nbsp;&lt;&nbsp;1)&nbsp;||&nbsp;(wn&nbsp;&gt;&nbsp;wc))&nbsp;{&nbsp;wn++;&nbsp;return&nbsp;-1;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line186">186</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line187">187</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Snippets.</h3><p><p> Although the idea is arguably implicit in I6, the formal concept of &quot;snippet&quot; is new in I7. A snippet is a value which represents a word range in the command most recently typed by the player. These words number consecutively upwards from 1, as noted above. The correspondence between <em> C = 100 + N </em>, the word range, and <em> C = 100 + N </em>, the number used to represent it as an I6 value, is: <p class="center"><em> V = 100w<sub></sub> + (w<sub></sub>-w<sub></sub>+1) </em></p> so that the remainder mod 100 is the number of words in the range. We require that <em> C = 100 + N </em>, where <em> C = 100 + N </em> is the number of words in the current player&#39;s command. The entire command is therefore represented by: <p class="center"><em> V = 100w<sub></sub> + (w<sub></sub>-w<sub></sub>+1) </em></p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line203">203</span><span class="td">[&nbsp;PrintSnippet&nbsp;snip&nbsp;from&nbsp;to&nbsp;i&nbsp;w1&nbsp;w2;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;w1&nbsp;=&nbsp;snip/100;&nbsp;w2&nbsp;=&nbsp;w1&nbsp;+&nbsp;(snip%100)&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;if&nbsp;((w2&lt;w1)&nbsp;||&nbsp;(w1&lt;1)&nbsp;||&nbsp;(w2&gt;WordCount()))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">&nbsp;&nbsp;if&nbsp;((w1&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(w2&nbsp;==&nbsp;0))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td">&nbsp;&nbsp;return&nbsp;RunTimeProblem(RTP_SAYINVALIDSNIPPET,&nbsp;w1,&nbsp;w2);</span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;from&nbsp;=&nbsp;WordAddress(w1);&nbsp;to&nbsp;=&nbsp;WordAddress(w2)&nbsp;+&nbsp;WordLength(w2)&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;for&nbsp;(i=from:&nbsp;i&lt;=to:&nbsp;i++)&nbsp;print&nbsp;(char)&nbsp;i-&gt;0;</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">[&nbsp;SpliceSnippet&nbsp;snip&nbsp;t&nbsp;i&nbsp;w1&nbsp;w2&nbsp;nextw&nbsp;at&nbsp;endsnippet&nbsp;newlen;</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td">&nbsp;w1&nbsp;=&nbsp;snip/100;&nbsp;w2&nbsp;=&nbsp;w1&nbsp;+&nbsp;(snip%100)&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">&nbsp;if&nbsp;((w2&lt;w1)&nbsp;||&nbsp;(w1&lt;1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;&nbsp;if&nbsp;((w1&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(w2&nbsp;==&nbsp;0))&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;&nbsp;return&nbsp;RunTimeProblem(RTP_SPLICEINVALIDSNIPPET,&nbsp;w1,&nbsp;w2);</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">&nbsp;@push&nbsp;say__p;&nbsp;@push&nbsp;say__pc;</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td">&nbsp;nextw&nbsp;=&nbsp;w2&nbsp;+&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">&nbsp;at&nbsp;=&nbsp;WordAddress(w1)&nbsp;-&nbsp;buffer;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;if&nbsp;(nextw&nbsp;&lt;=&nbsp;WordCount())&nbsp;endsnippet&nbsp;=&nbsp;100*nextw&nbsp;+&nbsp;(WordCount()&nbsp;-&nbsp;nextw&nbsp;+&nbsp;1);</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;buffer2--&gt;0&nbsp;=&nbsp;120;</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;newlen&nbsp;=&nbsp;VM_PrintToBuffer(buffer2,&nbsp;120,&nbsp;SpliceSnippet__TextPrinter,&nbsp;t,&nbsp;endsnippet);</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;for&nbsp;(i=0:&nbsp;(i&lt;newlen)&nbsp;&amp;&amp;&nbsp;(at+i&lt;120):&nbsp;i++)&nbsp;buffer-&gt;(at+i)&nbsp;=&nbsp;buffer2-&gt;(WORDSIZE+i);</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">&nbsp;#Ifdef&nbsp;TARGET_ZCODE;&nbsp;buffer-&gt;1&nbsp;=&nbsp;at+i;&nbsp;#ifnot;&nbsp;buffer--&gt;0&nbsp;=&nbsp;at+i;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">&nbsp;for&nbsp;(:at+i&lt;120:i++)&nbsp;buffer-&gt;(at+i)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">&nbsp;VM_Tokenise(buffer,&nbsp;parse);</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;WordCount();</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;@pull&nbsp;say__pc;&nbsp;@pull&nbsp;say__p;</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">[&nbsp;SpliceSnippet__TextPrinter&nbsp;t&nbsp;endsnippet;</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">&nbsp;TEXT_TY_Say(t);</span></span>
<span class="tr"><span class="th" id="line235">235</span><span class="td">&nbsp;if&nbsp;(endsnippet)&nbsp;{&nbsp;print&nbsp;&quot;&nbsp;&quot;;&nbsp;PrintSnippet(endsnippet);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line236">236</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line237">237</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line238">238</span><span class="td">[&nbsp;SnippetIncludes&nbsp;test&nbsp;snippet&nbsp;w1&nbsp;w2&nbsp;wlen&nbsp;i&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line239">239</span><span class="td">&nbsp;w1&nbsp;=&nbsp;snippet/100;&nbsp;w2&nbsp;=&nbsp;w1&nbsp;+&nbsp;(snippet%100)&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line240">240</span><span class="td">&nbsp;if&nbsp;((w2&lt;w1)&nbsp;||&nbsp;(w1&lt;1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line241">241</span><span class="td">&nbsp;&nbsp;if&nbsp;((w1&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(w2&nbsp;==&nbsp;0))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line242">242</span><span class="td">&nbsp;&nbsp;return&nbsp;RunTimeProblem(RTP_INCLUDEINVALIDSNIPPET,&nbsp;w1,&nbsp;w2);</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td">&nbsp;if&nbsp;(metaclass(test)&nbsp;==&nbsp;Routine)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line245">245</span><span class="td">&nbsp;&nbsp;wlen&nbsp;=&nbsp;snippet%100;</span></span>
<span class="tr"><span class="th" id="line246">246</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=w1,&nbsp;j=wlen:&nbsp;j&gt;0:&nbsp;i++,&nbsp;j--)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(((test)(i,&nbsp;0))&nbsp;~=&nbsp;GPR_FAIL)&nbsp;return&nbsp;i*100+wn-i;</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line249">249</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line250">250</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line251">251</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line252">252</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line253">253</span><span class="td">[&nbsp;SnippetMatches&nbsp;snippet&nbsp;topic_gpr&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line254">254</span><span class="td">&nbsp;wn=1;</span></span>
<span class="tr"><span class="th" id="line255">255</span><span class="td">&nbsp;if&nbsp;(topic_gpr&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line256">256</span><span class="td">&nbsp;if&nbsp;(metaclass(topic_gpr)&nbsp;==&nbsp;Routine)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line257">257</span><span class="td">&nbsp;&nbsp;rv&nbsp;=&nbsp;(topic_gpr)(snippet/100,&nbsp;snippet%100);</span></span>
<span class="tr"><span class="th" id="line258">258</span><span class="td">&nbsp;&nbsp;if&nbsp;(rv&nbsp;~=&nbsp;GPR_FAIL)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line259">259</span><span class="td">&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line260">260</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line261">261</span><span class="td">&nbsp;RunTimeProblem(RTP_BADTOPIC);</span></span>
<span class="tr"><span class="th" id="line262">262</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line263">263</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Unpacking Grammar Lines.</h3><p><p> Grammar lines are sequences of tokens in an array built into the story file, but in a format which differs depending on the virtual machine in use, so the following code unpacks the data into more convenient if larger arrays which are VM-independent.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line272">272</span><span class="td">[&nbsp;UnpackGrammarLine&nbsp;line_address&nbsp;i&nbsp;size;</span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;32&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line274">274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_token--&gt;i&nbsp;=&nbsp;ENDIT_TOKEN;</span></span>
<span class="tr"><span class="th" id="line275">275</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_ttype--&gt;i&nbsp;=&nbsp;ELEMENTARY_TT;</span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_tdata--&gt;i&nbsp;=&nbsp;ENDIT_TOKEN;</span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action_to_be&nbsp;=&nbsp;256*(line_address-&gt;0)&nbsp;+&nbsp;line_address-&gt;1;</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action_reversed&nbsp;=&nbsp;((action_to_be&nbsp;&amp;&nbsp;$400)&nbsp;~=&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action_to_be&nbsp;=&nbsp;action_to_be&nbsp;&amp;&nbsp;$3ff;</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;line_address--;</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">#Ifnot;&nbsp;!&nbsp;GLULX</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@aloads&nbsp;line_address&nbsp;0&nbsp;action_to_be;</span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action_reversed&nbsp;=&nbsp;(((line_address-&gt;2)&nbsp;&amp;&nbsp;1)&nbsp;~=&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;line_address&nbsp;=&nbsp;line_address&nbsp;-&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;5;</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;params_wanted&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_address&nbsp;=&nbsp;line_address&nbsp;+&nbsp;size;</span></span>
<span class="tr"><span class="th" id="line293">293</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_address-&gt;0&nbsp;==&nbsp;ENDIT_TOKEN)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line294">294</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_token--&gt;i&nbsp;=&nbsp;line_address;</span></span>
<span class="tr"><span class="th" id="line295">295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnalyseToken(line_address);</span></span>
<span class="tr"><span class="th" id="line296">296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(found_ttype&nbsp;~=&nbsp;PREPOSITION_TT)&nbsp;params_wanted++;</span></span>
<span class="tr"><span class="th" id="line297">297</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_ttype--&gt;i&nbsp;=&nbsp;found_ttype;</span></span>
<span class="tr"><span class="th" id="line298">298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_tdata--&gt;i&nbsp;=&nbsp;found_tdata;</span></span>
<span class="tr"><span class="th" id="line299">299</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line300">300</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;line_address&nbsp;+&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">[&nbsp;AnalyseToken&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token&nbsp;==&nbsp;ENDIT_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;found_ttype&nbsp;=&nbsp;ELEMENTARY_TT;</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;found_tdata&nbsp;=&nbsp;ENDIT_TOKEN;</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;found_ttype&nbsp;=&nbsp;(token-&gt;0)&nbsp;&amp;&nbsp;$$1111;</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;found_tdata&nbsp;=&nbsp;(token+1)--&gt;0;</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Extracting Verb Numbers.</h3><p><p> A long tale of woe lies behind the following. Infocom games stored verb numbers in a single byte in dictionary entries, but they did so counting downwards, so that verb number 0 was stored as 255, 1 as 254, and so on. Inform followed suit so that debugging of Inform 1 could be aided by using the then-available tools for dumping dictionaries from Infocom story files; by using the Infocom format for dictionary tables, Inform&#39;s life was easier.<p></p><p> But there was an implicit restriction there of 255 distinct verbs (not 256 since not all words were verbs). When Glulx raised almost all of the Z-machine limits, it made space for 65535 verbs instead of 255, but it appears that nobody remembered to implement this in I6-for-Glulx and the Glulx form of the I6 library. This was only put right in March 2009, and the following routine was added to concentrate lookups of this field in one place.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line329">329</span><span class="td">[&nbsp;DictionaryWordToVerbNum&nbsp;dword&nbsp;verbnum;</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;verbnum&nbsp;=&nbsp;$ff-(dword-&gt;#dict_par2);</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">#Ifnot;&nbsp;!&nbsp;GLULX</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;dword&nbsp;=&nbsp;dword&nbsp;+&nbsp;#dict_par2&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@aloads&nbsp;dword&nbsp;0&nbsp;verbnum;</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;verbnum&nbsp;=&nbsp;$ffff-verbnum;</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;return&nbsp;verbnum;</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Keyboard Primitive.</h3><p><p> This is the primitive routine to read from the keyboard: it usually delegates this to a routine specific to the virtual machine being used, but sometimes uses a hacked version to allow TEST commands to work. (When a TEST is running, the text in the walk-through provided is fed into the buffer as if it had been typed at the keyboard.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line348">348</span><span class="td">[&nbsp;KeyboardPrimitive&nbsp;a_buffer&nbsp;a_table;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">#Ifdef&nbsp;DEBUG;&nbsp;#Iftrue&nbsp;({-value:NUMBER_CREATED(test_scenario)}&nbsp;&gt;&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">&nbsp;return&nbsp;TestKeyboardPrimitive(a_buffer,&nbsp;a_table);</span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">#Endif;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;return&nbsp;VM_ReadKeyboard(a_buffer,&nbsp;a_table);</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Reading the Command.</h3><p><p> The <span class="fixed"><a href="./Parser.i6t.html#line376">Keyboard</a></span> routine actually receives the player&#39;s words, putting the words in <span class="fixed">a_buffer</span> and their dictionary addresses in <span class="fixed">a_table</span>. It is assumed that the table is the same one on each (standard) call. Much of the code handles the OOPS and UNDO commands, which are not actions and do not pass through the rest of the parser. The undo state is saved &ndash; it is essentially an internal saved game, in the VM interpreter&#39;s memory rather than in an external file &ndash; and note that this is therefore also where execution picks up if an UNDO has been typed. Since UNDO recreates the former machine state perfectly, it might seem impossible to tell that an UNDO had occurred, but in fact the VM passes information back in the form of a return code from the relevant instruction, and this allows us to detect an undo. (We deal with it by printing the current location and asking another command.)<p></p><p> <span class="fixed"><a href="./Parser.i6t.html#line376">Keyboard</a></span> can also be used by miscellaneous routines in the game to ask yes/no questions and the like, without invoking the rest of the parser.<p></p><p> The return value is the number of words typed.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line376">376</span><span class="td">[&nbsp;Keyboard&nbsp;&nbsp;a_buffer&nbsp;a_table&nbsp;&nbsp;nw&nbsp;i&nbsp;w&nbsp;w2&nbsp;x1&nbsp;x2;</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;sline1&nbsp;=&nbsp;score;&nbsp;sline2&nbsp;=&nbsp;turns;</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">&nbsp;while&nbsp;(true)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td">&nbsp;&nbsp;!&nbsp;Save&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;&quot;oops&quot;&nbsp;needs&nbsp;to&nbsp;restore&nbsp;it</span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;64&nbsp;:&nbsp;i++)&nbsp;oops_workspace-&gt;i&nbsp;=&nbsp;a_buffer-&gt;i;</span></span>
<span class="tr"><span class="th" id="line382">382</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line383">383</span><span class="td">&nbsp;&nbsp;!&nbsp;In&nbsp;case&nbsp;of&nbsp;an&nbsp;array&nbsp;entry&nbsp;corruption&nbsp;that&nbsp;shouldn&#39;t&nbsp;happen,&nbsp;but&nbsp;would&nbsp;be</span></span>
<span class="tr"><span class="th" id="line384">384</span><span class="td">&nbsp;&nbsp;!&nbsp;disastrous&nbsp;if&nbsp;it&nbsp;did:</span></span>
<span class="tr"><span class="th" id="line385">385</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line386">386</span><span class="td">&nbsp;&nbsp;a_buffer-&gt;0&nbsp;=&nbsp;INPUT_BUFFER_LEN;</span></span>
<span class="tr"><span class="th" id="line387">387</span><span class="td">&nbsp;&nbsp;a_table-&gt;0&nbsp;=&nbsp;15;&nbsp;&nbsp;!&nbsp;Allow&nbsp;to&nbsp;split&nbsp;input&nbsp;into&nbsp;this&nbsp;many&nbsp;words</span></span>
<span class="tr"><span class="th" id="line388">388</span><span class="td">&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line389">389</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;&nbsp;!&nbsp;Print&nbsp;the&nbsp;prompt,&nbsp;and&nbsp;read&nbsp;in&nbsp;the&nbsp;words&nbsp;and&nbsp;dictionary&nbsp;addresses</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;PrintPrompt();</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;DrawStatusLine();</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;KeyboardPrimitive(a_buffer,&nbsp;a_table);</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;!&nbsp;Set&nbsp;nw&nbsp;to&nbsp;the&nbsp;number&nbsp;of&nbsp;words</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;&nbsp;nw&nbsp;=&nbsp;a_table-&gt;1;&nbsp;#Ifnot;&nbsp;nw&nbsp;=&nbsp;a_table--&gt;0;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;blank,&nbsp;get&nbsp;a&nbsp;fresh&nbsp;line</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;&nbsp;if&nbsp;(nw&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">&nbsp;&nbsp;&nbsp;@push&nbsp;etype;&nbsp;etype&nbsp;=&nbsp;BLANKLINE_PE;</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">&nbsp;&nbsp;&nbsp;players_command&nbsp;=&nbsp;100;</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td">&nbsp;&nbsp;&nbsp;BeginActivity(PRINTING_A_PARSER_ERROR_ACT);</span></span>
<span class="tr"><span class="th" id="line403">403</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_A_PARSER_ERROR_ACT)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line404">404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;X&#39;,&nbsp;noun);&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line405">405</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line406">406</span><span class="td">&nbsp;&nbsp;&nbsp;EndActivity(PRINTING_A_PARSER_ERROR_ACT);</span></span>
<span class="tr"><span class="th" id="line407">407</span><span class="td">&nbsp;&nbsp;&nbsp;@pull&nbsp;etype;</span></span>
<span class="tr"><span class="th" id="line408">408</span><span class="td">&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line409">409</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">&nbsp;&nbsp;!&nbsp;Unless&nbsp;the&nbsp;opening&nbsp;word&nbsp;was&nbsp;OOPS,&nbsp;return</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">&nbsp;&nbsp;!&nbsp;Conveniently,&nbsp;a_table--&gt;1&nbsp;is&nbsp;the&nbsp;first&nbsp;word&nbsp;on&nbsp;both&nbsp;the&nbsp;Z-machine&nbsp;and&nbsp;Glulx</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line414">414</span><span class="td">&nbsp;&nbsp;w&nbsp;=&nbsp;a_table--&gt;1;</span></span>
<span class="tr"><span class="th" id="line415">415</span><span class="td">&nbsp;&nbsp;if&nbsp;(w&nbsp;==&nbsp;OOPS1__WD&nbsp;or&nbsp;OOPS2__WD&nbsp;or&nbsp;OOPS3__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line416">416</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(oops_from&nbsp;==&nbsp;0)&nbsp;{&nbsp;PARSER_COMMAND_INTERNAL_RM(&#39;A&#39;);&nbsp;new_line;&nbsp;continue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line417">417</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(nw&nbsp;==&nbsp;1)&nbsp;{&nbsp;PARSER_COMMAND_INTERNAL_RM(&#39;B&#39;);&nbsp;new_line;&nbsp;continue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line418">418</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(nw&nbsp;&gt;&nbsp;2)&nbsp;{&nbsp;PARSER_COMMAND_INTERNAL_RM(&#39;C&#39;);&nbsp;new_line;&nbsp;continue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line419">419</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line420">420</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;So&nbsp;now&nbsp;we&nbsp;know:&nbsp;there&nbsp;was&nbsp;a&nbsp;previous&nbsp;mistake,&nbsp;and&nbsp;the&nbsp;player&nbsp;has</span></span>
<span class="tr"><span class="th" id="line421">421</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;attempted&nbsp;to&nbsp;correct&nbsp;a&nbsp;single&nbsp;word&nbsp;of&nbsp;it.</span></span>
<span class="tr"><span class="th" id="line422">422</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line423">423</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;INPUT_BUFFER_LEN&nbsp;:&nbsp;i++)&nbsp;buffer2-&gt;i&nbsp;=&nbsp;a_buffer-&gt;i;</span></span>
<span class="tr"><span class="th" id="line424">424</span><span class="td">&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line425">425</span><span class="td">&nbsp;&nbsp;&nbsp;x1&nbsp;=&nbsp;a_table-&gt;9;&nbsp;&nbsp;!&nbsp;Start&nbsp;of&nbsp;word&nbsp;following&nbsp;&quot;oops&quot;</span></span>
<span class="tr"><span class="th" id="line426">426</span><span class="td">&nbsp;&nbsp;&nbsp;x2&nbsp;=&nbsp;a_table-&gt;8;&nbsp;&nbsp;!&nbsp;Length&nbsp;of&nbsp;word&nbsp;following&nbsp;&quot;oops&quot;</span></span>
<span class="tr"><span class="th" id="line427">427</span><span class="td">&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line428">428</span><span class="td">&nbsp;&nbsp;&nbsp;x1&nbsp;=&nbsp;a_table--&gt;6;&nbsp;!&nbsp;Start&nbsp;of&nbsp;word&nbsp;following&nbsp;&quot;oops&quot;</span></span>
<span class="tr"><span class="th" id="line429">429</span><span class="td">&nbsp;&nbsp;&nbsp;x2&nbsp;=&nbsp;a_table--&gt;5;&nbsp;!&nbsp;Length&nbsp;of&nbsp;word&nbsp;following&nbsp;&quot;oops&quot;</span></span>
<span class="tr"><span class="th" id="line430">430</span><span class="td">&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line431">431</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line432">432</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Repair&nbsp;the&nbsp;buffer&nbsp;to&nbsp;the&nbsp;text&nbsp;that&nbsp;was&nbsp;in&nbsp;it&nbsp;before&nbsp;the&nbsp;&quot;oops&quot;</span></span>
<span class="tr"><span class="th" id="line433">433</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;was&nbsp;typed:</span></span>
<span class="tr"><span class="th" id="line434">434</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;64&nbsp;:&nbsp;i++)&nbsp;a_buffer-&gt;i&nbsp;=&nbsp;oops_workspace-&gt;i;</span></span>
<span class="tr"><span class="th" id="line435">435</span><span class="td">&nbsp;&nbsp;&nbsp;VM_Tokenise(a_buffer,a_table);</span></span>
<span class="tr"><span class="th" id="line436">436</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line437">437</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Work&nbsp;out&nbsp;the&nbsp;position&nbsp;in&nbsp;the&nbsp;buffer&nbsp;of&nbsp;the&nbsp;word&nbsp;to&nbsp;be&nbsp;corrected:</span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td">&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;a_table-&gt;(4*oops_from&nbsp;+&nbsp;1);&nbsp;!&nbsp;Start&nbsp;of&nbsp;word&nbsp;to&nbsp;go</span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td">&nbsp;&nbsp;&nbsp;w2&nbsp;=&nbsp;a_table-&gt;(4*oops_from);&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Length&nbsp;of&nbsp;word&nbsp;to&nbsp;go</span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td">&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td">&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;a_table--&gt;(3*oops_from);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Start&nbsp;of&nbsp;word&nbsp;to&nbsp;go</span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td">&nbsp;&nbsp;&nbsp;w2&nbsp;=&nbsp;a_table--&gt;(3*oops_from&nbsp;-&nbsp;1);&nbsp;!&nbsp;Length&nbsp;of&nbsp;word&nbsp;to&nbsp;go</span></span>
<span class="tr"><span class="th" id="line444">444</span><span class="td">&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line445">445</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line446">446</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Write&nbsp;spaces&nbsp;over&nbsp;the&nbsp;word&nbsp;to&nbsp;be&nbsp;corrected:</span></span>
<span class="tr"><span class="th" id="line447">447</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;w2&nbsp;:&nbsp;i++)&nbsp;a_buffer-&gt;(i+w)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line448">448</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(w2&nbsp;&lt;&nbsp;x2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;replacement&nbsp;is&nbsp;longer&nbsp;than&nbsp;the&nbsp;original,&nbsp;move&nbsp;up...</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=INPUT_BUFFER_LEN-1&nbsp;:&nbsp;i&gt;=w+x2&nbsp;:&nbsp;i--)</span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_buffer-&gt;i&nbsp;=&nbsp;a_buffer-&gt;(i-x2+w2);</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...increasing&nbsp;buffer&nbsp;size&nbsp;accordingly.</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;a_buffer-&gt;1&nbsp;=&nbsp;(a_buffer-&gt;1)&nbsp;+&nbsp;(x2-w2);</span></span>
<span class="tr"><span class="th" id="line457">457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line458">458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;a_buffer--&gt;0&nbsp;=&nbsp;(a_buffer--&gt;0)&nbsp;+&nbsp;(x2-w2);</span></span>
<span class="tr"><span class="th" id="line459">459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line460">460</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Write&nbsp;the&nbsp;correction&nbsp;in:</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;x2&nbsp;:&nbsp;i++)&nbsp;a_buffer-&gt;(i+w)&nbsp;=&nbsp;buffer2-&gt;(i+x1);</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;&nbsp;VM_Tokenise(a_buffer,&nbsp;a_table);</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;&nbsp;nw&nbsp;=&nbsp;a_table-&gt;1;&nbsp;#Ifnot;&nbsp;nw&nbsp;=&nbsp;a_table--&gt;0;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;&nbsp;&nbsp;return&nbsp;nw;</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;!&nbsp;Undo&nbsp;handling</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;&nbsp;if&nbsp;((w&nbsp;==&nbsp;UNDO1__WD&nbsp;or&nbsp;UNDO2__WD&nbsp;or&nbsp;UNDO3__WD)&nbsp;&amp;&amp;&nbsp;(nw==1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;&nbsp;&nbsp;Perform_Undo();</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td">&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">&nbsp;&nbsp;i&nbsp;=&nbsp;VM_Save_Undo();</span></span>
<span class="tr"><span class="th" id="line478">478</span><span class="td">&nbsp;&nbsp;#ifdef&nbsp;PREVENT_UNDO;&nbsp;undo_flag&nbsp;=&nbsp;0;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line479">479</span><span class="td">&nbsp;&nbsp;#ifndef&nbsp;PREVENT_UNDO;&nbsp;undo_flag&nbsp;=&nbsp;2;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line480">480</span><span class="td">&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;-1)&nbsp;undo_flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line481">481</span><span class="td">&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;0)&nbsp;undo_flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line482">482</span><span class="td">&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line483">483</span><span class="td">&nbsp;&nbsp;&nbsp;VM_RestoreWindowColours();</span></span>
<span class="tr"><span class="th" id="line484">484</span><span class="td">&nbsp;&nbsp;&nbsp;VM_Style(SUBHEADER_VMSTY);</span></span>
<span class="tr"><span class="th" id="line485">485</span><span class="td">&nbsp;&nbsp;&nbsp;SL_Location();&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line486">486</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;print&nbsp;(name)&nbsp;location,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line487">487</span><span class="td">&nbsp;&nbsp;&nbsp;VM_Style(NORMAL_VMSTY);</span></span>
<span class="tr"><span class="th" id="line488">488</span><span class="td">&nbsp;&nbsp;&nbsp;IMMEDIATELY_UNDO_RM(&#39;E&#39;);&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line489">489</span><span class="td">&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line490">490</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line491">491</span><span class="td">&nbsp;&nbsp;return&nbsp;nw;</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Parser Proper.</h3><p><p> The main parser routine is something of a leviathan, and it has traditionally been divided into 11 lettered parts:<p></p><p> (A) Get the input, do OOPS and AGAIN (B) Is it a direction, and so an implicit GO?  If so go to (K) (C) Is anyone being addressed? (D) Get the command verb: try all the syntax lines for that verb (E) Break down a syntax line into analysed tokens (F) Look ahead for advance warning for <span class="fixed">multiexcept</span>/<span class="fixed">multiinside</span> (G) Parse each token in turn (calling <span class="fixed"><a href="./Parser.i6t.html#line1469">ParseToken</a></span> to do most of the work) (H) Cheaply parse otherwise unrecognised conversation and return (I) Print best possible error message (J) Retry the whole lot (K) Last thing: check for THEN and further instructions(s), return.<p></p><p> This lettering has been preserved here, with the code under each letter now being the body of &quot;Parser Letter A&quot;, &quot;Parser Letter B&quot; and so on.<p></p><p> Note that there are three different places where a return can happen. The routine returns only when a sensible request has been made; for a fairly thorough description of its output, which is written into the <span class="fixed">parser_results</span> array and also into several globals (see <span class="fixed"><a href="./OrderOfPlay.i6t.html">OrderOfPlay.i6t</a></span>).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line520">520</span><span class="td">[&nbsp;Parser__parse</span></span>
<span class="tr"><span class="th" id="line521">521</span><span class="td">&nbsp;syntax&nbsp;line&nbsp;num_lines&nbsp;line_address&nbsp;i&nbsp;j&nbsp;k&nbsp;token&nbsp;l&nbsp;m&nbsp;inferred_go;</span></span>
<span class="tr"><span class="th" id="line522">522</span><span class="td">&nbsp;cobj_flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line523">523</span><span class="td">&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td">&nbsp;parser_results--&gt;INP2_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">&nbsp;meta&nbsp;=&nbsp;false;</span></span>
</div><div class='text'>
<h3>Parser Letter A.</h3><p><p> Get the input, do OOPS and AGAIN.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line533">533</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(held_back_mode)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line534">534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;held_back_mode&nbsp;=&nbsp;false;&nbsp;wn&nbsp;=&nbsp;hb_wn;</span></span>
<span class="tr"><span class="th" id="line535">535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_wordnum&nbsp;&gt;&nbsp;0)&nbsp;i&nbsp;=&nbsp;WordAddress(verb_wordnum);&nbsp;else&nbsp;i&nbsp;=&nbsp;WordAddress(1);</span></span>
<span class="tr"><span class="th" id="line536">536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;WordAddress(wn);</span></span>
<span class="tr"><span class="th" id="line537">537</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&lt;=j)&nbsp;for&nbsp;(:&nbsp;i&lt;j&nbsp;:&nbsp;i++)&nbsp;i-&gt;0&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line538">538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line539">539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;AGAIN1__WD&nbsp;or&nbsp;AGAIN2__WD&nbsp;or&nbsp;AGAIN3__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Delete&nbsp;the&nbsp;words&nbsp;&quot;then&nbsp;again&quot;&nbsp;from&nbsp;the&nbsp;again&nbsp;buffer,</span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;in&nbsp;which&nbsp;we&nbsp;have&nbsp;just&nbsp;realised&nbsp;that&nbsp;it&nbsp;must&nbsp;occur:</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;prevents&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;on&nbsp;&quot;i.&nbsp;again&quot;</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;WordAddress(wn-2)-buffer;</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;j&nbsp;=&nbsp;INPUT_BUFFER_LEN-1;</span></span>
<span class="tr"><span class="th" id="line546">546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;j&nbsp;=&nbsp;WordAddress(wn)-buffer;</span></span>
<span class="tr"><span class="th" id="line547">547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(:&nbsp;i&lt;j&nbsp;:&nbsp;i++)&nbsp;buffer3-&gt;i&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line548">548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line549">549</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_Tokenise(buffer,&nbsp;parse);</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line563">ReParse</a>;</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;.ReType;</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;cobj_flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;actors_location&nbsp;=&nbsp;ScopeCeiling(player);</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(READING_A_COMMAND_ACT);&nbsp;if&nbsp;(ForActivity(READING_A_COMMAND_ACT)==false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;Keyboard(buffer,parse);</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;num_words&nbsp;=&nbsp;WordCount();&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;num_words;</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;if&nbsp;(EndActivity(READING_A_COMMAND_ACT))&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line554">ReType</a>;</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;.ReParse;</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;parser_inflection&nbsp;=&nbsp;name;</span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Initially&nbsp;assume&nbsp;the&nbsp;command&nbsp;is&nbsp;aimed&nbsp;at&nbsp;the&nbsp;player,&nbsp;and&nbsp;the&nbsp;verb</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;is&nbsp;the&nbsp;first&nbsp;word</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;num_words&nbsp;=&nbsp;WordCount();&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;num_words;</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;1;&nbsp;inferred_go&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguageToInformese;</span></span>
<span class="tr"><span class="th" id="line574">574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;LanguageToInformese();</span></span>
<span class="tr"><span class="th" id="line575">575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Re-tokenise:</span></span>
<span class="tr"><span class="th" id="line576">576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;VM_Tokenise(buffer,parse);</span></span>
<span class="tr"><span class="th" id="line577">577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageToInformese</span></span>
<span class="tr"><span class="th" id="line578">578</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line579">579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;num_words&nbsp;=&nbsp;WordCount();&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;num_words;</span></span>
<span class="tr"><span class="th" id="line580">580</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line581">581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k=0;</span></span>
<span class="tr"><span class="th" id="line582">582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line583">583</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line584">584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line585">585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;num_words&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line586">586</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line587">587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line588">588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;parse--&gt;(i*2&nbsp;+&nbsp;1);</span></span>
<span class="tr"><span class="th" id="line589">589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line590">590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;parse--&gt;(i*3&nbsp;+&nbsp;1);</span></span>
<span class="tr"><span class="th" id="line591">591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line592">592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;WordAddress(i+1);</span></span>
<span class="tr"><span class="th" id="line593">593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;WordLength(i+1);</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;~&quot;;&nbsp;for&nbsp;(m=0&nbsp;:&nbsp;m&lt;l&nbsp;:&nbsp;m++)&nbsp;print&nbsp;(char)&nbsp;k-&gt;m;&nbsp;print&nbsp;&quot;~&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line596">596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;?&quot;;</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(UnsignedCompare(j,&nbsp;HDR_DICTIONARY--&gt;0)&nbsp;&gt;=&nbsp;0&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnsignedCompare(j,&nbsp;HDR_HIGHMEMORY--&gt;0)&nbsp;&lt;&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(address)&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j-&gt;0&nbsp;==&nbsp;$60)&nbsp;print&nbsp;(address)&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;~=&nbsp;num_words-1)&nbsp;print&nbsp;&quot;&nbsp;/&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;verb_wordnum&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actor&nbsp;=&nbsp;player;</span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actors_location&nbsp;=&nbsp;ScopeCeiling(player);</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;usual_grammar_after&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">&nbsp;&nbsp;.AlmostReParse;</span></span>
<span class="tr"><span class="th" id="line619">619</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line620">620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;scope_token&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line621">621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;action_to_be&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line622">622</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line623">623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Begin&nbsp;from&nbsp;what&nbsp;we&nbsp;currently&nbsp;think&nbsp;is&nbsp;the&nbsp;verb&nbsp;word</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;.BeginCommand;</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line627">627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum;</span></span>
<span class="tr"><span class="th" id="line628">628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;verb_word&nbsp;=&nbsp;NextWordStopped();</span></span>
<span class="tr"><span class="th" id="line629">629</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line630">630</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;input&nbsp;here,&nbsp;we&nbsp;must&nbsp;have&nbsp;something&nbsp;like&nbsp;&quot;person,&quot;.</span></span>
<span class="tr"><span class="th" id="line631">631</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line632">632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line633">633</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;STUCK_PE;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;best_etype&nbsp;=&nbsp;COMMABEGIN_PE;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now&nbsp;try&nbsp;for&nbsp;&quot;again&quot;&nbsp;or&nbsp;&quot;g&quot;,&nbsp;which&nbsp;are&nbsp;special&nbsp;cases:&nbsp;don&#39;t&nbsp;allow&nbsp;&quot;again&quot;&nbsp;if&nbsp;nothing</span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;has&nbsp;previously&nbsp;been&nbsp;typed;&nbsp;simply&nbsp;copy&nbsp;the&nbsp;previous&nbsp;text&nbsp;across</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;AGAIN2__WD&nbsp;or&nbsp;AGAIN3__WD)&nbsp;verb_word&nbsp;=&nbsp;AGAIN1__WD;</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;AGAIN1__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(actor&nbsp;~=&nbsp;player)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;ANIMAAGAIN_PE;</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line649">649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer3-&gt;1&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line650">650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARSER_COMMAND_INTERNAL_RM(&#39;D&#39;);&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line651">651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line554">ReType</a>;</span></span>
<span class="tr"><span class="th" id="line652">652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer3--&gt;0&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARSER_COMMAND_INTERNAL_RM(&#39;D&#39;);&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line656">656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line554">ReType</a>;</span></span>
<span class="tr"><span class="th" id="line657">657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line658">658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line659">659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;INPUT_BUFFER_LEN&nbsp;:&nbsp;i++)&nbsp;buffer-&gt;i&nbsp;=&nbsp;buffer3-&gt;i;</span></span>
<span class="tr"><span class="th" id="line660">660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_Tokenise(buffer,parse);</span></span>
<span class="tr"><span class="th" id="line661">661</span><span class="td">&nbsp;&nbsp;num_words&nbsp;=&nbsp;WordCount();&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;num_words;</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line563">ReParse</a>;</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Save&nbsp;the&nbsp;present&nbsp;input&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;&quot;again&quot;&nbsp;next&nbsp;time</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;~=&nbsp;AGAIN1__WD)</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;INPUT_BUFFER_LEN&nbsp;:&nbsp;i++)&nbsp;buffer3-&gt;i&nbsp;=&nbsp;buffer-&gt;i;</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(usual_grammar_after&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line671">671</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;verb_wordnum;</span></span>
<span class="tr"><span class="th" id="line672">672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;RunRoutines(actor,&nbsp;grammar);&nbsp;</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2&nbsp;&amp;&amp;&nbsp;actor.grammar&nbsp;~=&nbsp;0&nbsp;or&nbsp;NULL)</span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;[Grammar&nbsp;property&nbsp;returned&nbsp;&quot;,&nbsp;i,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((i&nbsp;~=&nbsp;0&nbsp;or&nbsp;1)&nbsp;&amp;&amp;&nbsp;(VM_InvalidDictionaryAddress(i)))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usual_grammar_after&nbsp;=&nbsp;verb_wordnum;&nbsp;i=-i;</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;action;</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;noun;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP2_PRES&nbsp;=&nbsp;second;</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(noun)&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(second)&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;~=&nbsp;0)&nbsp;{&nbsp;verb_word&nbsp;=&nbsp;i;&nbsp;wn--;&nbsp;verb_wordnum--;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;wn&nbsp;=&nbsp;verb_wordnum;&nbsp;verb_word&nbsp;=&nbsp;NextWord();&nbsp;}</span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;usual_grammar_after&nbsp;=&nbsp;0;</span></span>
</div><div class='text'>
<h3>Parser Letter B.</h3><p><p> Is the command a direction name, and so an implicit GO? If so, go to (K).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguageIsVerb;</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;wn;&nbsp;verb_word&nbsp;=&nbsp;LanguageIsVerb(buffer,&nbsp;parse,&nbsp;verb_wordnum);</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageIsVerb</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;first&nbsp;word&nbsp;is&nbsp;not&nbsp;listed&nbsp;as&nbsp;a&nbsp;verb,&nbsp;it&nbsp;must&nbsp;be&nbsp;a&nbsp;direction</span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;or&nbsp;the&nbsp;name&nbsp;of&nbsp;someone&nbsp;to&nbsp;talk&nbsp;to</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;0&nbsp;||&nbsp;((verb_word-&gt;#dict_par1)&nbsp;&amp;&nbsp;1)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;So&nbsp;is&nbsp;the&nbsp;first&nbsp;word&nbsp;an&nbsp;object&nbsp;contained&nbsp;in&nbsp;the&nbsp;special&nbsp;object&nbsp;&quot;compass&quot;</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(i.e.,&nbsp;a&nbsp;direction)?&nbsp;&nbsp;This&nbsp;needs&nbsp;use&nbsp;of&nbsp;NounDomain,&nbsp;a&nbsp;routine&nbsp;which</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;does&nbsp;the&nbsp;object&nbsp;matching,&nbsp;returning&nbsp;the&nbsp;object&nbsp;number,&nbsp;or&nbsp;0&nbsp;if&nbsp;none&nbsp;found,</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;or&nbsp;REPARSE_CODE&nbsp;if&nbsp;it&nbsp;has&nbsp;restructured&nbsp;the&nbsp;parse&nbsp;table&nbsp;so&nbsp;the&nbsp;whole&nbsp;parse</span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;must&nbsp;be&nbsp;begun&nbsp;again...</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum;&nbsp;indef_mode&nbsp;=&nbsp;false;&nbsp;token_filter&nbsp;=&nbsp;0;&nbsp;parameters&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@push&nbsp;actor;&nbsp;@push&nbsp;action;&nbsp;@push&nbsp;action_to_be;</span></span>
<span class="tr"><span class="th" id="line720">720</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actor&nbsp;=&nbsp;player;&nbsp;meta&nbsp;=&nbsp;false;&nbsp;action&nbsp;=&nbsp;##Go;&nbsp;action_to_be&nbsp;=&nbsp;##Go;</span></span>
<span class="tr"><span class="th" id="line721">721</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NounDomain(compass,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line722">722</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;action_to_be;&nbsp;@pull&nbsp;action;&nbsp;@pull&nbsp;actor;</span></span>
<span class="tr"><span class="th" id="line723">723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line563">ReParse</a>;</span></span>
<span class="tr"><span class="th" id="line724">724</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line725">725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;direction,&nbsp;send&nbsp;back&nbsp;the&nbsp;results:</span></span>
<span class="tr"><span class="th" id="line726">726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;action=GoSub,&nbsp;no&nbsp;of&nbsp;arguments=1,&nbsp;argument&nbsp;1=the&nbsp;direction.</span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((l~=0)&nbsp;&amp;&amp;&nbsp;(l&nbsp;ofclass&nbsp;K3_direction))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;##Go;</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inferred_go&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1397">LookForMore</a>;</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;end&nbsp;of&nbsp;first-word-not-a-verb</span></span>
</div><div class='text'>
<h3>Parser Letter C.</h3><p><p> Is anyone being addressed?<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;!&nbsp;Only&nbsp;check&nbsp;for&nbsp;a&nbsp;comma&nbsp;(a&nbsp;&quot;someone,&nbsp;do&nbsp;something&quot;&nbsp;command)&nbsp;if&nbsp;we&nbsp;are</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;!&nbsp;not&nbsp;already&nbsp;in&nbsp;the&nbsp;middle&nbsp;of&nbsp;one.&nbsp;&nbsp;(This&nbsp;simplification&nbsp;stops&nbsp;us&nbsp;from</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">&nbsp;!&nbsp;worrying&nbsp;about&nbsp;&quot;robot,&nbsp;wizard,&nbsp;you&nbsp;are&nbsp;an&nbsp;idiot&quot;,&nbsp;telling&nbsp;the&nbsp;robot&nbsp;to</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td">&nbsp;!&nbsp;tell&nbsp;the&nbsp;wizard&nbsp;that&nbsp;she&nbsp;is&nbsp;an&nbsp;idiot.)</span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td">&nbsp;if&nbsp;(actor&nbsp;==&nbsp;player)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td">&nbsp;&nbsp;for&nbsp;(j=2&nbsp;:&nbsp;j&lt;=num_words&nbsp;:&nbsp;j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">&nbsp;&nbsp;&nbsp;i=NextWord();</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;comma_word)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line758">Conversation</a>;</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line824">NotConversation</a>;</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;!&nbsp;NextWord&nbsp;nudges&nbsp;the&nbsp;word&nbsp;number&nbsp;wn&nbsp;on&nbsp;by&nbsp;one&nbsp;each&nbsp;time,&nbsp;so&nbsp;we&#39;ve&nbsp;now</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;!&nbsp;advanced&nbsp;past&nbsp;a&nbsp;comma.&nbsp;&nbsp;(A&nbsp;comma&nbsp;is&nbsp;a&nbsp;word&nbsp;all&nbsp;on&nbsp;its&nbsp;own&nbsp;in&nbsp;the&nbsp;table.)</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;.Conversation;</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;j&nbsp;=&nbsp;wn&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;!&nbsp;Use&nbsp;NounDomain&nbsp;(in&nbsp;the&nbsp;context&nbsp;of&nbsp;&quot;animate&nbsp;creature&quot;)&nbsp;to&nbsp;see&nbsp;if&nbsp;the</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;!&nbsp;words&nbsp;make&nbsp;sense&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;someone&nbsp;held&nbsp;or&nbsp;nearby</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">&nbsp;wn&nbsp;=&nbsp;1;&nbsp;lookahead&nbsp;=&nbsp;HELD_TOKEN;</span></span>
<span class="tr"><span class="th" id="line766">766</span><span class="td">&nbsp;scope_reason&nbsp;=&nbsp;TALKING_REASON;</span></span>
<span class="tr"><span class="th" id="line767">767</span><span class="td">&nbsp;l&nbsp;=&nbsp;NounDomain(player,actors_location,6);</span></span>
<span class="tr"><span class="th" id="line768">768</span><span class="td">&nbsp;scope_reason&nbsp;=&nbsp;PARSING_REASON;</span></span>
<span class="tr"><span class="th" id="line769">769</span><span class="td">&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line563">ReParse</a>;</span></span>
<span class="tr"><span class="th" id="line770">770</span><span class="td">&nbsp;if&nbsp;(l&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line771">771</span><span class="td">&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;&amp;&amp;&nbsp;((verb_word-&gt;#dict_par1)&nbsp;&amp;&nbsp;1))&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line824">NotConversation</a>;</span></span>
<span class="tr"><span class="th" id="line772">772</span><span class="td">&nbsp;&nbsp;best_etype&nbsp;=&nbsp;MISSINGPERSON_PE;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line773">773</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line774">774</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line775">775</span><span class="td">&nbsp;.Conversation2;</span></span>
<span class="tr"><span class="th" id="line776">776</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line777">777</span><span class="td">&nbsp;!&nbsp;The&nbsp;object&nbsp;addressed&nbsp;must&nbsp;at&nbsp;least&nbsp;be&nbsp;&quot;talkable&quot;&nbsp;if&nbsp;not&nbsp;actually&nbsp;&quot;animate&quot;</span></span>
<span class="tr"><span class="th" id="line778">778</span><span class="td">&nbsp;!&nbsp;(the&nbsp;distinction&nbsp;allows,&nbsp;for&nbsp;instance,&nbsp;a&nbsp;microphone&nbsp;to&nbsp;be&nbsp;spoken&nbsp;to,</span></span>
<span class="tr"><span class="th" id="line779">779</span><span class="td">&nbsp;!&nbsp;without&nbsp;the&nbsp;parser&nbsp;thinking&nbsp;that&nbsp;the&nbsp;microphone&nbsp;is&nbsp;human).</span></span>
<span class="tr"><span class="th" id="line780">780</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line781">781</span><span class="td">&nbsp;if&nbsp;(l&nbsp;hasnt&nbsp;animate&nbsp;&amp;&amp;&nbsp;l&nbsp;hasnt&nbsp;talkable)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line782">782</span><span class="td">&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;ANIMALISTEN_PE;&nbsp;noun&nbsp;=&nbsp;l;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line783">783</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line784">784</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line785">785</span><span class="td">&nbsp;!&nbsp;Check&nbsp;that&nbsp;there&nbsp;aren&#39;t&nbsp;any&nbsp;mystery&nbsp;words&nbsp;between&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;person&#39;s</span></span>
<span class="tr"><span class="th" id="line786">786</span><span class="td">&nbsp;!&nbsp;name&nbsp;and&nbsp;the&nbsp;comma&nbsp;(eg,&nbsp;throw&nbsp;out&nbsp;&quot;dwarf&nbsp;sdfgsdgs,&nbsp;go&nbsp;north&quot;).</span></span>
<span class="tr"><span class="th" id="line787">787</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line788">788</span><span class="td">&nbsp;if&nbsp;(wn&nbsp;~=&nbsp;j)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line789">789</span><span class="td">&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;&amp;&amp;&nbsp;((verb_word-&gt;#dict_par1)&nbsp;&amp;&nbsp;1))&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line824">NotConversation</a>;</span></span>
<span class="tr"><span class="th" id="line790">790</span><span class="td">&nbsp;&nbsp;best_etype&nbsp;=&nbsp;TOTALK_PE;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line791">791</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line792">792</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line793">793</span><span class="td">&nbsp;!&nbsp;The&nbsp;player&nbsp;has&nbsp;now&nbsp;successfully&nbsp;named&nbsp;someone.&nbsp;&nbsp;Adjust&nbsp;&quot;him&quot;,&nbsp;&quot;her&quot;,&nbsp;&quot;it&quot;:</span></span>
<span class="tr"><span class="th" id="line794">794</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line795">795</span><span class="td">&nbsp;PronounNotice(l);</span></span>
<span class="tr"><span class="th" id="line796">796</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line797">797</span><span class="td">&nbsp;!&nbsp;Set&nbsp;the&nbsp;global&nbsp;variable&nbsp;&quot;actor&quot;,&nbsp;adjust&nbsp;the&nbsp;number&nbsp;of&nbsp;the&nbsp;first&nbsp;word,</span></span>
<span class="tr"><span class="th" id="line798">798</span><span class="td">&nbsp;!&nbsp;and&nbsp;begin&nbsp;parsing&nbsp;again&nbsp;from&nbsp;there.</span></span>
<span class="tr"><span class="th" id="line799">799</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line800">800</span><span class="td">&nbsp;verb_wordnum&nbsp;=&nbsp;j&nbsp;+&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line801">801</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line802">802</span><span class="td">&nbsp;!&nbsp;Stop&nbsp;things&nbsp;like&nbsp;&quot;me,&nbsp;again&quot;:</span></span>
<span class="tr"><span class="th" id="line803">803</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line804">804</span><span class="td">&nbsp;if&nbsp;(l&nbsp;==&nbsp;player)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line805">805</span><span class="td">&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum;</span></span>
<span class="tr"><span class="th" id="line806">806</span><span class="td">&nbsp;&nbsp;if&nbsp;(NextWordStopped()&nbsp;==&nbsp;AGAIN1__WD&nbsp;or&nbsp;AGAIN2__WD&nbsp;or&nbsp;AGAIN3__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line807">807</span><span class="td">&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;ANIMAAGAIN_PE;</span></span>
<span class="tr"><span class="th" id="line808">808</span><span class="td">&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line809">809</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line810">810</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line811">811</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line812">812</span><span class="td">&nbsp;actor&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line813">813</span><span class="td">&nbsp;actors_location&nbsp;=&nbsp;ScopeCeiling(l);</span></span>
<span class="tr"><span class="th" id="line814">814</span><span class="td">&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line815">815</span><span class="td">&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;1)</span></span>
<span class="tr"><span class="th" id="line816">816</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;[Actor&nbsp;is&nbsp;&quot;,&nbsp;(the)&nbsp;actor,&nbsp;&quot;&nbsp;in&nbsp;&quot;,&nbsp;(name)&nbsp;actors_location,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line817">817</span><span class="td">&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line818">818</span><span class="td">&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line625">BeginCommand</a>;</span></span>
</div><div class='text'>
<h3>Parser Letter D.</h3><p><p> Get the verb: try all the syntax lines for that verb.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line824">824</span><span class="td">&nbsp;.NotConversation;</span></span>
<span class="tr"><span class="th" id="line825">825</span><span class="td">&nbsp;if&nbsp;(verb_word&nbsp;==&nbsp;0&nbsp;||&nbsp;((verb_word-&gt;#dict_par1)&nbsp;&amp;&nbsp;1)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line826">826</span><span class="td">&nbsp;&nbsp;verb_word&nbsp;=&nbsp;UnknownVerb(verb_word);</span></span>
<span class="tr"><span class="th" id="line827">827</span><span class="td">&nbsp;&nbsp;if&nbsp;(verb_word&nbsp;~=&nbsp;0)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line831">VerbAccepted</a>;</span></span>
<span class="tr"><span class="th" id="line828">828</span><span class="td">&nbsp;&nbsp;best_etype&nbsp;=&nbsp;VERB_PE;</span></span>
<span class="tr"><span class="th" id="line829">829</span><span class="td">&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line830">830</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line831">831</span><span class="td">&nbsp;.VerbAccepted;</span></span>
<span class="tr"><span class="th" id="line832">832</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line833">833</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;We&nbsp;now&nbsp;definitely&nbsp;have&nbsp;a&nbsp;verb,&nbsp;not&nbsp;a&nbsp;direction,&nbsp;whether&nbsp;we&nbsp;got&nbsp;here&nbsp;by&nbsp;the</span></span>
<span class="tr"><span class="th" id="line834">834</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&quot;take&nbsp;...&quot;&nbsp;or&nbsp;&quot;person,&nbsp;take&nbsp;...&quot;&nbsp;method.&nbsp;&nbsp;Get&nbsp;the&nbsp;meta&nbsp;flag&nbsp;for&nbsp;this&nbsp;verb:</span></span>
<span class="tr"><span class="th" id="line835">835</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line836">836</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;meta&nbsp;=&nbsp;((verb_word-&gt;#dict_par1)&nbsp;&amp;&nbsp;2)/2;</span></span>
<span class="tr"><span class="th" id="line837">837</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line838">838</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;You&nbsp;can&#39;t&nbsp;order&nbsp;other&nbsp;people&nbsp;to&nbsp;&quot;full&nbsp;score&quot;&nbsp;for&nbsp;you,&nbsp;and&nbsp;so&nbsp;on...</span></span>
<span class="tr"><span class="th" id="line839">839</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line840">840</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(meta&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;actor&nbsp;~=&nbsp;player)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line841">841</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;VERB_PE;</span></span>
<span class="tr"><span class="th" id="line842">842</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line843">843</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line844">844</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line845">845</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line846">846</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now&nbsp;let&nbsp;i&nbsp;be&nbsp;the&nbsp;corresponding&nbsp;verb&nbsp;number...</span></span>
<span class="tr"><span class="th" id="line847">847</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line848">848</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;DictionaryWordToVerbNum(verb_word);</span></span>
<span class="tr"><span class="th" id="line849">849</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line850">850</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...then&nbsp;look&nbsp;up&nbsp;the&nbsp;i-th&nbsp;entry&nbsp;in&nbsp;the&nbsp;verb&nbsp;table,&nbsp;whose&nbsp;address&nbsp;is&nbsp;at&nbsp;word</span></span>
<span class="tr"><span class="th" id="line851">851</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;7&nbsp;in&nbsp;the&nbsp;Z-machine&nbsp;(in&nbsp;the&nbsp;header),&nbsp;so&nbsp;as&nbsp;to&nbsp;get&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;syntax</span></span>
<span class="tr"><span class="th" id="line852">852</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;table&nbsp;for&nbsp;the&nbsp;given&nbsp;verb...</span></span>
<span class="tr"><span class="th" id="line853">853</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line854">854</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line855">855</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;=&nbsp;(HDR_STATICMEMORY--&gt;0)--&gt;i;</span></span>
<span class="tr"><span class="th" id="line856">856</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line857">857</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;syntax&nbsp;=&nbsp;(#grammar_table)--&gt;(i+1);</span></span>
<span class="tr"><span class="th" id="line858">858</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line859">859</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line860">860</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...and&nbsp;then&nbsp;see&nbsp;how&nbsp;many&nbsp;lines&nbsp;(ie,&nbsp;different&nbsp;patterns&nbsp;corresponding&nbsp;to&nbsp;the</span></span>
<span class="tr"><span class="th" id="line861">861</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;same&nbsp;verb)&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;parse&nbsp;table...</span></span>
<span class="tr"><span class="th" id="line862">862</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line863">863</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;num_lines&nbsp;=&nbsp;(syntax-&gt;0)&nbsp;-&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line864">864</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line865">865</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...and&nbsp;now&nbsp;go&nbsp;through&nbsp;them&nbsp;all,&nbsp;one&nbsp;by&nbsp;one.</span></span>
<span class="tr"><span class="th" id="line866">866</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;To&nbsp;prevent&nbsp;pronoun_word&nbsp;0&nbsp;being&nbsp;misunderstood,</span></span>
<span class="tr"><span class="th" id="line867">867</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line868">868</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pronoun_word&nbsp;=&nbsp;NULL;&nbsp;pronoun_obj&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line869">869</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line870">870</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line871">871</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;1)</span></span>
<span class="tr"><span class="th" id="line872">872</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[Parsing&nbsp;for&nbsp;the&nbsp;verb&nbsp;&#39;&quot;,&nbsp;(address)&nbsp;verb_word,&nbsp;&quot;&#39;&nbsp;(&quot;,&nbsp;num_lines+1,&nbsp;&quot;&nbsp;lines)]^&quot;;</span></span>
<span class="tr"><span class="th" id="line873">873</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line874">874</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line875">875</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;STUCK_PE;&nbsp;nextbest_etype&nbsp;=&nbsp;STUCK_PE;</span></span>
<span class="tr"><span class="th" id="line876">876</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;multiflag&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line877">877</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line878">878</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&quot;best_etype&quot;&nbsp;is&nbsp;the&nbsp;current&nbsp;failure-to-match&nbsp;error&nbsp;-&nbsp;it&nbsp;is&nbsp;by&nbsp;default</span></span>
<span class="tr"><span class="th" id="line879">879</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;the&nbsp;least&nbsp;informative&nbsp;one,&nbsp;&quot;don&#39;t&nbsp;understand&nbsp;that&nbsp;sentence&quot;.</span></span>
<span class="tr"><span class="th" id="line880">880</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&quot;nextbest_etype&quot;&nbsp;remembers&nbsp;the&nbsp;best&nbsp;alternative&nbsp;to&nbsp;having&nbsp;to&nbsp;ask&nbsp;a</span></span>
<span class="tr"><span class="th" id="line881">881</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;scope&nbsp;token&nbsp;for&nbsp;an&nbsp;error&nbsp;message&nbsp;(i.e.,&nbsp;the&nbsp;best&nbsp;not&nbsp;counting&nbsp;ASKSCOPE_PE).</span></span>
<span class="tr"><span class="th" id="line882">882</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;multiflag&nbsp;is&nbsp;used&nbsp;here&nbsp;to&nbsp;prevent&nbsp;inappropriate&nbsp;MULTI_PE&nbsp;errors</span></span>
<span class="tr"><span class="th" id="line883">883</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;in&nbsp;addition&nbsp;to&nbsp;its&nbsp;unrelated&nbsp;duties&nbsp;passing&nbsp;information&nbsp;to&nbsp;action&nbsp;routines</span></span>
</div><div class='text'>
<h3>Parser Letter E.</h3><p><p> Break down a syntax line into analysed tokens.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line889">889</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;line_address&nbsp;=&nbsp;syntax&nbsp;+&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line890">890</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line891">891</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(line=0&nbsp;:&nbsp;line&lt;=num_lines&nbsp;:&nbsp;line++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line892">892</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line893">893</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Unpack&nbsp;the&nbsp;syntax&nbsp;line&nbsp;from&nbsp;Inform&nbsp;format&nbsp;into&nbsp;three&nbsp;arrays;&nbsp;ensure&nbsp;that</span></span>
<span class="tr"><span class="th" id="line894">894</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;the&nbsp;sequence&nbsp;of&nbsp;tokens&nbsp;ends&nbsp;in&nbsp;an&nbsp;ENDIT_TOKEN.</span></span>
<span class="tr"><span class="th" id="line895">895</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line896">896</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line_address&nbsp;=&nbsp;UnpackGrammarLine(line_address);</span></span>
<span class="tr"><span class="th" id="line897">897</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line898">898</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line899">899</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line900">900</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line901">901</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[line&nbsp;&quot;,&nbsp;line;&nbsp;DebugGrammarLine();</span></span>
<span class="tr"><span class="th" id="line902">902</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line903">903</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line904">904</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line905">905</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line906">906</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;We&nbsp;aren&#39;t&nbsp;in&nbsp;&quot;not&nbsp;holding&quot;&nbsp;or&nbsp;inferring&nbsp;modes,&nbsp;and&nbsp;haven&#39;t&nbsp;entered</span></span>
<span class="tr"><span class="th" id="line907">907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;any&nbsp;parameters&nbsp;on&nbsp;the&nbsp;line&nbsp;yet,&nbsp;or&nbsp;any&nbsp;special&nbsp;numbers;&nbsp;the&nbsp;multiple</span></span>
<span class="tr"><span class="th" id="line908">908</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;object&nbsp;is&nbsp;still&nbsp;empty.</span></span>
<span class="tr"><span class="th" id="line909">909</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line910">910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inferfrom&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line911">911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameters&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line912">912</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nsns&nbsp;=&nbsp;0;&nbsp;special_word&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line913">913</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line914">914</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi_context&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line915">915</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;STUCK_PE;</span></span>
<span class="tr"><span class="th" id="line916">916</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line917">917</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Put&nbsp;the&nbsp;word&nbsp;marker&nbsp;back&nbsp;to&nbsp;just&nbsp;after&nbsp;the&nbsp;verb</span></span>
<span class="tr"><span class="th" id="line918">918</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line919">919</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum+1;</span></span>
</div><div class='text'>
<h3>Parser Letter F.</h3><p><p> Look ahead for advance warning for <span class="fixed">multiexcept</span>/<span class="fixed">multiinside</span>.<p></p><p> There are two special cases where parsing a token now has to be affected by the result of parsing another token later, and these two cases (multiexcept and multiinside tokens) are helped by a quick look ahead, to work out the future token now. We can only carry this out in the simple (but by far the most common) case:<p>         	|multiexcept &lt;one or more prepositions&gt; noun|<p>          and similarly for <span class="fixed">multiinside</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line935">935</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;advance_warning&nbsp;=&nbsp;-1;&nbsp;indef_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line936">936</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0,m=false,pcount=0&nbsp;:&nbsp;line_token--&gt;pcount&nbsp;~=&nbsp;ENDIT_TOKEN&nbsp;:&nbsp;pcount++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line937">937</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_token&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line938">938</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line939">939</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_ttype--&gt;pcount&nbsp;~=&nbsp;PREPOSITION_TT)&nbsp;i++;</span></span>
<span class="tr"><span class="th" id="line940">940</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line941">941</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_ttype--&gt;pcount&nbsp;==&nbsp;ELEMENTARY_TT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line942">942</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_tdata--&gt;pcount&nbsp;==&nbsp;MULTI_TOKEN)&nbsp;m&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line943">943</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_tdata--&gt;pcount&nbsp;==&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN&nbsp;&nbsp;&amp;&amp;&nbsp;i&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line944">944</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;First&nbsp;non-preposition&nbsp;is&nbsp;&quot;multiexcept&quot;&nbsp;or</span></span>
<span class="tr"><span class="th" id="line945">945</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&quot;multiinside&quot;,&nbsp;so&nbsp;look&nbsp;ahead.</span></span>
<span class="tr"><span class="th" id="line946">946</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line947">947</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line948">948</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)&nbsp;print&nbsp;&quot;&nbsp;[Trying&nbsp;look-ahead]^&quot;;</span></span>
<span class="tr"><span class="th" id="line949">949</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line950">950</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line951">951</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;We&nbsp;need&nbsp;this&nbsp;to&nbsp;be&nbsp;followed&nbsp;by&nbsp;1&nbsp;or&nbsp;more&nbsp;prepositions.</span></span>
<span class="tr"><span class="th" id="line952">952</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line953">953</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcount++;</span></span>
<span class="tr"><span class="th" id="line954">954</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_ttype--&gt;pcount&nbsp;==&nbsp;PREPOSITION_TT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line955">955</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;skip&nbsp;ahead&nbsp;to&nbsp;a&nbsp;preposition&nbsp;word&nbsp;in&nbsp;the&nbsp;input</span></span>
<span class="tr"><span class="th" id="line956">956</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{</span></span>
<span class="tr"><span class="th" id="line957">957</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line958">958</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;until&nbsp;((wn&nbsp;&gt;&nbsp;num_words)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line959">959</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(l&nbsp;&amp;&amp;&nbsp;(l-&gt;#dict_par1)&nbsp;&amp;&nbsp;8&nbsp;~=&nbsp;0));</span></span>
<span class="tr"><span class="th" id="line960">960</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line961">961</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line962">962</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line963">963</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)</span></span>
<span class="tr"><span class="th" id="line964">964</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;[Look-ahead&nbsp;aborted:&nbsp;prepositions&nbsp;missing]^&quot;;</span></span>
<span class="tr"><span class="th" id="line965">965</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line966">966</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line999">EmptyLine</a>;</span></span>
<span class="tr"><span class="th" id="line967">967</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line968">968</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line969">969</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{</span></span>
<span class="tr"><span class="th" id="line970">970</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(PrepositionChain(l,&nbsp;pcount)&nbsp;~=&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line971">971</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;advance&nbsp;past&nbsp;the&nbsp;chain</span></span>
<span class="tr"><span class="th" id="line972">972</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((line_token--&gt;pcount)-&gt;0&nbsp;&amp;&nbsp;$20&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line973">973</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcount++;</span></span>
<span class="tr"><span class="th" id="line974">974</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((line_token--&gt;pcount&nbsp;~=&nbsp;ENDIT_TOKEN)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line975">975</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((line_token--&gt;pcount)-&gt;0&nbsp;&amp;&nbsp;$10&nbsp;~=&nbsp;0))</span></span>
<span class="tr"><span class="th" id="line976">976</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcount++;</span></span>
<span class="tr"><span class="th" id="line977">977</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line978">978</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcount++;</span></span>
<span class="tr"><span class="th" id="line979">979</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line980">980</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line981">981</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;try&nbsp;to&nbsp;find&nbsp;another&nbsp;preposition&nbsp;word</span></span>
<span class="tr"><span class="th" id="line982">982</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{</span></span>
<span class="tr"><span class="th" id="line983">983</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line984">984</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;until&nbsp;((wn&nbsp;&gt;=&nbsp;num_words)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line985">985</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(l&nbsp;&amp;&amp;&nbsp;(l-&gt;#dict_par1)&nbsp;&amp;&nbsp;8&nbsp;~=&nbsp;0));</span></span>
<span class="tr"><span class="th" id="line986">986</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line987">987</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;&amp;&amp;&nbsp;(l-&gt;#dict_par1)&nbsp;&amp;&nbsp;8)&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line988">988</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line989">989</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;lookahead&nbsp;failed</span></span>
<span class="tr"><span class="th" id="line990">990</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line991">991</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)</span></span>
<span class="tr"><span class="th" id="line992">992</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;[Look-ahead&nbsp;aborted:&nbsp;prepositions&nbsp;don&#39;t&nbsp;match]^&quot;;</span></span>
<span class="tr"><span class="th" id="line993">993</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line994">994</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1242">LineFailed</a>;</span></span>
<span class="tr"><span class="th" id="line995">995</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line996">996</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&lt;=&nbsp;num_words)&nbsp;l&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line997">997</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;until&nbsp;(line_ttype--&gt;pcount&nbsp;~=&nbsp;PREPOSITION_TT);</span></span>
<span class="tr"><span class="th" id="line998">998</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line999">999</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.EmptyLine;</span></span>
<span class="tr"><span class="th" id="line1000">1000</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;put&nbsp;back&nbsp;the&nbsp;non-preposition&nbsp;we&nbsp;just&nbsp;read</span></span>
<span class="tr"><span class="th" id="line1001">1001</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line1002">1002</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1003">1003</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((line_ttype--&gt;pcount&nbsp;==&nbsp;ELEMENTARY_TT)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1004">1004</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(line_tdata--&gt;pcount&nbsp;==&nbsp;NOUN_TOKEN))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1005">1005</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;Descriptors();&nbsp;&nbsp;!&nbsp;skip&nbsp;past&nbsp;THE&nbsp;etc</span></span>
<span class="tr"><span class="th" id="line1006">1006</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l~=0)&nbsp;etype=l;&nbsp;&nbsp;!&nbsp;don&#39;t&nbsp;allow&nbsp;multiple&nbsp;objects</span></span>
<span class="tr"><span class="th" id="line1007">1007</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;parser_results--&gt;INP1_PRES;&nbsp;@push&nbsp;k;&nbsp;@push&nbsp;parameters;</span></span>
<span class="tr"><span class="th" id="line1008">1008</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameters&nbsp;=&nbsp;1;&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1009">1009</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NounDomain(actors_location,&nbsp;actor,&nbsp;NOUN_TOKEN,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1010">1010</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;parameters;&nbsp;@pull&nbsp;k;&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line1011">1011</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1012">1012</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1013">1013</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;[Advanced&nbsp;to&nbsp;~noun~&nbsp;token:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1014">1014</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;print&nbsp;&quot;re-parse&nbsp;request]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1015">1015</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1016">1016</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;1)&nbsp;print&nbsp;&quot;but&nbsp;multiple&nbsp;found]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1017">1017</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;error&nbsp;&quot;,&nbsp;etype,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1018">1018</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;&gt;=&nbsp;2)&nbsp;print&nbsp;(the)&nbsp;l,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1019">1019</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1020">1020</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1021">1021</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1022">1022</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line563">ReParse</a>;</span></span>
<span class="tr"><span class="th" id="line1023">1023</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;&gt;=&nbsp;2)&nbsp;advance_warning&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1024">1024</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1025">1025</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1026">1026</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1027">1027</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1028">1028</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1029">1029</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1030">1030</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1031">1031</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Slightly&nbsp;different&nbsp;line-parsing&nbsp;rules&nbsp;will&nbsp;apply&nbsp;to&nbsp;&quot;take&nbsp;multi&quot;,&nbsp;to</span></span>
<span class="tr"><span class="th" id="line1032">1032</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;prevent&nbsp;&quot;take&nbsp;all&quot;&nbsp;behaving&nbsp;correctly&nbsp;but&nbsp;misleadingly&nbsp;when&nbsp;there&#39;s</span></span>
<span class="tr"><span class="th" id="line1033">1033</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;nothing&nbsp;to&nbsp;take.</span></span>
<span class="tr"><span class="th" id="line1034">1034</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1035">1035</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;take_all_rule&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1036">1036</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m&nbsp;&amp;&amp;&nbsp;params_wanted&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;action_to_be&nbsp;==&nbsp;##Take)</span></span>
<span class="tr"><span class="th" id="line1037">1037</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;take_all_rule&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1038">1038</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1039">1039</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;now&nbsp;start&nbsp;again,&nbsp;properly,&nbsp;forearmed&nbsp;or&nbsp;not&nbsp;as&nbsp;the&nbsp;case&nbsp;may&nbsp;be.</span></span>
<span class="tr"><span class="th" id="line1040">1040</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;As&nbsp;a&nbsp;precaution,&nbsp;we&nbsp;clear&nbsp;all&nbsp;the&nbsp;variables&nbsp;again&nbsp;(they&nbsp;may&nbsp;have&nbsp;been</span></span>
<span class="tr"><span class="th" id="line1041">1041</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;disturbed&nbsp;by&nbsp;the&nbsp;call&nbsp;to&nbsp;NounDomain,&nbsp;which&nbsp;may&nbsp;have&nbsp;called&nbsp;outside</span></span>
<span class="tr"><span class="th" id="line1042">1042</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;code,&nbsp;which&nbsp;may&nbsp;have&nbsp;done&nbsp;anything!).</span></span>
<span class="tr"><span class="th" id="line1043">1043</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1044">1044</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inferfrom&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1045">1045</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameters&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1046">1046</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nsns&nbsp;=&nbsp;0;&nbsp;special_word&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1047">1047</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1048">1048</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;STUCK_PE;</span></span>
<span class="tr"><span class="th" id="line1049">1049</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum+1;</span></span>
</div><div class='text'>
<h3>Parser Letter G.</h3><p><p> Parse each token in turn (calling <span class="fixed"><a href="./Parser.i6t.html#line1469">ParseToken</a></span> to do most of the work).<p></p><p> The <span class="fixed">pattern</span> gradually accumulates what has been recognised so far, so that it may be reprinted by the parser later on.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1058">1058</span><span class="td">&nbsp;&nbsp;m&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1059">1059</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(pcount=1&nbsp;:&nbsp;:&nbsp;pcount++)</span></span>
<span class="tr"><span class="th" id="line1060">1060</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_token--&gt;(pcount-1)&nbsp;==&nbsp;ENDIT_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1061">1061</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pcount&nbsp;&gt;=&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1062">1062</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((((line_token--&gt;(pcount-2))-&gt;0)&nbsp;&amp;&nbsp;$10)&nbsp;~=&nbsp;0)&nbsp;pcount--;</span></span>
<span class="tr"><span class="th" id="line1063">1063</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnalyseToken(line_token--&gt;(pcount-2));</span></span>
<span class="tr"><span class="th" id="line1064">1064</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(found_ttype&nbsp;==&nbsp;PREPOSITION_TT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1065">1065</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1066">1066</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(true)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1067">1067</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;NextWordStopped();</span></span>
<span class="tr"><span class="th" id="line1068">1068</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m&nbsp;==&nbsp;-1)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1069">1069</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;m;</span></span>
<span class="tr"><span class="th" id="line1070">1070</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1071">1071</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(PrepositionChain(l,&nbsp;pcount-2)&nbsp;==&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1072">1072</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1073">1073</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1074">1074</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)</span></span>
<span class="tr"><span class="th" id="line1075">1075</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[line&nbsp;rejected&nbsp;for&nbsp;not&nbsp;ending&nbsp;with&nbsp;correct&nbsp;preposition]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1076">1076</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1077">1077</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;m&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1078">1078</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1079">1079</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1080">1080</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1081">1081</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1082">1082</span><span class="td">&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum+1;</span></span>
<span class="tr"><span class="th" id="line1083">1083</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1084">1084</span><span class="td">&nbsp;&nbsp;if&nbsp;(m)&nbsp;for&nbsp;(pcount=1&nbsp;:&nbsp;:&nbsp;pcount++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1085">1085</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pattern--&gt;pcount&nbsp;=&nbsp;PATTERN_NULL;&nbsp;scope_token&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1086">1086</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1087">1087</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;line_token--&gt;(pcount-1);</span></span>
<span class="tr"><span class="th" id="line1088">1088</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lookahead&nbsp;=&nbsp;line_token--&gt;pcount;</span></span>
<span class="tr"><span class="th" id="line1089">1089</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1090">1090</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1091">1091</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;2)</span></span>
<span class="tr"><span class="th" id="line1092">1092</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;[line&nbsp;&quot;,&nbsp;line,&nbsp;&quot;&nbsp;token&nbsp;&quot;,&nbsp;pcount,&nbsp;&quot;&nbsp;word&nbsp;&quot;,&nbsp;wn,&nbsp;&quot;&nbsp;:&nbsp;&quot;,&nbsp;(DebugToken)&nbsp;token,</span></span>
<span class="tr"><span class="th" id="line1093">1093</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1094">1094</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1095">1095</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1096">1096</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token&nbsp;~=&nbsp;ENDIT_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1097">1097</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_reason&nbsp;=&nbsp;PARSING_REASON;</span></span>
<span class="tr"><span class="th" id="line1098">1098</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnalyseToken(token);</span></span>
<span class="tr"><span class="th" id="line1099">1099</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1100">1100</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;ParseToken(found_ttype,&nbsp;found_tdata,&nbsp;pcount-1,&nbsp;token);</span></span>
<span class="tr"><span class="th" id="line1101">1101</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((l&nbsp;&gt;=&nbsp;GPR_NOUN)&nbsp;&amp;&amp;&nbsp;(l&nbsp;&lt;&nbsp;-1))&nbsp;l&nbsp;=&nbsp;ParseToken(ELEMENTARY_TT,&nbsp;l&nbsp;+&nbsp;256);</span></span>
<span class="tr"><span class="th" id="line1102">1102</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_reason&nbsp;=&nbsp;PARSING_REASON;</span></span>
<span class="tr"><span class="th" id="line1103">1103</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1104">1104</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;GPR_PREPOSITION)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1105">1105</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(found_ttype~=PREPOSITION_TT&nbsp;&amp;&amp;&nbsp;(found_ttype~=ELEMENTARY_TT&nbsp;||</span></span>
<span class="tr"><span class="th" id="line1106">1106</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;found_tdata~=TOPIC_TOKEN))&nbsp;params_wanted--;</span></span>
<span class="tr"><span class="th" id="line1107">1107</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1108">1108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1109">1109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1110">1110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;&lt;&nbsp;0)&nbsp;l&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1111">1111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1112">1112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;~=&nbsp;GPR_REPARSE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1113">1113</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;GPR_NUMBER)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1114">1114</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nsns&nbsp;==&nbsp;0)&nbsp;special_number1&nbsp;=&nbsp;parsed_number;</span></span>
<span class="tr"><span class="th" id="line1115">1115</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;special_number2&nbsp;=&nbsp;parsed_number;</span></span>
<span class="tr"><span class="th" id="line1116">1116</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nsns++;&nbsp;l&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1117">1117</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1118">1118</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;GPR_MULTIPLE)&nbsp;l&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1119">1119</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;(parameters+INP1_PRES)&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1120">1120</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameters++;</span></span>
<span class="tr"><span class="th" id="line1121">1121</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pattern--&gt;pcount&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1122">1122</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1123">1123</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1124">1124</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1125">1125</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1126">1126</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1127">1127</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[token&nbsp;resulted&nbsp;in&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1128">1128</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;print&nbsp;&quot;re-parse&nbsp;request]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1129">1129</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;failure&nbsp;with&nbsp;error&nbsp;type&nbsp;&quot;,&nbsp;etype,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1130">1130</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;1)&nbsp;print&nbsp;&quot;success]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1131">1131</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1132">1132</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1133">1133</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1134">1134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line563">ReParse</a>;</span></span>
<span class="tr"><span class="th" id="line1135">1135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;false)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1136">1136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1137">1137</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1138">1138</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1139">1139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;player&nbsp;has&nbsp;entered&nbsp;enough&nbsp;already&nbsp;but&nbsp;there&#39;s&nbsp;still</span></span>
<span class="tr"><span class="th" id="line1140">1140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;text&nbsp;to&nbsp;wade&nbsp;through:&nbsp;store&nbsp;the&nbsp;pattern&nbsp;away&nbsp;so&nbsp;as&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;produce</span></span>
<span class="tr"><span class="th" id="line1141">1141</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;a&nbsp;decent&nbsp;error&nbsp;message&nbsp;if&nbsp;this&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;the&nbsp;best&nbsp;we&nbsp;ever&nbsp;manage,</span></span>
<span class="tr"><span class="th" id="line1142">1142</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;in&nbsp;the&nbsp;mean&nbsp;time&nbsp;give&nbsp;up&nbsp;on&nbsp;this&nbsp;line</span></span>
<span class="tr"><span class="th" id="line1143">1143</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1144">1144</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;However,&nbsp;if&nbsp;the&nbsp;superfluous&nbsp;text&nbsp;begins&nbsp;with&nbsp;a&nbsp;comma&nbsp;or&nbsp;&quot;then&quot;&nbsp;then</span></span>
<span class="tr"><span class="th" id="line1145">1145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;take&nbsp;that&nbsp;to&nbsp;be&nbsp;the&nbsp;start&nbsp;of&nbsp;another&nbsp;instruction</span></span>
<span class="tr"><span class="th" id="line1146">1146</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1147">1147</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&lt;=&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1148">1148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1149">1149</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;THEN1__WD&nbsp;or&nbsp;THEN2__WD&nbsp;or&nbsp;THEN3__WD&nbsp;or&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1150">1150</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;held_back_mode&nbsp;=&nbsp;true;&nbsp;hb_wn&nbsp;=&nbsp;wn-1;</span></span>
<span class="tr"><span class="th" id="line1151">1151</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1152">1152</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(m=0&nbsp;:&nbsp;m&lt;32&nbsp;:&nbsp;m++)&nbsp;pattern2--&gt;m&nbsp;=&nbsp;pattern--&gt;m;</span></span>
<span class="tr"><span class="th" id="line1153">1153</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcount2&nbsp;=&nbsp;pcount;</span></span>
<span class="tr"><span class="th" id="line1154">1154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;UPTO_PE;</span></span>
<span class="tr"><span class="th" id="line1155">1155</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1156">1156</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1157">1157</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1158">1158</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1159">1159</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now,&nbsp;we&nbsp;may&nbsp;need&nbsp;to&nbsp;revise&nbsp;the&nbsp;multiple&nbsp;object&nbsp;because&nbsp;of&nbsp;the&nbsp;single&nbsp;one</span></span>
<span class="tr"><span class="th" id="line1160">1160</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;we&nbsp;now&nbsp;know&nbsp;(but&nbsp;didn&#39;t&nbsp;when&nbsp;the&nbsp;list&nbsp;was&nbsp;drawn&nbsp;up).</span></span>
<span class="tr"><span class="th" id="line1161">1161</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1162">1162</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parameters&nbsp;&gt;=&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1163">1163</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_results--&gt;INP1_PRES&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1164">1164</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;ReviseMulti(parser_results--&gt;INP2_PRES);</span></span>
<span class="tr"><span class="th" id="line1165">1165</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;~=&nbsp;0)&nbsp;{&nbsp;etype&nbsp;=&nbsp;l;&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;action_to_be;&nbsp;break;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1166">1166</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1167">1167</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1168">1168</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parameters&nbsp;&gt;=&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1169">1169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_results--&gt;INP2_PRES&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1170">1170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;ReviseMulti(parser_results--&gt;INP1_PRES);</span></span>
<span class="tr"><span class="th" id="line1171">1171</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;~=&nbsp;0)&nbsp;{&nbsp;etype&nbsp;=&nbsp;l;&nbsp;break;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1172">1172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1173">1173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;parser_results--&gt;INP1_PRES;&nbsp;l&nbsp;=&nbsp;parser_results--&gt;INP2_PRES;</span></span>
<span class="tr"><span class="th" id="line1174">1174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(k&nbsp;&amp;&amp;&nbsp;l)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1175">1175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((multi_context==MULTIEXCEPT_TOKEN&nbsp;&amp;&amp;&nbsp;k&nbsp;==&nbsp;l)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line1176">1176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((multi_context==MULTIINSIDE_TOKEN&nbsp;&amp;&amp;&nbsp;k&nbsp;notin&nbsp;l&nbsp;&amp;&amp;&nbsp;l&nbsp;notin&nbsp;k)))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1177">1177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;NOTHING_PE;</span></span>
<span class="tr"><span class="th" id="line1178">1178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;action_to_be;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line1179">1179</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1180">1180</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1181">1181</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1182">1182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1183">1183</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1184">1184</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;To&nbsp;trap&nbsp;the&nbsp;case&nbsp;of&nbsp;&quot;take&nbsp;all&quot;&nbsp;inferring&nbsp;only&nbsp;&quot;yourself&quot;&nbsp;when&nbsp;absolutely</span></span>
<span class="tr"><span class="th" id="line1185">1185</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;nothing&nbsp;else&nbsp;is&nbsp;in&nbsp;the&nbsp;vicinity...</span></span>
<span class="tr"><span class="th" id="line1186">1186</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1187">1187</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(take_all_rule&nbsp;==&nbsp;2&nbsp;&amp;&amp;&nbsp;parser_results--&gt;INP1_PRES&nbsp;==&nbsp;actor)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1188">1188</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;NOTHING_PE;</span></span>
<span class="tr"><span class="th" id="line1189">1189</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line1190">1190</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1191">1191</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1192">1192</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1193">1193</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;1)&nbsp;print&nbsp;&quot;[Line&nbsp;successfully&nbsp;parsed]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1194">1194</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1195">1195</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1196">1196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;line&nbsp;has&nbsp;successfully&nbsp;matched&nbsp;the&nbsp;text.&nbsp;&nbsp;Declare&nbsp;the&nbsp;input&nbsp;error-free...</span></span>
<span class="tr"><span class="th" id="line1197">1197</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1198">1198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oops_from&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1199">1199</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1200">1200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...explain&nbsp;any&nbsp;inferences&nbsp;made&nbsp;(using&nbsp;the&nbsp;pattern)...</span></span>
<span class="tr"><span class="th" id="line1201">1201</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1202">1202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inferfrom&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1203">1203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintInferredCommand(inferfrom);</span></span>
<span class="tr"><span class="th" id="line1204">1204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClearParagraphing(20);</span></span>
<span class="tr"><span class="th" id="line1205">1205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1206">1206</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1207">1207</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...copy&nbsp;the&nbsp;action&nbsp;number,&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;parameters...</span></span>
<span class="tr"><span class="th" id="line1208">1208</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1209">1209</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;action_to_be;</span></span>
<span class="tr"><span class="th" id="line1210">1210</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;parameters;</span></span>
<span class="tr"><span class="th" id="line1211">1211</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1212">1212</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...reverse&nbsp;first&nbsp;and&nbsp;second&nbsp;parameters&nbsp;if&nbsp;need&nbsp;be...</span></span>
<span class="tr"><span class="th" id="line1213">1213</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1214">1214</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(action_reversed&nbsp;&amp;&amp;&nbsp;parameters&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1215">1215</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;parser_results--&gt;INP1_PRES;</span></span>
<span class="tr"><span class="th" id="line1216">1216</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;parser_results--&gt;INP2_PRES;</span></span>
<span class="tr"><span class="th" id="line1217">1217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP2_PRES&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line1218">1218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nsns&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1219">1219</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;special_number1;&nbsp;special_number1&nbsp;=&nbsp;special_number2;</span></span>
<span class="tr"><span class="th" id="line1220">1220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special_number2&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line1221">1221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1222">1222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1223">1223</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1224">1224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...and&nbsp;to&nbsp;reset&nbsp;&quot;it&quot;-style&nbsp;objects&nbsp;to&nbsp;the&nbsp;first&nbsp;of&nbsp;these&nbsp;parameters,&nbsp;if</span></span>
<span class="tr"><span class="th" id="line1225">1225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;there&nbsp;is&nbsp;one&nbsp;(and&nbsp;it&nbsp;really&nbsp;is&nbsp;an&nbsp;object)...</span></span>
<span class="tr"><span class="th" id="line1226">1226</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1227">1227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parameters&nbsp;&gt;&nbsp;0&nbsp;&amp;&amp;&nbsp;parser_results--&gt;INP1_PRES&nbsp;&gt;=&nbsp;2)</span></span>
<span class="tr"><span class="th" id="line1228">1228</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PronounNotice(parser_results--&gt;INP1_PRES);</span></span>
<span class="tr"><span class="th" id="line1229">1229</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1230">1230</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...and&nbsp;return&nbsp;from&nbsp;the&nbsp;parser&nbsp;altogether,&nbsp;having&nbsp;successfully&nbsp;matched</span></span>
<span class="tr"><span class="th" id="line1231">1231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;a&nbsp;line.</span></span>
<span class="tr"><span class="th" id="line1232">1232</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1233">1233</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(held_back_mode)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1234">1234</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn=hb_wn;</span></span>
<span class="tr"><span class="th" id="line1235">1235</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1397">LookForMore</a>;</span></span>
<span class="tr"><span class="th" id="line1236">1236</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1237">1237</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1238">1238</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1239">1239</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;end&nbsp;of&nbsp;if(token&nbsp;~=&nbsp;ENDIT_TOKEN)&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1240">1240</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;end&nbsp;of&nbsp;for(pcount++)</span></span>
<span class="tr"><span class="th" id="line1241">1241</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1242">1242</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.LineFailed;</span></span>
<span class="tr"><span class="th" id="line1243">1243</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;line&nbsp;has&nbsp;failed&nbsp;to&nbsp;match.</span></span>
<span class="tr"><span class="th" id="line1244">1244</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;We&nbsp;continue&nbsp;the&nbsp;outer&nbsp;&quot;for&quot;&nbsp;loop,&nbsp;trying&nbsp;the&nbsp;next&nbsp;line&nbsp;in&nbsp;the&nbsp;grammar.</span></span>
<span class="tr"><span class="th" id="line1245">1245</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1246">1246</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;&gt;&nbsp;best_etype)&nbsp;best_etype&nbsp;=&nbsp;etype;</span></span>
<span class="tr"><span class="th" id="line1247">1247</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;~=&nbsp;ASKSCOPE_PE&nbsp;&amp;&amp;&nbsp;etype&nbsp;&gt;&nbsp;nextbest_etype)&nbsp;nextbest_etype&nbsp;=&nbsp;etype;</span></span>
<span class="tr"><span class="th" id="line1248">1248</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1249">1249</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...unless&nbsp;the&nbsp;line&nbsp;was&nbsp;something&nbsp;like&nbsp;&quot;take&nbsp;all&quot;&nbsp;which&nbsp;failed&nbsp;because</span></span>
<span class="tr"><span class="th" id="line1250">1250</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;nothing&nbsp;matched&nbsp;the&nbsp;&quot;all&quot;,&nbsp;in&nbsp;which&nbsp;case&nbsp;we&nbsp;stop&nbsp;and&nbsp;give&nbsp;an&nbsp;error&nbsp;now.</span></span>
<span class="tr"><span class="th" id="line1251">1251</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1252">1252</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(take_all_rule&nbsp;==&nbsp;2&nbsp;&amp;&amp;&nbsp;etype==NOTHING_PE)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1253">1253</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1254">1254</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;end&nbsp;of&nbsp;for(line++)</span></span>
<span class="tr"><span class="th" id="line1255">1255</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1256">1256</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;grammar&nbsp;is&nbsp;exhausted:&nbsp;every&nbsp;line&nbsp;has&nbsp;failed&nbsp;to&nbsp;match.</span></span>
</div><div class='text'>
<h3>Parser Letter H.</h3><p><p> Cheaply parse otherwise unrecognised conversation and return.<p></p><p> (Errors are handled differently depending on who was talking. If the command was addressed to somebody else (eg, DWARF, SFGH) then it is taken as conversation which the parser has no business in disallowing.)<p></p><p> The parser used to return the fake action <span class="fixed">##NotUnderstood</span> when a command in the form PERSON, ARFLE BARFLE GLOOP is parsed, where a character is addressed but with an instruction which the parser can&#39;t understand. (If a command such as ARFLE BARFLE GLOOP is not an instruction to someone else, the parser prints an error and requires the player to type another command: thus <span class="fixed">##NotUnderstood</span> was only returned when <span class="fixed"><a href="./Output.i6t.html#line237">actor</a></span> is not the player.) And I6 had elaborate object-oriented ways to deal with this, but we won&#39;t use any of that: we simply convert to a <span class="fixed">##Answer</span> action, which communicates a snippet of words to another character, just as if the player had typed ANSWER ARFLE BARFLE GLOOP TO PERSON. For I7 purposes, the fake action <span class="fixed">##NotUnderstood</span> does not exist.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1278">1278</span><span class="td">&nbsp;&nbsp;.GiveError;</span></span>
<span class="tr"><span class="th" id="line1279">1279</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1280">1280</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;best_etype;</span></span>
<span class="tr"><span class="th" id="line1281">1281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(actor&nbsp;~=&nbsp;player)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1282">1282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(usual_grammar_after&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1283">1283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verb_wordnum&nbsp;=&nbsp;usual_grammar_after;</span></span>
<span class="tr"><span class="th" id="line1284">1284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line618">AlmostReParse</a>;</span></span>
<span class="tr"><span class="th" id="line1285">1285</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1286">1286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;verb_wordnum;</span></span>
<span class="tr"><span class="th" id="line1287">1287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special_word&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1288">1288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(special_word&nbsp;==&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1289">1289</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special_word&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1290">1290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;verb_wordnum++;</span></span>
<span class="tr"><span class="th" id="line1291">1291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1292">1292</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;##Answer;</span></span>
<span class="tr"><span class="th" id="line1293">1293</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;NO_INPS_PRES&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line1294">1294</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP1_PRES&nbsp;=&nbsp;actor;</span></span>
<span class="tr"><span class="th" id="line1295">1295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP2_PRES&nbsp;=&nbsp;1;&nbsp;special_number1&nbsp;=&nbsp;special_word;</span></span>
<span class="tr"><span class="th" id="line1296">1296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actor&nbsp;=&nbsp;player;</span></span>
<span class="tr"><span class="th" id="line1297">1297</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consult_from&nbsp;=&nbsp;verb_wordnum;&nbsp;consult_words&nbsp;=&nbsp;num_words-consult_from+1;</span></span>
<span class="tr"><span class="th" id="line1298">1298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1299">1299</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
</div><div class='text'>
<h3>Parser Letter I.</h3><p><p> Print best possible error message.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1305">1305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;player&nbsp;was&nbsp;the&nbsp;actor&nbsp;(eg,&nbsp;in&nbsp;&quot;take&nbsp;dfghh&quot;)&nbsp;the&nbsp;error&nbsp;must&nbsp;be&nbsp;printed,</span></span>
<span class="tr"><span class="th" id="line1306">1306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;fresh&nbsp;input&nbsp;called&nbsp;for.&nbsp;&nbsp;In&nbsp;three&nbsp;cases&nbsp;the&nbsp;oops&nbsp;word&nbsp;must&nbsp;be&nbsp;jiggled.</span></span>
<span class="tr"><span class="th" id="line1307">1307</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1308">1308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((etype&nbsp;ofclass&nbsp;Routine)&nbsp;||&nbsp;(etype&nbsp;ofclass&nbsp;String))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1309">1309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ParserError(etype)&nbsp;~=&nbsp;0)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line554">ReType</a>;</span></span>
<span class="tr"><span class="th" id="line1310">1310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1311">1311</span><span class="td">&nbsp;&nbsp;if&nbsp;(verb_wordnum&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;etype&nbsp;==&nbsp;CANTSEE_PE)&nbsp;etype&nbsp;=&nbsp;VERB_PE;</span></span>
<span class="tr"><span class="th" id="line1312">1312</span><span class="td">&nbsp;&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;WordCount();&nbsp;!&nbsp;The&nbsp;snippet&nbsp;variable&nbsp;&quot;player&#39;s&nbsp;command&quot;</span></span>
<span class="tr"><span class="th" id="line1313">1313</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(PRINTING_A_PARSER_ERROR_ACT);</span></span>
<span class="tr"><span class="th" id="line1314">1314</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_A_PARSER_ERROR_ACT))&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1374">SkipParserError</a>;</span></span>
<span class="tr"><span class="th" id="line1315">1315</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1316">1316</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pronoun_word&nbsp;=&nbsp;pronoun__word;&nbsp;pronoun_obj&nbsp;=&nbsp;pronoun__obj;</span></span>
<span class="tr"><span class="th" id="line1317">1317</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1318">1318</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;STUCK_PE)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;A&#39;);&nbsp;new_line;&nbsp;oops_from&nbsp;=&nbsp;1;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1319">1319</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;UPTO_PE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1320">1320</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inferred_go)&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;C&#39;);</span></span>
<span class="tr"><span class="th" id="line1321">1321</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line1322">1322</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(m=0&nbsp;:&nbsp;m&lt;32&nbsp;:&nbsp;m++)&nbsp;pattern--&gt;m&nbsp;=&nbsp;pattern2--&gt;m;</span></span>
<span class="tr"><span class="th" id="line1323">1323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pcount&nbsp;=&nbsp;pcount2;&nbsp;PrintCommand(0);</span></span>
<span class="tr"><span class="th" id="line1324">1324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;.^&quot;;</span></span>
<span class="tr"><span class="th" id="line1325">1325</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1326">1326</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;NUMBER_PE)&nbsp;{&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;D&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1327">1327</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;CANTSEE_PE)&nbsp;{&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;E&#39;);&nbsp;new_line;&nbsp;oops_from=saved_oops;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1328">1328</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;TOOLIT_PE)&nbsp;{&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;F&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1329">1329</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;NOTHELD_PE)&nbsp;{&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;G&#39;);&nbsp;new_line;&nbsp;oops_from=saved_oops;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1330">1330</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;MULTI_PE)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;H&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1331">1331</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;MMULTI_PE)&nbsp;{&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;I&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1332">1332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;VAGUE_PE)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;J&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1333">1333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;ITGONE_PE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1334">1334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pronoun_obj&nbsp;==&nbsp;NULL)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;J&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1335">1335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;K&#39;,&nbsp;noun);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1336">1336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1337">1337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;EXCEPT_PE)&nbsp;{&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;L&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1338">1338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;ANIMA_PE)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;M&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1339">1339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;VERB_PE)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;N&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1340">1340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;SCENERY_PE)&nbsp;{&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;O&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1341">1341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;JUNKAFTER_PE)&nbsp;{&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;P&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1342">1342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;TOOFEW_PE)&nbsp;{&nbsp;&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;Q&#39;,&nbsp;multi_had);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1343">1343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;NOTHING_PE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1344">1344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_results--&gt;ACTION_PRES&nbsp;==&nbsp;##Remove&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1345">1345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_results--&gt;INP2_PRES&nbsp;ofclass&nbsp;Object)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1346">1346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noun&nbsp;=&nbsp;parser_results--&gt;INP2_PRES;&nbsp;!&nbsp;ensure&nbsp;valid&nbsp;for&nbsp;messages</span></span>
<span class="tr"><span class="th" id="line1347">1347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(noun&nbsp;has&nbsp;animate)&nbsp;{&nbsp;PARSER_N_ERROR_INTERNAL_RM(&#39;C&#39;,&nbsp;noun);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1348">1348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(noun&nbsp;hasnt&nbsp;container&nbsp;or&nbsp;supporter)&nbsp;{&nbsp;PARSER_N_ERROR_INTERNAL_RM(&#39;D&#39;,&nbsp;noun);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1349">1349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(noun&nbsp;has&nbsp;container&nbsp;&amp;&amp;&nbsp;noun&nbsp;hasnt&nbsp;open)&nbsp;&nbsp;{&nbsp;PARSER_N_ERROR_INTERNAL_RM(&#39;E&#39;,&nbsp;noun);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1350">1350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(children(noun)==0)&nbsp;{&nbsp;PARSER_N_ERROR_INTERNAL_RM(&#39;F&#39;,&nbsp;noun);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1351">1351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;parser_results--&gt;ACTION_PRES&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1352">1352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1353">1353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_results--&gt;ACTION_PRES&nbsp;~=&nbsp;##Remove)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1354">1354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(multi_wanted==100)&nbsp;{&nbsp;PARSER_N_ERROR_INTERNAL_RM(&#39;A&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1355">1355</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;PARSER_N_ERROR_INTERNAL_RM(&#39;B&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1356">1356</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1357">1357</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1358">1358</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;NOTINCONTEXT_PE)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;R&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1359">1359</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;ANIMAAGAIN_PE)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;S&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1360">1360</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;COMMABEGIN_PE)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;T&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1361">1361</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;MISSINGPERSON_PE)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;U&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1362">1362</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;ANIMALISTEN_PE)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;V&#39;,&nbsp;noun);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1363">1363</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;TOTALK_PE)&nbsp;{&nbsp;PARSER_ERROR_INTERNAL_RM(&#39;W&#39;);&nbsp;new_line;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1364">1364</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;ASKSCOPE_PE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1365">1365</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_stage&nbsp;=&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line1366">1366</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indirect(scope_error)&nbsp;==&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1367">1367</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;nextbest_etype;</span></span>
<span class="tr"><span class="th" id="line1368">1368</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(~~((etype&nbsp;ofclass&nbsp;Routine)&nbsp;||&nbsp;(etype&nbsp;ofclass&nbsp;String)))</span></span>
<span class="tr"><span class="th" id="line1369">1369</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(PRINTING_A_PARSER_ERROR_ACT);</span></span>
<span class="tr"><span class="th" id="line1370">1370</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
<span class="tr"><span class="th" id="line1371">1371</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1372">1372</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1373">1373</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1374">1374</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;.SkipParserError;</span></span>
<span class="tr"><span class="th" id="line1375">1375</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((etype&nbsp;ofclass&nbsp;Routine)&nbsp;||&nbsp;(etype&nbsp;ofclass&nbsp;String))&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line554">ReType</a>;</span></span>
<span class="tr"><span class="th" id="line1376">1376</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;say__p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1377">1377</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(PRINTING_A_PARSER_ERROR_ACT);</span></span>
</div><div class='text'>
<h3>Parser Letter J.</h3><p><p> Retry the whole lot.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1383">1383</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;go&nbsp;(almost)&nbsp;right&nbsp;back&nbsp;to&nbsp;square&nbsp;one...</span></span>
<span class="tr"><span class="th" id="line1384">1384</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1385">1385</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line554">ReType</a>;</span></span>
<span class="tr"><span class="th" id="line1386">1386</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1387">1387</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...being&nbsp;careful&nbsp;not&nbsp;to&nbsp;go&nbsp;all&nbsp;the&nbsp;way&nbsp;back,&nbsp;to&nbsp;avoid&nbsp;infinite&nbsp;repetition</span></span>
<span class="tr"><span class="th" id="line1388">1388</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;of&nbsp;a&nbsp;deferred&nbsp;command&nbsp;causing&nbsp;an&nbsp;error.</span></span>
</div><div class='text'>
<h3>Parser Letter K.</h3><p><p> Last thing: check for THEN and further instructions(s), return.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1394">1394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;all&nbsp;prepared,&nbsp;and&nbsp;we&nbsp;are&nbsp;only&nbsp;looking</span></span>
<span class="tr"><span class="th" id="line1395">1395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;to&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;&quot;then&quot;&nbsp;followed&nbsp;by&nbsp;subsequent&nbsp;instruction(s).</span></span>
<span class="tr"><span class="th" id="line1396">1396</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1397">1397</span><span class="td">&nbsp;&nbsp;.LookForMore;</span></span>
<span class="tr"><span class="th" id="line1398">1398</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1399">1399</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1400">1400</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1401">1401</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1402">1402</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;THEN1__WD&nbsp;or&nbsp;THEN2__WD&nbsp;or&nbsp;THEN3__WD&nbsp;or&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1403">1403</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1404">1404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;held_back_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1405">1405</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line1406">1406</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1407">1407</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hb_wn&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line1408">1408</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;held_back_mode&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1409">1409</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line1410">1410</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1411">1411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;best_etype&nbsp;=&nbsp;UPTO_PE;</span></span>
<span class="tr"><span class="th" id="line1412">1412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1278">GiveError</a>;</span></span>
</div><div class='text'>
<h3>End of Parser Proper.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1417">1417</span><span class="td">];&nbsp;!&nbsp;end&nbsp;of&nbsp;Parser__parse</span></span>
</div><div class='text'>
<h3>Internal Rule.</h3><p><p> As a hook on which to hang responses.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1423">1423</span><span class="td">[&nbsp;PARSER_ERROR_INTERNAL_R;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line1424">1424</span><span class="td">[&nbsp;PARSER_N_ERROR_INTERNAL_R;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line1425">1425</span><span class="td">[&nbsp;PARSER_COMMAND_INTERNAL_R;&nbsp;];</span></span>
</div><div class='text'>
<h3>Parse Token.</h3><p><p> The main parsing routine above tried a sequence of &quot;grammar lines&quot; in turn, matching each against the text typed until one fitted. A grammar line is itself a sequence of &quot;grammar tokens&quot;. Here we have to parse the tokens.<p></p><p> <span class="fixed"><a href="./Parser.i6t.html#line1469">ParseToken(type, data)</a></span> tries the match text beginning at the current word marker <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> against a token of the given <span class="fixed">type</span>, with the given <span class="fixed">data</span>. The optional further arguments <span class="fixed">token_n</span> and <span class="fixed">token</span> supply the token number in the current grammar line (because some tokens do depend on what has happened before or is needed later) and the address of the dictionary word which makes up the <span class="fixed">token</span>, in the case where it&#39;s a &quot;preposition&quot;.<p></p><p> The return values are: (a) <span class="fixed"><a href="./Definitions.i6t.html#line545">GPR_REPARSE</a></span> for &quot;I have rewritten the command, please re-parse from scratch&quot;; (b) <span class="fixed"><a href="./Definitions.i6t.html#line542">GPR_PREPOSITION</a></span> for &quot;token accepted with no result&quot;; (c) <em></em> for &quot;please parse <span class="fixed"><a href="./Parser.i6t.html#line1469">ParseToken(ELEMENTARY_TT, x)</a></span> instead&quot;; (d) 0 for &quot;token accepted, result is the multiple object list&quot;; (e) 1 for &quot;token accepted, result is the number in <span class="fixed"><a href="./Output.i6t.html#line261">parsed_number</a></span>&quot;; (f) an object number for &quot;token accepted with this object as result&quot;; (g) <em></em> for &quot;token rejected&quot;.<p></p><p> Strictly speaking <span class="fixed"><a href="./Parser.i6t.html#line1469">ParseToken</a></span> is a shell routine which saves the current state on the stack, and calling <span class="fixed"><a href="./Parser.i6t.html#line1500">ParseToken__</a></span> to do the actual work.<p></p><p> Once again the routine is traditionally divided into six letters, here named under paragraphs &quot;Parse Token Letter A&quot;, and so on.<p></p><p> (A) Analyse the token; handle all tokens not involving object lists and break down others into elementary tokens (B) Begin parsing an object list (C) Parse descriptors (articles, pronouns, etc.) in the list (D) Parse an object name (E) Parse connectives (AND, BUT, etc.) and go back to (C) (F) Return the conclusion of parsing an object list<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1463">1463</span><span class="td">[&nbsp;ParseTokenStopped&nbsp;x&nbsp;y;</span></span>
<span class="tr"><span class="th" id="line1464">1464</span><span class="td">&nbsp;if&nbsp;(wn&gt;WordCount())&nbsp;return&nbsp;GPR_FAIL;</span></span>
<span class="tr"><span class="th" id="line1465">1465</span><span class="td">&nbsp;return&nbsp;ParseToken(x,y);</span></span>
<span class="tr"><span class="th" id="line1466">1466</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1467">1467</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1468">1468</span><span class="td">Global&nbsp;parsetoken_nesting&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1469">1469</span><span class="td">[&nbsp;ParseToken&nbsp;given_ttype&nbsp;given_tdata&nbsp;token_n&nbsp;token&nbsp;&nbsp;i&nbsp;t&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1470">1470</span><span class="td">&nbsp;if&nbsp;(parsetoken_nesting&nbsp;&gt;&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1471">1471</span><span class="td">&nbsp;&nbsp;!&nbsp;save&nbsp;match&nbsp;globals</span></span>
<span class="tr"><span class="th" id="line1472">1472</span><span class="td">&nbsp;&nbsp;@push&nbsp;match_from;&nbsp;@push&nbsp;token_filter;&nbsp;@push&nbsp;match_length;</span></span>
<span class="tr"><span class="th" id="line1473">1473</span><span class="td">&nbsp;&nbsp;@push&nbsp;number_of_classes;&nbsp;@push&nbsp;oops_from;</span></span>
<span class="tr"><span class="th" id="line1474">1474</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=0:&nbsp;i&lt;number_matched:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1475">1475</span><span class="td">&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;match_list--&gt;i;&nbsp;@push&nbsp;t;</span></span>
<span class="tr"><span class="th" id="line1476">1476</span><span class="td">&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;match_classes--&gt;i;&nbsp;@push&nbsp;t;</span></span>
<span class="tr"><span class="th" id="line1477">1477</span><span class="td">&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;match_scores--&gt;i;&nbsp;@push&nbsp;t;</span></span>
<span class="tr"><span class="th" id="line1478">1478</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1479">1479</span><span class="td">&nbsp;&nbsp;@push&nbsp;number_matched;</span></span>
<span class="tr"><span class="th" id="line1480">1480</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1481">1481</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1482">1482</span><span class="td">&nbsp;parsetoken_nesting++;</span></span>
<span class="tr"><span class="th" id="line1483">1483</span><span class="td">&nbsp;rv&nbsp;=&nbsp;ParseToken__(given_ttype,&nbsp;given_tdata,&nbsp;token_n,&nbsp;token);</span></span>
<span class="tr"><span class="th" id="line1484">1484</span><span class="td">&nbsp;parsetoken_nesting--;</span></span>
<span class="tr"><span class="th" id="line1485">1485</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1486">1486</span><span class="td">&nbsp;if&nbsp;(parsetoken_nesting&nbsp;&gt;&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1487">1487</span><span class="td">&nbsp;&nbsp;!&nbsp;restore&nbsp;match&nbsp;globals</span></span>
<span class="tr"><span class="th" id="line1488">1488</span><span class="td">&nbsp;&nbsp;@pull&nbsp;number_matched;</span></span>
<span class="tr"><span class="th" id="line1489">1489</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=number_matched-1:&nbsp;i&gt;=0:&nbsp;i--)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1490">1490</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;t;&nbsp;match_scores--&gt;i&nbsp;=&nbsp;t;</span></span>
<span class="tr"><span class="th" id="line1491">1491</span><span class="td">&nbsp;&nbsp;&nbsp;@pull&nbsp;t;&nbsp;match_classes--&gt;i&nbsp;=&nbsp;t;</span></span>
<span class="tr"><span class="th" id="line1492">1492</span><span class="td">&nbsp;&nbsp;&nbsp;@pull&nbsp;t;&nbsp;match_list--&gt;i&nbsp;=&nbsp;t;</span></span>
<span class="tr"><span class="th" id="line1493">1493</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1494">1494</span><span class="td">&nbsp;&nbsp;@pull&nbsp;oops_from;&nbsp;@pull&nbsp;number_of_classes;</span></span>
<span class="tr"><span class="th" id="line1495">1495</span><span class="td">&nbsp;&nbsp;@pull&nbsp;match_length;&nbsp;@pull&nbsp;token_filter;&nbsp;@pull&nbsp;match_from;</span></span>
<span class="tr"><span class="th" id="line1496">1496</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1497">1497</span><span class="td">&nbsp;return&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1498">1498</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1499">1499</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1500">1500</span><span class="td">[&nbsp;ParseToken__&nbsp;given_ttype&nbsp;given_tdata&nbsp;token_n&nbsp;token</span></span>
<span class="tr"><span class="th" id="line1501">1501</span><span class="td">&nbsp;l&nbsp;o&nbsp;i&nbsp;j&nbsp;k&nbsp;and_parity&nbsp;single_object&nbsp;desc_wn&nbsp;many_flag</span></span>
<span class="tr"><span class="th" id="line1502">1502</span><span class="td">&nbsp;token_allows_multiple&nbsp;prev_indef_wanted;</span></span>
</div><div class='text'>
<h3>Parse Token Letter A.</h3><p><p> Analyse token; handle all not involving object lists, break down others.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1508">1508</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token_filter&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1509">1509</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;parser_inflection&nbsp;=&nbsp;name;</span></span>
<span class="tr"><span class="th" id="line1510">1510</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1511">1511</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(given_ttype)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1512">1512</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELEMENTARY_TT:</span></span>
<span class="tr"><span class="th" id="line1513">1513</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(given_tdata)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1514">1514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPECIAL_TOKEN:</span></span>
<span class="tr"><span class="th" id="line1515">1515</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;TryNumber(wn);</span></span>
<span class="tr"><span class="th" id="line1516">1516</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special_word&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1517">1517</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1518">1518</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;~=&nbsp;-1000)</span></span>
<span class="tr"><span class="th" id="line1519">1519</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Read&nbsp;special&nbsp;as&nbsp;the&nbsp;number&nbsp;&quot;,&nbsp;l,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1520">1520</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1521">1521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;-1000)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1522">1522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1523">1523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Read&nbsp;special&nbsp;word&nbsp;at&nbsp;word&nbsp;number&nbsp;&quot;,&nbsp;wn,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1524">1524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1525">1525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;special_word;</span></span>
<span class="tr"><span class="th" id="line1526">1526</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1527">1527</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsed_number&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1528">1528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_NUMBER;</span></span>
<span class="tr"><span class="th" id="line1529">1529</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1530">1530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NUMBER_TOKEN:</span></span>
<span class="tr"><span class="th" id="line1531">1531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l=TryNumber(wn++);</span></span>
<span class="tr"><span class="th" id="line1532">1532</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;-1000)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1533">1533</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;NUMBER_PE;</span></span>
<span class="tr"><span class="th" id="line1534">1534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_FAIL;</span></span>
<span class="tr"><span class="th" id="line1535">1535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1536">1536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1537">1537</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&gt;=3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Read&nbsp;number&nbsp;as&nbsp;&quot;,&nbsp;l,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1538">1538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1539">1539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsed_number&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1540">1540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_NUMBER;</span></span>
<span class="tr"><span class="th" id="line1541">1541</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1542">1542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATURE_TOKEN:</span></span>
<span class="tr"><span class="th" id="line1543">1543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(action_to_be&nbsp;==&nbsp;##Answer&nbsp;or&nbsp;##Ask&nbsp;or&nbsp;##AskFor&nbsp;or&nbsp;##Tell)</span></span>
<span class="tr"><span class="th" id="line1544">1544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_reason&nbsp;=&nbsp;TALKING_REASON;</span></span>
<span class="tr"><span class="th" id="line1545">1545</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1546">1546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TOPIC_TOKEN:</span></span>
<span class="tr"><span class="th" id="line1547">1547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consult_from&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line1548">1548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((line_ttype--&gt;(token_n+1)&nbsp;~=&nbsp;PREPOSITION_TT)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1549">1549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(line_token--&gt;(token_n+1)&nbsp;~=&nbsp;ENDIT_TOKEN))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1550">1550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunTimeProblem(RTP_TEXTTOKENTOOHARD);</span></span>
<span class="tr"><span class="th" id="line1551">1551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_PREPOSITION;</span></span>
<span class="tr"><span class="th" id="line1552">1552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1553">1553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;o&nbsp;=&nbsp;NextWordStopped();</span></span>
<span class="tr"><span class="th" id="line1554">1554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;until&nbsp;(o&nbsp;==&nbsp;-1&nbsp;||&nbsp;PrepositionChain(o,&nbsp;token_n+1)&nbsp;~=&nbsp;-1);</span></span>
<span class="tr"><span class="th" id="line1555">1555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line1556">1556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;consult_words&nbsp;=&nbsp;wn-consult_from;</span></span>
<span class="tr"><span class="th" id="line1557">1557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(consult_words&nbsp;==&nbsp;0)&nbsp;return&nbsp;GPR_FAIL;</span></span>
<span class="tr"><span class="th" id="line1558">1558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(action_to_be&nbsp;==&nbsp;##Ask&nbsp;or&nbsp;##Answer&nbsp;or&nbsp;##Tell)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1559">1559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;wn;&nbsp;wn&nbsp;=&nbsp;consult_from;&nbsp;parsed_number&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1560">1560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;o;&nbsp;return&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1561">1561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1562">1562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o==-1&nbsp;&amp;&amp;&nbsp;(line_ttype--&gt;(token_n+1)&nbsp;==&nbsp;PREPOSITION_TT))</span></span>
<span class="tr"><span class="th" id="line1563">1563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_FAIL;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;don&#39;t&nbsp;infer&nbsp;if&nbsp;required&nbsp;preposition&nbsp;is&nbsp;absent</span></span>
<span class="tr"><span class="th" id="line1564">1564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_PREPOSITION;</span></span>
<span class="tr"><span class="th" id="line1565">1565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1566">1566</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1567">1567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PREPOSITION_TT:</span></span>
<span class="tr"><span class="th" id="line1568">1568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Is&nbsp;it&nbsp;an&nbsp;unnecessary&nbsp;alternative&nbsp;preposition,&nbsp;when&nbsp;a&nbsp;previous&nbsp;choice</span></span>
<span class="tr"><span class="th" id="line1569">1569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;has&nbsp;already&nbsp;been&nbsp;matched?</span></span>
<span class="tr"><span class="th" id="line1570">1570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token-&gt;0)&nbsp;&amp;&nbsp;$10)&nbsp;return&nbsp;GPR_PREPOSITION;</span></span>
<span class="tr"><span class="th" id="line1571">1571</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1572">1572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;we&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;the&nbsp;player&#39;s&nbsp;input,&nbsp;but&nbsp;still&nbsp;have&nbsp;parameters&nbsp;to</span></span>
<span class="tr"><span class="th" id="line1573">1573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;specify,&nbsp;we&nbsp;go&nbsp;into&nbsp;&quot;infer&quot;&nbsp;mode,&nbsp;remembering&nbsp;where&nbsp;we&nbsp;are&nbsp;and&nbsp;the</span></span>
<span class="tr"><span class="th" id="line1574">1574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;preposition&nbsp;we&nbsp;are&nbsp;inferring...</span></span>
<span class="tr"><span class="th" id="line1575">1575</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1576">1576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1577">1577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inferfrom==0&nbsp;&amp;&amp;&nbsp;parameters&lt;params_wanted)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1578">1578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inferfrom&nbsp;=&nbsp;pcount;&nbsp;inferword&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line1579">1579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pattern--&gt;pcount&nbsp;=&nbsp;REPARSE_CODE&nbsp;+&nbsp;VM_DictionaryAddressToNumber(given_tdata);</span></span>
<span class="tr"><span class="th" id="line1580">1580</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1581">1581</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1582">1582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;we&nbsp;are&nbsp;not&nbsp;inferring,&nbsp;then&nbsp;the&nbsp;line&nbsp;is&nbsp;wrong...</span></span>
<span class="tr"><span class="th" id="line1583">1583</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1584">1584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inferfrom&nbsp;==&nbsp;0)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1585">1585</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1586">1586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;not,&nbsp;then&nbsp;the&nbsp;line&nbsp;is&nbsp;right&nbsp;but&nbsp;we&nbsp;mark&nbsp;in&nbsp;the&nbsp;preposition...</span></span>
<span class="tr"><span class="th" id="line1587">1587</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1588">1588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pattern--&gt;pcount&nbsp;=&nbsp;REPARSE_CODE&nbsp;+&nbsp;VM_DictionaryAddressToNumber(given_tdata);</span></span>
<span class="tr"><span class="th" id="line1589">1589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_PREPOSITION;</span></span>
<span class="tr"><span class="th" id="line1590">1590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1591">1591</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1592">1592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1593">1593</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1594">1594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pattern--&gt;pcount&nbsp;=&nbsp;REPARSE_CODE&nbsp;+&nbsp;VM_DictionaryAddressToNumber(o);</span></span>
<span class="tr"><span class="th" id="line1595">1595</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1596">1596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Whereas,&nbsp;if&nbsp;the&nbsp;player&nbsp;has&nbsp;typed&nbsp;something&nbsp;here,&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;the</span></span>
<span class="tr"><span class="th" id="line1597">1597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;required&nbsp;preposition...&nbsp;if&nbsp;it&#39;s&nbsp;wrong,&nbsp;the&nbsp;line&nbsp;must&nbsp;be&nbsp;wrong,</span></span>
<span class="tr"><span class="th" id="line1598">1598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;but&nbsp;if&nbsp;it&#39;s&nbsp;right,&nbsp;the&nbsp;token&nbsp;is&nbsp;passed&nbsp;(jump&nbsp;to&nbsp;finish&nbsp;this&nbsp;token).</span></span>
<span class="tr"><span class="th" id="line1599">1599</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1600">1600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;given_tdata)&nbsp;return&nbsp;GPR_PREPOSITION;</span></span>
<span class="tr"><span class="th" id="line1601">1601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(PrepositionChain(o,&nbsp;token_n)&nbsp;~=&nbsp;-1)&nbsp;return&nbsp;GPR_PREPOSITION;</span></span>
<span class="tr"><span class="th" id="line1602">1602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1603">1603</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1604">1604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPR_TT:</span></span>
<span class="tr"><span class="th" id="line1605">1605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;indirect(given_tdata);</span></span>
<span class="tr"><span class="th" id="line1606">1606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1607">1607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Outside&nbsp;parsing&nbsp;routine&nbsp;returned&nbsp;&quot;,&nbsp;l,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1608">1608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1609">1609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1610">1610</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1611">1611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCOPE_TT:</span></span>
<span class="tr"><span class="th" id="line1612">1612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_token&nbsp;=&nbsp;given_tdata;</span></span>
<span class="tr"><span class="th" id="line1613">1613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_stage&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1614">1614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1615">1615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Scope&nbsp;routine&nbsp;called&nbsp;at&nbsp;stage&nbsp;1]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1616">1616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1617">1617</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;indirect(scope_token);</span></span>
<span class="tr"><span class="th" id="line1618">1618</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1619">1619</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Scope&nbsp;routine&nbsp;returned&nbsp;multiple-flag&nbsp;of&nbsp;&quot;,&nbsp;l,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1620">1620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1621">1621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;1)&nbsp;given_tdata&nbsp;=&nbsp;MULTI_TOKEN;&nbsp;else&nbsp;given_tdata&nbsp;=&nbsp;NOUN_TOKEN;</span></span>
<span class="tr"><span class="th" id="line1622">1622</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1623">1623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATTR_FILTER_TT:</span></span>
<span class="tr"><span class="th" id="line1624">1624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token_filter&nbsp;=&nbsp;1&nbsp;+&nbsp;given_tdata;</span></span>
<span class="tr"><span class="th" id="line1625">1625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given_tdata&nbsp;=&nbsp;NOUN_TOKEN;</span></span>
<span class="tr"><span class="th" id="line1626">1626</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1627">1627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ROUTINE_FILTER_TT:</span></span>
<span class="tr"><span class="th" id="line1628">1628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token_filter&nbsp;=&nbsp;given_tdata;</span></span>
<span class="tr"><span class="th" id="line1629">1629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given_tdata&nbsp;=&nbsp;NOUN_TOKEN;</span></span>
<span class="tr"><span class="th" id="line1630">1630</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1631">1631</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;end&nbsp;of&nbsp;switch(given_ttype)</span></span>
<span class="tr"><span class="th" id="line1632">1632</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1633">1633</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;given_tdata;</span></span>
</div><div class='text'>
<h3>Parse Token Letter B.</h3><p><p> Begin parsing an object list.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1639">1639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;There&nbsp;are&nbsp;now&nbsp;three&nbsp;possible&nbsp;ways&nbsp;we&nbsp;can&nbsp;be&nbsp;here:</span></span>
<span class="tr"><span class="th" id="line1640">1640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsing&nbsp;an&nbsp;elementary&nbsp;token&nbsp;other&nbsp;than&nbsp;&quot;special&quot;&nbsp;or&nbsp;&quot;number&quot;;</span></span>
<span class="tr"><span class="th" id="line1641">1641</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsing&nbsp;a&nbsp;scope&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line1642">1642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parsing&nbsp;a&nbsp;noun-filter&nbsp;token&nbsp;(either&nbsp;by&nbsp;routine&nbsp;or&nbsp;attribute).</span></span>
<span class="tr"><span class="th" id="line1643">1643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!</span></span>
<span class="tr"><span class="th" id="line1644">1644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;In&nbsp;each&nbsp;case,&nbsp;token&nbsp;holds&nbsp;the&nbsp;type&nbsp;of&nbsp;elementary&nbsp;parse&nbsp;to</span></span>
<span class="tr"><span class="th" id="line1645">1645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;perform&nbsp;in&nbsp;matching&nbsp;one&nbsp;or&nbsp;more&nbsp;objects,&nbsp;and</span></span>
<span class="tr"><span class="th" id="line1646">1646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;token_filter&nbsp;is&nbsp;0&nbsp;(default),&nbsp;an&nbsp;attribute&nbsp;+&nbsp;1&nbsp;for&nbsp;an&nbsp;attribute&nbsp;filter</span></span>
<span class="tr"><span class="th" id="line1647">1647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;or&nbsp;a&nbsp;routine&nbsp;address&nbsp;for&nbsp;a&nbsp;routine&nbsp;filter.</span></span>
<span class="tr"><span class="th" id="line1648">1648</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1649">1649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token_allows_multiple&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1650">1650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token&nbsp;==&nbsp;MULTI_TOKEN&nbsp;or&nbsp;MULTIHELD_TOKEN&nbsp;or&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN)</span></span>
<span class="tr"><span class="th" id="line1651">1651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token_allows_multiple&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1652">1652</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1653">1653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;many_flag&nbsp;=&nbsp;false;&nbsp;and_parity&nbsp;=&nbsp;true;&nbsp;dont_infer&nbsp;=&nbsp;false;</span></span>
</div><div class='text'>
<h3>Parse Token Letter C.</h3><p><p> Parse descriptors (articles, pronouns, etc.) in the list.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1659">1659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;We&nbsp;expect&nbsp;to&nbsp;find&nbsp;a&nbsp;list&nbsp;of&nbsp;objects&nbsp;next&nbsp;in&nbsp;what&nbsp;the&nbsp;player&#39;s&nbsp;typed.</span></span>
<span class="tr"><span class="th" id="line1660">1660</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1661">1661</span><span class="td">&nbsp;&nbsp;.ObjectList;</span></span>
<span class="tr"><span class="th" id="line1662">1662</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1663">1663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1664">1664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Object&nbsp;list&nbsp;from&nbsp;word&nbsp;&quot;,&nbsp;wn,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1665">1665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1666">1666</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1667">1667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Take&nbsp;an&nbsp;advance&nbsp;look&nbsp;at&nbsp;the&nbsp;next&nbsp;word:&nbsp;if&nbsp;it&#39;s&nbsp;&quot;it&quot;&nbsp;or&nbsp;&quot;them&quot;,&nbsp;and&nbsp;these</span></span>
<span class="tr"><span class="th" id="line1668">1668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;are&nbsp;unset,&nbsp;set&nbsp;the&nbsp;appropriate&nbsp;error&nbsp;number&nbsp;and&nbsp;give&nbsp;up&nbsp;on&nbsp;the&nbsp;line</span></span>
<span class="tr"><span class="th" id="line1669">1669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(if&nbsp;not,&nbsp;these&nbsp;are&nbsp;still&nbsp;parsed&nbsp;in&nbsp;the&nbsp;usual&nbsp;way&nbsp;-&nbsp;it&nbsp;is&nbsp;not&nbsp;assumed</span></span>
<span class="tr"><span class="th" id="line1670">1670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;that&nbsp;they&nbsp;still&nbsp;refer&nbsp;to&nbsp;something&nbsp;in&nbsp;scope)</span></span>
<span class="tr"><span class="th" id="line1671">1671</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1672">1672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;NextWord();&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line1673">1673</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1674">1674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pronoun_word&nbsp;=&nbsp;NULL;&nbsp;pronoun_obj&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line1675">1675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;PronounValue(o);</span></span>
<span class="tr"><span class="th" id="line1676">1676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1677">1677</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pronoun_word&nbsp;=&nbsp;o;&nbsp;pronoun_obj&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1678">1678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1679">1679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Don&#39;t&nbsp;assume&nbsp;this&nbsp;is&nbsp;a&nbsp;use&nbsp;of&nbsp;an&nbsp;unset&nbsp;pronoun&nbsp;until&nbsp;the</span></span>
<span class="tr"><span class="th" id="line1680">1680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;descriptors&nbsp;have&nbsp;been&nbsp;checked,&nbsp;because&nbsp;it&nbsp;might&nbsp;be&nbsp;an</span></span>
<span class="tr"><span class="th" id="line1681">1681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;article&nbsp;(or&nbsp;some&nbsp;such)&nbsp;instead</span></span>
<span class="tr"><span class="th" id="line1682">1682</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1683">1683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(l=1&nbsp;:&nbsp;l&lt;=LanguageDescriptors--&gt;0&nbsp;:&nbsp;l=l+4)</span></span>
<span class="tr"><span class="th" id="line1684">1684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;LanguageDescriptors--&gt;l)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1692">AssumeDescriptor</a>;</span></span>
<span class="tr"><span class="th" id="line1685">1685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pronoun__word&nbsp;=&nbsp;pronoun_word;&nbsp;pronoun__obj&nbsp;=&nbsp;pronoun_obj;</span></span>
<span class="tr"><span class="th" id="line1686">1686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;VAGUE_PE;</span></span>
<span class="tr"><span class="th" id="line1687">1687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Stop:&nbsp;unset&nbsp;pronoun]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1688">1688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_FAIL;</span></span>
<span class="tr"><span class="th" id="line1689">1689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1690">1690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1691">1691</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1692">1692</span><span class="td">&nbsp;&nbsp;.AssumeDescriptor;</span></span>
<span class="tr"><span class="th" id="line1693">1693</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1694">1694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;ME1__WD&nbsp;or&nbsp;ME2__WD&nbsp;or&nbsp;ME3__WD)&nbsp;{&nbsp;pronoun_word&nbsp;=&nbsp;o;&nbsp;pronoun_obj&nbsp;=&nbsp;player;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1695">1695</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1696">1696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;allow_plurals&nbsp;=&nbsp;true;&nbsp;desc_wn&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line1697">1697</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1698">1698</span><span class="td">&nbsp;&nbsp;.TryAgain;</span></span>
<span class="tr"><span class="th" id="line1699">1699</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1700">1700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;First,&nbsp;we&nbsp;parse&nbsp;any&nbsp;descriptive&nbsp;words&nbsp;(like&nbsp;&quot;the&quot;,&nbsp;&quot;five&quot;&nbsp;or&nbsp;&quot;every&quot;):</span></span>
<span class="tr"><span class="th" id="line1701">1701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;Descriptors(token_allows_multiple);</span></span>
<span class="tr"><span class="th" id="line1702">1702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;~=&nbsp;0)&nbsp;{&nbsp;etype&nbsp;=&nbsp;l;&nbsp;return&nbsp;0;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1703">1703</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1704">1704</span><span class="td">&nbsp;&nbsp;.TryAgain2;</span></span>
</div><div class='text'>
<h3>Parse Token Letter D.</h3><p><p> Parse an object name.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1710">1710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;This&nbsp;is&nbsp;an&nbsp;actual&nbsp;specified&nbsp;object,&nbsp;and&nbsp;is&nbsp;therefore&nbsp;where&nbsp;a&nbsp;typing&nbsp;error</span></span>
<span class="tr"><span class="th" id="line1711">1711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;is&nbsp;most&nbsp;likely&nbsp;to&nbsp;occur,&nbsp;so&nbsp;we&nbsp;set:</span></span>
<span class="tr"><span class="th" id="line1712">1712</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1713">1713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;oops_from&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line1714">1714</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1715">1715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;So,&nbsp;two&nbsp;cases.&nbsp;&nbsp;Case&nbsp;1:&nbsp;token&nbsp;not&nbsp;equal&nbsp;to&nbsp;&quot;held&quot;&nbsp;(so,&nbsp;no&nbsp;implicit&nbsp;takes)</span></span>
<span class="tr"><span class="th" id="line1716">1716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;but&nbsp;we&nbsp;may&nbsp;well&nbsp;be&nbsp;dealing&nbsp;with&nbsp;multiple&nbsp;objects</span></span>
<span class="tr"><span class="th" id="line1717">1717</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1718">1718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;In&nbsp;either&nbsp;case&nbsp;below&nbsp;we&nbsp;use&nbsp;NounDomain,&nbsp;giving&nbsp;it&nbsp;the&nbsp;token&nbsp;number&nbsp;as</span></span>
<span class="tr"><span class="th" id="line1719">1719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;context,&nbsp;and&nbsp;two&nbsp;places&nbsp;to&nbsp;look:&nbsp;among&nbsp;the&nbsp;actor&#39;s&nbsp;possessions,&nbsp;and&nbsp;in&nbsp;the</span></span>
<span class="tr"><span class="th" id="line1720">1720</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;present&nbsp;location.&nbsp;&nbsp;(Note&nbsp;that&nbsp;the&nbsp;order&nbsp;depends&nbsp;on&nbsp;which&nbsp;is&nbsp;likeliest.)</span></span>
<span class="tr"><span class="th" id="line1721">1721</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1722">1722</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token&nbsp;~=&nbsp;HELD_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1723">1723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line1724">1724</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1725">1725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Calling&nbsp;NounDomain&nbsp;on&nbsp;location&nbsp;and&nbsp;actor]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1726">1726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1727">1727</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NounDomain(actors_location,&nbsp;actor,&nbsp;token);</span></span>
<span class="tr"><span class="th" id="line1728">1728</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;return&nbsp;l;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Reparse&nbsp;after&nbsp;Q&amp;A</span></span>
<span class="tr"><span class="th" id="line1729">1729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_wanted&nbsp;==&nbsp;INDEF_ALL_WANTED&nbsp;&amp;&amp;&nbsp;l&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;number_matched&nbsp;==&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line1730">1730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;1;&nbsp;&nbsp;!&nbsp;ReviseMulti&nbsp;if&nbsp;TAKE&nbsp;ALL&nbsp;FROM&nbsp;empty&nbsp;container</span></span>
<span class="tr"><span class="th" id="line1731">1731</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1732">1732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token_allows_multiple&nbsp;&amp;&amp;&nbsp;~~multiflag)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1733">1733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(best_etype==MULTI_PE)&nbsp;best_etype=STUCK_PE;</span></span>
<span class="tr"><span class="th" id="line1734">1734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiflag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1735">1735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1736">1736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1737">1737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_possambig)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1738">1738</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResetDescriptors();</span></span>
<span class="tr"><span class="th" id="line1739">1739</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;desc_wn;</span></span>
<span class="tr"><span class="th" id="line1740">1740</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1704">TryAgain2</a>;</span></span>
<span class="tr"><span class="th" id="line1741">1741</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1742">1742</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;==&nbsp;MULTI_PE&nbsp;&amp;&amp;&nbsp;multiflag)&nbsp;etype&nbsp;=&nbsp;STUCK_PE;</span></span>
<span class="tr"><span class="th" id="line1743">1743</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype=CantSee();</span></span>
<span class="tr"><span class="th" id="line1744">1744</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1915">FailToken</a>;</span></span>
<span class="tr"><span class="th" id="line1745">1745</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;Choose&nbsp;best&nbsp;error</span></span>
<span class="tr"><span class="th" id="line1746">1746</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1747">1747</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1748">1748</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1749">1749</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;&gt;&nbsp;1)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[ND&nbsp;returned&nbsp;&quot;,&nbsp;(the)&nbsp;l,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1750">1750</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1751">1751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[ND&nbsp;appended&nbsp;to&nbsp;the&nbsp;multiple&nbsp;object&nbsp;list:^&quot;;</span></span>
<span class="tr"><span class="th" id="line1752">1752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line1753">1753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=i+1&nbsp;:&nbsp;j&lt;=k&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line1754">1754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;Entry&nbsp;&quot;,&nbsp;j,&nbsp;&quot;:&nbsp;&quot;,&nbsp;(The)&nbsp;multiple_object--&gt;j,</span></span>
<span class="tr"><span class="th" id="line1755">1755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;(&quot;,&nbsp;multiple_object--&gt;j,&nbsp;&quot;)^&quot;;</span></span>
<span class="tr"><span class="th" id="line1756">1756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;List&nbsp;now&nbsp;has&nbsp;size&nbsp;&quot;,&nbsp;k,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1757">1757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1758">1758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1759">1759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1760">1760</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1761">1761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1762">1762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(~~many_flag)&nbsp;many_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1763">1763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Merge&nbsp;with&nbsp;earlier&nbsp;ones</span></span>
<span class="tr"><span class="th" id="line1764">1764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;multiple_object--&gt;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(with&nbsp;either&nbsp;parity)</span></span>
<span class="tr"><span class="th" id="line1765">1765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line1766">1766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=i+1&nbsp;:&nbsp;j&lt;=k&nbsp;:&nbsp;j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1767">1767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(and_parity)&nbsp;MultiAdd(multiple_object--&gt;j);</span></span>
<span class="tr"><span class="th" id="line1768">1768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MultiSub(multiple_object--&gt;j);</span></span>
<span class="tr"><span class="th" id="line1769">1769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1770">1770</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1771">1771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)</span></span>
<span class="tr"><span class="th" id="line1772">1772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Merging&nbsp;&quot;,&nbsp;k-i,&nbsp;&quot;&nbsp;new&nbsp;objects&nbsp;to&nbsp;the&nbsp;&quot;,&nbsp;i,&nbsp;&quot;&nbsp;old&nbsp;ones]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1773">1773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1774">1774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1775">1775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1776">1776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1777">1777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;A&nbsp;single&nbsp;object&nbsp;was&nbsp;indeed&nbsp;found</span></span>
<span class="tr"><span class="th" id="line1778">1778</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1779">1779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_length&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;indef_possambig)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1780">1780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;So&nbsp;the&nbsp;answer&nbsp;had&nbsp;to&nbsp;be&nbsp;inferred&nbsp;from&nbsp;no&nbsp;textual&nbsp;data,</span></span>
<span class="tr"><span class="th" id="line1781">1781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;we&nbsp;know&nbsp;that&nbsp;there&nbsp;was&nbsp;an&nbsp;ambiguity&nbsp;in&nbsp;the&nbsp;descriptor</span></span>
<span class="tr"><span class="th" id="line1782">1782</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;stage&nbsp;(such&nbsp;as&nbsp;a&nbsp;word&nbsp;which&nbsp;could&nbsp;be&nbsp;a&nbsp;pronoun&nbsp;being</span></span>
<span class="tr"><span class="th" id="line1783">1783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;parsed&nbsp;as&nbsp;an&nbsp;article&nbsp;or&nbsp;possessive).&nbsp;&nbsp;It&#39;s&nbsp;worth&nbsp;having</span></span>
<span class="tr"><span class="th" id="line1784">1784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;another&nbsp;go.</span></span>
<span class="tr"><span class="th" id="line1785">1785</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1786">1786</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResetDescriptors();</span></span>
<span class="tr"><span class="th" id="line1787">1787</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;desc_wn;</span></span>
<span class="tr"><span class="th" id="line1788">1788</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1704">TryAgain2</a>;</span></span>
<span class="tr"><span class="th" id="line1789">1789</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1790">1790</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1791">1791</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token&nbsp;==&nbsp;CREATURE_TOKEN)&nbsp;&amp;&amp;&nbsp;(CreatureTest(l)&nbsp;==&nbsp;0))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1792">1792</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;ANIMA_PE;</span></span>
<span class="tr"><span class="th" id="line1793">1793</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1915">FailToken</a>;</span></span>
<span class="tr"><span class="th" id="line1794">1794</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;&nbsp;Animation&nbsp;is&nbsp;required</span></span>
<span class="tr"><span class="th" id="line1795">1795</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1796">1796</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(~~many_flag)&nbsp;single_object&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1797">1797</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1798">1798</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(and_parity)&nbsp;MultiAdd(l);&nbsp;else&nbsp;MultiSub(l);</span></span>
<span class="tr"><span class="th" id="line1799">1799</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1800">1800</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Combining&nbsp;&quot;,&nbsp;(the)&nbsp;l,&nbsp;&quot;&nbsp;with&nbsp;list]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1801">1801</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1802">1802</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1803">1803</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1804">1804</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1805">1805</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1806">1806</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1807">1807</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1808">1808</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Case&nbsp;2:&nbsp;token&nbsp;is&nbsp;&quot;held&quot;&nbsp;(which&nbsp;fortunately&nbsp;can&#39;t&nbsp;take&nbsp;multiple&nbsp;objects)</span></span>
<span class="tr"><span class="th" id="line1809">1809</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;may&nbsp;generate&nbsp;an&nbsp;implicit&nbsp;take</span></span>
<span class="tr"><span class="th" id="line1810">1810</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1811">1811</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NounDomain(actor,actors_location,token);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Same&nbsp;as&nbsp;above...</span></span>
<span class="tr"><span class="th" id="line1812">1812</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;REPARSE_CODE)&nbsp;return&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1813">1813</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1814">1814</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_possambig)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1815">1815</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResetDescriptors();</span></span>
<span class="tr"><span class="th" id="line1816">1816</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;desc_wn;</span></span>
<span class="tr"><span class="th" id="line1817">1817</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1704">TryAgain2</a>;</span></span>
<span class="tr"><span class="th" id="line1818">1818</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1819">1819</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;CantSee();&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1915">FailToken</a>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Choose&nbsp;best&nbsp;error</span></span>
<span class="tr"><span class="th" id="line1820">1820</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1821">1821</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1822">1822</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...until&nbsp;it&nbsp;produces&nbsp;something&nbsp;not&nbsp;held&nbsp;by&nbsp;the&nbsp;actor.&nbsp;&nbsp;Then&nbsp;an&nbsp;implicit</span></span>
<span class="tr"><span class="th" id="line1823">1823</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;take&nbsp;must&nbsp;be&nbsp;tried.&nbsp;&nbsp;If&nbsp;this&nbsp;is&nbsp;already&nbsp;happening&nbsp;anyway,&nbsp;things&nbsp;are&nbsp;too</span></span>
<span class="tr"><span class="th" id="line1824">1824</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;confused&nbsp;and&nbsp;we&nbsp;have&nbsp;to&nbsp;give&nbsp;up&nbsp;(but&nbsp;saving&nbsp;the&nbsp;oops&nbsp;marker&nbsp;so&nbsp;as&nbsp;to&nbsp;get</span></span>
<span class="tr"><span class="th" id="line1825">1825</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;it&nbsp;on&nbsp;the&nbsp;right&nbsp;word&nbsp;afterwards).</span></span>
<span class="tr"><span class="th" id="line1826">1826</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;point&nbsp;of&nbsp;this&nbsp;last&nbsp;rule&nbsp;is&nbsp;that&nbsp;a&nbsp;sequence&nbsp;like</span></span>
<span class="tr"><span class="th" id="line1827">1827</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!</span></span>
<span class="tr"><span class="th" id="line1828">1828</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;read&nbsp;newspaper</span></span>
<span class="tr"><span class="th" id="line1829">1829</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(taking&nbsp;the&nbsp;newspaper&nbsp;first)</span></span>
<span class="tr"><span class="th" id="line1830">1830</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;dwarf&nbsp;unexpectedly&nbsp;prevents&nbsp;you&nbsp;from&nbsp;taking&nbsp;the&nbsp;newspaper!</span></span>
<span class="tr"><span class="th" id="line1831">1831</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!</span></span>
<span class="tr"><span class="th" id="line1832">1832</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;should&nbsp;not&nbsp;be&nbsp;allowed&nbsp;to&nbsp;go&nbsp;into&nbsp;an&nbsp;infinite&nbsp;repeat&nbsp;-&nbsp;read&nbsp;becomes</span></span>
<span class="tr"><span class="th" id="line1833">1833</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;take&nbsp;then&nbsp;read,&nbsp;but&nbsp;take&nbsp;has&nbsp;no&nbsp;effect,&nbsp;so&nbsp;read&nbsp;becomes&nbsp;take&nbsp;then&nbsp;read...</span></span>
<span class="tr"><span class="th" id="line1834">1834</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Anyway&nbsp;for&nbsp;now&nbsp;all&nbsp;we&nbsp;do&nbsp;is&nbsp;record&nbsp;the&nbsp;number&nbsp;of&nbsp;the&nbsp;object&nbsp;to&nbsp;take.</span></span>
<span class="tr"><span class="th" id="line1835">1835</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1836">1836</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;parent(l);</span></span>
<span class="tr"><span class="th" id="line1837">1837</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;~=&nbsp;actor)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1838">1838</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1839">1839</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Allowing&nbsp;object&nbsp;&quot;,&nbsp;(the)&nbsp;l,&nbsp;&quot;&nbsp;for&nbsp;now]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1840">1840</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1841">1841</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1842">1842</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;single_object&nbsp;=&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line1843">1843</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;!&nbsp;end&nbsp;of&nbsp;if&nbsp;(token&nbsp;~=&nbsp;HELD_TOKEN)&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1844">1844</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1845">1845</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;following&nbsp;moves&nbsp;the&nbsp;word&nbsp;marker&nbsp;to&nbsp;just&nbsp;past&nbsp;the&nbsp;named&nbsp;object...</span></span>
<span class="tr"><span class="th" id="line1846">1846</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line1847">1847</span><span class="td">!&nbsp;if&nbsp;(match_from&nbsp;~=&nbsp;oops_from)&nbsp;print&nbsp;match_from,&nbsp;&quot;&nbsp;vs&nbsp;&quot;,&nbsp;oops_from,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1848">1848</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1849">1849</span><span class="td">!&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;oops_from&nbsp;+&nbsp;match_length;</span></span>
<span class="tr"><span class="th" id="line1850">1850</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;match_from&nbsp;+&nbsp;match_length;</span></span>
</div><div class='text'>
<h3>Parse Token Letter E.</h3><p><p> Parse connectives (AND, BUT, etc.) and go back to (C).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1856">1856</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Object(s)&nbsp;specified&nbsp;now:&nbsp;is&nbsp;that&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;list,&nbsp;or&nbsp;have&nbsp;we&nbsp;reached</span></span>
<span class="tr"><span class="th" id="line1857">1857</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&quot;and&quot;,&nbsp;&quot;but&quot;&nbsp;and&nbsp;so&nbsp;on?&nbsp;&nbsp;If&nbsp;so,&nbsp;create&nbsp;a&nbsp;multiple-object&nbsp;list&nbsp;if&nbsp;we</span></span>
<span class="tr"><span class="th" id="line1858">1858</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;haven&#39;t&nbsp;already&nbsp;(and&nbsp;are&nbsp;allowed&nbsp;to).</span></span>
<span class="tr"><span class="th" id="line1859">1859</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1860">1860</span><span class="td">&nbsp;&nbsp;.NextInList;</span></span>
<span class="tr"><span class="th" id="line1861">1861</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1862">1862</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line1863">1863</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1864">1864</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;AND1__WD&nbsp;or&nbsp;AND2__WD&nbsp;or&nbsp;AND3__WD&nbsp;or&nbsp;BUT1__WD&nbsp;or&nbsp;BUT2__WD&nbsp;or&nbsp;BUT3__WD&nbsp;or&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1865">1865</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1866">1866</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1867">1867</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Read&nbsp;connective&nbsp;&#39;&quot;,&nbsp;(address)&nbsp;o,&nbsp;&quot;&#39;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1868">1868</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1869">1869</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1870">1870</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(~~token_allows_multiple)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1871">1871</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(multiflag)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1898">PassToken</a>;&nbsp;!&nbsp;give&nbsp;UPTO_PE&nbsp;error</span></span>
<span class="tr"><span class="th" id="line1872">1872</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype=MULTI_PE;</span></span>
<span class="tr"><span class="th" id="line1873">1873</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1915">FailToken</a>;</span></span>
<span class="tr"><span class="th" id="line1874">1874</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1875">1875</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1876">1876</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;BUT1__WD&nbsp;or&nbsp;BUT2__WD&nbsp;or&nbsp;BUT3__WD)&nbsp;and_parity&nbsp;=&nbsp;1-and_parity;</span></span>
<span class="tr"><span class="th" id="line1877">1877</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1878">1878</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(~~many_flag)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1879">1879</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1880">1880</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;1&nbsp;=&nbsp;single_object;</span></span>
<span class="tr"><span class="th" id="line1881">1881</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;many_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1882">1882</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1883">1883</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Making&nbsp;new&nbsp;list&nbsp;from&nbsp;&quot;,&nbsp;(the)&nbsp;single_object,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1884">1884</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line1885">1885</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1886">1886</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dont_infer&nbsp;=&nbsp;true;&nbsp;inferfrom=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Don&#39;t&nbsp;print&nbsp;(inferences)</span></span>
<span class="tr"><span class="th" id="line1887">1887</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1661">ObjectList</a>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;And&nbsp;back&nbsp;around</span></span>
<span class="tr"><span class="th" id="line1888">1888</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1889">1889</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1890">1890</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn--;&nbsp;&nbsp;&nbsp;!&nbsp;Word&nbsp;marker&nbsp;back&nbsp;to&nbsp;first&nbsp;not-understood&nbsp;word</span></span>
</div><div class='text'>
<h3>Parse Token Letter F.</h3><p><p> Return the conclusion of parsing an object list.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1896">1896</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Happy&nbsp;or&nbsp;unhappy&nbsp;endings:</span></span>
<span class="tr"><span class="th" id="line1897">1897</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1898">1898</span><span class="td">&nbsp;&nbsp;.PassToken;</span></span>
<span class="tr"><span class="th" id="line1899">1899</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(many_flag)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1900">1900</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;single_object&nbsp;=&nbsp;GPR_MULTIPLE;</span></span>
<span class="tr"><span class="th" id="line1901">1901</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi_context&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line1902">1902</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1903">1903</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1904">1904</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;indef_type&nbsp;&amp;&nbsp;PLURAL_BIT&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1905">1905</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token&nbsp;==&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN)&nbsp;multi_context&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line1906">1906</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_wanted&nbsp;&lt;&nbsp;INDEF_ALL_WANTED&nbsp;&amp;&amp;&nbsp;indef_wanted&nbsp;&gt;&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1907">1907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi_had&nbsp;=&nbsp;1;&nbsp;multi_wanted&nbsp;=&nbsp;indef_wanted;</span></span>
<span class="tr"><span class="th" id="line1908">1908</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;TOOFEW_PE;</span></span>
<span class="tr"><span class="th" id="line1909">1909</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1915">FailToken</a>;</span></span>
<span class="tr"><span class="th" id="line1910">1910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1911">1911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1912">1912</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1913">1913</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;single_object;</span></span>
<span class="tr"><span class="th" id="line1914">1914</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1915">1915</span><span class="td">&nbsp;&nbsp;.FailToken;</span></span>
<span class="tr"><span class="th" id="line1916">1916</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1917">1917</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;we&nbsp;were&nbsp;only&nbsp;guessing&nbsp;about&nbsp;it&nbsp;being&nbsp;a&nbsp;plural,&nbsp;try&nbsp;again&nbsp;but&nbsp;only</span></span>
<span class="tr"><span class="th" id="line1918">1918</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;allowing&nbsp;singulars&nbsp;(so&nbsp;that&nbsp;words&nbsp;like&nbsp;&quot;six&quot;&nbsp;are&nbsp;not&nbsp;swallowed&nbsp;up&nbsp;as</span></span>
<span class="tr"><span class="th" id="line1919">1919</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Descriptors)</span></span>
<span class="tr"><span class="th" id="line1920">1920</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1921">1921</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(allow_plurals&nbsp;&amp;&amp;&nbsp;indef_guess_p&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1922">1922</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line1923">1923</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;[Retrying&nbsp;singulars&nbsp;after&nbsp;failure&nbsp;&quot;,&nbsp;etype,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line1924">1924</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line1925">1925</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prev_indef_wanted&nbsp;=&nbsp;indef_wanted;</span></span>
<span class="tr"><span class="th" id="line1926">1926</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow_plurals&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1927">1927</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;desc_wn;</span></span>
<span class="tr"><span class="th" id="line1928">1928</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line1698">TryAgain</a>;</span></span>
<span class="tr"><span class="th" id="line1929">1929</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1930">1930</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1931">1931</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((indef_wanted&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;prev_indef_wanted&nbsp;&gt;&nbsp;0)&nbsp;&amp;&amp;&nbsp;(~~multiflag))&nbsp;etype&nbsp;=&nbsp;MULTI_PE;</span></span>
<span class="tr"><span class="th" id="line1932">1932</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1933">1933</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;GPR_FAIL;</span></span>
<span class="tr"><span class="th" id="line1934">1934</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1935">1935</span><span class="td">];&nbsp;!&nbsp;end&nbsp;of&nbsp;ParseToken__</span></span>
</div><div class='text'>
<h3>Descriptors.</h3><p><p> In grammatical terms, a descriptor appears at the front of an English noun phrase and clarifies the quantity or specific identity of what is referred to: for instance, <strong> my</strong> mirror, <strong> the</strong> dwarf, <strong> that</strong> woman. (Numbers, as in <strong> four</strong> duets, are also descriptors in linguistics: but the I6 parser doesn&#39;t handle them that way.)<p></p><p> Slightly unfortunately, the bitmap constants used for descriptors in the I6 parser have names in the form <span class="fixed">*_BIT</span>, coinciding with the names of style bits in the list-writer: but they never occur in the same context.<p></p><p> The actual words used as descriptors are read from tables in the language definition. <span class="fixed"><a href="./Parser.i6t.html#line1969">ArticleDescriptors</a></span> uses this table to move current word marker past a run of one or more descriptors which refer to the definite or indefinite article.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1954">1954</span><span class="td">Constant&nbsp;OTHER_BIT&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;These&nbsp;will&nbsp;be&nbsp;used&nbsp;in&nbsp;Adjudicate()</span></span>
<span class="tr"><span class="th" id="line1955">1955</span><span class="td">Constant&nbsp;MY_BIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;to&nbsp;disambiguate&nbsp;choices</span></span>
<span class="tr"><span class="th" id="line1956">1956</span><span class="td">Constant&nbsp;THAT_BIT&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;4;</span></span>
<span class="tr"><span class="th" id="line1957">1957</span><span class="td">Constant&nbsp;PLURAL_BIT&nbsp;=&nbsp;&nbsp;&nbsp;8;</span></span>
<span class="tr"><span class="th" id="line1958">1958</span><span class="td">Constant&nbsp;LIT_BIT&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;16;</span></span>
<span class="tr"><span class="th" id="line1959">1959</span><span class="td">Constant&nbsp;UNLIT_BIT&nbsp;&nbsp;=&nbsp;&nbsp;32;</span></span>
<span class="tr"><span class="th" id="line1960">1960</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1961">1961</span><span class="td">[&nbsp;ResetDescriptors;</span></span>
<span class="tr"><span class="th" id="line1962">1962</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;0;&nbsp;indef_type&nbsp;=&nbsp;0;&nbsp;indef_wanted&nbsp;=&nbsp;0;&nbsp;indef_guess_p&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1963">1963</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;indef_possambig&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1964">1964</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;indef_owner&nbsp;=&nbsp;nothing;</span></span>
<span class="tr"><span class="th" id="line1965">1965</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;indef_cases&nbsp;=&nbsp;$$111111111111;</span></span>
<span class="tr"><span class="th" id="line1966">1966</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;indef_nspec_at&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1967">1967</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1968">1968</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1969">1969</span><span class="td">[&nbsp;ArticleDescriptors&nbsp;&nbsp;o&nbsp;x&nbsp;flag&nbsp;cto&nbsp;type&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line1970">1970</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1971">1971</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1972">1972</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(flag=true&nbsp;:&nbsp;flag&nbsp;:)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1973">1973</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;NextWordStopped();&nbsp;flag&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1974">1974</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1975">1975</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(x=1&nbsp;:&nbsp;x&lt;=LanguageDescriptors--&gt;0&nbsp;:&nbsp;x=x+4)</span></span>
<span class="tr"><span class="th" id="line1976">1976</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;LanguageDescriptors--&gt;x)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1977">1977</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;LanguageDescriptors--&gt;(x+2);</span></span>
<span class="tr"><span class="th" id="line1978">1978</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(type&nbsp;==&nbsp;DEFART_PK&nbsp;or&nbsp;INDEFART_PK)&nbsp;flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1979">1979</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1980">1980</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1981">1981</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line1982">1982</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1983">1983</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Parsing Descriptors.</h3><p><p> The <span class="fixed"><a href="./Parser.i6t.html#line1992">Descriptors()</a></span> routine parses the descriptors at the head of a noun phrase, leaving the current word marker <span class="fixed"><a href="./Output.i6t.html#line283">wn</a></span> at the first word of the noun phrase&#39;s body. It is allowed to set up for a plural only if <span class="fixed">allow_p</span> is set; it returns a parser error number, or 0 if no error occurred.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1992">1992</span><span class="td">[&nbsp;Descriptors&nbsp;&nbsp;o&nbsp;x&nbsp;flag&nbsp;cto&nbsp;type&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line1993">1993</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ResetDescriptors();</span></span>
<span class="tr"><span class="th" id="line1994">1994</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1995">1995</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1996">1996</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(flag=true&nbsp;:&nbsp;flag&nbsp;:)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1997">1997</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;NextWordStopped();&nbsp;flag&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1998">1998</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1999">1999</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(x=1&nbsp;:&nbsp;x&lt;=LanguageDescriptors--&gt;0&nbsp;:&nbsp;x=x+4)</span></span>
<span class="tr"><span class="th" id="line2000">2000</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;LanguageDescriptors--&gt;x)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2001">2001</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line2002">2002</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;LanguageDescriptors--&gt;(x+2);</span></span>
<span class="tr"><span class="th" id="line2003">2003</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(type&nbsp;~=&nbsp;DEFART_PK)&nbsp;indef_mode&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line2004">2004</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_possambig&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line2005">2005</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_cases&nbsp;=&nbsp;indef_cases&nbsp;&amp;&nbsp;(LanguageDescriptors--&gt;(x+1));</span></span>
<span class="tr"><span class="th" id="line2006">2006</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2007">2007</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(type&nbsp;==&nbsp;POSSESS_PK)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2008">2008</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cto&nbsp;=&nbsp;LanguageDescriptors--&gt;(x+3);</span></span>
<span class="tr"><span class="th" id="line2009">2009</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(cto)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2010">2010</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;MY_BIT;</span></span>
<span class="tr"><span class="th" id="line2011">2011</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;THAT_BIT;</span></span>
<span class="tr"><span class="th" id="line2012">2012</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</span></span>
<span class="tr"><span class="th" id="line2013">2013</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_owner&nbsp;=&nbsp;PronounValue(cto);</span></span>
<span class="tr"><span class="th" id="line2014">2014</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_owner&nbsp;==&nbsp;NULL)&nbsp;indef_owner&nbsp;=&nbsp;InformParser;</span></span>
<span class="tr"><span class="th" id="line2015">2015</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2016">2016</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2017">2017</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2018">2018</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(type&nbsp;==&nbsp;light)&nbsp;&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;LIT_BIT;</span></span>
<span class="tr"><span class="th" id="line2019">2019</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(type&nbsp;==&nbsp;-light)&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;UNLIT_BIT;</span></span>
<span class="tr"><span class="th" id="line2020">2020</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2021">2021</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2022">2022</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;OTHER1__WD&nbsp;or&nbsp;OTHER2__WD&nbsp;or&nbsp;OTHER3__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2023">2023</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;1;&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2024">2024</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;OTHER_BIT;</span></span>
<span class="tr"><span class="th" id="line2025">2025</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2026">2026</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;ALL1__WD&nbsp;or&nbsp;ALL2__WD&nbsp;or&nbsp;ALL3__WD&nbsp;or&nbsp;ALL4__WD&nbsp;or&nbsp;ALL5__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2027">2027</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;1;&nbsp;flag&nbsp;=&nbsp;1;&nbsp;indef_wanted&nbsp;=&nbsp;INDEF_ALL_WANTED;</span></span>
<span class="tr"><span class="th" id="line2028">2028</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(take_all_rule&nbsp;==&nbsp;1)&nbsp;take_all_rule&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line2029">2029</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;PLURAL_BIT;</span></span>
<span class="tr"><span class="th" id="line2030">2030</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2031">2031</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(allow_plurals)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2032">2032</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(NextWordStopped()&nbsp;~=&nbsp;-1&nbsp;or&nbsp;THEN1__WD)&nbsp;{&nbsp;wn--;&nbsp;n&nbsp;=&nbsp;TryNumber(wn-1);&nbsp;}&nbsp;else&nbsp;{&nbsp;n=0;&nbsp;wn--;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2033">2033</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;==&nbsp;1)&nbsp;{&nbsp;indef_mode&nbsp;=&nbsp;1;&nbsp;flag&nbsp;=&nbsp;1;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2034">2034</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;&gt;&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2035">2035</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_guess_p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2036">2036</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;1;&nbsp;flag&nbsp;=&nbsp;1;&nbsp;indef_wanted&nbsp;=&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line2037">2037</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_nspec_at&nbsp;=&nbsp;wn-1;</span></span>
<span class="tr"><span class="th" id="line2038">2038</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;PLURAL_BIT;</span></span>
<span class="tr"><span class="th" id="line2039">2039</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2040">2040</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2041">2041</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flag&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;NextWordStopped()&nbsp;~=&nbsp;OF1__WD&nbsp;or&nbsp;OF2__WD&nbsp;or&nbsp;OF3__WD&nbsp;or&nbsp;OF4__WD)</span></span>
<span class="tr"><span class="th" id="line2042">2042</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn--;&nbsp;&nbsp;!&nbsp;Skip&nbsp;&#39;of&#39;&nbsp;after&nbsp;these</span></span>
<span class="tr"><span class="th" id="line2043">2043</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2044">2044</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line2045">2045</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2046">2046</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line2047">2047</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2048">2048</span><span class="td">[&nbsp;SafeSkipDescriptors;</span></span>
<span class="tr"><span class="th" id="line2049">2049</span><span class="td">&nbsp;@push&nbsp;indef_mode;&nbsp;@push&nbsp;indef_type;&nbsp;@push&nbsp;indef_wanted;</span></span>
<span class="tr"><span class="th" id="line2050">2050</span><span class="td">&nbsp;@push&nbsp;indef_guess_p;&nbsp;@push&nbsp;indef_possambig;&nbsp;@push&nbsp;indef_owner;</span></span>
<span class="tr"><span class="th" id="line2051">2051</span><span class="td">&nbsp;@push&nbsp;indef_cases;&nbsp;@push&nbsp;indef_nspec_at;</span></span>
<span class="tr"><span class="th" id="line2052">2052</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line2053">2053</span><span class="td">&nbsp;Descriptors();</span></span>
<span class="tr"><span class="th" id="line2054">2054</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line2055">2055</span><span class="td">&nbsp;@pull&nbsp;indef_nspec_at;&nbsp;@pull&nbsp;indef_cases;</span></span>
<span class="tr"><span class="th" id="line2056">2056</span><span class="td">&nbsp;@pull&nbsp;indef_owner;&nbsp;@pull&nbsp;indef_possambig;&nbsp;@pull&nbsp;indef_guess_p;</span></span>
<span class="tr"><span class="th" id="line2057">2057</span><span class="td">&nbsp;@pull&nbsp;indef_wanted;&nbsp;@pull&nbsp;indef_type;&nbsp;@pull&nbsp;indef_mode;</span></span>
<span class="tr"><span class="th" id="line2058">2058</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Preposition Chain.</h3><p><p> A small utility for runs of prepositions.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2064">2064</span><span class="td">[&nbsp;PrepositionChain&nbsp;wd&nbsp;index;</span></span>
<span class="tr"><span class="th" id="line2065">2065</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_tdata--&gt;index&nbsp;==&nbsp;wd)&nbsp;return&nbsp;wd;</span></span>
<span class="tr"><span class="th" id="line2066">2066</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((line_token--&gt;index)-&gt;0&nbsp;&amp;&nbsp;$20&nbsp;==&nbsp;0)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2067">2067</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2068">2068</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(line_tdata--&gt;index&nbsp;==&nbsp;wd)&nbsp;return&nbsp;wd;</span></span>
<span class="tr"><span class="th" id="line2069">2069</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index++;</span></span>
<span class="tr"><span class="th" id="line2070">2070</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;until&nbsp;((line_token--&gt;index&nbsp;==&nbsp;ENDIT_TOKEN)&nbsp;||&nbsp;(((line_token--&gt;index)-&gt;0&nbsp;&amp;&nbsp;$10)&nbsp;==&nbsp;0));</span></span>
<span class="tr"><span class="th" id="line2071">2071</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2072">2072</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Creature.</h3><p><p> Will this object do for an I6 <span class="fixed">creature</span> token? (In I7 terms, this affects the tokens &quot;[someone]&quot;, &quot;[somebody]&quot;, &quot;[anyone]&quot; and &quot;[anybody]&quot;.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2079">2079</span><span class="td">[&nbsp;CreatureTest&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line2080">2080</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;animate)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2081">2081</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;hasnt&nbsp;talkable)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line2082">2082</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(action_to_be&nbsp;==&nbsp;##Ask&nbsp;or&nbsp;##Answer&nbsp;or&nbsp;##Tell&nbsp;or&nbsp;##AskFor)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2083">2083</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line2084">2084</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Noun Domain.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line2104">NounDomain</a></span> does the most substantial part of parsing an object name. It is given two &quot;domains&quot; &ndash; usually a location and then the actor who is looking &ndash; and a context (i.e. token type), and returns:<p></p><p> (a) 0 if no match at all could be made, (b) 1 if a multiple object was made, (c) <em></em> if object <em></em> was the one decided upon, (d) <span class="fixed"><a href="./Definitions.i6t.html#line77">REPARSE_CODE</a></span> if it asked a question of the player and consequently rewrote the player&#39;s input, so that the whole parser should start again on the rewritten input.<p></p><p> In case (c), <span class="fixed"><a href="./Parser.i6t.html#line2104">NounDomain</a></span> also sets the variable <span class="fixed"><a href="./Parser.i6t.html#line74">length_of_noun</a></span> to the number of words in the input text matched to the noun. In case (b), the multiple objects are added to <span class="fixed">multiple_object</span> by hand (not by <span class="fixed"><a href="./Parser.i6t.html#line3171">MultiAdd</a></span>, because we want to allow duplicates).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2104">2104</span><span class="td">[&nbsp;NounDomain&nbsp;domain1&nbsp;domain2&nbsp;context&nbsp;dont_ask</span></span>
<span class="tr"><span class="th" id="line2105">2105</span><span class="td">&nbsp;first_word&nbsp;i&nbsp;j&nbsp;k&nbsp;l&nbsp;answer_words&nbsp;marker;</span></span>
<span class="tr"><span class="th" id="line2106">2106</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2107">2107</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2108">2108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;[NounDomain&nbsp;called&nbsp;at&nbsp;word&nbsp;&quot;,&nbsp;wn,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2109">2109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2110">2110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2111">2111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;seeking&nbsp;indefinite&nbsp;object:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2112">2112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;OTHER_BIT)&nbsp;&nbsp;print&nbsp;&quot;other&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2113">2113</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;MY_BIT)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;my&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2114">2114</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;THAT_BIT)&nbsp;&nbsp;&nbsp;print&nbsp;&quot;that&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2115">2115</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;PLURAL_BIT)&nbsp;print&nbsp;&quot;plural&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2116">2116</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;LIT_BIT)&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;lit&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2117">2117</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;UNLIT_BIT)&nbsp;&nbsp;print&nbsp;&quot;unlit&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2118">2118</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_owner&nbsp;~=&nbsp;0)&nbsp;print&nbsp;&quot;owner:&quot;,&nbsp;(name)&nbsp;indef_owner;</span></span>
<span class="tr"><span class="th" id="line2119">2119</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line2120">2120</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;number&nbsp;wanted:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2121">2121</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_wanted&nbsp;==&nbsp;INDEF_ALL_WANTED)&nbsp;print&nbsp;&quot;all&quot;;&nbsp;else&nbsp;print&nbsp;indef_wanted;</span></span>
<span class="tr"><span class="th" id="line2122">2122</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line2123">2123</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;most&nbsp;likely&nbsp;GNAs&nbsp;of&nbsp;names:&nbsp;&quot;,&nbsp;indef_cases,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2124">2124</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2125">2125</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;&quot;seeking&nbsp;definite&nbsp;object^&quot;;</span></span>
<span class="tr"><span class="th" id="line2126">2126</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2127">2127</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2128">2128</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2129">2129</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;match_length&nbsp;=&nbsp;0;&nbsp;number_matched&nbsp;=&nbsp;0;&nbsp;match_from&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line2130">2130</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2131">2131</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;SearchScope(domain1,&nbsp;domain2,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line2132">2132</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2133">2133</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2134">2134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;[ND&nbsp;made&nbsp;&quot;,&nbsp;number_matched,&nbsp;&quot;&nbsp;matches]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2135">2135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2136">2136</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2137">2137</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;match_from+match_length;</span></span>
<span class="tr"><span class="th" id="line2138">2138</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2139">2139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;nothing&nbsp;worked&nbsp;at&nbsp;all,&nbsp;leave&nbsp;with&nbsp;the&nbsp;word&nbsp;marker&nbsp;skipped&nbsp;past&nbsp;the</span></span>
<span class="tr"><span class="th" id="line2140">2140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;first&nbsp;unmatched&nbsp;word...</span></span>
<span class="tr"><span class="th" id="line2141">2141</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2142">2142</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;==&nbsp;0)&nbsp;{&nbsp;wn++;&nbsp;rfalse;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2143">2143</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2144">2144</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Suppose&nbsp;that&nbsp;there&nbsp;really&nbsp;were&nbsp;some&nbsp;words&nbsp;being&nbsp;parsed&nbsp;(i.e.,&nbsp;we&nbsp;did</span></span>
<span class="tr"><span class="th" id="line2145">2145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;not&nbsp;just&nbsp;infer).&nbsp;&nbsp;If&nbsp;so,&nbsp;and&nbsp;if&nbsp;there&nbsp;was&nbsp;only&nbsp;one&nbsp;match,&nbsp;it&nbsp;must&nbsp;be</span></span>
<span class="tr"><span class="th" id="line2146">2146</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;right&nbsp;and&nbsp;we&nbsp;return&nbsp;it...</span></span>
<span class="tr"><span class="th" id="line2147">2147</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2148">2148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_from&nbsp;&lt;=&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2149">2149</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2150">2150</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i=match_list--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2151">2151</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2152">2152</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2153">2153</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2154">2154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...now&nbsp;suppose&nbsp;that&nbsp;there&nbsp;was&nbsp;more&nbsp;typing&nbsp;to&nbsp;come,&nbsp;i.e.&nbsp;suppose&nbsp;that</span></span>
<span class="tr"><span class="th" id="line2155">2155</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;the&nbsp;user&nbsp;entered&nbsp;something&nbsp;beyond&nbsp;this&nbsp;noun.&nbsp;&nbsp;If&nbsp;nothing&nbsp;ought&nbsp;to&nbsp;follow,</span></span>
<span class="tr"><span class="th" id="line2156">2156</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;then&nbsp;there&nbsp;must&nbsp;be&nbsp;a&nbsp;mistake,&nbsp;(unless&nbsp;what&nbsp;does&nbsp;follow&nbsp;is&nbsp;just&nbsp;a&nbsp;full</span></span>
<span class="tr"><span class="th" id="line2157">2157</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;stop,&nbsp;and&nbsp;or&nbsp;comma)</span></span>
<span class="tr"><span class="th" id="line2158">2158</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2159">2159</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&lt;=&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2160">2160</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;NextWord();&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line2161">2161</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;~=&nbsp;&nbsp;AND1__WD&nbsp;or&nbsp;AND2__WD&nbsp;or&nbsp;AND3__WD&nbsp;or&nbsp;comma_word</span></span>
<span class="tr"><span class="th" id="line2162">2162</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;THEN1__WD&nbsp;or&nbsp;THEN2__WD&nbsp;or&nbsp;THEN3__WD</span></span>
<span class="tr"><span class="th" id="line2163">2163</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;BUT1__WD&nbsp;or&nbsp;BUT2__WD&nbsp;or&nbsp;BUT3__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2164">2164</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(lookahead&nbsp;==&nbsp;ENDIT_TOKEN)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line2165">2165</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2166">2166</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2167">2167</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2168">2168</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2169">2169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now&nbsp;look&nbsp;for&nbsp;a&nbsp;good&nbsp;choice,&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one&nbsp;choice...</span></span>
<span class="tr"><span class="th" id="line2170">2170</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2171">2171</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;number_of_classes&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2172">2172</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2173">2173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2174">2174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;match_list--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2175">2175</span><span class="td">&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;indef_type&nbsp;&amp;&nbsp;PLURAL_BIT&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2176">2176</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;==&nbsp;MULTI_TOKEN&nbsp;or&nbsp;MULTIHELD_TOKEN&nbsp;or</span></span>
<span class="tr"><span class="th" id="line2177">2177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN&nbsp;or</span></span>
<span class="tr"><span class="th" id="line2178">2178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;NOUN_TOKEN&nbsp;or&nbsp;HELD_TOKEN&nbsp;or&nbsp;CREATURE_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2179">2179</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line2180">2180</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ForActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;i))&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line2181">2181</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RulebookFailed()))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line2182">2182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line2183">2183</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2184">2184</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2185">2185</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2186">2186</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;&gt;&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2187">2187</span><span class="td">&nbsp;&nbsp;i&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line2188">2188</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;&gt;&nbsp;1)</span></span>
<span class="tr"><span class="th" id="line2189">2189</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=0&nbsp;:&nbsp;j&lt;number_matched-1&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line2190">2190</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Identical(match_list--&gt;j,&nbsp;match_list--&gt;(j+1))&nbsp;==&nbsp;false)</span></span>
<span class="tr"><span class="th" id="line2191">2191</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line2192">2192</span><span class="td">&nbsp;&nbsp;if&nbsp;(i)&nbsp;dont_infer&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line2193">2193</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;Adjudicate(context);</span></span>
<span class="tr"><span class="th" id="line2194">2194</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;-1)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line2195">2195</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;1)&nbsp;rtrue;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;Adjudicate&nbsp;has&nbsp;made&nbsp;a&nbsp;multiple</span></span>
<span class="tr"><span class="th" id="line2196">2196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;object,&nbsp;and&nbsp;we&nbsp;pass&nbsp;it&nbsp;on</span></span>
<span class="tr"><span class="th" id="line2197">2197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2198">2198</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2199">2199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;i&nbsp;is&nbsp;non-zero&nbsp;here,&nbsp;one&nbsp;of&nbsp;two&nbsp;things&nbsp;is&nbsp;happening:&nbsp;either</span></span>
<span class="tr"><span class="th" id="line2200">2200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(a)&nbsp;an&nbsp;inference&nbsp;has&nbsp;been&nbsp;successfully&nbsp;made&nbsp;that&nbsp;object&nbsp;i&nbsp;is</span></span>
<span class="tr"><span class="th" id="line2201">2201</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;intended&nbsp;one&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;specification,&nbsp;or</span></span>
<span class="tr"><span class="th" id="line2202">2202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(b)&nbsp;the&nbsp;user&nbsp;finished&nbsp;typing&nbsp;some&nbsp;time&nbsp;ago,&nbsp;but&nbsp;we&#39;ve&nbsp;decided</span></span>
<span class="tr"><span class="th" id="line2203">2203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;i&nbsp;because&nbsp;it&#39;s&nbsp;the&nbsp;only&nbsp;possible&nbsp;choice.</span></span>
<span class="tr"><span class="th" id="line2204">2204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;In&nbsp;either&nbsp;case&nbsp;we&nbsp;have&nbsp;to&nbsp;keep&nbsp;the&nbsp;pattern&nbsp;up&nbsp;to&nbsp;date,</span></span>
<span class="tr"><span class="th" id="line2205">2205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;note&nbsp;that&nbsp;an&nbsp;inference&nbsp;has&nbsp;been&nbsp;made&nbsp;and&nbsp;return.</span></span>
<span class="tr"><span class="th" id="line2206">2206</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(Except,&nbsp;we&nbsp;don&#39;t&nbsp;note&nbsp;which&nbsp;of&nbsp;a&nbsp;pile&nbsp;of&nbsp;identical&nbsp;objects.)</span></span>
<span class="tr"><span class="th" id="line2207">2207</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2208">2208</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2209">2209</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dont_infer)&nbsp;return&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2210">2210</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inferfrom&nbsp;==&nbsp;0)&nbsp;inferfrom=pcount;</span></span>
<span class="tr"><span class="th" id="line2211">2211</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pattern--&gt;pcount&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2212">2212</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2213">2213</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2214">2214</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2215">2215</span><span class="td">&nbsp;if&nbsp;(dont_ask)&nbsp;return&nbsp;match_list--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2216">2216</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2217">2217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;we&nbsp;get&nbsp;here,&nbsp;there&nbsp;was&nbsp;no&nbsp;obvious&nbsp;choice&nbsp;of&nbsp;object&nbsp;to&nbsp;make.&nbsp;&nbsp;If&nbsp;in</span></span>
<span class="tr"><span class="th" id="line2218">2218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;fact&nbsp;we&#39;ve&nbsp;already&nbsp;gone&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;player&#39;s&nbsp;typing&nbsp;(which</span></span>
<span class="tr"><span class="th" id="line2219">2219</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;means&nbsp;the&nbsp;match&nbsp;list&nbsp;must&nbsp;contain&nbsp;every&nbsp;object&nbsp;in&nbsp;scope,&nbsp;regardless</span></span>
<span class="tr"><span class="th" id="line2220">2220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;of&nbsp;its&nbsp;name),&nbsp;then&nbsp;it&#39;s&nbsp;foolish&nbsp;to&nbsp;give&nbsp;an&nbsp;enormous&nbsp;list&nbsp;to&nbsp;choose</span></span>
<span class="tr"><span class="th" id="line2221">2221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;from&nbsp;-&nbsp;instead&nbsp;we&nbsp;go&nbsp;and&nbsp;ask&nbsp;a&nbsp;more&nbsp;suitable&nbsp;question...</span></span>
<span class="tr"><span class="th" id="line2222">2222</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2223">2223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_from&nbsp;&gt;&nbsp;num_words)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2362">Incomplete</a>;</span></span>
<span class="tr"><span class="th" id="line2224">2224</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2225">2225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now&nbsp;we&nbsp;print&nbsp;up&nbsp;the&nbsp;question,&nbsp;using&nbsp;the&nbsp;equivalence&nbsp;classes&nbsp;as&nbsp;worked</span></span>
<span class="tr"><span class="th" id="line2226">2226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;out&nbsp;by&nbsp;Adjudicate()&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;repeat&nbsp;ourselves&nbsp;on&nbsp;plural&nbsp;objects...</span></span>
<span class="tr"><span class="th" id="line2227">2227</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2228">2228</span><span class="td">&nbsp;BeginActivity(ASKING_WHICH_DO_YOU_MEAN_ACT);</span></span>
<span class="tr"><span class="th" id="line2229">2229</span><span class="td">&nbsp;if&nbsp;(ForActivity(ASKING_WHICH_DO_YOU_MEAN_ACT))&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2256">SkipWhichQuestion</a>;</span></span>
<span class="tr"><span class="th" id="line2230">2230</span><span class="td">&nbsp;j&nbsp;=&nbsp;1;&nbsp;marker&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2231">2231</span><span class="td">&nbsp;for&nbsp;(i=1&nbsp;:&nbsp;i&lt;=number_of_classes&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2232">2232</span><span class="td">&nbsp;&nbsp;while&nbsp;(((match_classes--&gt;marker)&nbsp;~=&nbsp;i)&nbsp;&amp;&amp;&nbsp;((match_classes--&gt;marker)&nbsp;~=&nbsp;-i))</span></span>
<span class="tr"><span class="th" id="line2233">2233</span><span class="td">&nbsp;&nbsp;&nbsp;marker++;</span></span>
<span class="tr"><span class="th" id="line2234">2234</span><span class="td">&nbsp;&nbsp;if&nbsp;(match_list--&gt;marker&nbsp;hasnt&nbsp;animate)&nbsp;j&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2235">2235</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2236">2236</span><span class="td">&nbsp;if&nbsp;(j)&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;A&#39;);</span></span>
<span class="tr"><span class="th" id="line2237">2237</span><span class="td">&nbsp;else&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line2238">2238</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2239">2239</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;number_of_classes;&nbsp;marker&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2240">2240</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=1&nbsp;:&nbsp;i&lt;=number_of_classes&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2241">2241</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(((match_classes--&gt;marker)&nbsp;~=&nbsp;i)&nbsp;&amp;&amp;&nbsp;((match_classes--&gt;marker)&nbsp;~=&nbsp;-i))&nbsp;marker++;</span></span>
<span class="tr"><span class="th" id="line2242">2242</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;match_list--&gt;marker;</span></span>
<span class="tr"><span class="th" id="line2243">2243</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2244">2244</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_classes--&gt;marker&nbsp;&gt;&nbsp;0)&nbsp;print&nbsp;(the)&nbsp;k;&nbsp;else&nbsp;print&nbsp;(a)&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line2245">2245</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2246">2246</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&lt;&nbsp;j-1)&nbsp;&nbsp;print&nbsp;&quot;,&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2247">2247</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;j-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2248">2248</span><span class="td">&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;SERIAL_COMMA;</span></span>
<span class="tr"><span class="th" id="line2249">2249</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;~=&nbsp;2)&nbsp;print&nbsp;&quot;,&quot;;</span></span>
<span class="tr"><span class="th" id="line2250">2250</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;SERIAL_COMMA</span></span>
<span class="tr"><span class="th" id="line2251">2251</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;H&#39;);</span></span>
<span class="tr"><span class="th" id="line2252">2252</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2253">2253</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2254">2254</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;?^&quot;;</span></span>
<span class="tr"><span class="th" id="line2255">2255</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2256">2256</span><span class="td">&nbsp;.SkipWhichQuestion;&nbsp;EndActivity(ASKING_WHICH_DO_YOU_MEAN_ACT);</span></span>
<span class="tr"><span class="th" id="line2257">2257</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2258">2258</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...and&nbsp;get&nbsp;an&nbsp;answer:</span></span>
<span class="tr"><span class="th" id="line2259">2259</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2260">2260</span><span class="td">&nbsp;&nbsp;.WhichOne;</span></span>
<span class="tr"><span class="th" id="line2261">2261</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2262">2262</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=2&nbsp;:&nbsp;i&lt;INPUT_BUFFER_LEN&nbsp;:&nbsp;i++)&nbsp;buffer2-&gt;i&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2263">2263</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_ZCODE</span></span>
<span class="tr"><span class="th" id="line2264">2264</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;answer_words=Keyboard(buffer2,&nbsp;parse2);</span></span>
<span class="tr"><span class="th" id="line2265">2265</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2266">2266</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Conveniently,&nbsp;parse2--&gt;1&nbsp;is&nbsp;the&nbsp;first&nbsp;word&nbsp;in&nbsp;both&nbsp;ZCODE&nbsp;and&nbsp;GLULX.</span></span>
<span class="tr"><span class="th" id="line2267">2267</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;first_word&nbsp;=&nbsp;(parse2--&gt;1);</span></span>
<span class="tr"><span class="th" id="line2268">2268</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2269">2269</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Take&nbsp;care&nbsp;of&nbsp;&quot;all&quot;,&nbsp;because&nbsp;that&nbsp;does&nbsp;something&nbsp;too&nbsp;clever&nbsp;here&nbsp;to&nbsp;do</span></span>
<span class="tr"><span class="th" id="line2270">2270</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;later&nbsp;on:</span></span>
<span class="tr"><span class="th" id="line2271">2271</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2272">2272</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(first_word&nbsp;==&nbsp;ALL1__WD&nbsp;or&nbsp;ALL2__WD&nbsp;or&nbsp;ALL3__WD&nbsp;or&nbsp;ALL4__WD&nbsp;or&nbsp;ALL5__WD)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2273">2273</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;==&nbsp;MULTI_TOKEN&nbsp;or&nbsp;MULTIHELD_TOKEN&nbsp;or&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2274">2274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2275">2275</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;&amp;&amp;&nbsp;l+i&lt;MATCH_LIST_WORDS&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2276">2276</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;match_list--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2277">2277</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;(i+1+l)&nbsp;=&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line2278">2278</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2279">2279</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;i+l;</span></span>
<span class="tr"><span class="th" id="line2280">2280</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2281">2281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2282">2282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;C&#39;);</span></span>
<span class="tr"><span class="th" id="line2283">2283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2260">WhichOne</a>;</span></span>
<span class="tr"><span class="th" id="line2284">2284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2285">2285</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2286">2286</span><span class="td">&nbsp;!&nbsp;Look&nbsp;for&nbsp;a&nbsp;comma,&nbsp;and&nbsp;interpret&nbsp;this&nbsp;as&nbsp;a&nbsp;fresh&nbsp;conversation&nbsp;command</span></span>
<span class="tr"><span class="th" id="line2287">2287</span><span class="td">&nbsp;!&nbsp;if&nbsp;so:</span></span>
<span class="tr"><span class="th" id="line2288">2288</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2289">2289</span><span class="td">&nbsp;for&nbsp;(i=1&nbsp;:&nbsp;i&lt;=answer_words&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line2290">2290</span><span class="td">&nbsp;&nbsp;if&nbsp;(WordFrom(i,&nbsp;parse2)&nbsp;==&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2291">2291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_CopyBuffer(buffer,&nbsp;buffer2);</span></span>
<span class="tr"><span class="th" id="line2292">2292</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2343">RECONSTRUCT_INPUT</a>;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line2293">2293</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2294">2294</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2295">2295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;the&nbsp;first&nbsp;word&nbsp;of&nbsp;the&nbsp;reply&nbsp;can&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;verb,&nbsp;then</span></span>
<span class="tr"><span class="th" id="line2296">2296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;assume&nbsp;that&nbsp;the&nbsp;player&nbsp;has&nbsp;ignored&nbsp;the&nbsp;question&nbsp;and&nbsp;given&nbsp;a&nbsp;new</span></span>
<span class="tr"><span class="th" id="line2297">2297</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;command&nbsp;altogether.</span></span>
<span class="tr"><span class="th" id="line2298">2298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(This&nbsp;is&nbsp;one&nbsp;time&nbsp;when&nbsp;it&#39;s&nbsp;convenient&nbsp;that&nbsp;the&nbsp;directions&nbsp;are</span></span>
<span class="tr"><span class="th" id="line2299">2299</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;not&nbsp;themselves&nbsp;verbs&nbsp;-&nbsp;thus,&nbsp;&quot;north&quot;&nbsp;as&nbsp;a&nbsp;reply&nbsp;to&nbsp;&quot;Which,&nbsp;the&nbsp;north</span></span>
<span class="tr"><span class="th" id="line2300">2300</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;or&nbsp;south&nbsp;door&quot;&nbsp;is&nbsp;not&nbsp;treated&nbsp;as&nbsp;a&nbsp;fresh&nbsp;command&nbsp;but&nbsp;as&nbsp;an&nbsp;answer.)</span></span>
<span class="tr"><span class="th" id="line2301">2301</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2302">2302</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguageIsVerb;</span></span>
<span class="tr"><span class="th" id="line2303">2303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(first_word&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2304">2304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;wn;&nbsp;first_word&nbsp;=&nbsp;LanguageIsVerb(buffer2,&nbsp;parse2,&nbsp;1);&nbsp;wn&nbsp;=&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line2305">2305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2306">2306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageIsVerb</span></span>
<span class="tr"><span class="th" id="line2307">2307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(first_word&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2308">2308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;first_word-&gt;#dict_par1;</span></span>
<span class="tr"><span class="th" id="line2309">2309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((0&nbsp;~=&nbsp;j&amp;1)&nbsp;&amp;&amp;&nbsp;~~LanguageVerbMayBeName(first_word))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2310">2310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_CopyBuffer(buffer,&nbsp;buffer2);</span></span>
<span class="tr"><span class="th" id="line2311">2311</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2343">RECONSTRUCT_INPUT</a>;</span></span>
<span class="tr"><span class="th" id="line2312">2312</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2313">2313</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2314">2314</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2315">2315</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now&nbsp;we&nbsp;insert&nbsp;the&nbsp;answer&nbsp;into&nbsp;the&nbsp;original&nbsp;typed&nbsp;command,&nbsp;as</span></span>
<span class="tr"><span class="th" id="line2316">2316</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;words&nbsp;additionally&nbsp;describing&nbsp;the&nbsp;same&nbsp;object</span></span>
<span class="tr"><span class="th" id="line2317">2317</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(eg,&nbsp;&gt;&nbsp;take&nbsp;red&nbsp;button</span></span>
<span class="tr"><span class="th" id="line2318">2318</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Which&nbsp;one,&nbsp;...</span></span>
<span class="tr"><span class="th" id="line2319">2319</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;music</span></span>
<span class="tr"><span class="th" id="line2320">2320</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;becomes&nbsp;&quot;take&nbsp;music&nbsp;red&nbsp;button&quot;.&nbsp;&nbsp;The&nbsp;parser&nbsp;will&nbsp;thus&nbsp;have&nbsp;three</span></span>
<span class="tr"><span class="th" id="line2321">2321</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;words&nbsp;to&nbsp;work&nbsp;from&nbsp;next&nbsp;time,&nbsp;not&nbsp;two.)</span></span>
<span class="tr"><span class="th" id="line2322">2322</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2323">2323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2324">2324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;WordAddress(match_from)&nbsp;-&nbsp;buffer;&nbsp;l=buffer2-&gt;1+1;</span></span>
<span class="tr"><span class="th" id="line2325">2325</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=buffer&nbsp;+&nbsp;buffer-&gt;0&nbsp;-&nbsp;1&nbsp;:&nbsp;j&gt;=buffer+k+l&nbsp;:&nbsp;j--)&nbsp;j-&gt;0&nbsp;=&nbsp;0-&gt;(j-l);</span></span>
<span class="tr"><span class="th" id="line2326">2326</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;l&nbsp;:&nbsp;i++)&nbsp;buffer-&gt;(k+i)&nbsp;=&nbsp;buffer2-&gt;(2+i);</span></span>
<span class="tr"><span class="th" id="line2327">2327</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;buffer-&gt;(k+l-1)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2328">2328</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;buffer-&gt;1&nbsp;=&nbsp;buffer-&gt;1&nbsp;+&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line2329">2329</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer-&gt;1&nbsp;&gt;=&nbsp;(buffer-&gt;0&nbsp;-&nbsp;1))&nbsp;buffer-&gt;1&nbsp;=&nbsp;buffer-&gt;0;</span></span>
<span class="tr"><span class="th" id="line2330">2330</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line2331">2331</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;WordAddress(match_from)&nbsp;-&nbsp;buffer;</span></span>
<span class="tr"><span class="th" id="line2332">2332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;(buffer2--&gt;0)&nbsp;+&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2333">2333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=buffer+INPUT_BUFFER_LEN-1&nbsp;:&nbsp;j&gt;=buffer+k+l&nbsp;:&nbsp;j--)&nbsp;j-&gt;0&nbsp;=&nbsp;j-&gt;(-l);</span></span>
<span class="tr"><span class="th" id="line2334">2334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;l&nbsp;:&nbsp;i++)&nbsp;buffer-&gt;(k+i)&nbsp;=&nbsp;buffer2-&gt;(WORDSIZE+i);</span></span>
<span class="tr"><span class="th" id="line2335">2335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;buffer-&gt;(k+l-1)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2336">2336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;buffer--&gt;0&nbsp;=&nbsp;buffer--&gt;0&nbsp;+&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line2337">2337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer--&gt;0&nbsp;&gt;&nbsp;(INPUT_BUFFER_LEN-WORDSIZE))&nbsp;buffer--&gt;0&nbsp;=&nbsp;(INPUT_BUFFER_LEN-WORDSIZE);</span></span>
<span class="tr"><span class="th" id="line2338">2338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line2339">2339</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2340">2340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Having&nbsp;reconstructed&nbsp;the&nbsp;input,&nbsp;we&nbsp;warn&nbsp;the&nbsp;parser&nbsp;accordingly</span></span>
<span class="tr"><span class="th" id="line2341">2341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;get&nbsp;out.</span></span>
<span class="tr"><span class="th" id="line2342">2342</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2343">2343</span><span class="td">&nbsp;.RECONSTRUCT_INPUT;</span></span>
<span class="tr"><span class="th" id="line2344">2344</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2345">2345</span><span class="td">&nbsp;num_words&nbsp;=&nbsp;WordCount();&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;num_words;</span></span>
<span class="tr"><span class="th" id="line2346">2346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2347">2347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguageToInformese;</span></span>
<span class="tr"><span class="th" id="line2348">2348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;LanguageToInformese();</span></span>
<span class="tr"><span class="th" id="line2349">2349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Re-tokenise:</span></span>
<span class="tr"><span class="th" id="line2350">2350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;VM_Tokenise(buffer,parse);</span></span>
<span class="tr"><span class="th" id="line2351">2351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageToInformese</span></span>
<span class="tr"><span class="th" id="line2352">2352</span><span class="td">&nbsp;num_words&nbsp;=&nbsp;WordCount();&nbsp;players_command&nbsp;=&nbsp;100&nbsp;+&nbsp;num_words;</span></span>
<span class="tr"><span class="th" id="line2353">2353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actors_location&nbsp;=&nbsp;ScopeCeiling(player);</span></span>
<span class="tr"><span class="th" id="line2354">2354</span><span class="td">&nbsp;FollowRulebook(Activity_after_rulebooks--&gt;READING_A_COMMAND_ACT);</span></span>
<span class="tr"><span class="th" id="line2355">2355</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2356">2356</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;REPARSE_CODE;</span></span>
<span class="tr"><span class="th" id="line2357">2357</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2358">2358</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Now&nbsp;we&nbsp;come&nbsp;to&nbsp;the&nbsp;question&nbsp;asked&nbsp;when&nbsp;the&nbsp;input&nbsp;has&nbsp;run&nbsp;out</span></span>
<span class="tr"><span class="th" id="line2359">2359</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;and&nbsp;can&#39;t&nbsp;easily&nbsp;be&nbsp;guessed&nbsp;(eg,&nbsp;the&nbsp;player&nbsp;typed&nbsp;&quot;take&quot;&nbsp;and&nbsp;there</span></span>
<span class="tr"><span class="th" id="line2360">2360</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;were&nbsp;plenty&nbsp;of&nbsp;things&nbsp;which&nbsp;might&nbsp;have&nbsp;been&nbsp;meant).</span></span>
<span class="tr"><span class="th" id="line2361">2361</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2362">2362</span><span class="td">&nbsp;&nbsp;.Incomplete;</span></span>
<span class="tr"><span class="th" id="line2363">2363</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2364">2364</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;==&nbsp;CREATURE_TOKEN)&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;D&#39;,&nbsp;actor);</span></span>
<span class="tr"><span class="th" id="line2365">2365</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;E&#39;,&nbsp;actor);</span></span>
<span class="tr"><span class="th" id="line2366">2366</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line2367">2367</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2368">2368</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2369">2369</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=2&nbsp;:&nbsp;i&lt;INPUT_BUFFER_LEN&nbsp;:&nbsp;i++)&nbsp;buffer2-&gt;i=&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2370">2370</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_ZCODE</span></span>
<span class="tr"><span class="th" id="line2371">2371</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;answer_words&nbsp;=&nbsp;Keyboard(buffer2,&nbsp;parse2);</span></span>
<span class="tr"><span class="th" id="line2372">2372</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2373">2373</span><span class="td">&nbsp;!&nbsp;Look&nbsp;for&nbsp;a&nbsp;comma,&nbsp;and&nbsp;interpret&nbsp;this&nbsp;as&nbsp;a&nbsp;fresh&nbsp;conversation&nbsp;command</span></span>
<span class="tr"><span class="th" id="line2374">2374</span><span class="td">&nbsp;!&nbsp;if&nbsp;so:</span></span>
<span class="tr"><span class="th" id="line2375">2375</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2376">2376</span><span class="td">&nbsp;for&nbsp;(i=1&nbsp;:&nbsp;i&lt;=answer_words&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line2377">2377</span><span class="td">&nbsp;&nbsp;if&nbsp;(WordFrom(i,&nbsp;parse2)&nbsp;==&nbsp;comma_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2378">2378</span><span class="td">&nbsp;&nbsp;&nbsp;VM_CopyBuffer(buffer,&nbsp;buffer2);</span></span>
<span class="tr"><span class="th" id="line2379">2379</span><span class="td">&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2343">RECONSTRUCT_INPUT</a>;</span></span>
<span class="tr"><span class="th" id="line2380">2380</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2381">2381</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2382">2382</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;first_word=(parse2--&gt;1);</span></span>
<span class="tr"><span class="th" id="line2383">2383</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguageIsVerb;</span></span>
<span class="tr"><span class="th" id="line2384">2384</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(first_word==0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2385">2385</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;wn;&nbsp;first_word=LanguageIsVerb(buffer2,&nbsp;parse2,&nbsp;1);&nbsp;wn&nbsp;=&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line2386">2386</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2387">2387</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageIsVerb</span></span>
<span class="tr"><span class="th" id="line2388">2388</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2389">2389</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Once&nbsp;again,&nbsp;if&nbsp;the&nbsp;reply&nbsp;looks&nbsp;like&nbsp;a&nbsp;command,&nbsp;give&nbsp;it&nbsp;to&nbsp;the</span></span>
<span class="tr"><span class="th" id="line2390">2390</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;parser&nbsp;to&nbsp;get&nbsp;on&nbsp;with&nbsp;and&nbsp;forget&nbsp;about&nbsp;the&nbsp;question...</span></span>
<span class="tr"><span class="th" id="line2391">2391</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2392">2392</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(first_word&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2393">2393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;first_word-&gt;#dict_par1;</span></span>
<span class="tr"><span class="th" id="line2394">2394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((0&nbsp;~=&nbsp;j&amp;1)&nbsp;&amp;&amp;&nbsp;~~LanguageVerbMayBeName(first_word))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2395">2395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_CopyBuffer(buffer,&nbsp;buffer2);</span></span>
<span class="tr"><span class="th" id="line2396">2396</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2343">RECONSTRUCT_INPUT</a>;</span></span>
<span class="tr"><span class="th" id="line2397">2397</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2398">2398</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2399">2399</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2400">2400</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;...but&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;genuine&nbsp;answer,&nbsp;then:</span></span>
<span class="tr"><span class="th" id="line2401">2401</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!</span></span>
<span class="tr"><span class="th" id="line2402">2402</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(1)&nbsp;we&nbsp;must&nbsp;glue&nbsp;in&nbsp;text&nbsp;suitable&nbsp;for&nbsp;anything&nbsp;that&#39;s&nbsp;been&nbsp;inferred.</span></span>
<span class="tr"><span class="th" id="line2403">2403</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2404">2404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(inferfrom&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2405">2405</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=inferfrom&nbsp;:&nbsp;j&lt;pcount&nbsp;:&nbsp;j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2406">2406</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pattern--&gt;j&nbsp;==&nbsp;PATTERN_NULL)&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line2407">2407</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2408">2408</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;2+buffer-&gt;1;&nbsp;(buffer-&gt;1)++;&nbsp;buffer-&gt;(i++)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2409">2409</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line2410">2410</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;WORDSIZE&nbsp;+&nbsp;buffer--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2411">2411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(buffer--&gt;0)++;&nbsp;buffer-&gt;(i++)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2412">2412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line2413">2413</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2414">2414</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2415">2415</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;5)</span></span>
<span class="tr"><span class="th" id="line2416">2416</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[Gluing&nbsp;in&nbsp;inference&nbsp;with&nbsp;pattern&nbsp;code&nbsp;&quot;,&nbsp;pattern--&gt;j,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2417">2417</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2418">2418</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2419">2419</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Conveniently,&nbsp;parse2--&gt;1&nbsp;is&nbsp;the&nbsp;first&nbsp;word&nbsp;in&nbsp;both&nbsp;ZCODE&nbsp;and&nbsp;GLULX.</span></span>
<span class="tr"><span class="th" id="line2420">2420</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2421">2421</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parse2--&gt;1&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2422">2422</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2423">2423</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;An&nbsp;inferred&nbsp;object.&nbsp;&nbsp;Best&nbsp;we&nbsp;can&nbsp;do&nbsp;is&nbsp;glue&nbsp;in&nbsp;a&nbsp;pronoun.</span></span>
<span class="tr"><span class="th" id="line2424">2424</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(This&nbsp;is&nbsp;imperfect,&nbsp;but&nbsp;it&#39;s&nbsp;very&nbsp;seldom&nbsp;needed&nbsp;anyway.)</span></span>
<span class="tr"><span class="th" id="line2425">2425</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2426">2426</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pattern--&gt;j&nbsp;&gt;=&nbsp;2&nbsp;&amp;&amp;&nbsp;pattern--&gt;j&nbsp;&lt;&nbsp;REPARSE_CODE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2427">2427</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PronounNotice(pattern--&gt;j);</span></span>
<span class="tr"><span class="th" id="line2428">2428</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(k=1&nbsp;:&nbsp;k&lt;=LanguagePronouns--&gt;0&nbsp;:&nbsp;k=k+3)</span></span>
<span class="tr"><span class="th" id="line2429">2429</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pattern--&gt;j&nbsp;==&nbsp;LanguagePronouns--&gt;(k+2))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2430">2430</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parse2--&gt;1&nbsp;=&nbsp;LanguagePronouns--&gt;k;</span></span>
<span class="tr"><span class="th" id="line2431">2431</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2432">2432</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;5)</span></span>
<span class="tr"><span class="th" id="line2433">2433</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[Using&nbsp;pronoun&nbsp;&#39;&quot;,&nbsp;(address)&nbsp;parse2--&gt;1,&nbsp;&quot;&#39;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2434">2434</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2435">2435</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line2436">2436</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2437">2437</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2438">2438</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2439">2439</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;An&nbsp;inferred&nbsp;preposition.</span></span>
<span class="tr"><span class="th" id="line2440">2440</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parse2--&gt;1&nbsp;=&nbsp;VM_NumberToDictionaryAddress(pattern--&gt;j&nbsp;-&nbsp;REPARSE_CODE);</span></span>
<span class="tr"><span class="th" id="line2441">2441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2442">2442</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;5)</span></span>
<span class="tr"><span class="th" id="line2443">2443</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[Using&nbsp;preposition&nbsp;&#39;&quot;,&nbsp;(address)&nbsp;parse2--&gt;1,&nbsp;&quot;&#39;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2444">2444</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2445">2445</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2446">2446</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2447">2447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;parse2--&gt;1&nbsp;now&nbsp;holds&nbsp;the&nbsp;dictionary&nbsp;address&nbsp;of&nbsp;the&nbsp;word&nbsp;to&nbsp;glue&nbsp;in.</span></span>
<span class="tr"><span class="th" id="line2448">2448</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2449">2449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parse2--&gt;1&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2450">2450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;buffer&nbsp;+&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2451">2451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2452">2452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@output_stream&nbsp;3&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line2453">2453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(address)&nbsp;parse2--&gt;1;</span></span>
<span class="tr"><span class="th" id="line2454">2454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@output_stream&nbsp;-3;</span></span>
<span class="tr"><span class="th" id="line2455">2455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;k--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2456">2456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(l=i&nbsp;:&nbsp;l&lt;i+k&nbsp;:&nbsp;l++)&nbsp;buffer-&gt;l&nbsp;=&nbsp;buffer-&gt;(l+2);</span></span>
<span class="tr"><span class="th" id="line2457">2457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;i&nbsp;+&nbsp;k;&nbsp;buffer-&gt;1&nbsp;=&nbsp;i-2;</span></span>
<span class="tr"><span class="th" id="line2458">2458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line2459">2459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;Glulx_PrintAnyToArray(buffer+i,&nbsp;INPUT_BUFFER_LEN-i,&nbsp;parse2--&gt;1);</span></span>
<span class="tr"><span class="th" id="line2460">2460</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;i&nbsp;+&nbsp;k;&nbsp;buffer--&gt;0&nbsp;=&nbsp;i&nbsp;-&nbsp;WORDSIZE;</span></span>
<span class="tr"><span class="th" id="line2461">2461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line2462">2462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2463">2463</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2464">2464</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2465">2465</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2466">2466</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(2)&nbsp;we&nbsp;must&nbsp;glue&nbsp;the&nbsp;newly-typed&nbsp;text&nbsp;onto&nbsp;the&nbsp;end.</span></span>
<span class="tr"><span class="th" id="line2467">2467</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2468">2468</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2469">2469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;2+buffer-&gt;1;&nbsp;(buffer-&gt;1)++;&nbsp;buffer-&gt;(i++)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2470">2470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=0&nbsp;:&nbsp;j&lt;buffer2-&gt;1&nbsp;:&nbsp;i++,j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2471">2471</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer-&gt;i&nbsp;=&nbsp;buffer2-&gt;(j+2);</span></span>
<span class="tr"><span class="th" id="line2472">2472</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(buffer-&gt;1)++;</span></span>
<span class="tr"><span class="th" id="line2473">2473</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer-&gt;1&nbsp;==&nbsp;INPUT_BUFFER_LEN)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line2474">2474</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2475">2475</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line2476">2476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;WORDSIZE&nbsp;+&nbsp;buffer--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2477">2477</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(buffer--&gt;0)++;&nbsp;buffer-&gt;(i++)&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2478">2478</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=0&nbsp;:&nbsp;j&lt;buffer2--&gt;0&nbsp;:&nbsp;i++,j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2479">2479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer-&gt;i&nbsp;=&nbsp;buffer2-&gt;(j+WORDSIZE);</span></span>
<span class="tr"><span class="th" id="line2480">2480</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(buffer--&gt;0)++;</span></span>
<span class="tr"><span class="th" id="line2481">2481</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buffer--&gt;0&nbsp;==&nbsp;INPUT_BUFFER_LEN)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line2482">2482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2483">2483</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line2484">2484</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2485">2485</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(3)&nbsp;we&nbsp;fill&nbsp;up&nbsp;the&nbsp;buffer&nbsp;with&nbsp;spaces,&nbsp;which&nbsp;is&nbsp;unnecessary,&nbsp;but&nbsp;may</span></span>
<span class="tr"><span class="th" id="line2486">2486</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help&nbsp;incorrectly-written&nbsp;interpreters&nbsp;to&nbsp;cope.</span></span>
<span class="tr"><span class="th" id="line2487">2487</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2488">2488</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line2489">2489</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(:&nbsp;i&lt;INPUT_BUFFER_LEN&nbsp;:&nbsp;i++)&nbsp;buffer-&gt;i&nbsp;=&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line2490">2490</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_ZCODE</span></span>
<span class="tr"><span class="th" id="line2491">2491</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2492">2492</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line2343">RECONSTRUCT_INPUT</a>;</span></span>
<span class="tr"><span class="th" id="line2493">2493</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2494">2494</span><span class="td">];&nbsp;!&nbsp;end&nbsp;of&nbsp;NounDomain</span></span>
<span class="tr"><span class="th" id="line2495">2495</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2496">2496</span><span class="td">[&nbsp;PARSER_CLARIF_INTERNAL_R;&nbsp;];</span></span>
</div><div class='text'>
<h3>Adjudicate.</h3><p><p> The <span class="fixed"><a href="./Parser.i6t.html#line2521">Adjudicate</a></span> routine tries to see if there is an obvious choice, when faced with a list of objects (the <span class="fixed">match_list</span>) each of which matches the player&#39;s specification equally well. To do this it makes use of the <span class="fixed">context</span> (the token type being worked on).<p></p><p> It counts up the number of obvious choices for the given context &ndash; all to do with where a candidate is, except for 6 (<span class="fixed">animate</span>) which is to do with whether it is animate or not &ndash; and then:<p></p><p> (a) if only one obvious choice is found, that is returned; (b) if we are in indefinite mode (don&#39;t care which) one of the obvious choices is returned, or if there is no obvious choice then an unobvious one is made; (c) at this stage, we work out whether the objects are distinguishable from each other or not: if they are all indistinguishable from each other, then choose one, it doesn&#39;t matter which; (d) otherwise, 0 (meaning, unable to decide) is returned (but remember that the equivalence classes we&#39;ve just worked out will be needed by other routines to clear up this mess, so we can&#39;t economise on working them out).<p></p><p> <span class="fixed"><a href="./Parser.i6t.html#line2521">Adjudicate</a></span> returns <em></em> if an error occurred.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2521">2521</span><span class="td">[&nbsp;Adjudicate&nbsp;context&nbsp;i&nbsp;j&nbsp;k&nbsp;good_ones&nbsp;last&nbsp;n&nbsp;ultimate&nbsp;flag&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line2522">2522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2523">2523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2524">2524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;[Adjudicating&nbsp;match&nbsp;list&nbsp;of&nbsp;size&nbsp;&quot;,&nbsp;number_matched,</span></span>
<span class="tr"><span class="th" id="line2525">2525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;in&nbsp;context&nbsp;&quot;,&nbsp;context,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2526">2526</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2527">2527</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2528">2528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;indefinite&nbsp;type:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2529">2529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;OTHER_BIT)&nbsp;&nbsp;print&nbsp;&quot;other&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2530">2530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;MY_BIT)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;my&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2531">2531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;THAT_BIT)&nbsp;&nbsp;&nbsp;print&nbsp;&quot;that&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2532">2532</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;PLURAL_BIT)&nbsp;print&nbsp;&quot;plural&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2533">2533</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;LIT_BIT)&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;lit&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2534">2534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;UNLIT_BIT)&nbsp;&nbsp;print&nbsp;&quot;unlit&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2535">2535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_owner&nbsp;~=&nbsp;0)&nbsp;print&nbsp;&quot;owner:&quot;,&nbsp;(name)&nbsp;indef_owner;</span></span>
<span class="tr"><span class="th" id="line2536">2536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line2537">2537</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;number&nbsp;wanted:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line2538">2538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_wanted&nbsp;==&nbsp;INDEF_ALL_WANTED)&nbsp;print&nbsp;&quot;all&quot;;&nbsp;else&nbsp;print&nbsp;indef_wanted;</span></span>
<span class="tr"><span class="th" id="line2539">2539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line2540">2540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;most&nbsp;likely&nbsp;GNAs&nbsp;of&nbsp;names:&nbsp;&quot;,&nbsp;indef_cases,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2541">2541</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2542">2542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;&quot;definite&nbsp;object^&quot;;</span></span>
<span class="tr"><span class="th" id="line2543">2543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2544">2544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2545">2545</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2546">2546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;number_matched-1;&nbsp;good_ones&nbsp;=&nbsp;0;&nbsp;last&nbsp;=&nbsp;match_list--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2547">2547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;=j&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2548">2548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;match_list--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2549">2549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_scores--&gt;i&nbsp;=&nbsp;good_ones;</span></span>
<span class="tr"><span class="th" id="line2550">2550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ultimate&nbsp;=&nbsp;ScopeCeiling(n);</span></span>
<span class="tr"><span class="th" id="line2551">2551</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2552">2552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==HELD_TOKEN&nbsp;&amp;&amp;&nbsp;parent(n)==actor)</span></span>
<span class="tr"><span class="th" id="line2553">2553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2554">2554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTI_TOKEN&nbsp;&amp;&amp;&nbsp;ultimate==ScopeCeiling(actor)</span></span>
<span class="tr"><span class="th" id="line2555">2555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;n~=actor&nbsp;&amp;&amp;&nbsp;n&nbsp;hasnt&nbsp;concealed&nbsp;&amp;&amp;&nbsp;n&nbsp;hasnt&nbsp;scenery)&nbsp;</span></span>
<span class="tr"><span class="th" id="line2556">2556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2557">2557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTIHELD_TOKEN&nbsp;&amp;&amp;&nbsp;parent(n)==actor)</span></span>
<span class="tr"><span class="th" id="line2558">2558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2559">2559</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2560">2560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN)</span></span>
<span class="tr"><span class="th" id="line2561">2561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;if&nbsp;(advance_warning==-1)</span></span>
<span class="tr"><span class="th" id="line2562">2562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTIEXCEPT_TOKEN)</span></span>
<span class="tr"><span class="th" id="line2563">2563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;</span></span>
<span class="tr"><span class="th" id="line2564">2564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2565">2565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTIINSIDE_TOKEN)</span></span>
<span class="tr"><span class="th" id="line2566">2566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;if&nbsp;(parent(n)~=actor)&nbsp;{&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2567">2567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2568">2568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2569">2569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line2570">2570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTIEXCEPT_TOKEN&nbsp;&amp;&amp;&nbsp;n~=advance_warning)</span></span>
<span class="tr"><span class="th" id="line2571">2571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2572">2572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==MULTIINSIDE_TOKEN&nbsp;&amp;&amp;&nbsp;n&nbsp;in&nbsp;advance_warning)</span></span>
<span class="tr"><span class="th" id="line2573">2573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2574">2574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2575">2575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2576">2576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context==CREATURE_TOKEN&nbsp;&amp;&amp;&nbsp;CreatureTest(n)==1)</span></span>
<span class="tr"><span class="th" id="line2577">2577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;good_ones++;&nbsp;last=n;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2578">2578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line2579">2579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_scores--&gt;i&nbsp;=&nbsp;1000*(good_ones&nbsp;-&nbsp;match_scores--&gt;i);</span></span>
<span class="tr"><span class="th" id="line2580">2580</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2581">2581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(good_ones&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2582">2582</span><span class="td">&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;indef_type&nbsp;&amp;&nbsp;PLURAL_BIT&nbsp;~=&nbsp;0&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line2583">2583</span><span class="td">&nbsp;&nbsp;&nbsp;context&nbsp;==&nbsp;MULTI_TOKEN&nbsp;or&nbsp;MULTIHELD_TOKEN&nbsp;or</span></span>
<span class="tr"><span class="th" id="line2584">2584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2585">2585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;last);</span></span>
<span class="tr"><span class="th" id="line2586">2586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ForActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;last))&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line2587">2587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RulebookFailed()))&nbsp;good_ones&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2588">2588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;last);</span></span>
<span class="tr"><span class="th" id="line2589">2589</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(good_ones&nbsp;==&nbsp;1)&nbsp;return&nbsp;last;</span></span>
<span class="tr"><span class="th" id="line2590">2590</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2591">2591</span><span class="td">&nbsp;&nbsp;&nbsp;return&nbsp;last;</span></span>
<span class="tr"><span class="th" id="line2592">2592</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2593">2593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2594">2594</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2595">2595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;If&nbsp;there&nbsp;is&nbsp;ambiguity&nbsp;about&nbsp;what&nbsp;was&nbsp;typed,&nbsp;but&nbsp;it&nbsp;definitely&nbsp;wasn&#39;t</span></span>
<span class="tr"><span class="th" id="line2596">2596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;animate&nbsp;as&nbsp;required,&nbsp;then&nbsp;return&nbsp;anything;&nbsp;higher&nbsp;up&nbsp;in&nbsp;the&nbsp;parser</span></span>
<span class="tr"><span class="th" id="line2597">2597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;a&nbsp;suitable&nbsp;error&nbsp;will&nbsp;be&nbsp;given.&nbsp;&nbsp;(This&nbsp;prevents&nbsp;a&nbsp;question&nbsp;being&nbsp;asked.)</span></span>
<span class="tr"><span class="th" id="line2598">2598</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2599">2599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;==&nbsp;CREATURE_TOKEN&nbsp;&amp;&amp;&nbsp;good_ones&nbsp;==&nbsp;0)&nbsp;return&nbsp;match_list--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2600">2600</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2601">2601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;0)&nbsp;indef_type=0;</span></span>
<span class="tr"><span class="th" id="line2602">2602</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2603">2603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ScoreMatchL(context);</span></span>
<span class="tr"><span class="th" id="line2604">2604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;==&nbsp;0)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2605">2605</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2606">2606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2607">2607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;Is&nbsp;there&nbsp;now&nbsp;a&nbsp;single&nbsp;highest-scoring&nbsp;object?</span></span>
<span class="tr"><span class="th" id="line2608">2608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;SingleBestGuess();</span></span>
<span class="tr"><span class="th" id="line2609">2609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2610">2610</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2611">2611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2612">2612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Single&nbsp;best-scoring&nbsp;object&nbsp;returned.]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2613">2613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2614">2614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2615">2615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2616">2616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2617">2617</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2618">2618</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;indef_type&nbsp;&amp;&nbsp;PLURAL_BIT&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2619">2619</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;~=&nbsp;MULTI_TOKEN&nbsp;or&nbsp;MULTIHELD_TOKEN&nbsp;or&nbsp;MULTIEXCEPT_TOKEN</span></span>
<span class="tr"><span class="th" id="line2620">2620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;MULTIINSIDE_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2621">2621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;MULTI_PE;</span></span>
<span class="tr"><span class="th" id="line2622">2622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2623">2623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2624">2624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;0;&nbsp;offset&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2625">2625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=BestGuess():&nbsp;j~=-1&nbsp;&amp;&amp;&nbsp;i&lt;indef_wanted&nbsp;&amp;&amp;&nbsp;i+offset&lt;MATCH_LIST_WORDS-1:</span></span>
<span class="tr"><span class="th" id="line2626">2626</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j=BestGuess())&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2627">2627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2628">2628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;j);</span></span>
<span class="tr"><span class="th" id="line2629">2629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ForActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;j))&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2630">2630</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;hasnt&nbsp;concealed&nbsp;&amp;&amp;&nbsp;j&nbsp;hasnt&nbsp;worn)&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2631">2631</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;==&nbsp;MULTIHELD_TOKEN&nbsp;or&nbsp;MULTIEXCEPT_TOKEN&nbsp;&amp;&amp;&nbsp;parent(j)&nbsp;~=&nbsp;actor)</span></span>
<span class="tr"><span class="th" id="line2632">2632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2633">2633</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2634">2634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(action_to_be&nbsp;==&nbsp;##Take&nbsp;or&nbsp;##Remove&nbsp;&amp;&amp;&nbsp;parent(j)&nbsp;==&nbsp;actor)</span></span>
<span class="tr"><span class="th" id="line2635">2635</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2636">2636</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2637">2637</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;ChooseObjects(j,&nbsp;flag);</span></span>
<span class="tr"><span class="th" id="line2638">2638</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2639">2639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(k&nbsp;==&nbsp;1)</span></span>
<span class="tr"><span class="th" id="line2640">2640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2641">2641</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2642">2642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(k&nbsp;==&nbsp;2)&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2643">2643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2644">2644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2645">2645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;&nbsp;if&nbsp;(RulebookSucceeded())&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2646">2646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2647">2647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(DECIDING_WHETHER_ALL_INC_ACT,&nbsp;j);</span></span>
<span class="tr"><span class="th" id="line2648">2648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flag&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2649">2649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++;&nbsp;multiple_object--&gt;(i+offset)&nbsp;=&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line2650">2650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2651">2651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Accepting&nbsp;it^&quot;;</span></span>
<span class="tr"><span class="th" id="line2652">2652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2653">2653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2654">2654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2655">2655</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2656">2656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2657">2657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Rejecting&nbsp;it^&quot;;</span></span>
<span class="tr"><span class="th" id="line2658">2658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2659">2659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2660">2660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2661">2661</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&lt;&nbsp;indef_wanted&nbsp;&amp;&amp;&nbsp;indef_wanted&nbsp;&lt;&nbsp;INDEF_ALL_WANTED)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2662">2662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etype&nbsp;=&nbsp;TOOFEW_PE;&nbsp;multi_wanted&nbsp;=&nbsp;indef_wanted;</span></span>
<span class="tr"><span class="th" id="line2663">2663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;Too&nbsp;few&nbsp;found^&quot;;</span></span>
<span class="tr"><span class="th" id="line2664">2664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi_had=i;</span></span>
<span class="tr"><span class="th" id="line2665">2665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2666">2666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2667">2667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;i+offset;</span></span>
<span class="tr"><span class="th" id="line2668">2668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi_context&nbsp;=&nbsp;context;</span></span>
<span class="tr"><span class="th" id="line2669">2669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2670">2670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)</span></span>
<span class="tr"><span class="th" id="line2671">2671</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Made&nbsp;multiple&nbsp;object&nbsp;of&nbsp;size&nbsp;&quot;,&nbsp;i,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2672">2672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2673">2673</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2674">2674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2675">2675</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2676">2676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)&nbsp;match_classes--&gt;i&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2677">2677</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2678">2678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2679">2679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line2680">2680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_classes--&gt;i&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2681">2681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_classes--&gt;i&nbsp;=&nbsp;n++;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2682">2682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=i+1&nbsp;:&nbsp;j&lt;number_matched&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line2683">2683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_classes--&gt;j&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;Identical(match_list--&gt;i,&nbsp;match_list--&gt;j)&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2684">2684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag=1;</span></span>
<span class="tr"><span class="th" id="line2685">2685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_classes--&gt;j&nbsp;=&nbsp;match_classes--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2686">2686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2687">2687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flag&nbsp;==&nbsp;1)&nbsp;match_classes--&gt;i&nbsp;=&nbsp;1-n;</span></span>
<span class="tr"><span class="th" id="line2688">2688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2689">2689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n--;&nbsp;number_of_classes&nbsp;=&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line2690">2690</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2691">2691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2692">2692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2693">2693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Grouped&nbsp;into&nbsp;&quot;,&nbsp;n,&nbsp;&quot;&nbsp;possibilities&nbsp;by&nbsp;name:^&quot;;</span></span>
<span class="tr"><span class="th" id="line2694">2694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line2695">2695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_classes--&gt;i&nbsp;&gt;&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line2696">2696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&quot;,&nbsp;(The)&nbsp;match_list--&gt;i,&nbsp;&quot;&nbsp;(&quot;,&nbsp;match_list--&gt;i,&nbsp;&quot;)&nbsp;&nbsp;---&nbsp;&nbsp;group&nbsp;&quot;,</span></span>
<span class="tr"><span class="th" id="line2697">2697</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_classes--&gt;i,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2698">2698</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2699">2699</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2700">2700</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2701">2701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2702">2702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;&gt;&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2703">2703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2704">2704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2705">2705</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_scores--&gt;i&nbsp;&gt;&nbsp;k)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2706">2706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;match_scores--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2707">2707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;match_classes--&gt;i;&nbsp;j&nbsp;=&nbsp;j*j;</span></span>
<span class="tr"><span class="th" id="line2708">2708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2709">2709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2710">2710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line2711">2711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_scores--&gt;i&nbsp;==&nbsp;k)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2712">2712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((match_classes--&gt;i)&nbsp;*&nbsp;(match_classes--&gt;i)&nbsp;~=&nbsp;j)</span></span>
<span class="tr"><span class="th" id="line2713">2713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2714">2714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2715">2715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2716">2716</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2717">2717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flag)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2718">2718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2719">2719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Unable&nbsp;to&nbsp;choose&nbsp;best&nbsp;group,&nbsp;so&nbsp;ask&nbsp;player.]^&quot;;</span></span>
<span class="tr"><span class="th" id="line2720">2720</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2721">2721</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2722">2722</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2723">2723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2724">2724</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Best&nbsp;choices&nbsp;are&nbsp;all&nbsp;from&nbsp;the&nbsp;same&nbsp;group.^&quot;;</span></span>
<span class="tr"><span class="th" id="line2725">2725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2726">2726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2727">2727</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2728">2728</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2729">2729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;When&nbsp;the&nbsp;player&nbsp;is&nbsp;really&nbsp;vague,&nbsp;or&nbsp;there&#39;s&nbsp;a&nbsp;single&nbsp;collection&nbsp;of</span></span>
<span class="tr"><span class="th" id="line2730">2730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;indistinguishable&nbsp;objects&nbsp;to&nbsp;choose&nbsp;from,&nbsp;choose&nbsp;the&nbsp;one&nbsp;the&nbsp;player</span></span>
<span class="tr"><span class="th" id="line2731">2731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;most&nbsp;recently&nbsp;acquired,&nbsp;or&nbsp;if&nbsp;the&nbsp;player&nbsp;has&nbsp;none&nbsp;of&nbsp;them,&nbsp;then</span></span>
<span class="tr"><span class="th" id="line2732">2732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;the&nbsp;one&nbsp;most&nbsp;recently&nbsp;put&nbsp;where&nbsp;it&nbsp;is.</span></span>
<span class="tr"><span class="th" id="line2733">2733</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2734">2734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n&nbsp;==&nbsp;1)&nbsp;dont_infer&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line2735">2735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;BestGuess();</span></span>
<span class="tr"><span class="th" id="line2736">2736</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2737">2737</span><span class="td">];&nbsp;!&nbsp;Adjudicate</span></span>
</div><div class='text'>
<h3>ReviseMulti.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line2746">ReviseMulti</a></span> revises the multiple object which already exists, in the light of information which has come along since then (i.e., the second parameter).  It returns a parser error number, or else 0 if all is well. This only ever throws things out, never adds new ones.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2746">2746</span><span class="td">[&nbsp;ReviseMulti&nbsp;second_p&nbsp;&nbsp;i&nbsp;low;</span></span>
<span class="tr"><span class="th" id="line2747">2747</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2748">2748</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)</span></span>
<span class="tr"><span class="th" id="line2749">2749</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Revising&nbsp;multiple&nbsp;object&nbsp;list&nbsp;of&nbsp;size&nbsp;&quot;,&nbsp;multiple_object--&gt;0,</span></span>
<span class="tr"><span class="th" id="line2750">2750</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;with&nbsp;2nd&nbsp;&quot;,&nbsp;(name)&nbsp;second_p,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2751">2751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2752">2752</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2753">2753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(multi_context&nbsp;==&nbsp;MULTIEXCEPT_TOKEN&nbsp;or&nbsp;MULTIINSIDE_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2754">2754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=1,low=0&nbsp;:&nbsp;i&lt;=multiple_object--&gt;0&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2755">2755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;(multi_context==MULTIEXCEPT_TOKEN&nbsp;&amp;&amp;&nbsp;multiple_object--&gt;i&nbsp;~=&nbsp;second_p)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line2756">2756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(multi_context==MULTIINSIDE_TOKEN&nbsp;&amp;&amp;&nbsp;multiple_object--&gt;i&nbsp;in&nbsp;second_p))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2757">2757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;low++;</span></span>
<span class="tr"><span class="th" id="line2758">2758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;low&nbsp;=&nbsp;multiple_object--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2759">2759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2760">2760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2761">2761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;low;</span></span>
<span class="tr"><span class="th" id="line2762">2762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2763">2763</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2764">2764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(multi_context&nbsp;==&nbsp;MULTI_TOKEN&nbsp;&amp;&amp;&nbsp;action_to_be&nbsp;==&nbsp;##Take)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2765">2765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2766">2766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Token&nbsp;2&nbsp;plural&nbsp;case:&nbsp;number&nbsp;with&nbsp;actor&nbsp;&quot;,&nbsp;low,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2767">2767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2768">2768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(take_all_rule&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2769">2769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=1,low=0&nbsp;:&nbsp;i&lt;=multiple_object--&gt;0&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2770">2770</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ScopeCeiling(multiple_object--&gt;i)&nbsp;==&nbsp;ScopeCeiling(actor))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2771">2771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;low++;</span></span>
<span class="tr"><span class="th" id="line2772">2772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;low&nbsp;=&nbsp;multiple_object--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2773">2773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2774">2774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2775">2775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;low;</span></span>
<span class="tr"><span class="th" id="line2776">2776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2777">2777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2778">2778</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2779">2779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line2780">2780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2781">2781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Done:&nbsp;new&nbsp;size&nbsp;&quot;,&nbsp;i,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2782">2782</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2783">2783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;0)&nbsp;return&nbsp;NOTHING_PE;</span></span>
<span class="tr"><span class="th" id="line2784">2784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2785">2785</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Match List.</h3><p><p> The match list is an array, <span class="fixed">match_list--&gt;</span>, which holds the current best guesses at what object(s) a portion of the command refers to. The global <span class="fixed"><a href="./Parser.i6t.html#line120">number_matched</a></span> is set to the current length of the <span class="fixed">match_list</span>.<p></p><p> When the parser sees a possible match of object <span class="fixed">obj</span> at quality level <span class="fixed">q</span>, it calls <span class="fixed"><a href="./Parser.i6t.html#line2810">MakeMatch(obj, q)</a></span>. If this is the best quality match so far, then we wipe out all the previous matches and start a new list with this one. If it&#39;s only as good as the best so far, we add it to the list (provided we haven&#39;t run out of space, and provided it isn&#39;t in the list already). If it&#39;s worse, we ignore it altogether.<p></p><p> I6 tokens in the form <span class="fixed">noun=Filter</span> or <span class="fixed">Attribute</span> are &quot;noun filter tokens&quot;, and mean that the match list should be filtered to accept only nouns which are acceptable to the given routine, or have the given attribute. Such a token is in force if <span class="fixed"><a href="./Parser.i6t.html#line72">token_filter</a></span> is used. (I7 makes no use of this in the attribute case, which is deprecated nowadays.)<p></p><p> Quality is essentially the number of words in the command referring to the object: the idea is that &quot;red panic button&quot; is better than &quot;red button&quot; or &quot;panic&quot;.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2810">2810</span><span class="td">[&nbsp;MakeMatch&nbsp;obj&nbsp;quality&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2811">2811</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2812">2812</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;6)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;Match&nbsp;with&nbsp;quality&nbsp;&quot;,quality,&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2813">2813</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2814">2814</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token_filter&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;ConsultNounFilterToken(obj)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2815">2815</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2816">2816</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;6)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;Match&nbsp;filtered&nbsp;out:&nbsp;token&nbsp;filter&nbsp;&quot;,&nbsp;token_filter,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line2817">2817</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2818">2818</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2819">2819</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2820">2820</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(quality&nbsp;&lt;&nbsp;match_length)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2821">2821</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(quality&nbsp;&gt;&nbsp;match_length)&nbsp;{&nbsp;match_length&nbsp;=&nbsp;quality;&nbsp;number_matched&nbsp;=&nbsp;0;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2822">2822</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2823">2823</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(number_matched&nbsp;&gt;=&nbsp;MATCH_LIST_WORDS)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2824">2824</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line2825">2825</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_list--&gt;i&nbsp;==&nbsp;obj)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2826">2826</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2827">2827</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;match_list--&gt;number_matched++&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line2828">2828</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2829">2829</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;6)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;Match&nbsp;added&nbsp;to&nbsp;list^&quot;;</span></span>
<span class="tr"><span class="th" id="line2830">2830</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2831">2831</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line2832">2832</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2833">2833</span><span class="td">[&nbsp;ConsultNounFilterToken&nbsp;obj&nbsp;sn&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line2834">2834</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token_filter&nbsp;ofclass&nbsp;Routine)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2835">2835</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sn&nbsp;=&nbsp;noun;</span></span>
<span class="tr"><span class="th" id="line2836">2836</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noun&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line2837">2837</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;indirect(token_filter);</span></span>
<span class="tr"><span class="th" id="line2838">2838</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noun&nbsp;=&nbsp;sn;</span></span>
<span class="tr"><span class="th" id="line2839">2839</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line2840">2840</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2841">2841</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;(token_filter-1))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line2842">2842</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line2843">2843</span><span class="td">];</span></span>
</div><div class='text'>
<h3>ScoreMatchL.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line2865">ScoreMatchL</a></span> scores the match list for quality in terms of what the player has vaguely asked for. Points are awarded for conforming with requirements like &quot;my&quot;, and so on. Remove from the match list any entries which fail the basic requirements of the descriptors. (The scoring system used to evaluate the possibilities is discussed in detail in the DM4.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2853">2853</span><span class="td">Constant&nbsp;SCORE__CHOOSEOBJ&nbsp;=&nbsp;1000;</span></span>
<span class="tr"><span class="th" id="line2854">2854</span><span class="td">Constant&nbsp;SCORE__IFGOOD&nbsp;=&nbsp;500;</span></span>
<span class="tr"><span class="th" id="line2855">2855</span><span class="td">Constant&nbsp;SCORE__UNCONCEALED&nbsp;=&nbsp;100;</span></span>
<span class="tr"><span class="th" id="line2856">2856</span><span class="td">Constant&nbsp;SCORE__BESTLOC&nbsp;=&nbsp;60;</span></span>
<span class="tr"><span class="th" id="line2857">2857</span><span class="td">Constant&nbsp;SCORE__NEXTBESTLOC&nbsp;=&nbsp;40;</span></span>
<span class="tr"><span class="th" id="line2858">2858</span><span class="td">Constant&nbsp;SCORE__NOTCOMPASS&nbsp;=&nbsp;20;</span></span>
<span class="tr"><span class="th" id="line2859">2859</span><span class="td">Constant&nbsp;SCORE__NOTSCENERY&nbsp;=&nbsp;10;</span></span>
<span class="tr"><span class="th" id="line2860">2860</span><span class="td">Constant&nbsp;SCORE__NOTACTOR&nbsp;=&nbsp;5;</span></span>
<span class="tr"><span class="th" id="line2861">2861</span><span class="td">Constant&nbsp;SCORE__GNA&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line2862">2862</span><span class="td">Constant&nbsp;SCORE__DIVISOR&nbsp;=&nbsp;20;</span></span>
<span class="tr"><span class="th" id="line2863">2863</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2864">2864</span><span class="td">Constant&nbsp;PREFER_HELD;</span></span>
<span class="tr"><span class="th" id="line2865">2865</span><span class="td">[&nbsp;ScoreMatchL&nbsp;context&nbsp;its_owner&nbsp;its_score&nbsp;obj&nbsp;i&nbsp;j&nbsp;threshold&nbsp;met&nbsp;a_s&nbsp;l_s;</span></span>
<span class="tr"><span class="th" id="line2866">2866</span><span class="td">!&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;OTHER_BIT&nbsp;~=&nbsp;0)&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line2867">2867</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;MY_BIT&nbsp;~=&nbsp;0)&nbsp;&nbsp;&nbsp;&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line2868">2868</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;THAT_BIT&nbsp;~=&nbsp;0)&nbsp;&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line2869">2869</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;LIT_BIT&nbsp;~=&nbsp;0)&nbsp;&nbsp;&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line2870">2870</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;UNLIT_BIT&nbsp;~=&nbsp;0)&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line2871">2871</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_owner&nbsp;~=&nbsp;nothing)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line2872">2872</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2873">2873</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2874">2874</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Scoring&nbsp;match&nbsp;list:&nbsp;indef&nbsp;mode&nbsp;&quot;,&nbsp;indef_mode,&nbsp;&quot;&nbsp;type&nbsp;&quot;,</span></span>
<span class="tr"><span class="th" id="line2875">2875</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_type,&nbsp;&quot;,&nbsp;satisfying&nbsp;&quot;,&nbsp;threshold,&nbsp;&quot;&nbsp;requirements:^&quot;;</span></span>
<span class="tr"><span class="th" id="line2876">2876</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2877">2877</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2878">2878</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#ifdef&nbsp;PREFER_HELD;</span></span>
<span class="tr"><span class="th" id="line2879">2879</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;a_s&nbsp;=&nbsp;SCORE__BESTLOC;&nbsp;l_s&nbsp;=&nbsp;SCORE__NEXTBESTLOC;</span></span>
<span class="tr"><span class="th" id="line2880">2880</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(action_to_be&nbsp;==&nbsp;##Take&nbsp;or&nbsp;##Remove)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2881">2881</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_s&nbsp;=&nbsp;SCORE__NEXTBESTLOC;&nbsp;l_s&nbsp;=&nbsp;SCORE__BESTLOC;</span></span>
<span class="tr"><span class="th" id="line2882">2882</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2883">2883</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;context&nbsp;=&nbsp;context;&nbsp;&nbsp;!&nbsp;silence&nbsp;warning</span></span>
<span class="tr"><span class="th" id="line2884">2884</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#ifnot;</span></span>
<span class="tr"><span class="th" id="line2885">2885</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;a_s&nbsp;=&nbsp;SCORE__NEXTBESTLOC;&nbsp;l_s&nbsp;=&nbsp;SCORE__BESTLOC;</span></span>
<span class="tr"><span class="th" id="line2886">2886</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(context&nbsp;==&nbsp;HELD_TOKEN&nbsp;or&nbsp;MULTIHELD_TOKEN&nbsp;or&nbsp;MULTIEXCEPT_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2887">2887</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a_s&nbsp;=&nbsp;SCORE__BESTLOC;&nbsp;l_s&nbsp;=&nbsp;SCORE__NEXTBESTLOC;</span></span>
<span class="tr"><span class="th" id="line2888">2888</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2889">2889</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#endif;&nbsp;!&nbsp;PREFER_HELD</span></span>
<span class="tr"><span class="th" id="line2890">2890</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2891">2891</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2892">2892</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;match_list--&gt;i;&nbsp;its_owner&nbsp;=&nbsp;parent(obj);&nbsp;its_score=0;&nbsp;met=0;</span></span>
<span class="tr"><span class="th" id="line2893">2893</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2894">2894</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;OTHER_BIT&nbsp;~=&nbsp;0</span></span>
<span class="tr"><span class="th" id="line2895">2895</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;&nbsp;obj&nbsp;~=&nbsp;itobj&nbsp;or&nbsp;himobj&nbsp;or&nbsp;herobj)&nbsp;met++;</span></span>
<span class="tr"><span class="th" id="line2896">2896</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;MY_BIT&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;its_owner&nbsp;==&nbsp;actor)&nbsp;met++;</span></span>
<span class="tr"><span class="th" id="line2897">2897</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;THAT_BIT&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;its_owner&nbsp;==&nbsp;actors_location)&nbsp;met++;</span></span>
<span class="tr"><span class="th" id="line2898">2898</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;LIT_BIT&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;obj&nbsp;has&nbsp;light)&nbsp;met++;</span></span>
<span class="tr"><span class="th" id="line2899">2899</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_type&nbsp;&amp;&nbsp;UNLIT_BIT&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;obj&nbsp;hasnt&nbsp;light)&nbsp;met++;</span></span>
<span class="tr"><span class="th" id="line2900">2900</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_owner&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;its_owner&nbsp;==&nbsp;indef_owner)&nbsp;met++;</span></span>
<span class="tr"><span class="th" id="line2901">2901</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2902">2902</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(met&nbsp;&lt;&nbsp;threshold)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2903">2903</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2904">2904</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)</span></span>
<span class="tr"><span class="th" id="line2905">2905</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&quot;,&nbsp;(The)&nbsp;match_list--&gt;i,&nbsp;&quot;&nbsp;(&quot;,&nbsp;match_list--&gt;i,&nbsp;&quot;)&nbsp;in&nbsp;&quot;,</span></span>
<span class="tr"><span class="th" id="line2906">2906</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(the)&nbsp;its_owner,&nbsp;&quot;&nbsp;is&nbsp;rejected&nbsp;(doesn&#39;t&nbsp;match&nbsp;descriptors)^&quot;;</span></span>
<span class="tr"><span class="th" id="line2907">2907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2908">2908</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_list--&gt;i&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2909">2909</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2910">2910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2911">2911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;its_score&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line2912">2912</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;hasnt&nbsp;concealed)&nbsp;its_score&nbsp;=&nbsp;SCORE__UNCONCEALED;</span></span>
<span class="tr"><span class="th" id="line2913">2913</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2914">2914</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(its_owner&nbsp;==&nbsp;actor)&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;a_s;</span></span>
<span class="tr"><span class="th" id="line2915">2915</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line2916">2916</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(its_owner&nbsp;==&nbsp;actors_location)&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;l_s;</span></span>
<span class="tr"><span class="th" id="line2917">2917</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line2918">2918</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(its_owner&nbsp;~=&nbsp;compass)&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;SCORE__NOTCOMPASS;</span></span>
<span class="tr"><span class="th" id="line2919">2919</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2920">2920</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;SCORE__CHOOSEOBJ&nbsp;*&nbsp;ChooseObjects(obj,&nbsp;2);</span></span>
<span class="tr"><span class="th" id="line2921">2921</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2922">2922</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;hasnt&nbsp;scenery)&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;SCORE__NOTSCENERY;</span></span>
<span class="tr"><span class="th" id="line2923">2923</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;~=&nbsp;actor)&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;SCORE__NOTACTOR;</span></span>
<span class="tr"><span class="th" id="line2924">2924</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2925">2925</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;A&nbsp;small&nbsp;bonus&nbsp;for&nbsp;having&nbsp;the&nbsp;correct&nbsp;GNA,</span></span>
<span class="tr"><span class="th" id="line2926">2926</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;for&nbsp;sorting&nbsp;out&nbsp;ambiguous&nbsp;articles&nbsp;and&nbsp;the&nbsp;like.</span></span>
<span class="tr"><span class="th" id="line2927">2927</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2928">2928</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_cases&nbsp;&amp;&nbsp;(PowersOfTwo_TB--&gt;(GetGNAOfObject(obj))))</span></span>
<span class="tr"><span class="th" id="line2929">2929</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;its_score&nbsp;=&nbsp;its_score&nbsp;+&nbsp;SCORE__GNA;</span></span>
<span class="tr"><span class="th" id="line2930">2930</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2931">2931</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_scores--&gt;i&nbsp;=&nbsp;match_scores--&gt;i&nbsp;+&nbsp;its_score;</span></span>
<span class="tr"><span class="th" id="line2932">2932</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2933">2933</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;,&nbsp;(The)&nbsp;match_list--&gt;i,&nbsp;&quot;&nbsp;(&quot;,&nbsp;match_list--&gt;i,</span></span>
<span class="tr"><span class="th" id="line2934">2934</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;)&nbsp;in&nbsp;&quot;,&nbsp;(the)&nbsp;its_owner,&nbsp;&quot;&nbsp;:&nbsp;&quot;,&nbsp;match_scores--&gt;i,&nbsp;&quot;&nbsp;points^&quot;;</span></span>
<span class="tr"><span class="th" id="line2935">2935</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2936">2936</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2937">2937</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2938">2938</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line2939">2939</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2940">2940</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(match_list--&gt;i&nbsp;==&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2941">2941</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;number_matched-1)&nbsp;{&nbsp;number_matched--;&nbsp;break;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2942">2942</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=i&nbsp;:&nbsp;j&lt;number_matched-1&nbsp;:&nbsp;j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2943">2943</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_list--&gt;j&nbsp;=&nbsp;match_list--&gt;(j+1);</span></span>
<span class="tr"><span class="th" id="line2944">2944</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match_scores--&gt;j&nbsp;=&nbsp;match_scores--&gt;(j+1);</span></span>
<span class="tr"><span class="th" id="line2945">2945</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2946">2946</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number_matched--;</span></span>
<span class="tr"><span class="th" id="line2947">2947</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2948">2948</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2949">2949</span><span class="td">];</span></span>
</div><div class='text'>
<h3>BestGuess.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line2958">BestGuess</a></span> makes the best guess it can out of the match list, assuming that everything in the match list is textually as good as everything else; however it ignores items marked as <em></em>, and so marks anything it chooses. It returns <em></em> if there are no possible choices.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2958">2958</span><span class="td">[&nbsp;BestGuess&nbsp;&nbsp;earliest&nbsp;its_score&nbsp;best&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2959">2959</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;earliest&nbsp;=&nbsp;0;&nbsp;best&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2960">2960</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2961">2961</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(match_list--&gt;i&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2962">2962</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;its_score&nbsp;=&nbsp;match_scores--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2963">2963</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(its_score&nbsp;&gt;&nbsp;best)&nbsp;{&nbsp;best&nbsp;=&nbsp;its_score;&nbsp;earliest&nbsp;=&nbsp;i;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2964">2964</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2965">2965</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2966">2966</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line2967">2967</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;4)</span></span>
<span class="tr"><span class="th" id="line2968">2968</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(best&nbsp;&lt;&nbsp;0)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Best&nbsp;guess&nbsp;ran&nbsp;out&nbsp;of&nbsp;choices^&quot;;</span></span>
<span class="tr"><span class="th" id="line2969">2969</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;Best&nbsp;guess&nbsp;&quot;,&nbsp;(the)&nbsp;match_list--&gt;earliest,</span></span>
<span class="tr"><span class="th" id="line2970">2970</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;(&quot;,&nbsp;match_list--&gt;earliest,&nbsp;&quot;)^&quot;;</span></span>
<span class="tr"><span class="th" id="line2971">2971</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line2972">2972</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(best&nbsp;&lt;&nbsp;0)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2973">2973</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;match_list--&gt;earliest;</span></span>
<span class="tr"><span class="th" id="line2974">2974</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;match_list--&gt;earliest&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2975">2975</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2976">2976</span><span class="td">];</span></span>
</div><div class='text'>
<h3>SingleBestGuess.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line2983">SingleBestGuess</a></span> returns the highest-scoring object in the match list if it is the clear winner, or returns <em></em> if there is no clear winner.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line2983">2983</span><span class="td">[&nbsp;SingleBestGuess&nbsp;&nbsp;earliest&nbsp;its_score&nbsp;best&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line2984">2984</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;earliest&nbsp;=&nbsp;-1;&nbsp;best&nbsp;=&nbsp;-1000;</span></span>
<span class="tr"><span class="th" id="line2985">2985</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;number_matched&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line2986">2986</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;its_score&nbsp;=&nbsp;match_scores--&gt;i;</span></span>
<span class="tr"><span class="th" id="line2987">2987</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(its_score&nbsp;==&nbsp;best)&nbsp;earliest&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line2988">2988</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(its_score&nbsp;&gt;&nbsp;best)&nbsp;{&nbsp;best&nbsp;=&nbsp;its_score;&nbsp;earliest&nbsp;=&nbsp;match_list--&gt;i;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2989">2989</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line2990">2990</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;earliest;</span></span>
<span class="tr"><span class="th" id="line2991">2991</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Identical.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3002">Identical</a></span> decides whether or not two objects can be distinguished from each other by anything the player can type. If not, it returns <span class="fixed">true</span>. (This routine is critical to the handling of plurals, and the list-writer requires it to be an equivalence relation between objects: but it is, because it is equivalent to <em></em> if and only if <em></em> for some function <em></em>.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3002">3002</span><span class="td">[&nbsp;Identical&nbsp;o1&nbsp;o2&nbsp;p1&nbsp;p2&nbsp;n1&nbsp;n2&nbsp;i&nbsp;j&nbsp;flag;</span></span>
<span class="tr"><span class="th" id="line3003">3003</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o1&nbsp;==&nbsp;o2)&nbsp;rtrue;&nbsp;&nbsp;!&nbsp;This&nbsp;should&nbsp;never&nbsp;happen,&nbsp;but&nbsp;to&nbsp;be&nbsp;on&nbsp;the&nbsp;safe&nbsp;side</span></span>
<span class="tr"><span class="th" id="line3004">3004</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o1&nbsp;==&nbsp;0&nbsp;||&nbsp;o2&nbsp;==&nbsp;0)&nbsp;rfalse;&nbsp;&nbsp;!&nbsp;Similarly</span></span>
<span class="tr"><span class="th" id="line3005">3005</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o1&nbsp;ofclass&nbsp;K3_direction&nbsp;||&nbsp;o2&nbsp;ofclass&nbsp;K3_direction)&nbsp;rfalse;&nbsp;!&nbsp;Saves&nbsp;time</span></span>
<span class="tr"><span class="th" id="line3006">3006</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3007">3007</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;What&nbsp;complicates&nbsp;things&nbsp;is&nbsp;that&nbsp;o1&nbsp;or&nbsp;o2&nbsp;might&nbsp;have&nbsp;a&nbsp;parsing&nbsp;routine,</span></span>
<span class="tr"><span class="th" id="line3008">3008</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;so&nbsp;the&nbsp;parser&nbsp;can&#39;t&nbsp;know&nbsp;from&nbsp;here&nbsp;whether&nbsp;they&nbsp;are&nbsp;or&nbsp;aren&#39;t&nbsp;the&nbsp;same.</span></span>
<span class="tr"><span class="th" id="line3009">3009</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;If&nbsp;they&nbsp;have&nbsp;different&nbsp;parsing&nbsp;routines,&nbsp;we&nbsp;simply&nbsp;assume&nbsp;they&#39;re</span></span>
<span class="tr"><span class="th" id="line3010">3010</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;different.&nbsp;&nbsp;If&nbsp;they&nbsp;have&nbsp;the&nbsp;same&nbsp;routine&nbsp;(which&nbsp;they&nbsp;probably&nbsp;got&nbsp;from</span></span>
<span class="tr"><span class="th" id="line3011">3011</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;a&nbsp;class&nbsp;definition)&nbsp;then&nbsp;the&nbsp;decision&nbsp;process&nbsp;is&nbsp;as&nbsp;follows:</span></span>
<span class="tr"><span class="th" id="line3012">3012</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!</span></span>
<span class="tr"><span class="th" id="line3013">3013</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;routine&nbsp;is&nbsp;called&nbsp;(with&nbsp;self&nbsp;being&nbsp;o1,&nbsp;not&nbsp;that&nbsp;it&nbsp;matters)</span></span>
<span class="tr"><span class="th" id="line3014">3014</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;noun&nbsp;and&nbsp;second&nbsp;being&nbsp;set&nbsp;to&nbsp;o1&nbsp;and&nbsp;o2,&nbsp;and&nbsp;action&nbsp;being&nbsp;set</span></span>
<span class="tr"><span class="th" id="line3015">3015</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;fake&nbsp;action&nbsp;TheSame.&nbsp;&nbsp;If&nbsp;it&nbsp;returns&nbsp;-1,&nbsp;they&nbsp;are&nbsp;found</span></span>
<span class="tr"><span class="th" id="line3016">3016</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;identical;&nbsp;if&nbsp;-2,&nbsp;different;&nbsp;and&nbsp;if&nbsp;&gt;=0,&nbsp;then&nbsp;the&nbsp;usual&nbsp;method</span></span>
<span class="tr"><span class="th" id="line3017">3017</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;used&nbsp;instead.</span></span>
<span class="tr"><span class="th" id="line3018">3018</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3019">3019</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o1.parse_name&nbsp;~=&nbsp;0&nbsp;||&nbsp;o2.parse_name&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3020">3020</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o1.parse_name&nbsp;~=&nbsp;o2.parse_name)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3021">3021</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_action&nbsp;=&nbsp;##TheSame;&nbsp;parser_one&nbsp;=&nbsp;o1;&nbsp;parser_two&nbsp;=&nbsp;o2;</span></span>
<span class="tr"><span class="th" id="line3022">3022</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;wn;&nbsp;i&nbsp;=&nbsp;RunRoutines(o1,parse_name);&nbsp;wn&nbsp;=&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line3023">3023</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;-1)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3024">3024</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;-2)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3025">3025</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3026">3026</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3027">3027</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;This&nbsp;is&nbsp;the&nbsp;default&nbsp;algorithm:&nbsp;do&nbsp;they&nbsp;have&nbsp;the&nbsp;same&nbsp;words&nbsp;in&nbsp;their</span></span>
<span class="tr"><span class="th" id="line3028">3028</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;&quot;name&quot;&nbsp;(i.e.&nbsp;property&nbsp;no.&nbsp;1)&nbsp;properties.&nbsp;&nbsp;(Note&nbsp;that&nbsp;the&nbsp;following&nbsp;allows</span></span>
<span class="tr"><span class="th" id="line3029">3029</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;for&nbsp;repeated&nbsp;words&nbsp;and&nbsp;words&nbsp;in&nbsp;different&nbsp;orders.)</span></span>
<span class="tr"><span class="th" id="line3030">3030</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3031">3031</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;p1&nbsp;=&nbsp;o1.&amp;1;&nbsp;n1&nbsp;=&nbsp;(o1.#1)/WORDSIZE;</span></span>
<span class="tr"><span class="th" id="line3032">3032</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;p2&nbsp;=&nbsp;o2.&amp;1;&nbsp;n2&nbsp;=&nbsp;(o2.#1)/WORDSIZE;</span></span>
<span class="tr"><span class="th" id="line3033">3033</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3034">3034</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;n1&nbsp;:&nbsp;i++)&nbsp;{&nbsp;print&nbsp;(address)&nbsp;p1--&gt;i,&nbsp;&quot;&nbsp;&quot;;&nbsp;}&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line3035">3035</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;n2&nbsp;:&nbsp;i++)&nbsp;{&nbsp;print&nbsp;(address)&nbsp;p2--&gt;i,&nbsp;&quot;&nbsp;&quot;;&nbsp;}&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line3036">3036</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3037">3037</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;n1&nbsp;:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3038">3038</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3039">3039</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=0&nbsp;:&nbsp;j&lt;n2&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line3040">3040</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(p1--&gt;i&nbsp;==&nbsp;p2--&gt;j)&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3041">3041</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flag&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3042">3042</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3043">3043</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3044">3044</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=0&nbsp;:&nbsp;j&lt;n2&nbsp;:&nbsp;j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3045">3045</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3046">3046</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;i&lt;n1&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line3047">3047</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(p1--&gt;i&nbsp;==&nbsp;p2--&gt;j)&nbsp;flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3048">3048</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flag&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3049">3049</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3050">3050</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3051">3051</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;&nbsp;print&nbsp;&quot;Which&nbsp;are&nbsp;identical!^&quot;;</span></span>
<span class="tr"><span class="th" id="line3052">3052</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3053">3053</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Print Command.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3091">PrintCommand</a></span> reconstructs the command as it presently reads, from the pattern which has been built up.<p></p><p> If <span class="fixed">from</span> is 0, it starts with the verb: then it goes through the pattern.<p></p><p> The other parameter is <span class="fixed">emptyf</span> &ndash; a flag: if 0, it goes up to <span class="fixed"><a href="./Parser.i6t.html#line35">pcount</a></span>: if 1, it goes up to <span class="fixed"><a href="./Parser.i6t.html#line35">pcount</a></span>-1.<p></p><p> Note that verbs and prepositions are printed out of the dictionary: and that since the dictionary may only preserve the first six characters of a word (in a V3 game), we have to hand-code the longer words needed. At present, I7 doesn&#39;t do this, but it probably should.<p></p><p> (Recall that pattern entries are 0 for &quot;multiple object&quot;, 1 for &quot;special word&quot;, 2 to <span class="fixed">REPARSE_CODE-1</span> are object numbers and <span class="fixed">REPARSE_CODE+n</span> means the preposition <span class="fixed">n</span>.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3074">3074</span><span class="td">[&nbsp;PrintInferredCommand&nbsp;from&nbsp;singleton_noun;</span></span>
<span class="tr"><span class="th" id="line3075">3075</span><span class="td">&nbsp;singleton_noun&nbsp;=&nbsp;FALSE;</span></span>
<span class="tr"><span class="th" id="line3076">3076</span><span class="td">&nbsp;if&nbsp;((from&nbsp;~=&nbsp;0)&nbsp;&amp;&amp;&nbsp;(from&nbsp;==&nbsp;pcount-1)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line3077">3077</span><span class="td">&nbsp;&nbsp;(pattern--&gt;from&nbsp;&gt;&nbsp;1)&nbsp;&amp;&amp;&nbsp;(pattern--&gt;from&nbsp;&lt;&nbsp;REPARSE_CODE))</span></span>
<span class="tr"><span class="th" id="line3078">3078</span><span class="td">&nbsp;&nbsp;&nbsp;singleton_noun&nbsp;=&nbsp;TRUE;</span></span>
<span class="tr"><span class="th" id="line3079">3079</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3080">3080</span><span class="td">&nbsp;if&nbsp;(singleton_noun)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3081">3081</span><span class="td">&nbsp;&nbsp;BeginActivity(CLARIFYING_PARSERS_CHOICE_ACT,&nbsp;pattern--&gt;from);</span></span>
<span class="tr"><span class="th" id="line3082">3082</span><span class="td">&nbsp;&nbsp;if&nbsp;(ForActivity(CLARIFYING_PARSERS_CHOICE_ACT,&nbsp;pattern--&gt;from)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3083">3083</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;(&quot;;&nbsp;PrintCommand(from);&nbsp;print&nbsp;&quot;)^&quot;;</span></span>
<span class="tr"><span class="th" id="line3084">3084</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3085">3085</span><span class="td">&nbsp;&nbsp;EndActivity(CLARIFYING_PARSERS_CHOICE_ACT,&nbsp;pattern--&gt;from);</span></span>
<span class="tr"><span class="th" id="line3086">3086</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3087">3087</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;(&quot;;&nbsp;PrintCommand(from);&nbsp;print&nbsp;&quot;)^&quot;;</span></span>
<span class="tr"><span class="th" id="line3088">3088</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3089">3089</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3090">3090</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3091">3091</span><span class="td">[&nbsp;PrintCommand&nbsp;from&nbsp;i&nbsp;k&nbsp;spacing_flag;</span></span>
<span class="tr"><span class="th" id="line3092">3092</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(from&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3093">3093</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;verb_word;</span></span>
<span class="tr"><span class="th" id="line3094">3094</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LanguageVerb(i)&nbsp;==&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line3095">3095</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(PrintVerb(i)&nbsp;==&nbsp;0)&nbsp;print&nbsp;(address)&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3096">3096</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from++;&nbsp;spacing_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line3097">3097</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3098">3098</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(k=from&nbsp;:&nbsp;k&lt;pcount&nbsp;:&nbsp;k++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3099">3099</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;pattern--&gt;k;</span></span>
<span class="tr"><span class="th" id="line3100">3100</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;PATTERN_NULL)&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line3101">3101</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(spacing_flag)&nbsp;print&nbsp;(char)&nbsp;&#39;&nbsp;&#39;;</span></span>
<span class="tr"><span class="th" id="line3102">3102</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;0)&nbsp;{&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;F&#39;);&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3111">TokenPrinted</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3103">3103</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;1)&nbsp;{&nbsp;PARSER_CLARIF_INTERNAL_RM(&#39;G&#39;);&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3111">TokenPrinted</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3104">3104</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&gt;=&nbsp;REPARSE_CODE)</span></span>
<span class="tr"><span class="th" id="line3105">3105</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(address)&nbsp;VM_NumberToDictionaryAddress(i-REPARSE_CODE);</span></span>
<span class="tr"><span class="th" id="line3106">3106</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line3107">3107</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;ofclass&nbsp;K3_direction)</span></span>
<span class="tr"><span class="th" id="line3108">3108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(LanguageDirection)&nbsp;i;&nbsp;!&nbsp;the&nbsp;direction&nbsp;name&nbsp;as&nbsp;adverb</span></span>
<span class="tr"><span class="th" id="line3109">3109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line3110">3110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(the)&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3111">3111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.TokenPrinted;</span></span>
<span class="tr"><span class="th" id="line3112">3112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spacing_flag&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line3113">3113</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3114">3114</span><span class="td">];</span></span>
</div><div class='text'>
<h3>CantSee.</h3><p><p> The <span class="fixed"><a href="./Parser.i6t.html#line3131">CantSee</a></span> routine returns a good error number for the situation where the last word looked at didn&#39;t seem to refer to any object in context.<p></p><p> The idea is that: if the actor is in a location (but not inside something like, for instance, a tank which is in that location) then an attempt to refer to one of the words listed as meaningful-but-irrelevant there will cause &quot;you don&#39;t need to refer to that in this game&quot; rather than &quot;no such thing&quot; or &quot;what&#39;s `it&#39;?&quot;.<p></p><p> (The advantage of not having looked at &quot;irrelevant&quot; local nouns until now is that it stops them from clogging up the ambiguity-resolving process. Thus game objects always triumph over scenery.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3131">3131</span><span class="td">[&nbsp;CantSee&nbsp;&nbsp;i&nbsp;w&nbsp;e;</span></span>
<span class="tr"><span class="th" id="line3132">3132</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;saved_oops=oops_from;</span></span>
<span class="tr"><span class="th" id="line3133">3133</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3134">3134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(scope_token&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3135">3135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_error&nbsp;=&nbsp;scope_token;&nbsp;return&nbsp;ASKSCOPE_PE;</span></span>
<span class="tr"><span class="th" id="line3136">3136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3137">3137</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3138">3138</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;wn--;&nbsp;w&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line3139">3139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;e&nbsp;=&nbsp;CANTSEE_PE;</span></span>
<span class="tr"><span class="th" id="line3140">3140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(w&nbsp;==&nbsp;pronoun_word)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3141">3141</span><span class="td">&nbsp;&nbsp;w&nbsp;=&nbsp;NextWordStopped();&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line3142">3142</span><span class="td">&nbsp;&nbsp;if&nbsp;((w&nbsp;==&nbsp;-1)&nbsp;||&nbsp;(line_token--&gt;(pcount)&nbsp;~=&nbsp;ENDIT_TOKEN))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3143">3143</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(pcount&nbsp;&gt;&nbsp;0)&nbsp;AnalyseToken(line_token--&gt;(pcount-1));</span></span>
<span class="tr"><span class="th" id="line3144">3144</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((pcount&nbsp;&gt;&nbsp;0)&nbsp;&amp;&amp;&nbsp;(found_ttype&nbsp;==&nbsp;ROUTINE_FILTER_TT&nbsp;or&nbsp;ATTR_FILTER_TT))</span></span>
<span class="tr"><span class="th" id="line3145">3145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;e&nbsp;=&nbsp;NOTINCONTEXT_PE;</span></span>
<span class="tr"><span class="th" id="line3146">3146</span><span class="td">&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3147">3147</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pronoun__word&nbsp;=&nbsp;pronoun_word;&nbsp;pronoun__obj&nbsp;=&nbsp;pronoun_obj;</span></span>
<span class="tr"><span class="th" id="line3148">3148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;e&nbsp;=&nbsp;ITGONE_PE;</span></span>
<span class="tr"><span class="th" id="line3149">3149</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3150">3150</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3151">3151</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3152">3152</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line3153">3153</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(etype&nbsp;&gt;&nbsp;e)&nbsp;return&nbsp;etype;</span></span>
<span class="tr"><span class="th" id="line3154">3154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;e;</span></span>
<span class="tr"><span class="th" id="line3155">3155</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Multiple Object List.</h3><p><p> The <span class="fixed"><a href="./Parser.i6t.html#line3171">MultiAdd</a></span> routine adds object <span class="fixed">o</span> to the multiple-object-list. This is only allowed to hold <span class="fixed">MATCH_LIST_WORDS</span> minus one objects at most, at which point it ignores any new entries (and sets a global flag so that a warning may later be printed if need be).<p></p><p> The <span class="fixed"><a href="./Parser.i6t.html#line3181">MultiSub</a></span> routine deletes object <span class="fixed">o</span> from the multiple-object-list. It returns 0 if the object was there in the first place, and 9 (because this is the appropriate error number in <span class="fixed">Parser</span>) if it wasn&#39;t.<p></p><p> The <span class="fixed"><a href="./Parser.i6t.html#line3192">MultiFilter</a></span> routine goes through the multiple-object-list and throws out anything without the given attribute <span class="fixed">attr</span> set.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3171">3171</span><span class="td">[&nbsp;MultiAdd&nbsp;o&nbsp;i&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line3172">3172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3173">3173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;MATCH_LIST_WORDS-1)&nbsp;{&nbsp;toomany_flag&nbsp;=&nbsp;1;&nbsp;rtrue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3174">3174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=1&nbsp;:&nbsp;j&lt;=i&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line3175">3175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;multiple_object--&gt;j)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3176">3176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i++;</span></span>
<span class="tr"><span class="th" id="line3177">3177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;i&nbsp;=&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line3178">3178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3179">3179</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3180">3180</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3181">3181</span><span class="td">[&nbsp;MultiSub&nbsp;o&nbsp;i&nbsp;j&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line3182">3182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3183">3183</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=1&nbsp;:&nbsp;j&lt;=i&nbsp;:&nbsp;j++)</span></span>
<span class="tr"><span class="th" id="line3184">3184</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;multiple_object--&gt;j)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3185">3185</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(k=j&nbsp;:&nbsp;k&lt;=i&nbsp;:&nbsp;k++)&nbsp;multiple_object--&gt;k&nbsp;=&nbsp;multiple_object--&gt;(k+1);</span></span>
<span class="tr"><span class="th" id="line3186">3186</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple_object--&gt;0&nbsp;=&nbsp;--i;</span></span>
<span class="tr"><span class="th" id="line3187">3187</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3188">3188</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3189">3189</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;VAGUE_PE;</span></span>
<span class="tr"><span class="th" id="line3190">3190</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3191">3191</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3192">3192</span><span class="td">[&nbsp;MultiFilter&nbsp;attr&nbsp;&nbsp;i&nbsp;j&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line3193">3193</span><span class="td">&nbsp;.MFiltl;</span></span>
<span class="tr"><span class="th" id="line3194">3194</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;multiple_object--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3195">3195</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=1&nbsp;:&nbsp;j&lt;=i&nbsp;:&nbsp;j++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3196">3196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o&nbsp;=&nbsp;multiple_object--&gt;j;</span></span>
<span class="tr"><span class="th" id="line3197">3197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;hasnt&nbsp;attr)&nbsp;{&nbsp;MultiSub(o);&nbsp;jump&nbsp;Mfiltl;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3198">3198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3199">3199</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Scope.</h3><p><p> The scope of an actor is the set of objects which he can refer to in typed commands, which is normally the same as the set of visible objects; but this can be modified. This is how I7 handles tokens like &quot;[any room]&quot;.<p></p><p> Scope determination is done by calling <span class="fixed"><a href="./Parser.i6t.html#line3332">SearchScope</a></span> to iterate through the objects in scope, and &quot;visit&quot; each one: which means, carry out some task for each as we get there. The task depends on the current value of <span class="fixed"><a href="./Output.i6t.html#line289">scope_reason</a></span>, which is <span class="fixed"><a href="./Definitions.i6t.html#line493">PARSING_REASON</a></span> when the parser is matching command text against object names.<p></p><p> The scope machinery is built on a number of levels, each making use only of lower levels: (0) Either <span class="fixed"><a href="./Parser.i6t.html#line2104">NounDomain</a></span>, <span class="fixed"><a href="./Parser.i6t.html#line3270">TestScope</a></span> or <span class="fixed"><a href="./Parser.i6t.html#line3281">LoopOverScope</a></span> makes one or more calls to <span class="fixed"><a href="./Parser.i6t.html#line3332">SearchScope</a></span> (on level 1). The point of making multiple calls is to influence the order in which items in scope are visited, which improves the quality of &quot;take all&quot;-style multiple object lists, for instance. (1) <span class="fixed"><a href="./Parser.i6t.html#line3332">SearchScope</a></span> searches for the objects in scope which are within first one domain, and then another: for instance, first within the current room but not within the current actor, and then within the current actor. It can be called either from level 0, or externally from the choose-objects machinery, but is not recursive. It works within the context of a given token in the parser (when called for <span class="fixed"><a href="./Definitions.i6t.html#line493">PARSING_REASON</a></span>) and in particular the <span class="fixed">multiinside</span> token, and also handles testing commands, scope tokens, scope in darkness, and intervention by the I7 &quot;deciding the scope of&quot; activity. Most of its actual searches are delegated to <span class="fixed"><a href="./Parser.i6t.html#line3387">ScopeWithin</a></span> (level 2), but it also uses <span class="fixed"><a href="./Parser.i6t.html#line3415">DoScopeActionAndRecurse</a></span> (level 3) and <span class="fixed"><a href="./Parser.i6t.html#line3471">DoScopeAction</a></span> (level 4) as necessary. (2) <span class="fixed"><a href="./Parser.i6t.html#line3387">ScopeWithin</a></span> iterates through the objects in scope which are within one supplied domain, but not within another. It can be called either from level 1, or independently from rules in the &quot;deciding the scope of&quot; activity via the I7 &quot;place the contents of X in scope&quot; phrase. It calls <span class="fixed"><a href="./Parser.i6t.html#line3415">DoScopeActionAndRecurse</a></span> (level 3) on any unconcealed objects it finds. (3) <span class="fixed"><a href="./Parser.i6t.html#line3415">DoScopeActionAndRecurse</a></span> visits a given object by calling down to <span class="fixed"><a href="./Parser.i6t.html#line3471">DoScopeAction</a></span> (level 4), and recurses to all unconcealed object-tree contents and component parts of the object. The I7 phrase &quot;place X in scope&quot; uses this routine. (4) <span class="fixed"><a href="./Parser.i6t.html#line3471">DoScopeAction</a></span> simply visits a single object, taking whatever action is needed there &ndash; which will depend on the <span class="fixed"><a href="./Output.i6t.html#line289">scope_reason</a></span>. The only use made by the parser of <span class="fixed"><a href="./Parser.i6t.html#line3542">TryGivenObject</a></span>, which tries to match command text against the name of a given object, is from here. The I7 phrase &quot;place X in scope, but not its contents&quot; uses this routine.<p></p><p> Two routines are provided for code external to the parser to modify the scope. They should be called only during scope deliberations &ndash; i.e.,  in <span class="fixed">scope=...</span> tokens or in rules for the &quot;deciding the scope of&quot; activity. (At present, <span class="fixed"><a href="./Parser.i6t.html#line3260">AddToScope</a></span> is not used in I7 at all.) Note that this I7 form of <span class="fixed"><a href="./Parser.i6t.html#line3253">PlaceInScope</a></span> has a slightly different specification to its I6 library counterpart of the same name: it can place a room in scope. (In I6, room names were not normally parsed.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3253">3253</span><span class="td">[&nbsp;PlaceInScope&nbsp;O&nbsp;opts&nbsp;ws;&nbsp;!&nbsp;If&nbsp;opts&nbsp;is&nbsp;set,&nbsp;do&nbsp;not&nbsp;place&nbsp;contents&nbsp;in&nbsp;scope</span></span>
<span class="tr"><span class="th" id="line3254">3254</span><span class="td">&nbsp;ws&nbsp;=&nbsp;wn;&nbsp;wn&nbsp;=&nbsp;match_from;</span></span>
<span class="tr"><span class="th" id="line3255">3255</span><span class="td">&nbsp;if&nbsp;(opts&nbsp;==&nbsp;false)&nbsp;DoScopeActionAndRecurse(O);</span></span>
<span class="tr"><span class="th" id="line3256">3256</span><span class="td">&nbsp;else&nbsp;DoScopeAction(O);</span></span>
<span class="tr"><span class="th" id="line3257">3257</span><span class="td">&nbsp;wn&nbsp;=&nbsp;ws;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line3258">3258</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3259">3259</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3260">3260</span><span class="td">[&nbsp;AddToScope&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line3261">3261</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ats_flag&nbsp;&gt;=&nbsp;2)&nbsp;DoScopeActionAndRecurse(obj,&nbsp;0,&nbsp;ats_flag-2);</span></span>
<span class="tr"><span class="th" id="line3262">3262</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ats_flag&nbsp;==&nbsp;1)&nbsp;{&nbsp;if&nbsp;(HasLightSource(obj)==1)&nbsp;ats_hls&nbsp;=&nbsp;1;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3263">3263</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Scope Level 0.</h3><p><p> The two ways of starting up the scope machinery other than via the parser code above.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3270">3270</span><span class="td">[&nbsp;TestScope&nbsp;obj&nbsp;act&nbsp;a&nbsp;al&nbsp;sr&nbsp;x&nbsp;y;</span></span>
<span class="tr"><span class="th" id="line3271">3271</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;parser_one;&nbsp;y&nbsp;=&nbsp;parser_two;</span></span>
<span class="tr"><span class="th" id="line3272">3272</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;parser_one&nbsp;=&nbsp;obj;&nbsp;parser_two&nbsp;=&nbsp;0;&nbsp;a&nbsp;=&nbsp;actor;&nbsp;al&nbsp;=&nbsp;actors_location;</span></span>
<span class="tr"><span class="th" id="line3273">3273</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;sr&nbsp;=&nbsp;scope_reason;&nbsp;scope_reason&nbsp;=&nbsp;TESTSCOPE_REASON;</span></span>
<span class="tr"><span class="th" id="line3274">3274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(act&nbsp;==&nbsp;0)&nbsp;actor&nbsp;=&nbsp;player;&nbsp;else&nbsp;actor&nbsp;=&nbsp;act;</span></span>
<span class="tr"><span class="th" id="line3275">3275</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actors_location&nbsp;=&nbsp;ScopeCeiling(actor);</span></span>
<span class="tr"><span class="th" id="line3276">3276</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;SearchScope(actors_location,&nbsp;actor,&nbsp;0);&nbsp;scope_reason&nbsp;=&nbsp;sr;&nbsp;actor&nbsp;=&nbsp;a;</span></span>
<span class="tr"><span class="th" id="line3277">3277</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actors_location&nbsp;=&nbsp;al;&nbsp;parser_one&nbsp;=&nbsp;x;&nbsp;x&nbsp;=&nbsp;parser_two;&nbsp;parser_two&nbsp;=&nbsp;y;</span></span>
<span class="tr"><span class="th" id="line3278">3278</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3279">3279</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3280">3280</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3281">3281</span><span class="td">[&nbsp;LoopOverScope&nbsp;routine&nbsp;act&nbsp;x&nbsp;y&nbsp;a&nbsp;al;</span></span>
<span class="tr"><span class="th" id="line3282">3282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;parser_one;&nbsp;y&nbsp;=&nbsp;scope_reason;&nbsp;a&nbsp;=&nbsp;actor;&nbsp;al&nbsp;=&nbsp;actors_location;</span></span>
<span class="tr"><span class="th" id="line3283">3283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;parser_one&nbsp;=&nbsp;routine;</span></span>
<span class="tr"><span class="th" id="line3284">3284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(act&nbsp;==&nbsp;0)&nbsp;actor&nbsp;=&nbsp;player;&nbsp;else&nbsp;actor&nbsp;=&nbsp;act;</span></span>
<span class="tr"><span class="th" id="line3285">3285</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;actors_location&nbsp;=&nbsp;ScopeCeiling(actor);</span></span>
<span class="tr"><span class="th" id="line3286">3286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;scope_reason&nbsp;=&nbsp;LOOPOVERSCOPE_REASON;</span></span>
<span class="tr"><span class="th" id="line3287">3287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;SearchScope(actors_location,&nbsp;actor,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line3288">3288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;parser_one&nbsp;=&nbsp;x;&nbsp;scope_reason&nbsp;=&nbsp;y;&nbsp;actor&nbsp;=&nbsp;a;&nbsp;actors_location&nbsp;=&nbsp;al;</span></span>
<span class="tr"><span class="th" id="line3289">3289</span><span class="td">];</span></span>
</div><div class='text'>
<h3>SearchScope.</h3><p><p> Level 1. The method is: (a) If the context is a <span class="fixed">scope=...</span> token, then the search is delegated to &quot;stage 2&quot; of the scope routine. This was the old I6 way to override the searching behaviour: while users probably won&#39;t be using it any more, the template does, in order to give testing commands universal scope which is exempt from the activity below; and the NI compiler creates <span class="fixed">scope=...</span> tokens to handle Understand grammar such as &quot;[any room]&quot;. So the feature remains very much still in use. (b) The &quot;deciding the scope of&quot; activity is given the chance to intervene. This is the I7 way to override the searching behaviour, and is the one taken by users. (c) And otherwise: (-1) The I6 <span class="fixed">multiinside</span> token, used as the first noun of its grammar line, has as its scope all of the objects which are inside or on top of the <strong> second</strong> noun of the grammar line. This provides a neat scope for the ALL in a command like GET ALL FROM CUPBOARD, where the player clearly does not intend ALL to refer to the cupboard itself, for instance. The difficulty is that we don&#39;t yet know what the second object is, if we are parsing left to right. But the parser code above has taken care of all of that, and the <span class="fixed"><a href="./Output.i6t.html#line293">advance_warning</a></span> global is set to the object number of the second noun, or to <em></em> if that is not yet known. Note that we check that the contents are visible before adding them to scope, because otherwise an unscrupulous player could use such a command to detect the contents of an opaque locked box. If this rule applies, we skip (c.2), (c.3) and (c.4). (-2) For all other tokens except <span class="fixed">creature</span>, searching scope for the room holding the current actor always catches the compass directions unless a definite article has already been typed. (Thus OPEN THE EAST would match an object called &quot;east door&quot;, but not the compass direction &quot;east&quot;.) (-3) The contents of <span class="fixed">domain1</span> which are not contents of <span class="fixed">domain2</span> are placed in scope, and so are any component parts of <span class="fixed">domain1</span>. If <span class="fixed">domain1</span> is a container or supporter, it is placed in scope itself. (-4) The contents and component parts of <span class="fixed">domain2</span> are placed in scope. If <span class="fixed">domain2</span> is a container or supporter, it is placed in scope itself. (-5) In darkness, the actor and his component parts are in scope. If the actor is inside or on top of something, then that thing is also in scope. (This avoids a situation where the player gets into an opaque box, then pulls it closed from the inside, plunging himself into darkness, then types OPEN BOX only to be told that he can&#39;t see any such thing.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3332">3332</span><span class="td">[&nbsp;SearchScope&nbsp;domain1&nbsp;domain2&nbsp;context&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3333">3333</span><span class="td">&nbsp;if&nbsp;(domain1&nbsp;==&nbsp;0)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line3334">3334</span><span class="td">&nbsp;!&nbsp;(a)</span></span>
<span class="tr"><span class="th" id="line3335">3335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(scope_token)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3336">3336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scope_stage&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line3337">3337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line3338">3338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;[Scope&nbsp;routine&nbsp;called&nbsp;at&nbsp;stage&nbsp;2]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3339">3339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;</span></span>
<span class="tr"><span class="th" id="line3340">3340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indirect(scope_token)&nbsp;~=&nbsp;0)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3341">3341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3342">3342</span><span class="td">&nbsp;!&nbsp;(b)</span></span>
<span class="tr"><span class="th" id="line3343">3343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BeginActivity(DECIDING_SCOPE_ACT,&nbsp;actor);</span></span>
<span class="tr"><span class="th" id="line3344">3344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ForActivity(DECIDING_SCOPE_ACT,&nbsp;actor)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3345">3345</span><span class="td">&nbsp;&nbsp;!&nbsp;(c.1)</span></span>
<span class="tr"><span class="th" id="line3346">3346</span><span class="td">&nbsp;&nbsp;if&nbsp;((scope_reason&nbsp;==&nbsp;PARSING_REASON)&nbsp;&amp;&amp;&nbsp;(context&nbsp;==&nbsp;MULTIINSIDE_TOKEN)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line3347">3347</span><span class="td">&nbsp;&nbsp;&nbsp;(advance_warning&nbsp;~=&nbsp;-1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3348">3348</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(IsSeeThrough(advance_warning)&nbsp;==&nbsp;1)</span></span>
<span class="tr"><span class="th" id="line3349">3349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScopeWithin(advance_warning,&nbsp;0,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3350">3350</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3351">3351</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;(c.2)</span></span>
<span class="tr"><span class="th" id="line3352">3352</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((scope_reason&nbsp;==&nbsp;PARSING_REASON)&nbsp;&amp;&amp;&nbsp;(context&nbsp;~=&nbsp;CREATURE_TOKEN)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line3353">3353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(indef_mode&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(domain1&nbsp;==&nbsp;actors_location))</span></span>
<span class="tr"><span class="th" id="line3354">3354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScopeWithin(compass);</span></span>
<span class="tr"><span class="th" id="line3355">3355</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;(c.3)</span></span>
<span class="tr"><span class="th" id="line3356">3356</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(domain1&nbsp;has&nbsp;supporter&nbsp;or&nbsp;container)&nbsp;DoScopeAction(domain1);</span></span>
<span class="tr"><span class="th" id="line3357">3357</span><span class="td">&nbsp;&nbsp;&nbsp;ScopeWithin(domain1,&nbsp;domain2,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3358">3358</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;(c.4)</span></span>
<span class="tr"><span class="th" id="line3359">3359</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(domain2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3360">3360</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(domain2&nbsp;has&nbsp;supporter&nbsp;or&nbsp;container)&nbsp;DoScopeAction(domain2);</span></span>
<span class="tr"><span class="th" id="line3361">3361</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ScopeWithin(domain2,&nbsp;0,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3362">3362</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3363">3363</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3364">3364</span><span class="td">&nbsp;&nbsp;!&nbsp;(c.5)</span></span>
<span class="tr"><span class="th" id="line3365">3365</span><span class="td">&nbsp;&nbsp;if&nbsp;(thedark&nbsp;==&nbsp;domain1&nbsp;or&nbsp;domain2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3366">3366</span><span class="td">&nbsp;&nbsp;&nbsp;DoScopeActionAndRecurse(actor,&nbsp;actor,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3367">3367</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(parent(actor)&nbsp;has&nbsp;supporter&nbsp;or&nbsp;container)</span></span>
<span class="tr"><span class="th" id="line3368">3368</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;DoScopeActionAndRecurse(parent(actor),&nbsp;parent(actor),&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3369">3369</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3370">3370</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3371">3371</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(DECIDING_SCOPE_ACT,&nbsp;actor);</span></span>
<span class="tr"><span class="th" id="line3372">3372</span><span class="td">];</span></span>
</div><div class='text'>
<h3>ScopeWithin.</h3><p><p> Level 2. <span class="fixed"><a href="./Parser.i6t.html#line3387">ScopeWithin</a></span> puts objects visible from within the <span class="fixed">domain</span> into scope. An item belonging to the <span class="fixed">domain</span> is placed in scope unless it is being concealed by the <span class="fixed">domain</span>: and even then, if the <span class="fixed">domain</span> is the current actor. Suppose Zorro conceals a book beneath his cloak: then the book is not in scope to his lady friend The Black Whip, but it is in scope to Zorro himself. (Thus an actor is not allowed to conceal anything from himself.)<p></p><p> Note that the <span class="fixed">domain</span> object itself, and its component parts if any, are not placed in scope by this routine, though nothing prevents some other code doing so.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3387">3387</span><span class="td">[&nbsp;ScopeWithin&nbsp;domain&nbsp;nosearch&nbsp;context&nbsp;obj&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line3388">3388</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(domain&nbsp;==&nbsp;0)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3389">3389</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3390">3390</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Look&nbsp;through&nbsp;the&nbsp;objects&nbsp;in&nbsp;the&nbsp;domain,&nbsp;avoiding&nbsp;&quot;objectloop&quot;&nbsp;in&nbsp;case</span></span>
<span class="tr"><span class="th" id="line3391">3391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;movements&nbsp;occur.</span></span>
<span class="tr"><span class="th" id="line3392">3392</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;child(domain);</span></span>
<span class="tr"><span class="th" id="line3393">3393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(obj)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3394">3394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_obj&nbsp;=&nbsp;sibling(obj);</span></span>
<span class="tr"><span class="th" id="line3395">3395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((domain&nbsp;==&nbsp;actor)&nbsp;||&nbsp;(TestConcealment(domain,&nbsp;obj)&nbsp;==&nbsp;false))</span></span>
<span class="tr"><span class="th" id="line3396">3396</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoScopeActionAndRecurse(obj,&nbsp;nosearch,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3397">3397</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line3398">3398</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3399">3399</span><span class="td">];</span></span>
</div><div class='text'>
<h3>DoScopeActionAndRecurse.</h3><p><p> Level 3. In all cases, the <span class="fixed">domain</span> itself is visited. There are then three possible forms of recursion: (a) To unconcealed objects which are inside, on top of, carried or worn by the <span class="fixed">domain</span>: this is called &quot;searching&quot; in traditional I6 language and is suppressed if <span class="fixed">domain</span> is the special value <span class="fixed">nosearch</span>. (b) To unconcealed component parts of the <span class="fixed">domain</span>. (c) To any other objects listed in the <span class="fixed">add_to_scope</span> property array, or supplied by the <span class="fixed">add_to_scope</span> property routine, if it has one. (I7 does not usually use <span class="fixed">add_to_scope</span>, but it remains a useful hook in the parser, so it retains its old I6 library interpretation.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3415">3415</span><span class="td">[&nbsp;DoScopeActionAndRecurse&nbsp;domain&nbsp;nosearch&nbsp;context&nbsp;i&nbsp;ad&nbsp;n&nbsp;obj&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line3416">3416</span><span class="td">&nbsp;DoScopeAction(domain);</span></span>
<span class="tr"><span class="th" id="line3417">3417</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3418">3418</span><span class="td">&nbsp;&nbsp;!&nbsp;(a)</span></span>
<span class="tr"><span class="th" id="line3419">3419</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((domain&nbsp;~=&nbsp;nosearch)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line3420">3420</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((domain&nbsp;ofclass&nbsp;K1_room&nbsp;or&nbsp;K8_person)&nbsp;||&nbsp;(IsSeeThrough(domain)&nbsp;==&nbsp;1)))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3421">3421</span><span class="td">&nbsp;&nbsp;obj&nbsp;=&nbsp;child(domain);</span></span>
<span class="tr"><span class="th" id="line3422">3422</span><span class="td">&nbsp;&nbsp;while&nbsp;(obj)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3423">3423</span><span class="td">&nbsp;&nbsp;&nbsp;next_obj&nbsp;=&nbsp;sibling(obj);</span></span>
<span class="tr"><span class="th" id="line3424">3424</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((domain&nbsp;==&nbsp;actor)&nbsp;||&nbsp;(TestConcealment(domain,&nbsp;obj)&nbsp;==&nbsp;false))</span></span>
<span class="tr"><span class="th" id="line3425">3425</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;DoScopeActionAndRecurse(obj,&nbsp;nosearch,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3426">3426</span><span class="td">&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line3427">3427</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3428">3428</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3429">3429</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3430">3430</span><span class="td">&nbsp;!&nbsp;(b)</span></span>
<span class="tr"><span class="th" id="line3431">3431</span><span class="td">&nbsp;if&nbsp;(domain&nbsp;provides&nbsp;component_child)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3432">3432</span><span class="td">&nbsp;&nbsp;obj&nbsp;=&nbsp;domain.component_child;</span></span>
<span class="tr"><span class="th" id="line3433">3433</span><span class="td">&nbsp;&nbsp;while&nbsp;(obj)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3434">3434</span><span class="td">&nbsp;&nbsp;&nbsp;next_obj&nbsp;=&nbsp;obj.component_sibling;</span></span>
<span class="tr"><span class="th" id="line3435">3435</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((domain&nbsp;==&nbsp;actor)&nbsp;||&nbsp;(TestConcealment(domain,&nbsp;obj)&nbsp;==&nbsp;false))</span></span>
<span class="tr"><span class="th" id="line3436">3436</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;DoScopeActionAndRecurse(obj,&nbsp;0,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3437">3437</span><span class="td">&nbsp;&nbsp;&nbsp;obj&nbsp;=&nbsp;next_obj;</span></span>
<span class="tr"><span class="th" id="line3438">3438</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3439">3439</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3440">3440</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3441">3441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;(c)</span></span>
<span class="tr"><span class="th" id="line3442">3442</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ad&nbsp;=&nbsp;domain.&amp;add_to_scope;</span></span>
<span class="tr"><span class="th" id="line3443">3443</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ad&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3444">3444</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Test&nbsp;if&nbsp;the&nbsp;property&nbsp;value&nbsp;is&nbsp;not&nbsp;an&nbsp;object.</span></span>
<span class="tr"><span class="th" id="line3445">3445</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line3446">3446</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;(UnsignedCompare(ad--&gt;0,&nbsp;top_object)&nbsp;&gt;&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line3447">3447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line3448">3448</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;(((ad--&gt;0)-&gt;0)&nbsp;~=&nbsp;$70);</span></span>
<span class="tr"><span class="th" id="line3449">3449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line3450">3450</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3451">3451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3452">3452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ats_flag&nbsp;=&nbsp;2+context;</span></span>
<span class="tr"><span class="th" id="line3453">3453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunRoutines(domain,&nbsp;add_to_scope);</span></span>
<span class="tr"><span class="th" id="line3454">3454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ats_flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3455">3455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3456">3456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3457">3457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;domain.#add_to_scope;</span></span>
<span class="tr"><span class="th" id="line3458">3458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0&nbsp;:&nbsp;(WORDSIZE*i)&lt;n&nbsp;:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line3459">3459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ad--&gt;i)</span></span>
<span class="tr"><span class="th" id="line3460">3460</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoScopeActionAndRecurse(ad--&gt;i,&nbsp;0,&nbsp;context);</span></span>
<span class="tr"><span class="th" id="line3461">3461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3462">3462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3463">3463</span><span class="td">];</span></span>
</div><div class='text'>
<h3>DoScopeAction.</h3><p><p> Level 4. This is where we take whatever action is to be performed as the &quot;visit&quot; to each scoped object, and it&#39;s the bottom at last of the scope mechanism.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3471">3471</span><span class="td">[&nbsp;DoScopeAction&nbsp;item;</span></span>
<span class="tr"><span class="th" id="line3472">3472</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3473">3473</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line3474">3474</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;6)</span></span>
<span class="tr"><span class="th" id="line3475">3475</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[DSA&nbsp;on&nbsp;&quot;,&nbsp;(the)&nbsp;item,&nbsp;&quot;&nbsp;with&nbsp;reason&nbsp;=&nbsp;&quot;,&nbsp;scope_reason,</span></span>
<span class="tr"><span class="th" id="line3476">3476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&nbsp;p1&nbsp;=&nbsp;&quot;,&nbsp;parser_one,&nbsp;&quot;&nbsp;p2&nbsp;=&nbsp;&quot;,&nbsp;parser_two,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3477">3477</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line3478">3478</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3479">3479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@push&nbsp;parser_one;&nbsp;@push&nbsp;scope_reason;</span></span>
<span class="tr"><span class="th" id="line3480">3480</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3481">3481</span><span class="td">&nbsp;switch(scope_reason)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3482">3482</span><span class="td">&nbsp;&nbsp;TESTSCOPE_REASON:&nbsp;if&nbsp;(item&nbsp;==&nbsp;parser_one)&nbsp;parser_two&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3483">3483</span><span class="td">&nbsp;&nbsp;LOOPOVERSCOPE_REASON:&nbsp;if&nbsp;(parser_one&nbsp;ofclass&nbsp;Routine)&nbsp;indirect(parser_one,&nbsp;item);</span></span>
<span class="tr"><span class="th" id="line3484">3484</span><span class="td">&nbsp;&nbsp;PARSING_REASON,&nbsp;TALKING_REASON:&nbsp;MatchTextAgainstObject(item);</span></span>
<span class="tr"><span class="th" id="line3485">3485</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3486">3486</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3487">3487</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;@pull&nbsp;scope_reason;&nbsp;@pull&nbsp;parser_one;</span></span>
<span class="tr"><span class="th" id="line3488">3488</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Parsing Object Names.</h3><p><p> We now reach the final major block of code in the parser: the part which tries to match a given object&#39;s name(s) against the text at word position <span class="fixed"><a href="./Parser.i6t.html#line123">match_from</a></span> in the player&#39;s command, and calls <span class="fixed"><a href="./Parser.i6t.html#line2810">MakeMatch</a></span> if it succeeds. There are basically four possibilities: ME, a pronoun such as IT, a name which doesn&#39;t begin misleadingly with a number, and a name which does. In the latter two cases, we pass the job down to <span class="fixed"><a href="./Parser.i6t.html#line3542">TryGivenObject</a></span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3499">3499</span><span class="td">[&nbsp;MatchTextAgainstObject&nbsp;item&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3500">3500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token_filter&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;ConsultNounFilterToken(item)&nbsp;==&nbsp;0)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line3501">3501</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3502">3502</span><span class="td">&nbsp;if&nbsp;(match_from&nbsp;&lt;=&nbsp;num_words)&nbsp;{&nbsp;!&nbsp;If&nbsp;there&#39;s&nbsp;any&nbsp;text&nbsp;to&nbsp;match,&nbsp;that&nbsp;is</span></span>
<span class="tr"><span class="th" id="line3503">3503</span><span class="td">&nbsp;&nbsp;wn&nbsp;=&nbsp;match_from;</span></span>
<span class="tr"><span class="th" id="line3504">3504</span><span class="td">&nbsp;&nbsp;i&nbsp;=&nbsp;NounWord();</span></span>
<span class="tr"><span class="th" id="line3505">3505</span><span class="td">&nbsp;&nbsp;if&nbsp;((i&nbsp;==&nbsp;1)&nbsp;&amp;&amp;&nbsp;(player&nbsp;==&nbsp;item))&nbsp;MakeMatch(item,&nbsp;1);&nbsp;!&nbsp;&quot;me&quot;</span></span>
<span class="tr"><span class="th" id="line3506">3506</span><span class="td">&nbsp;&nbsp;if&nbsp;((i&nbsp;&gt;=&nbsp;2)&nbsp;&amp;&amp;&nbsp;(i&nbsp;&lt;&nbsp;128)&nbsp;&amp;&amp;&nbsp;(LanguagePronouns--&gt;i&nbsp;==&nbsp;item))&nbsp;MakeMatch(item,&nbsp;1);</span></span>
<span class="tr"><span class="th" id="line3507">3507</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3508">3508</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3509">3509</span><span class="td">&nbsp;!&nbsp;Construing&nbsp;the&nbsp;current&nbsp;word&nbsp;as&nbsp;the&nbsp;start&nbsp;of&nbsp;a&nbsp;noun,&nbsp;can&nbsp;it&nbsp;refer&nbsp;to&nbsp;the</span></span>
<span class="tr"><span class="th" id="line3510">3510</span><span class="td">&nbsp;!&nbsp;object?</span></span>
<span class="tr"><span class="th" id="line3511">3511</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3512">3512</span><span class="td">&nbsp;wn&nbsp;=&nbsp;match_from;</span></span>
<span class="tr"><span class="th" id="line3513">3513</span><span class="td">&nbsp;if&nbsp;(TryGivenObject(item)&nbsp;&gt;&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line3514">3514</span><span class="td">&nbsp;&nbsp;if&nbsp;(indef_nspec_at&nbsp;&gt;&nbsp;0&nbsp;&amp;&amp;&nbsp;match_from&nbsp;~=&nbsp;indef_nspec_at)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3515">3515</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;This&nbsp;case&nbsp;arises&nbsp;if&nbsp;the&nbsp;player&nbsp;has&nbsp;typed&nbsp;a&nbsp;number&nbsp;in</span></span>
<span class="tr"><span class="th" id="line3516">3516</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;which&nbsp;is&nbsp;hypothetically&nbsp;an&nbsp;indefinite&nbsp;descriptor:</span></span>
<span class="tr"><span class="th" id="line3517">3517</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;e.g.&nbsp;&quot;take&nbsp;two&nbsp;clubs&quot;.&nbsp;&nbsp;We&nbsp;have&nbsp;just&nbsp;checked&nbsp;the&nbsp;object</span></span>
<span class="tr"><span class="th" id="line3518">3518</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;against&nbsp;the&nbsp;word&nbsp;&quot;clubs&quot;,&nbsp;in&nbsp;the&nbsp;hope&nbsp;of&nbsp;eventually&nbsp;finding</span></span>
<span class="tr"><span class="th" id="line3519">3519</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;two&nbsp;such&nbsp;objects.&nbsp;&nbsp;But&nbsp;we&nbsp;also&nbsp;backtrack&nbsp;and&nbsp;check&nbsp;it</span></span>
<span class="tr"><span class="th" id="line3520">3520</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;against&nbsp;the&nbsp;words&nbsp;&quot;two&nbsp;clubs&quot;,&nbsp;in&nbsp;case&nbsp;it&nbsp;turns&nbsp;out&nbsp;to</span></span>
<span class="tr"><span class="th" id="line3521">3521</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;be&nbsp;the&nbsp;2&nbsp;of&nbsp;Clubs&nbsp;from&nbsp;a&nbsp;pack&nbsp;of&nbsp;cards,&nbsp;say.&nbsp;&nbsp;If&nbsp;it&nbsp;does</span></span>
<span class="tr"><span class="th" id="line3522">3522</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;match&nbsp;against&nbsp;&quot;two&nbsp;clubs&quot;,&nbsp;we&nbsp;tear&nbsp;up&nbsp;our&nbsp;original</span></span>
<span class="tr"><span class="th" id="line3523">3523</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;assumption&nbsp;about&nbsp;the&nbsp;meaning&nbsp;of&nbsp;&quot;two&quot;&nbsp;and&nbsp;lapse&nbsp;back&nbsp;into</span></span>
<span class="tr"><span class="th" id="line3524">3524</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;definite&nbsp;mode.</span></span>
<span class="tr"><span class="th" id="line3525">3525</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3526">3526</span><span class="td">&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;indef_nspec_at;</span></span>
<span class="tr"><span class="th" id="line3527">3527</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TryGivenObject(item)&nbsp;&gt;&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3528">3528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;match_from&nbsp;=&nbsp;indef_nspec_at;</span></span>
<span class="tr"><span class="th" id="line3529">3529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ResetDescriptors();</span></span>
<span class="tr"><span class="th" id="line3530">3530</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3531">3531</span><span class="td">&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;match_from;</span></span>
<span class="tr"><span class="th" id="line3532">3532</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3533">3533</span><span class="td">];</span></span>
</div><div class='text'>
<h3>TryGivenObject.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3542">TryGivenObject</a></span> tries to match as many words as possible in what has been typed to the given object, <span class="fixed">obj</span>. If it manages any words matched at all, it calls <span class="fixed"><a href="./Parser.i6t.html#line2810">MakeMatch</a></span> to say so, then returns the number of words (or 1 if it was a match because of inadequate input).<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3542">3542</span><span class="td">[&nbsp;TryGivenObject&nbsp;obj&nbsp;nomatch&nbsp;threshold&nbsp;k&nbsp;w&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line3543">3543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line3544">3544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;5)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;Trying&nbsp;&quot;,&nbsp;(the)&nbsp;obj,&nbsp;&quot;&nbsp;(&quot;,&nbsp;obj,&nbsp;&quot;)&nbsp;at&nbsp;word&nbsp;&quot;,&nbsp;wn,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line3545">3545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line3546">3546</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3547">3547</span><span class="td">&nbsp;if&nbsp;(nomatch&nbsp;&amp;&amp;&nbsp;obj&nbsp;==&nbsp;0)&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3548">3548</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3549">3549</span><span class="td">!&nbsp;if&nbsp;(nomatch)&nbsp;print&nbsp;&quot;***&nbsp;TryGivenObject&nbsp;***&nbsp;on&nbsp;&quot;,&nbsp;(the)&nbsp;obj,&nbsp;&quot;&nbsp;at&nbsp;wn&nbsp;=&nbsp;&quot;,&nbsp;wn,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line3550">3550</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3551">3551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;dict_flags_of_noun&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3552">3552</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3553">3553</span><span class="td">!&nbsp;&nbsp;If&nbsp;input&nbsp;has&nbsp;run&nbsp;out&nbsp;then&nbsp;always&nbsp;match,&nbsp;with&nbsp;only&nbsp;quality&nbsp;0&nbsp;(this&nbsp;saves</span></span>
<span class="tr"><span class="th" id="line3554">3554</span><span class="td">!&nbsp;&nbsp;time).</span></span>
<span class="tr"><span class="th" id="line3555">3555</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3556">3556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wn&nbsp;&gt;&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3557">3557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nomatch)&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3558">3558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;~=&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line3559">3559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dict_flags_of_noun&nbsp;=&nbsp;$$01110000;&nbsp;&nbsp;!&nbsp;Reject&nbsp;&quot;plural&quot;&nbsp;bit</span></span>
<span class="tr"><span class="th" id="line3560">3560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MakeMatch(obj,0);</span></span>
<span class="tr"><span class="th" id="line3561">3561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line3562">3562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;5)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;Matched&nbsp;(0)^&quot;;</span></span>
<span class="tr"><span class="th" id="line3563">3563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line3564">3564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3565">3565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3566">3566</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3567">3567</span><span class="td">!&nbsp;&nbsp;Ask&nbsp;the&nbsp;object&nbsp;to&nbsp;parse&nbsp;itself&nbsp;if&nbsp;necessary,&nbsp;sitting&nbsp;up&nbsp;and&nbsp;taking&nbsp;notice</span></span>
<span class="tr"><span class="th" id="line3568">3568</span><span class="td">!&nbsp;&nbsp;if&nbsp;it&nbsp;says&nbsp;the&nbsp;plural&nbsp;was&nbsp;used:</span></span>
<span class="tr"><span class="th" id="line3569">3569</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3570">3570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj.parse_name~=0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3571">3571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parser_action&nbsp;=&nbsp;NULL;&nbsp;j=wn;</span></span>
<span class="tr"><span class="th" id="line3572">3572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;RunRoutines(obj,parse_name);</span></span>
<span class="tr"><span class="th" id="line3573">3573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(k&nbsp;&gt;&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3574">3574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wn=j+k;</span></span>
<span class="tr"><span class="th" id="line3575">3575</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3576">3576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.MMbyPN;</span></span>
<span class="tr"><span class="th" id="line3577">3577</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3578">3578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_action&nbsp;==&nbsp;##PluralFound)</span></span>
<span class="tr"><span class="th" id="line3579">3579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dict_flags_of_noun&nbsp;=&nbsp;dict_flags_of_noun&nbsp;|&nbsp;4;</span></span>
<span class="tr"><span class="th" id="line3580">3580</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3581">3581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dict_flags_of_noun&nbsp;&amp;&nbsp;4)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3582">3582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(~~allow_plurals)&nbsp;k&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3583">3583</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3584">3584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3585">3585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;1;&nbsp;indef_type&nbsp;=&nbsp;0;&nbsp;indef_wanted&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3586">3586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3587">3587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_type&nbsp;=&nbsp;indef_type&nbsp;|&nbsp;PLURAL_BIT;</span></span>
<span class="tr"><span class="th" id="line3588">3588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_wanted&nbsp;==&nbsp;0)&nbsp;indef_wanted&nbsp;=&nbsp;INDEF_ALL_WANTED;</span></span>
<span class="tr"><span class="th" id="line3589">3589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3590">3590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3591">3591</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3592">3592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line3593">3593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_trace&nbsp;&gt;=&nbsp;5)&nbsp;print&nbsp;&quot;&nbsp;&nbsp;&nbsp;&nbsp;Matched&nbsp;(&quot;,&nbsp;k,&nbsp;&quot;)^&quot;;</span></span>
<span class="tr"><span class="th" id="line3594">3594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line3595">3595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nomatch&nbsp;==&nbsp;false)&nbsp;MakeMatch(obj,k);</span></span>
<span class="tr"><span class="th" id="line3596">3596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line3597">3597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3598">3598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(k&nbsp;==&nbsp;0)&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3613">NoWordsMatch</a>;</span></span>
<span class="tr"><span class="th" id="line3599">3599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3600">3600</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3601">3601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;The&nbsp;default&nbsp;algorithm&nbsp;is&nbsp;simply&nbsp;to&nbsp;count&nbsp;up&nbsp;how&nbsp;many&nbsp;words&nbsp;pass&nbsp;the</span></span>
<span class="tr"><span class="th" id="line3602">3602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Refers&nbsp;test:</span></span>
<span class="tr"><span class="th" id="line3603">3603</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3604">3604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;parser_action&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line3605">3605</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3606">3606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;NounWord();</span></span>
<span class="tr"><span class="th" id="line3607">3607</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3608">3608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(w&nbsp;==&nbsp;1&nbsp;&amp;&amp;&nbsp;player&nbsp;==&nbsp;obj)&nbsp;{&nbsp;k=1;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3576">MMbyPN</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3609">3609</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3610">3610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(w&nbsp;&gt;=&nbsp;2&nbsp;&amp;&amp;&nbsp;w&nbsp;&lt;&nbsp;128&nbsp;&amp;&amp;&nbsp;(LanguagePronouns--&gt;w&nbsp;==&nbsp;obj))&nbsp;{&nbsp;k&nbsp;=&nbsp;1;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3576">MMbyPN</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3611">3611</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3612">3612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Refers(obj,&nbsp;wn-1)&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3613">3613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.NoWordsMatch;</span></span>
<span class="tr"><span class="th" id="line3614">3614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;~=&nbsp;0)&nbsp;{&nbsp;k&nbsp;=&nbsp;0;&nbsp;parser_action&nbsp;=&nbsp;NULL;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3576">MMbyPN</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3615">3615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3616">3616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3617">3617</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3618">3618</span><span class="td">&nbsp;threshold&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3619">3619</span><span class="td">&nbsp;dict_flags_of_noun&nbsp;=&nbsp;(w-&gt;#dict_par1)&nbsp;&amp;&nbsp;$$01110100;</span></span>
<span class="tr"><span class="th" id="line3620">3620</span><span class="td">&nbsp;w&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line3621">3621</span><span class="td">&nbsp;while&nbsp;(Refers(obj,&nbsp;wn-1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3622">3622</span><span class="td">&nbsp;&nbsp;threshold++;</span></span>
<span class="tr"><span class="th" id="line3623">3623</span><span class="td">&nbsp;&nbsp;if&nbsp;(w)</span></span>
<span class="tr"><span class="th" id="line3624">3624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dict_flags_of_noun&nbsp;=&nbsp;dict_flags_of_noun&nbsp;|&nbsp;((w-&gt;#dict_par1)&nbsp;&amp;&nbsp;$$01110100);</span></span>
<span class="tr"><span class="th" id="line3625">3625</span><span class="td">&nbsp;&nbsp;w&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line3626">3626</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3627">3627</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3628">3628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;threshold;</span></span>
<span class="tr"><span class="th" id="line3629">3629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3576">MMbyPN</a>;</span></span>
<span class="tr"><span class="th" id="line3630">3630</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Refers.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3639">Refers</a></span> works out whether the word at number wnum can refer to the object <span class="fixed">obj</span>, returning true or false.  The standard method is to see if the word is listed under the <span class="fixed">name</span> property for the object, but this is more complex in languages other than English.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3639">3639</span><span class="td">[&nbsp;Refers&nbsp;obj&nbsp;wnum&nbsp;&nbsp;&nbsp;wd&nbsp;k&nbsp;l&nbsp;m;</span></span>
<span class="tr"><span class="th" id="line3640">3640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3641">3641</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3642">3642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguageRefers;</span></span>
<span class="tr"><span class="th" id="line3643">3643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;LanguageRefers(obj,wnum);&nbsp;if&nbsp;(k&nbsp;&gt;=&nbsp;0)&nbsp;return&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line3644">3644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageRefers</span></span>
<span class="tr"><span class="th" id="line3645">3645</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3646">3646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;wn;&nbsp;wn&nbsp;=&nbsp;wnum;&nbsp;wd&nbsp;=&nbsp;NextWordStopped();&nbsp;wn&nbsp;=&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line3647">3647</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3648">3648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parser_inflection&nbsp;&gt;=&nbsp;256)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3649">3649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;indirect(parser_inflection,&nbsp;obj,&nbsp;wd);</span></span>
<span class="tr"><span class="th" id="line3650">3650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(k&nbsp;&gt;=&nbsp;0)&nbsp;return&nbsp;k;</span></span>
<span class="tr"><span class="th" id="line3651">3651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;-k;</span></span>
<span class="tr"><span class="th" id="line3652">3652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3653">3653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line3654">3654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;parser_inflection;</span></span>
<span class="tr"><span class="th" id="line3655">3655</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;obj.&amp;m;&nbsp;l&nbsp;=&nbsp;(obj.#m)/WORDSIZE-1;</span></span>
<span class="tr"><span class="th" id="line3656">3656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(m=0&nbsp;:&nbsp;m&lt;=l&nbsp;:&nbsp;m++)</span></span>
<span class="tr"><span class="th" id="line3657">3657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wd&nbsp;==&nbsp;k--&gt;m)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3658">3658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3659">3659</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3660">3660</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3661">3661</span><span class="td">[&nbsp;WordInProperty&nbsp;wd&nbsp;obj&nbsp;prop&nbsp;k&nbsp;l&nbsp;m;</span></span>
<span class="tr"><span class="th" id="line3662">3662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;=&nbsp;obj.&amp;prop;&nbsp;l&nbsp;=&nbsp;(obj.#prop)/WORDSIZE-1;</span></span>
<span class="tr"><span class="th" id="line3663">3663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(m=0&nbsp;:&nbsp;m&lt;=l&nbsp;:&nbsp;m++)</span></span>
<span class="tr"><span class="th" id="line3664">3664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(wd&nbsp;==&nbsp;k--&gt;m)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3665">3665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3666">3666</span><span class="td">];</span></span>
</div><div class='text'>
<h3>NounWord.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3678">NounWord</a></span> (which takes no arguments) returns: (a) 0 if the next word is not in the dictionary or is but does not carry the &quot;noun&quot; bit in its dictionary entry, (b) 1 if it is a word meaning &quot;me&quot;, (c) the index in the pronoun table (plus 2) of the value field of a pronoun, if it is a pronoun, (d) the address in the dictionary if it is a recognised noun.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3678">3678</span><span class="td">[&nbsp;NounWord&nbsp;i&nbsp;j&nbsp;s;</span></span>
<span class="tr"><span class="th" id="line3679">3679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;NextWord();</span></span>
<span class="tr"><span class="th" id="line3680">3680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3681">3681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;ME1__WD&nbsp;or&nbsp;ME2__WD&nbsp;or&nbsp;ME3__WD)&nbsp;return&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3682">3682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;LanguagePronouns--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3683">3683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(j=1&nbsp;:&nbsp;j&lt;=s&nbsp;:&nbsp;j=j+3)</span></span>
<span class="tr"><span class="th" id="line3684">3684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;LanguagePronouns--&gt;j)</span></span>
<span class="tr"><span class="th" id="line3685">3685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;j+2;</span></span>
<span class="tr"><span class="th" id="line3686">3686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((i-&gt;#dict_par1)&amp;128&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3687">3687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3688">3688</span><span class="td">];</span></span>
</div><div class='text'>
<h3>TryNumber.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3705">TryNumber</a></span> takes word number <span class="fixed">wordnum</span> and tries to parse it as an (unsigned) decimal number or the name of a small number, returning<p></p><p> (a) <em></em> if it is not a number (b) the number, if it has between 1 and 4 digits (c) 10000 if it has 5 or more digits.<p></p><p> (The danger of allowing 5 digits is that Z-machine integers are only 16 bits long, and anyway this routine isn&#39;t meant to be perfect: it only really needs to be good enough to handle numeric descriptors such as those in TAKE 31 COINS or DROP FOUR DAGGERS. In particular, it is not the way I7 &quot;[number]&quot; tokens are parsed.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3705">3705</span><span class="td">[&nbsp;TryNumber&nbsp;wordnum&nbsp;&nbsp;&nbsp;i&nbsp;j&nbsp;c&nbsp;num&nbsp;len&nbsp;mul&nbsp;tot&nbsp;d&nbsp;digit;</span></span>
<span class="tr"><span class="th" id="line3706">3706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;wn;&nbsp;wn&nbsp;=&nbsp;wordnum;&nbsp;j&nbsp;=&nbsp;NextWord();&nbsp;wn&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3707">3707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;NumberWord(j);&nbsp;!&nbsp;Test&nbsp;for&nbsp;verbal&nbsp;forms&nbsp;ONE&nbsp;to&nbsp;THIRTY</span></span>
<span class="tr"><span class="th" id="line3708">3708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j&nbsp;&gt;=&nbsp;1)&nbsp;return&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line3709">3709</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3710">3710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line3711">3711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;wordnum*4+1;&nbsp;j&nbsp;=&nbsp;parse-&gt;i;&nbsp;num&nbsp;=&nbsp;j+buffer;&nbsp;len&nbsp;=&nbsp;parse-&gt;(i-1);</span></span>
<span class="tr"><span class="th" id="line3712">3712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line3713">3713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;wordnum*3;&nbsp;j&nbsp;=&nbsp;parse--&gt;i;&nbsp;num&nbsp;=&nbsp;j+buffer;&nbsp;len&nbsp;=&nbsp;parse--&gt;(i-1);</span></span>
<span class="tr"><span class="th" id="line3714">3714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line3715">3715</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3716">3716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(len&nbsp;&gt;=&nbsp;4)&nbsp;mul=1000;</span></span>
<span class="tr"><span class="th" id="line3717">3717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(len&nbsp;==&nbsp;3)&nbsp;mul=100;</span></span>
<span class="tr"><span class="th" id="line3718">3718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(len&nbsp;==&nbsp;2)&nbsp;mul=10;</span></span>
<span class="tr"><span class="th" id="line3719">3719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(len&nbsp;==&nbsp;1)&nbsp;mul=1;</span></span>
<span class="tr"><span class="th" id="line3720">3720</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3721">3721</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;tot&nbsp;=&nbsp;0;&nbsp;c&nbsp;=&nbsp;0;&nbsp;len&nbsp;=&nbsp;len-1;</span></span>
<span class="tr"><span class="th" id="line3722">3722</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3723">3723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(c=0&nbsp;:&nbsp;c&lt;=len&nbsp;:&nbsp;c++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3724">3724</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digit=num-&gt;c;</span></span>
<span class="tr"><span class="th" id="line3725">3725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;0&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;0;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3726">3726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;1&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;1;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3727">3727</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;2&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;2;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3728">3728</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;3&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;3;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3729">3729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;4&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;4;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3730">3730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;5&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;5;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3731">3731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;6&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;6;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3732">3732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;7&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;7;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3733">3733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;8&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;8;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3734">3734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(digit&nbsp;==&nbsp;&#39;9&#39;)&nbsp;{&nbsp;d&nbsp;=&nbsp;9;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3736">digok</a>;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3735">3735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1000;</span></span>
<span class="tr"><span class="th" id="line3736">3736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.digok;</span></span>
<span class="tr"><span class="th" id="line3737">3737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tot&nbsp;=&nbsp;tot+mul*d;&nbsp;mul&nbsp;=&nbsp;mul/10;</span></span>
<span class="tr"><span class="th" id="line3738">3738</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3739">3739</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(len&nbsp;&gt;&nbsp;3)&nbsp;tot=10000;</span></span>
<span class="tr"><span class="th" id="line3740">3740</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;tot;</span></span>
<span class="tr"><span class="th" id="line3741">3741</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Gender.</h3><p><p> <span class="fixed"><a href="./Parser.i6t.html#line3752">GetGender</a></span> returns 0 if the given animate object is female, and 1 if male, and is abstracted as a routine in case something more elaborate is ever needed.<p></p><p> For GNAs &ndash; gender/noun/animation combinations &ndash; see the <strong> Inform Designer&#39;s Manual</strong>, 4th edition.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3752">3752</span><span class="td">[&nbsp;GetGender&nbsp;person;</span></span>
<span class="tr"><span class="th" id="line3753">3753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(person&nbsp;hasnt&nbsp;female)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3754">3754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3755">3755</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3756">3756</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3757">3757</span><span class="td">[&nbsp;GetGNAOfObject&nbsp;obj&nbsp;case&nbsp;gender;</span></span>
<span class="tr"><span class="th" id="line3758">3758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;hasnt&nbsp;animate)&nbsp;case&nbsp;=&nbsp;6;</span></span>
<span class="tr"><span class="th" id="line3759">3759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;male)&nbsp;gender&nbsp;=&nbsp;male;</span></span>
<span class="tr"><span class="th" id="line3760">3760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;female)&nbsp;gender&nbsp;=&nbsp;female;</span></span>
<span class="tr"><span class="th" id="line3761">3761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;neuter)&nbsp;gender&nbsp;=&nbsp;neuter;</span></span>
<span class="tr"><span class="th" id="line3762">3762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(gender&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3763">3763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(case&nbsp;==&nbsp;0)&nbsp;gender&nbsp;=&nbsp;LanguageAnimateGender;</span></span>
<span class="tr"><span class="th" id="line3764">3764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;gender&nbsp;=&nbsp;LanguageInanimateGender;</span></span>
<span class="tr"><span class="th" id="line3765">3765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3766">3766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(gender&nbsp;==&nbsp;female)&nbsp;&nbsp;&nbsp;case&nbsp;=&nbsp;case&nbsp;+&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3767">3767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(gender&nbsp;==&nbsp;neuter)&nbsp;&nbsp;&nbsp;case&nbsp;=&nbsp;case&nbsp;+&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line3768">3768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;pluralname)&nbsp;case&nbsp;=&nbsp;case&nbsp;+&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line3769">3769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;case;</span></span>
<span class="tr"><span class="th" id="line3770">3770</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Noticing Plurals.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3775">3775</span><span class="td">[&nbsp;DetectPluralWord&nbsp;at&nbsp;n&nbsp;i&nbsp;w&nbsp;swn&nbsp;outcome;</span></span>
<span class="tr"><span class="th" id="line3776">3776</span><span class="td">&nbsp;swn&nbsp;=&nbsp;wn;&nbsp;wn&nbsp;=&nbsp;at;</span></span>
<span class="tr"><span class="th" id="line3777">3777</span><span class="td">&nbsp;for&nbsp;(i=0:i&lt;n:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3778">3778</span><span class="td">&nbsp;&nbsp;w&nbsp;=&nbsp;NextWordStopped();</span></span>
<span class="tr"><span class="th" id="line3779">3779</span><span class="td">&nbsp;&nbsp;if&nbsp;(w&nbsp;==&nbsp;0&nbsp;or&nbsp;THEN1__WD&nbsp;or&nbsp;COMMA_WORD&nbsp;or&nbsp;-1)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line3780">3780</span><span class="td">&nbsp;&nbsp;if&nbsp;((w-&gt;#dict_par1)&nbsp;&amp;&nbsp;$$00000100)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3781">3781</span><span class="td">&nbsp;&nbsp;&nbsp;parser_action&nbsp;=&nbsp;##PluralFound;</span></span>
<span class="tr"><span class="th" id="line3782">3782</span><span class="td">&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line3783">3783</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3784">3784</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3785">3785</span><span class="td">&nbsp;wn&nbsp;=&nbsp;swn;</span></span>
<span class="tr"><span class="th" id="line3786">3786</span><span class="td">&nbsp;return&nbsp;outcome;</span></span>
<span class="tr"><span class="th" id="line3787">3787</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Pronoun Handling.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3792">3792</span><span class="td">[&nbsp;SetPronoun&nbsp;dword&nbsp;value&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3793">3793</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(x=1&nbsp;:&nbsp;x&lt;=LanguagePronouns--&gt;0&nbsp;:&nbsp;x=x+3)</span></span>
<span class="tr"><span class="th" id="line3794">3794</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LanguagePronouns--&gt;x&nbsp;==&nbsp;dword)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3795">3795</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LanguagePronouns--&gt;(x+2)&nbsp;=&nbsp;value;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line3796">3796</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3797">3797</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;RunTimeError(14);</span></span>
<span class="tr"><span class="th" id="line3798">3798</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3799">3799</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3800">3800</span><span class="td">[&nbsp;PronounValue&nbsp;dword&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3801">3801</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(x=1&nbsp;:&nbsp;x&lt;=LanguagePronouns--&gt;0&nbsp;:&nbsp;x=x+3)</span></span>
<span class="tr"><span class="th" id="line3802">3802</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LanguagePronouns--&gt;x&nbsp;==&nbsp;dword)</span></span>
<span class="tr"><span class="th" id="line3803">3803</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;LanguagePronouns--&gt;(x+2);</span></span>
<span class="tr"><span class="th" id="line3804">3804</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3805">3805</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3806">3806</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3807">3807</span><span class="td">[&nbsp;ResetVagueWords&nbsp;obj;&nbsp;PronounNotice(obj);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line3808">3808</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3809">3809</span><span class="td">[&nbsp;PronounNotice&nbsp;obj&nbsp;x&nbsp;bm&nbsp;g;</span></span>
<span class="tr"><span class="th" id="line3810">3810</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;player)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line3811">3811</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3812">3812</span><span class="td">&nbsp;g&nbsp;=&nbsp;(GetGNAOfObject(obj));</span></span>
<span class="tr"><span class="th" id="line3813">3813</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3814">3814</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;bm&nbsp;=&nbsp;PowersOfTwo_TB--&gt;g;</span></span>
<span class="tr"><span class="th" id="line3815">3815</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(x=1&nbsp;:&nbsp;x&lt;=LanguagePronouns--&gt;0&nbsp;:&nbsp;x=x+3)</span></span>
<span class="tr"><span class="th" id="line3816">3816</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bm&nbsp;&amp;&nbsp;(LanguagePronouns--&gt;(x+1))&nbsp;~=&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line3817">3817</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LanguagePronouns--&gt;(x+2)&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line3818">3818</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3819">3819</span><span class="td">&nbsp;if&nbsp;(((g&nbsp;%&nbsp;6)&nbsp;&lt;&nbsp;3)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;has&nbsp;ambigpluralname))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3820">3820</span><span class="td">&nbsp;&nbsp;g&nbsp;=&nbsp;g&nbsp;+&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line3821">3821</span><span class="td">&nbsp;&nbsp;bm&nbsp;=&nbsp;PowersOfTwo_TB--&gt;g;</span></span>
<span class="tr"><span class="th" id="line3822">3822</span><span class="td">&nbsp;&nbsp;for&nbsp;(x=1&nbsp;:&nbsp;x&lt;=LanguagePronouns--&gt;0&nbsp;:&nbsp;x=x+3)</span></span>
<span class="tr"><span class="th" id="line3823">3823</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(bm&nbsp;&amp;&nbsp;(LanguagePronouns--&gt;(x+1))&nbsp;~=&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line3824">3824</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;LanguagePronouns--&gt;(x+2)&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line3825">3825</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3826">3826</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3827">3827</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3828">3828</span><span class="td">[&nbsp;PronounNoticeHeldObjects&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3829">3829</span><span class="td">#IFNDEF&nbsp;MANUAL_PRONOUNS;</span></span>
<span class="tr"><span class="th" id="line3830">3830</span><span class="td">&nbsp;objectloop(x&nbsp;in&nbsp;player)&nbsp;PronounNotice(x);</span></span>
<span class="tr"><span class="th" id="line3831">3831</span><span class="td">#ENDIF;</span></span>
<span class="tr"><span class="th" id="line3832">3832</span><span class="td">&nbsp;x&nbsp;=&nbsp;0;&nbsp;!&nbsp;To&nbsp;prevent&nbsp;a&nbsp;&quot;not&nbsp;used&quot;&nbsp;error</span></span>
<span class="tr"><span class="th" id="line3833">3833</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3834">3834</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Yes/No Questions.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3839">3839</span><span class="td">[&nbsp;YesOrNo&nbsp;i&nbsp;j;</span></span>
<span class="tr"><span class="th" id="line3840">3840</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(::)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3841">3841</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line3842">3842</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(location&nbsp;==&nbsp;nothing&nbsp;||&nbsp;parent(player)&nbsp;==&nbsp;nothing)&nbsp;read&nbsp;buffer2&nbsp;parse2;</span></span>
<span class="tr"><span class="th" id="line3843">3843</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;read&nbsp;buffer2&nbsp;parse2&nbsp;DrawStatusLine;</span></span>
<span class="tr"><span class="th" id="line3844">3844</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;parse2-&gt;1;</span></span>
<span class="tr"><span class="th" id="line3845">3845</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX;</span></span>
<span class="tr"><span class="th" id="line3846">3846</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(location&nbsp;~=&nbsp;nothing&nbsp;&amp;&amp;&nbsp;parent(player)&nbsp;~=&nbsp;nothing)&nbsp;DrawStatusLine();</span></span>
<span class="tr"><span class="th" id="line3847">3847</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KeyboardPrimitive(buffer2,&nbsp;parse2);</span></span>
<span class="tr"><span class="th" id="line3848">3848</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;parse2--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3849">3849</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line3850">3850</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(j)&nbsp;{&nbsp;!&nbsp;at&nbsp;least&nbsp;one&nbsp;word&nbsp;entered</span></span>
<span class="tr"><span class="th" id="line3851">3851</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;parse2--&gt;1;</span></span>
<span class="tr"><span class="th" id="line3852">3852</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;YES1__WD&nbsp;or&nbsp;YES2__WD&nbsp;or&nbsp;YES3__WD)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line3853">3853</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;==&nbsp;NO1__WD&nbsp;or&nbsp;NO2__WD&nbsp;or&nbsp;NO3__WD)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3854">3854</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3855">3855</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;YES_OR_NO_QUESTION_INTERNAL_RM(&#39;A&#39;);&nbsp;print&nbsp;&quot;&gt;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line3856">3856</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3857">3857</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3858">3858</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3859">3859</span><span class="td">[&nbsp;YES_OR_NO_QUESTION_INTERNAL_R;&nbsp;];</span></span>
</div><div class='text'>
<h3>Number Words.</h3><p><p> Not much of a parsing routine: we look through an array of pairs of number words (single words) and their numeric equivalents.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3866">3866</span><span class="td">[&nbsp;NumberWord&nbsp;o&nbsp;i&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line3867">3867</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;LanguageNumbers--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3868">3868</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=1&nbsp;:&nbsp;i&lt;=n&nbsp;:&nbsp;i=i+2)</span></span>
<span class="tr"><span class="th" id="line3869">3869</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;LanguageNumbers--&gt;i)&nbsp;return&nbsp;LanguageNumbers--&gt;(i+1);</span></span>
<span class="tr"><span class="th" id="line3870">3870</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3871">3871</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Choose Objects.</h3><p><p> This material, the final body of code in the parser, is an I7 addition. The I6 parser leaves it to the user to provide a <span class="fixed"><a href="./Parser.i6t.html#line3917">ChooseObjects</a></span> routine to decide between possibilities when the situation is ambiguous. For I7 use, we provide a <span class="fixed"><a href="./Parser.i6t.html#line3917">ChooseObjects</a></span> which essentially runs the &quot;does the player mean&quot; rulebook to decide, though this is not obvious from the code below because it is hidden in the <span class="fixed">CheckDPMR</span> routine &ndash; which is defined in the Standard Rules, not here.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line3883">3883</span><span class="td">!Constant&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3884">3884</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3885">3885</span><span class="td">!&nbsp;the&nbsp;highest&nbsp;value&nbsp;returned&nbsp;by&nbsp;CheckDPMR&nbsp;(see&nbsp;the&nbsp;Standard&nbsp;Rules)</span></span>
<span class="tr"><span class="th" id="line3886">3886</span><span class="td">Constant&nbsp;HIGHEST_DPMR_SCORE&nbsp;=&nbsp;4;</span></span>
<span class="tr"><span class="th" id="line3887">3887</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3888">3888</span><span class="td">Array&nbsp;alt_match_list&nbsp;--&gt;&nbsp;(MATCH_LIST_WORDS+1);</span></span>
<span class="tr"><span class="th" id="line3889">3889</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3890">3890</span><span class="td">#ifdef&nbsp;TARGET_GLULX;</span></span>
<span class="tr"><span class="th" id="line3891">3891</span><span class="td">[&nbsp;COBJ__Copy&nbsp;words&nbsp;from&nbsp;to&nbsp;&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line3892">3892</span><span class="td">&nbsp;for&nbsp;(i=0:&nbsp;i&lt;words:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line3893">3893</span><span class="td">&nbsp;&nbsp;to--&gt;i&nbsp;=&nbsp;from--&gt;i;</span></span>
<span class="tr"><span class="th" id="line3894">3894</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3895">3895</span><span class="td">#ifnot;</span></span>
<span class="tr"><span class="th" id="line3896">3896</span><span class="td">[&nbsp;COBJ__Copy&nbsp;words&nbsp;from&nbsp;to&nbsp;&nbsp;bytes;</span></span>
<span class="tr"><span class="th" id="line3897">3897</span><span class="td">&nbsp;bytes&nbsp;=&nbsp;words&nbsp;*&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line3898">3898</span><span class="td">&nbsp;@copy_table&nbsp;from&nbsp;to&nbsp;bytes;</span></span>
<span class="tr"><span class="th" id="line3899">3899</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3900">3900</span><span class="td">#endif;</span></span>
<span class="tr"><span class="th" id="line3901">3901</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3902">3902</span><span class="td">!&nbsp;swap&nbsp;alt_match_list&nbsp;with&nbsp;match_list/number_matched</span></span>
<span class="tr"><span class="th" id="line3903">3903</span><span class="td">[&nbsp;COBJ__SwapMatches&nbsp;i&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3904">3904</span><span class="td">&nbsp;!&nbsp;swap&nbsp;the&nbsp;counts</span></span>
<span class="tr"><span class="th" id="line3905">3905</span><span class="td">&nbsp;x&nbsp;=&nbsp;number_matched;</span></span>
<span class="tr"><span class="th" id="line3906">3906</span><span class="td">&nbsp;number_matched&nbsp;=&nbsp;alt_match_list--&gt;0;</span></span>
<span class="tr"><span class="th" id="line3907">3907</span><span class="td">&nbsp;alt_match_list--&gt;0&nbsp;=&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3908">3908</span><span class="td">&nbsp;!&nbsp;swap&nbsp;the&nbsp;values</span></span>
<span class="tr"><span class="th" id="line3909">3909</span><span class="td">&nbsp;if&nbsp;(x&nbsp;&lt;&nbsp;number_matched)&nbsp;x&nbsp;=&nbsp;number_matched;</span></span>
<span class="tr"><span class="th" id="line3910">3910</span><span class="td">&nbsp;for&nbsp;(i=x:&nbsp;i&gt;0:&nbsp;i--)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3911">3911</span><span class="td">&nbsp;&nbsp;x&nbsp;=&nbsp;match_list--&gt;(i-1);</span></span>
<span class="tr"><span class="th" id="line3912">3912</span><span class="td">&nbsp;&nbsp;match_list--&gt;(i-1)&nbsp;=&nbsp;alt_match_list--&gt;i;</span></span>
<span class="tr"><span class="th" id="line3913">3913</span><span class="td">&nbsp;&nbsp;alt_match_list--&gt;i&nbsp;=&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line3914">3914</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3915">3915</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line3916">3916</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3917">3917</span><span class="td">[&nbsp;ChooseObjects&nbsp;obj&nbsp;code&nbsp;&nbsp;l&nbsp;i&nbsp;swn&nbsp;spcount;</span></span>
<span class="tr"><span class="th" id="line3918">3918</span><span class="td">&nbsp;if&nbsp;(code&lt;2)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line3919">3919</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3920">3920</span><span class="td">&nbsp;if&nbsp;(cobj_flag&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3921">3921</span><span class="td">&nbsp;&nbsp;.CodeOne;</span></span>
<span class="tr"><span class="th" id="line3922">3922</span><span class="td">&nbsp;&nbsp;if&nbsp;(parameters&nbsp;&gt;&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3923">3923</span><span class="td">&nbsp;&nbsp;&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3924">3924</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[scoring&nbsp;&quot;,&nbsp;(the)&nbsp;obj,&nbsp;&quot;&nbsp;(second)]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3925">3925</span><span class="td">&nbsp;&nbsp;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line3926">3926</span><span class="td">&nbsp;&nbsp;&nbsp;return&nbsp;ScoreDabCombo(parser_results--&gt;INP1_PRES,&nbsp;obj);</span></span>
<span class="tr"><span class="th" id="line3927">3927</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3928">3928</span><span class="td">&nbsp;&nbsp;&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3929">3929</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[scoring&nbsp;&quot;,&nbsp;(the)&nbsp;obj,&nbsp;&quot;&nbsp;(first)&nbsp;in&nbsp;&quot;,</span></span>
<span class="tr"><span class="th" id="line3930">3930</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;alt_match_list--&gt;0,&nbsp;&quot;&nbsp;combinations]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3931">3931</span><span class="td">&nbsp;&nbsp;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line3932">3932</span><span class="td">&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3933">3933</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=1:&nbsp;i&lt;=alt_match_list--&gt;0:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3934">3934</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;spcount&nbsp;=&nbsp;ScoreDabCombo(obj,&nbsp;alt_match_list--&gt;i);</span></span>
<span class="tr"><span class="th" id="line3935">3935</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(spcount&nbsp;==&nbsp;HIGHEST_DPMR_SCORE)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3936">3936</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3937">3937</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;[scored&nbsp;&quot;,&nbsp;spcount,&nbsp;&quot;&nbsp;-&nbsp;best&nbsp;possible]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3938">3938</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line3939">3939</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;spcount;</span></span>
<span class="tr"><span class="th" id="line3940">3940</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3941">3941</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(spcount&gt;l)&nbsp;l&nbsp;=&nbsp;spcount;</span></span>
<span class="tr"><span class="th" id="line3942">3942</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3943">3943</span><span class="td">&nbsp;&nbsp;&nbsp;return&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line3944">3944</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3945">3945</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3946">3946</span><span class="td">&nbsp;if&nbsp;(cobj_flag&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3947">3947</span><span class="td">&nbsp;&nbsp;.CodeTwo;</span></span>
<span class="tr"><span class="th" id="line3948">3948</span><span class="td">&nbsp;&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3949">3949</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;[scoring&nbsp;&quot;,&nbsp;(the)&nbsp;obj,&nbsp;&quot;&nbsp;(simple);&nbsp;parameters&nbsp;=&nbsp;&quot;,&nbsp;parameters,</span></span>
<span class="tr"><span class="th" id="line3950">3950</span><span class="td">&nbsp;&nbsp;&nbsp;&quot;&nbsp;aw&nbsp;=&nbsp;&quot;,&nbsp;advance_warning,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3951">3951</span><span class="td">&nbsp;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line3952">3952</span><span class="td">&nbsp;&nbsp;@push&nbsp;action_to_be;</span></span>
<span class="tr"><span class="th" id="line3953">3953</span><span class="td">&nbsp;&nbsp;if&nbsp;(parameters==0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3954">3954</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(advance_warning&nbsp;&gt;&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line3955">3955</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;ScoreDabCombo(obj,&nbsp;advance_warning);</span></span>
<span class="tr"><span class="th" id="line3956">3956</span><span class="td">&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line3957">3957</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;ScoreDabCombo(obj,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line3958">3958</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3959">3959</span><span class="td">&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;ScoreDabCombo(parser_results--&gt;INP1_PRES,&nbsp;obj);</span></span>
<span class="tr"><span class="th" id="line3960">3960</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3961">3961</span><span class="td">&nbsp;&nbsp;@pull&nbsp;action_to_be;</span></span>
<span class="tr"><span class="th" id="line3962">3962</span><span class="td">&nbsp;&nbsp;return&nbsp;l;</span></span>
<span class="tr"><span class="th" id="line3963">3963</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3964">3964</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line3965">3965</span><span class="td">&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3966">3966</span><span class="td">&nbsp;print&nbsp;&quot;[choosing&nbsp;a&nbsp;cobj&nbsp;strategy:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line3967">3967</span><span class="td">&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line3968">3968</span><span class="td">&nbsp;swn&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line3969">3969</span><span class="td">&nbsp;spcount&nbsp;=&nbsp;pcount;</span></span>
<span class="tr"><span class="th" id="line3970">3970</span><span class="td">&nbsp;while&nbsp;(line_ttype--&gt;pcount&nbsp;==&nbsp;PREPOSITION_TT)&nbsp;pcount++;</span></span>
<span class="tr"><span class="th" id="line3971">3971</span><span class="td">&nbsp;if&nbsp;(line_ttype--&gt;pcount&nbsp;==&nbsp;ELEMENTARY_TT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3972">3972</span><span class="td">&nbsp;&nbsp;if&nbsp;(line_tdata--&gt;pcount&nbsp;==&nbsp;TOPIC_TOKEN)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3973">3973</span><span class="td">&nbsp;&nbsp;&nbsp;pcount&nbsp;=&nbsp;spcount;</span></span>
<span class="tr"><span class="th" id="line3974">3974</span><span class="td">&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3947">CodeTwo</a>;</span></span>
<span class="tr"><span class="th" id="line3975">3975</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3976">3976</span><span class="td">&nbsp;&nbsp;while&nbsp;(wn&nbsp;&lt;=&nbsp;num_words)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line3977">3977</span><span class="td">&nbsp;&nbsp;&nbsp;l&nbsp;=&nbsp;NextWordStopped();&nbsp;wn--;</span></span>
<span class="tr"><span class="th" id="line3978">3978</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;THEN1__WD)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line3979">3979</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;(l&nbsp;~=&nbsp;-1&nbsp;or&nbsp;0)&nbsp;&amp;&amp;&nbsp;(l-&gt;#dict_par1)&nbsp;&amp;8&nbsp;)&nbsp;{&nbsp;wn++;&nbsp;continue;&nbsp;}&nbsp;!&nbsp;if&nbsp;preposition</span></span>
<span class="tr"><span class="th" id="line3980">3980</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(l&nbsp;==&nbsp;ALL1__WD&nbsp;or&nbsp;ALL2__WD&nbsp;or&nbsp;ALL3__WD&nbsp;or&nbsp;ALL4__WD&nbsp;or&nbsp;ALL5__WD)&nbsp;{&nbsp;wn++;&nbsp;continue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line3981">3981</span><span class="td">&nbsp;&nbsp;&nbsp;SafeSkipDescriptors();</span></span>
<span class="tr"><span class="th" id="line3982">3982</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;save&nbsp;the&nbsp;current&nbsp;match&nbsp;state</span></span>
<span class="tr"><span class="th" id="line3983">3983</span><span class="td">&nbsp;&nbsp;&nbsp;@push&nbsp;match_length;&nbsp;@push&nbsp;token_filter;&nbsp;@push&nbsp;match_from;</span></span>
<span class="tr"><span class="th" id="line3984">3984</span><span class="td">&nbsp;&nbsp;&nbsp;alt_match_list--&gt;0&nbsp;=&nbsp;number_matched;</span></span>
<span class="tr"><span class="th" id="line3985">3985</span><span class="td">&nbsp;&nbsp;&nbsp;COBJ__Copy(number_matched,&nbsp;match_list,&nbsp;alt_match_list+WORDSIZE);</span></span>
<span class="tr"><span class="th" id="line3986">3986</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;now&nbsp;get&nbsp;all&nbsp;the&nbsp;matches&nbsp;for&nbsp;the&nbsp;second&nbsp;noun</span></span>
<span class="tr"><span class="th" id="line3987">3987</span><span class="td">&nbsp;&nbsp;&nbsp;match_length&nbsp;=&nbsp;0;&nbsp;number_matched&nbsp;=&nbsp;0;&nbsp;match_from&nbsp;=&nbsp;wn;</span></span>
<span class="tr"><span class="th" id="line3988">3988</span><span class="td">&nbsp;&nbsp;&nbsp;token_filter&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line3989">3989</span><span class="td">&nbsp;&nbsp;&nbsp;SearchScope(actor,&nbsp;actors_location,&nbsp;line_tdata--&gt;pcount);</span></span>
<span class="tr"><span class="th" id="line3990">3990</span><span class="td">&nbsp;&nbsp;&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line3991">3991</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;number_matched,&nbsp;&quot;&nbsp;possible&nbsp;second&nbsp;nouns]^&quot;;</span></span>
<span class="tr"><span class="th" id="line3992">3992</span><span class="td">&nbsp;&nbsp;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line3993">3993</span><span class="td">&nbsp;&nbsp;&nbsp;wn&nbsp;=&nbsp;swn;</span></span>
<span class="tr"><span class="th" id="line3994">3994</span><span class="td">&nbsp;&nbsp;&nbsp;cobj_flag&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line3995">3995</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;restore&nbsp;match&nbsp;variables</span></span>
<span class="tr"><span class="th" id="line3996">3996</span><span class="td">&nbsp;&nbsp;&nbsp;COBJ__SwapMatches();</span></span>
<span class="tr"><span class="th" id="line3997">3997</span><span class="td">&nbsp;&nbsp;&nbsp;@pull&nbsp;match_from;&nbsp;@pull&nbsp;token_filter;&nbsp;@pull&nbsp;match_length;</span></span>
<span class="tr"><span class="th" id="line3998">3998</span><span class="td">&nbsp;&nbsp;&nbsp;pcount&nbsp;=&nbsp;spcount;</span></span>
<span class="tr"><span class="th" id="line3999">3999</span><span class="td">&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3921">CodeOne</a>;</span></span>
<span class="tr"><span class="th" id="line4000">4000</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line4001">4001</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line4002">4002</span><span class="td">&nbsp;pcount&nbsp;=&nbsp;spcount;</span></span>
<span class="tr"><span class="th" id="line4003">4003</span><span class="td">&nbsp;wn&nbsp;=&nbsp;swn;&nbsp;</span></span>
<span class="tr"><span class="th" id="line4004">4004</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line4005">4005</span><span class="td">&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line4006">4006</span><span class="td">&nbsp;print&nbsp;&quot;nothing&nbsp;interesting]^&quot;;</span></span>
<span class="tr"><span class="th" id="line4007">4007</span><span class="td">&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line4008">4008</span><span class="td">&nbsp;cobj_flag&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line4009">4009</span><span class="td">&nbsp;jump&nbsp;<a href="./Parser.i6t.html#line3947">CodeTwo</a>;</span></span>
<span class="tr"><span class="th" id="line4010">4010</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line4011">4011</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line4012">4012</span><span class="td">[&nbsp;ScoreDabCombo&nbsp;a&nbsp;b&nbsp;&nbsp;result;</span></span>
<span class="tr"><span class="th" id="line4013">4013</span><span class="td">&nbsp;@push&nbsp;action;&nbsp;@push&nbsp;act_requester;&nbsp;@push&nbsp;noun;&nbsp;@push&nbsp;second;</span></span>
<span class="tr"><span class="th" id="line4014">4014</span><span class="td">&nbsp;action&nbsp;=&nbsp;action_to_be;</span></span>
<span class="tr"><span class="th" id="line4015">4015</span><span class="td">&nbsp;act_requester&nbsp;=&nbsp;player;</span></span>
<span class="tr"><span class="th" id="line4016">4016</span><span class="td">&nbsp;if&nbsp;(action_reversed)&nbsp;{&nbsp;noun&nbsp;=&nbsp;b;&nbsp;second&nbsp;=&nbsp;a;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line4017">4017</span><span class="td">&nbsp;else&nbsp;{&nbsp;noun&nbsp;=&nbsp;a;&nbsp;second&nbsp;=&nbsp;b;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line4018">4018</span><span class="td">&nbsp;result&nbsp;=&nbsp;CheckDPMR();</span></span>
<span class="tr"><span class="th" id="line4019">4019</span><span class="td">&nbsp;@pull&nbsp;second;&nbsp;@pull&nbsp;noun;&nbsp;@pull&nbsp;act_requester;&nbsp;@pull&nbsp;action;</span></span>
<span class="tr"><span class="th" id="line4020">4020</span><span class="td">&nbsp;#ifdef&nbsp;COBJ_DEBUG;</span></span>
<span class="tr"><span class="th" id="line4021">4021</span><span class="td">&nbsp;print&nbsp;&quot;[&quot;,&nbsp;(the)&nbsp;a,&nbsp;&quot;&nbsp;/&nbsp;&quot;,&nbsp;(the)&nbsp;b,&nbsp;&quot;&nbsp;=&gt;&nbsp;&quot;,&nbsp;result,&nbsp;&quot;]^&quot;;</span></span>
<span class="tr"><span class="th" id="line4022">4022</span><span class="td">&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line4023">4023</span><span class="td">&nbsp;return&nbsp;result;</span></span>
<span class="tr"><span class="th" id="line4024">4024</span><span class="td">];</span></span>
</div><div class='text'>
<h3>Default Topic.</h3><p><p> A default value for the I7 sort-of-kind &quot;topic&quot;, which never matches.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line4030">4030</span><span class="td">[&nbsp;DefaultTopic;&nbsp;return&nbsp;GPR_FAIL;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line4031">4031</span><span class="td"></span></span>
</div><footer><hr><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
