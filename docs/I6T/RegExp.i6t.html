<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>RegExp</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}

.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 50rem; }
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: 1rem; margin-bottom: 2rem; }
    </style>
</head>
<body>
<div id="front_matter">
<h1><a href="./RegExp.i6t">RegExp</a></h1><h2>Debugging.</h2><p><p> Set this to true at your peril.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line11">11</span><span class="td">Global&nbsp;TEXT_TY_RE_Trace&nbsp;=&nbsp;false;&nbsp;!&nbsp;Change&nbsp;to&nbsp;true&nbsp;for&nbsp;(a&nbsp;lot&nbsp;of)&nbsp;debugging&nbsp;data&nbsp;in&nbsp;use</span></span>
<span class="tr"><span class="th" id="line12">12</span><span class="td">[&nbsp;TEXT_TY_RE_SetTrace&nbsp;F;&nbsp;TEXT_TY_RE_Trace&nbsp;=&nbsp;F;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line13">13</span><span class="td"></span></span>
</div><div class='text'>
<h2>Algorithm.</h2><p><p> Once Inform 7 supported (indexed) text, regular-expression matching became an obvious goal: regexp-based features offer more or less the gold standard in text search and replace facilities, and I7 is so concerned with text that we shouldn&#39;t make do with less. But the best and most portable implementation of regular expression matching, PCRE by Philip Hazel, is about a hundred times larger than the code in this section, and also had unacceptable memory needs: there was no practicable way to make it small enough to do useful work on the Z-machine. Nor could an I6 regexp-matcher compile just-in-time code, or translate the expression into a suitable deterministic finite state machine. One day, though, I read one of the papers which Brian Kernighan writes every few years to the effect that regular-expression matching is much easier than you think. Kernighan is right: writing a regexp matcher is indeed easier than you think (one day&#39;s worth of cheerful hacking), but debugging one until it passes the trickiest hundred of Perl&#39;s 645 test cases is another matter (and it took a whole week more). Still, the result seems to be robust. The main compromise made is that backtracking is not always comprehensive with regexps like <span class="fixed">^(a\1?){4}$</span>, because we do not allocate individual storage to backtrack individually through all possibilities of each of the four uses of the bracketed subexpression &ndash; which means we miss some cases, since the subexpression contains a reference to itself, so that its content can vary in the four uses. PCRE&#39;s approach here is to expand the expression as if it were a sequence of four bracketed expressions, thus removing the awkward quantifier <span class="fixed">{4}</span>, but that costs memory: indeed this is why PCRE cannot solve all of Perl&#39;s test cases without its default memory allocation being raised. In other respects, the algorithm below appears to be accurate if not very fast.<p></p><p><h2>Class Codes.</h2><p><p> While in principle we could keep the match expression in textual form, in practice the syntax of regular expressions is complex enough that this would be tricky and rather slow: we would be parsing the same notations over and over again. So we begin by compiling it to a simple tree structure. The tree is made up of nodes, and each node has a &quot;class code&quot;: these are identified by the <span class="fixed">*_RE_CC</span> constants below. Note that the class codes below are all negative: this is so that they are distinct from all valid ZSCII or Unicode characters. (ZSCII is used only on the Z-machine, which has a 16-bit word but an 8-bit character set, so that all character values are positive; similarly, Unicode is (for our purposes) a 16-bit character set on a 32-bit virtual machine.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line57">57</span><span class="td">!&nbsp;Character&nbsp;classes</span></span>
<span class="tr"><span class="th" id="line58">58</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line59">59</span><span class="td">Constant&nbsp;NEWLINE_RE_CC&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line60">60</span><span class="td">Constant&nbsp;TAB_RE_CC&nbsp;=&nbsp;-2;</span></span>
<span class="tr"><span class="th" id="line61">61</span><span class="td">Constant&nbsp;DIGIT_RE_CC&nbsp;=&nbsp;-3;</span></span>
<span class="tr"><span class="th" id="line62">62</span><span class="td">Constant&nbsp;NONDIGIT_RE_CC&nbsp;=&nbsp;-4;</span></span>
<span class="tr"><span class="th" id="line63">63</span><span class="td">Constant&nbsp;WHITESPACE_RE_CC&nbsp;=&nbsp;-5;</span></span>
<span class="tr"><span class="th" id="line64">64</span><span class="td">Constant&nbsp;NONWHITESPACE_RE_CC&nbsp;=&nbsp;-6;</span></span>
<span class="tr"><span class="th" id="line65">65</span><span class="td">Constant&nbsp;PUNCTUATION_RE_CC&nbsp;=&nbsp;-7;</span></span>
<span class="tr"><span class="th" id="line66">66</span><span class="td">Constant&nbsp;NONPUNCTUATION_RE_CC&nbsp;=&nbsp;-8;</span></span>
<span class="tr"><span class="th" id="line67">67</span><span class="td">Constant&nbsp;WORD_RE_CC&nbsp;=&nbsp;-9;</span></span>
<span class="tr"><span class="th" id="line68">68</span><span class="td">Constant&nbsp;NONWORD_RE_CC&nbsp;=&nbsp;-10;</span></span>
<span class="tr"><span class="th" id="line69">69</span><span class="td">Constant&nbsp;ANYTHING_RE_CC&nbsp;=&nbsp;-11;</span></span>
<span class="tr"><span class="th" id="line70">70</span><span class="td">Constant&nbsp;NOTHING_RE_CC&nbsp;=&nbsp;-12;</span></span>
<span class="tr"><span class="th" id="line71">71</span><span class="td">Constant&nbsp;RANGE_RE_CC&nbsp;=&nbsp;-13;</span></span>
<span class="tr"><span class="th" id="line72">72</span><span class="td">Constant&nbsp;LCASE_RE_CC&nbsp;=&nbsp;-14;</span></span>
<span class="tr"><span class="th" id="line73">73</span><span class="td">Constant&nbsp;NONLCASE_RE_CC&nbsp;=&nbsp;-15;</span></span>
<span class="tr"><span class="th" id="line74">74</span><span class="td">Constant&nbsp;UCASE_RE_CC&nbsp;=&nbsp;-16;</span></span>
<span class="tr"><span class="th" id="line75">75</span><span class="td">Constant&nbsp;NONUCASE_RE_CC&nbsp;=&nbsp;-17;</span></span>
<span class="tr"><span class="th" id="line76">76</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line77">77</span><span class="td">!&nbsp;Control&nbsp;structures</span></span>
<span class="tr"><span class="th" id="line78">78</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line79">79</span><span class="td">Constant&nbsp;SUBEXP_RE_CC&nbsp;=&nbsp;-20;</span></span>
<span class="tr"><span class="th" id="line80">80</span><span class="td">Constant&nbsp;DISJUNCTION_RE_CC&nbsp;=&nbsp;-21;</span></span>
<span class="tr"><span class="th" id="line81">81</span><span class="td">Constant&nbsp;CHOICE_RE_CC&nbsp;=&nbsp;-22;</span></span>
<span class="tr"><span class="th" id="line82">82</span><span class="td">Constant&nbsp;QUANTIFIER_RE_CC&nbsp;=&nbsp;-23;</span></span>
<span class="tr"><span class="th" id="line83">83</span><span class="td">Constant&nbsp;IF_RE_CC&nbsp;=&nbsp;-24;</span></span>
<span class="tr"><span class="th" id="line84">84</span><span class="td">Constant&nbsp;CONDITION_RE_CC&nbsp;=&nbsp;-25;</span></span>
<span class="tr"><span class="th" id="line85">85</span><span class="td">Constant&nbsp;THEN_RE_CC&nbsp;=&nbsp;-26;</span></span>
<span class="tr"><span class="th" id="line86">86</span><span class="td">Constant&nbsp;ELSE_RE_CC&nbsp;=&nbsp;-27;</span></span>
<span class="tr"><span class="th" id="line87">87</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line88">88</span><span class="td">!&nbsp;Substring&nbsp;matchers</span></span>
<span class="tr"><span class="th" id="line89">89</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line90">90</span><span class="td">Constant&nbsp;VARIABLE_RE_CC&nbsp;=&nbsp;-30;</span></span>
<span class="tr"><span class="th" id="line91">91</span><span class="td">Constant&nbsp;LITERAL_RE_CC&nbsp;=&nbsp;-31;</span></span>
<span class="tr"><span class="th" id="line92">92</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line93">93</span><span class="td">!&nbsp;Positional&nbsp;matchers</span></span>
<span class="tr"><span class="th" id="line94">94</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line95">95</span><span class="td">Constant&nbsp;START_RE_CC&nbsp;=&nbsp;-40;</span></span>
<span class="tr"><span class="th" id="line96">96</span><span class="td">Constant&nbsp;END_RE_CC&nbsp;=&nbsp;-41;</span></span>
<span class="tr"><span class="th" id="line97">97</span><span class="td">Constant&nbsp;BOUNDARY_RE_CC&nbsp;=&nbsp;-42;</span></span>
<span class="tr"><span class="th" id="line98">98</span><span class="td">Constant&nbsp;NONBOUNDARY_RE_CC&nbsp;=&nbsp;-43;</span></span>
<span class="tr"><span class="th" id="line99">99</span><span class="td">Constant&nbsp;ALWAYS_RE_CC&nbsp;=&nbsp;-44;</span></span>
<span class="tr"><span class="th" id="line100">100</span><span class="td">Constant&nbsp;NEVER_RE_CC&nbsp;=&nbsp;-45;</span></span>
<span class="tr"><span class="th" id="line101">101</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line102">102</span><span class="td">!&nbsp;Mode&nbsp;switches</span></span>
<span class="tr"><span class="th" id="line103">103</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line104">104</span><span class="td">Constant&nbsp;SENSITIVITY_RE_CC&nbsp;=&nbsp;-50;</span></span>
<span class="tr"><span class="th" id="line105">105</span><span class="td"></span></span>
</div><div class='text'>
<h2>Packets.</h2><p><p> The nodes of the compiled expression tree are stored in &quot;packets&quot;, which are segments of a fixed array. A regexp complicated enough that it cannot be stored in <a href="./RegExp.i6t.html#line121">RE_MAX_PACKETS</a> packets will be rejected with an error: it looks like a rather low limit, but in fact suffices to handle all of Perl&#39;s test cases, some of which are works of diabolism.<p></p><p> A packet is then a record containing 14 fields, with offsets defined by the constants defined below. These fields combine the compilation of the corresponding fragment of the regexp with both the tree structure holding these packets together and also the current state of the temporary variables recording how far we have progressed in trying all of the possible ways to match the packet.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line121">121</span><span class="td">Constant&nbsp;RE_MAX_PACKETS&nbsp;=&nbsp;32;</span></span>
<span class="tr"><span class="th" id="line122">122</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line123">123</span><span class="td">Constant&nbsp;RE_PACKET_SIZE&nbsp;=&nbsp;14;&nbsp;!&nbsp;Words&nbsp;of&nbsp;memory&nbsp;used&nbsp;per&nbsp;packet</span></span>
<span class="tr"><span class="th" id="line124">124</span><span class="td">Constant&nbsp;RE_PACKET_SIZE_IN_BYTES&nbsp;=&nbsp;WORDSIZE*RE_PACKET_SIZE;&nbsp;!&nbsp;Bytes&nbsp;used&nbsp;per&nbsp;packet</span></span>
<span class="tr"><span class="th" id="line125">125</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line126">126</span><span class="td">Array&nbsp;RE_PACKET_space&nbsp;--&gt;&nbsp;RE_MAX_PACKETS*RE_PACKET_SIZE;</span></span>
<span class="tr"><span class="th" id="line127">127</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line128">128</span><span class="td">Constant&nbsp;RE_CCLASS&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;One&nbsp;of&nbsp;the&nbsp;class&nbsp;codes&nbsp;defined&nbsp;above</span></span>
<span class="tr"><span class="th" id="line129">129</span><span class="td">Constant&nbsp;RE_PAR1&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Three&nbsp;parameters&nbsp;whose&nbsp;meaning&nbsp;depends&nbsp;on&nbsp;class&nbsp;code</span></span>
<span class="tr"><span class="th" id="line130">130</span><span class="td">Constant&nbsp;RE_PAR2&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line131">131</span><span class="td">Constant&nbsp;RE_PAR3&nbsp;=&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line132">132</span><span class="td">Constant&nbsp;RE_NEXT&nbsp;=&nbsp;4;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Younger&nbsp;sibling&nbsp;in&nbsp;the&nbsp;compiled&nbsp;tree</span></span>
<span class="tr"><span class="th" id="line133">133</span><span class="td">Constant&nbsp;RE_PREVIOUS&nbsp;=&nbsp;5;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Elder&nbsp;sibling</span></span>
<span class="tr"><span class="th" id="line134">134</span><span class="td">Constant&nbsp;RE_DOWN&nbsp;=&nbsp;6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Child</span></span>
<span class="tr"><span class="th" id="line135">135</span><span class="td">Constant&nbsp;RE_UP&nbsp;=&nbsp;7;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Parent</span></span>
<span class="tr"><span class="th" id="line136">136</span><span class="td">Constant&nbsp;RE_DATA1&nbsp;=&nbsp;8;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;Backtracking&nbsp;data</span></span>
<span class="tr"><span class="th" id="line137">137</span><span class="td">Constant&nbsp;RE_DATA2&nbsp;=&nbsp;9;</span></span>
<span class="tr"><span class="th" id="line138">138</span><span class="td">Constant&nbsp;RE_CONSTRAINT&nbsp;=&nbsp;10;</span></span>
<span class="tr"><span class="th" id="line139">139</span><span class="td">Constant&nbsp;RE_CACHE1&nbsp;=&nbsp;11;</span></span>
<span class="tr"><span class="th" id="line140">140</span><span class="td">Constant&nbsp;RE_CACHE2&nbsp;=&nbsp;12;</span></span>
<span class="tr"><span class="th" id="line141">141</span><span class="td">Constant&nbsp;RE_MODES&nbsp;=&nbsp;13;</span></span>
<span class="tr"><span class="th" id="line142">142</span><span class="td"></span></span>
</div><div class='text'>
<h2>Nodes.</h2><p><p> The routine to create a node, something which happens only during the compilation phase, and also the routine which returns the address of a given node. Nodes are numbered from 0 up to $M-1$, where $M$ is the constant <a href="./RegExp.i6t.html#line121">RE_MAX_PACKETS</a>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line150">150</span><span class="td">[&nbsp;TEXT_TY_RE_Node&nbsp;n&nbsp;cc&nbsp;par1&nbsp;par2&nbsp;par3&nbsp;&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line151">151</span><span class="td">&nbsp;if&nbsp;((n&lt;0)&nbsp;||&nbsp;(n&nbsp;&gt;=&nbsp;RE_MAX_PACKETS))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line152">152</span><span class="td">&nbsp;offset&nbsp;=&nbsp;RE_PACKET_space&nbsp;+&nbsp;n*RE_PACKET_SIZE_IN_BYTES;</span></span>
<span class="tr"><span class="th" id="line153">153</span><span class="td">&nbsp;offset--&gt;RE_CCLASS&nbsp;=&nbsp;cc;</span></span>
<span class="tr"><span class="th" id="line154">154</span><span class="td">&nbsp;offset--&gt;RE_PAR1&nbsp;=&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line155">155</span><span class="td">&nbsp;offset--&gt;RE_PAR2&nbsp;=&nbsp;par2;</span></span>
<span class="tr"><span class="th" id="line156">156</span><span class="td">&nbsp;offset--&gt;RE_PAR3&nbsp;=&nbsp;par3;</span></span>
<span class="tr"><span class="th" id="line157">157</span><span class="td">&nbsp;offset--&gt;RE_NEXT&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line158">158</span><span class="td">&nbsp;offset--&gt;RE_PREVIOUS&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line159">159</span><span class="td">&nbsp;offset--&gt;RE_DOWN&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line160">160</span><span class="td">&nbsp;offset--&gt;RE_UP&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line161">161</span><span class="td">&nbsp;offset--&gt;RE_DATA1&nbsp;=&nbsp;-1;&nbsp;!&nbsp;Match&nbsp;start</span></span>
<span class="tr"><span class="th" id="line162">162</span><span class="td">&nbsp;offset--&gt;RE_DATA2&nbsp;=&nbsp;-1;&nbsp;!&nbsp;Match&nbsp;end</span></span>
<span class="tr"><span class="th" id="line163">163</span><span class="td">&nbsp;offset--&gt;RE_CONSTRAINT&nbsp;=&nbsp;-1;&nbsp;!&nbsp;Rewind&nbsp;edge</span></span>
<span class="tr"><span class="th" id="line164">164</span><span class="td">&nbsp;return&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line165">165</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line166">166</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line167">167</span><span class="td">[&nbsp;TEXT_TY_RE_NodeAddress&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td">&nbsp;if&nbsp;((n&lt;0)&nbsp;||&nbsp;(n&nbsp;&gt;=&nbsp;RE_MAX_PACKETS))&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">&nbsp;return&nbsp;RE_PACKET_space&nbsp;+&nbsp;n*RE_PACKET_SIZE_IN_BYTES;</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td"></span></span>
</div><div class='text'>
<h2>Match Variables.</h2><p><p> A bracketed subexpression can be used as a variable: we support <span class="fixed">\1</span>, ..., <span class="fixed">\9</span> to mean &quot;the value of subexpression 1 to 9&quot;, and <span class="fixed">\0</span> to mean &quot;the whole text matched&quot;, as if the entire regexp were bracketed. (PCRE and Perl also allow <span class="fixed">\10</span>, <span class="fixed">\11</span>, ..., but we don&#39;t, because it complicates parsing and memory is too short.)<p></p><p> <span class="fixed">RE_Subexpressions--&gt;10</span> stores the number of subexpressions in use, not counting <span class="fixed">\0</span>. During the compiling stage, <span class="fixed">RE_Subexpressions--&gt;N</span> is set to point to the node representating <span class="fixed">\N</span>, where <span class="fixed">N</span> varies from 1 to 9. When matching is complete, and assuming we care about the contents of these variables &ndash; which we might not, and if not we certainly don&#39;t want to waste time and memory &ndash; we call <a href="./RegExp.i6t.html#line207">TEXT_TY_RE_CreateMatchVars</a> to allocate text variables and fill them in as appropriate, memory permitting.<p></p><p> <a href="./RegExp.i6t.html#line229">TEXT_TY_RE_EmptyMatchVars</a> empties any such variables which may survive from a previous match, setting them to the empty text.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line191">191</span><span class="td">Array&nbsp;RE_Subexpressions&nbsp;--&gt;&nbsp;11;&nbsp;!&nbsp;Address&nbsp;of&nbsp;node&nbsp;for&nbsp;this&nbsp;subexpression</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td">Array&nbsp;Allocated_Match_Vars&nbsp;--&gt;&nbsp;10;&nbsp;!&nbsp;Indexed&nbsp;text&nbsp;to&nbsp;hold&nbsp;values&nbsp;of&nbsp;the&nbsp;variables</span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td">[&nbsp;TEXT_TY_RE_DebugMatchVars&nbsp;txt</span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">&nbsp;offset&nbsp;n&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">&nbsp;print&nbsp;RE_Subexpressions--&gt;10,&nbsp;&quot;&nbsp;collecting&nbsp;subexps^&quot;;</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td">&nbsp;for&nbsp;(n=0:(n&lt;RE_Subexpressions--&gt;10)&nbsp;&amp;&amp;&nbsp;(n&lt;10):&nbsp;n++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">&nbsp;&nbsp;offset&nbsp;=&nbsp;RE_Subexpressions--&gt;n;</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;Subexp&nbsp;&quot;,&nbsp;offset--&gt;RE_PAR1,</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td">&nbsp;&nbsp;&nbsp;&quot;&nbsp;=&nbsp;[&quot;,&nbsp;offset--&gt;RE_DATA1,&nbsp;&quot;,&quot;,&nbsp;offset--&gt;RE_DATA2,&nbsp;&quot;]&nbsp;=&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=offset--&gt;RE_DATA1:i&lt;offset--&gt;RE_DATA2:i++)</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;(char)&nbsp;BlkValueRead(txt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td">[&nbsp;TEXT_TY_RE_CreateMatchVars&nbsp;txt</span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">&nbsp;offset&nbsp;n&nbsp;i&nbsp;ch&nbsp;ctxt&nbsp;cl&nbsp;csize;</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;for&nbsp;(n=0:(n&lt;RE_Subexpressions--&gt;10)&nbsp;&amp;&amp;&nbsp;(n&lt;10):&nbsp;n++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;&nbsp;offset&nbsp;=&nbsp;RE_Subexpressions--&gt;n;</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">&nbsp;&nbsp;if&nbsp;(Allocated_Match_Vars--&gt;n)&nbsp;BlkValueFree(Allocated_Match_Vars--&gt;n);</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">&nbsp;&nbsp;Allocated_Match_Vars--&gt;n&nbsp;=&nbsp;BlkValueCreate(TEXT_TY);</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">&nbsp;&nbsp;TEXT_TY_Transmute(Allocated_Match_Vars--&gt;n);</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td">&nbsp;&nbsp;ctxt&nbsp;=&nbsp;Allocated_Match_Vars--&gt;n;</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">&nbsp;&nbsp;csize&nbsp;=&nbsp;BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;&nbsp;cl&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=offset--&gt;RE_DATA1:i&lt;offset--&gt;RE_DATA2:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(cl+1&nbsp;&gt;=&nbsp;csize)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueSetLBCapacity(ctxt,&nbsp;2*cl)&nbsp;==&nbsp;false)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;csize&nbsp;=&nbsp;BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt,&nbsp;cl++,&nbsp;ch);</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;&nbsp;BlkValueWrite(ctxt,&nbsp;cl,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">[&nbsp;TEXT_TY_RE_EmptyMatchVars&nbsp;txt</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">&nbsp;for&nbsp;(n=0:(n&lt;RE_Subexpressions--&gt;10)&nbsp;&amp;&amp;&nbsp;(n&lt;10):&nbsp;n++)</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td">&nbsp;&nbsp;if&nbsp;(Allocated_Match_Vars--&gt;n&nbsp;~=&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">&nbsp;&nbsp;&nbsp;BlkValueWrite(Allocated_Match_Vars--&gt;n,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line235">235</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line236">236</span><span class="td">[&nbsp;TEXT_TY_RE_GetMatchVar&nbsp;vn</span></span>
<span class="tr"><span class="th" id="line237">237</span><span class="td">&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line238">238</span><span class="td">&nbsp;if&nbsp;((vn&lt;0)&nbsp;||&nbsp;(vn&gt;=10)&nbsp;||&nbsp;(vn&nbsp;&gt;=&nbsp;RE_Subexpressions--&gt;10))&nbsp;return&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line239">239</span><span class="td">&nbsp;offset&nbsp;=&nbsp;RE_Subexpressions--&gt;vn;</span></span>
<span class="tr"><span class="th" id="line240">240</span><span class="td">&nbsp;if&nbsp;(offset&nbsp;==&nbsp;0)&nbsp;return&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line241">241</span><span class="td">&nbsp;if&nbsp;(offset--&gt;RE_DATA1&nbsp;&lt;&nbsp;0)&nbsp;return&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line242">242</span><span class="td">&nbsp;if&nbsp;(Allocated_Match_Vars--&gt;vn&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;***&nbsp;&quot;,&nbsp;vn,&nbsp;&quot;&nbsp;unallocated!&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td">&nbsp;&nbsp;return&nbsp;EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line245">245</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line246">246</span><span class="td">&nbsp;return&nbsp;Allocated_Match_Vars--&gt;vn;</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td"></span></span>
</div><div class='text'>
<h2>Markers.</h2><p><p> At each node, the <span class="fixed">--&gt;RE_DATA1</span> and <span class="fixed">--&gt;RE_DATA2</span> fields represent the character positions of the start and end of the text matched by the node and its subtree (if any). These are called markers.<p></p><p> Thus |TEXT_TY_MV_End(N, 0)| returns the start of <span class="fixed">\N</span> and |TEXT_TY_MV_End(N, 1)| the end of <span class="fixed">\N</span>, according to the current match of subexpression <span class="fixed">N</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line258">258</span><span class="td">[&nbsp;TEXT_TY_MV_End&nbsp;n&nbsp;end</span></span>
<span class="tr"><span class="th" id="line259">259</span><span class="td">&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line260">260</span><span class="td">&nbsp;offset&nbsp;=&nbsp;RE_Subexpressions--&gt;n;</span></span>
<span class="tr"><span class="th" id="line261">261</span><span class="td">&nbsp;if&nbsp;(end==0)&nbsp;return&nbsp;offset--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line262">262</span><span class="td">&nbsp;return&nbsp;offset--&gt;RE_DATA2;</span></span>
<span class="tr"><span class="th" id="line263">263</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line264">264</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line265">265</span><span class="td">[&nbsp;TEXT_TY_RE_Clear_Markers&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line266">266</span><span class="td">&nbsp;for&nbsp;(:&nbsp;token&nbsp;~=&nbsp;NULL:&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line267">267</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;TEXT_TY_RE_Clear_Markers(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line268">268</span><span class="td">&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line269">269</span><span class="td">&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line270">270</span><span class="td">&nbsp;&nbsp;token--&gt;RE_CONSTRAINT&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line271">271</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line272">272</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td"></span></span>
</div><div class='text'>
<h2>Debugging.</h2><p><p> Code in this paragraph simply prints a convenient screen representation of the compiled regexp, together with the current values of its markers. It is invaluable for debugging purposes and, touch wood, may not be needed again, but it is relatively compact and we keep it just in case.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line281">281</span><span class="td">[&nbsp;TEXT_TY_RE_DebugTree&nbsp;ftxt&nbsp;detail;</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;print&nbsp;&quot;Pattern:&nbsp;&quot;,&nbsp;(TEXT_TY_Say)&nbsp;ftxt,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;TEXT_TY_RE_DebugSubtree(ftxt,&nbsp;1,&nbsp;RE_PACKET_space,&nbsp;detail);</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">[&nbsp;TEXT_TY_RE_DebugSubtree&nbsp;ftxt&nbsp;depth&nbsp;offset&nbsp;detail</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;cup;</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;if&nbsp;(offset&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">&nbsp;&nbsp;cup&nbsp;=&nbsp;offset--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;&nbsp;if&nbsp;(offset--&gt;RE_PREVIOUS&nbsp;~=&nbsp;NULL)&nbsp;print&nbsp;&quot;***&nbsp;broken&nbsp;initial&nbsp;previous&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">&nbsp;while&nbsp;(offset&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line293">293</span><span class="td">&nbsp;&nbsp;if&nbsp;(offset--&gt;RE_UP&nbsp;~=&nbsp;cup)&nbsp;print&nbsp;&quot;***&nbsp;broken&nbsp;up&nbsp;matching&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line294">294</span><span class="td">&nbsp;&nbsp;spaces(depth*2);</span></span>
<span class="tr"><span class="th" id="line295">295</span><span class="td">&nbsp;&nbsp;TEXT_TY_RE_DebugNode(offset,&nbsp;ftxt,&nbsp;detail);</span></span>
<span class="tr"><span class="th" id="line296">296</span><span class="td">&nbsp;&nbsp;if&nbsp;(offset--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line297">297</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((offset--&gt;RE_DOWN)--&gt;RE_UP&nbsp;~=&nbsp;offset)</span></span>
<span class="tr"><span class="th" id="line298">298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;***&nbsp;broken&nbsp;down/up&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line299">299</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugSubtree(ftxt,&nbsp;depth+1,&nbsp;offset--&gt;RE_DOWN,&nbsp;detail);</span></span>
<span class="tr"><span class="th" id="line300">300</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">&nbsp;&nbsp;if&nbsp;(offset--&gt;RE_NEXT&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((offset--&gt;RE_NEXT)--&gt;RE_PREVIOUS&nbsp;~=&nbsp;offset)</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;***&nbsp;broken&nbsp;next/previous&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;offset&nbsp;=&nbsp;offset--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">[&nbsp;TEXT_TY_RE_DebugNode&nbsp;offset&nbsp;ftxt&nbsp;detail</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">&nbsp;i&nbsp;par1&nbsp;par2&nbsp;par3;</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">&nbsp;if&nbsp;(offset&nbsp;==&nbsp;NULL)&nbsp;&quot;[NULL]&quot;;</span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td">&nbsp;print&nbsp;&quot;[&quot;,&nbsp;(offset-RE_PACKET_space)/(RE_PACKET_SIZE_IN_BYTES),&nbsp;&quot;]&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line313">313</span><span class="td">&nbsp;!&nbsp;for&nbsp;(i=0:i&lt;RE_PACKET_SIZE:i++)&nbsp;print&nbsp;offset--&gt;i,&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line314">314</span><span class="td">&nbsp;par1&nbsp;=&nbsp;offset--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line315">315</span><span class="td">&nbsp;par2&nbsp;=&nbsp;offset--&gt;RE_PAR2;</span></span>
<span class="tr"><span class="th" id="line316">316</span><span class="td">&nbsp;par3&nbsp;=&nbsp;offset--&gt;RE_PAR3;</span></span>
<span class="tr"><span class="th" id="line317">317</span><span class="td">&nbsp;switch&nbsp;(offset--&gt;RE_CCLASS)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line318">318</span><span class="td">&nbsp;&nbsp;DIGIT_RE_CC:&nbsp;print&nbsp;&quot;DIGIT&quot;;</span></span>
<span class="tr"><span class="th" id="line319">319</span><span class="td">&nbsp;&nbsp;NONDIGIT_RE_CC:&nbsp;print&nbsp;&quot;NONDIGIT&quot;;</span></span>
<span class="tr"><span class="th" id="line320">320</span><span class="td">&nbsp;&nbsp;UCASE_RE_CC:&nbsp;print&nbsp;&quot;UCASE&quot;;</span></span>
<span class="tr"><span class="th" id="line321">321</span><span class="td">&nbsp;&nbsp;NONUCASE_RE_CC:&nbsp;print&nbsp;&quot;NONUCASE&quot;;</span></span>
<span class="tr"><span class="th" id="line322">322</span><span class="td">&nbsp;&nbsp;LCASE_RE_CC:&nbsp;print&nbsp;&quot;LCASE&quot;;</span></span>
<span class="tr"><span class="th" id="line323">323</span><span class="td">&nbsp;&nbsp;NONLCASE_RE_CC:&nbsp;print&nbsp;&quot;NONLCASE&quot;;</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">&nbsp;&nbsp;WHITESPACE_RE_CC:&nbsp;print&nbsp;&quot;WHITESPACE&quot;;</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">&nbsp;&nbsp;NONWHITESPACE_RE_CC:&nbsp;print&nbsp;&quot;NONWHITESPACE&quot;;</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">&nbsp;&nbsp;PUNCTUATION_RE_CC:&nbsp;print&nbsp;&quot;PUNCTUATION&quot;;</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">&nbsp;&nbsp;NONPUNCTUATION_RE_CC:&nbsp;print&nbsp;&quot;NONPUNCTUATION&quot;;</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td">&nbsp;&nbsp;WORD_RE_CC:&nbsp;print&nbsp;&quot;WORD&quot;;</span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">&nbsp;&nbsp;NONWORD_RE_CC:&nbsp;print&nbsp;&quot;NONWORD&quot;;</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">&nbsp;&nbsp;ALWAYS_RE_CC:&nbsp;print&nbsp;&quot;ALWAYS&quot;;</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;&nbsp;NEVER_RE_CC:&nbsp;print&nbsp;&quot;NEVER&quot;;</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">&nbsp;&nbsp;START_RE_CC:&nbsp;print&nbsp;&quot;START&quot;;</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;&nbsp;END_RE_CC:&nbsp;print&nbsp;&quot;END&quot;;</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;&nbsp;BOUNDARY_RE_CC:&nbsp;print&nbsp;&quot;BOUNDARY&quot;;</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;NONBOUNDARY_RE_CC:&nbsp;print&nbsp;&quot;NONBOUNDARY&quot;;</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;ANYTHING_RE_CC:&nbsp;print&nbsp;&quot;ANYTHING&quot;;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;&nbsp;NOTHING_RE_CC:&nbsp;print&nbsp;&quot;NOTHING&quot;;</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;RANGE_RE_CC:&nbsp;print&nbsp;&quot;RANGE&quot;;&nbsp;if&nbsp;(par3&nbsp;==&nbsp;true)&nbsp;print&nbsp;&quot;&nbsp;(negated)&quot;;</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=par1:i&lt;par2:i++)&nbsp;print&nbsp;(char)&nbsp;BlkValueRead(ftxt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;VARIABLE_RE_CC:&nbsp;print&nbsp;&quot;VARIABLE&nbsp;&quot;,&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;SUBEXP_RE_CC:</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par1&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;EXP&quot;;</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;&quot;SUBEXP&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par1&nbsp;&gt;=&nbsp;0)&nbsp;print&nbsp;&quot;=&nbsp;V&quot;,&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par3&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;&nbsp;(?=...)&nbsp;lookahead&quot;;</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;&quot;&nbsp;(?&lt;=...)&nbsp;lookbehind&nbsp;of&nbsp;width&nbsp;&quot;,&nbsp;par3;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par3&nbsp;==&nbsp;0)&nbsp;print&nbsp;&quot;&nbsp;(?!...)&nbsp;negated&nbsp;lookahead&quot;;</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;print&nbsp;&quot;&nbsp;(?&lt;!...)&nbsp;negated&nbsp;lookbehind&nbsp;of&nbsp;width&nbsp;&quot;,&nbsp;par3;</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line354">354</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;3)&nbsp;print&nbsp;&quot;&nbsp;uncollecting&quot;;</span></span>
<span class="tr"><span class="th" id="line355">355</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;0&nbsp;or&nbsp;3)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line356">356</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par3&nbsp;==&nbsp;1)&nbsp;print&nbsp;&quot;&nbsp;forcing&nbsp;case&nbsp;sensitivity&quot;;</span></span>
<span class="tr"><span class="th" id="line357">357</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par3&nbsp;==&nbsp;2)&nbsp;print&nbsp;&quot;&nbsp;forcing&nbsp;case&nbsp;insensitivity&quot;;</span></span>
<span class="tr"><span class="th" id="line358">358</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;4)&nbsp;print&nbsp;&quot;&nbsp;(?&gt;...)&nbsp;possessive&quot;;</span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">&nbsp;&nbsp;NEWLINE_RE_CC:&nbsp;print&nbsp;&quot;NEWLINE&quot;;</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;&nbsp;TAB_RE_CC:&nbsp;print&nbsp;&quot;TAB&quot;;</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;&nbsp;QUANTIFIER_RE_CC:&nbsp;print&nbsp;&quot;QUANTIFIER&nbsp;min=&quot;,&nbsp;par1,&nbsp;&quot;&nbsp;max=&quot;,&nbsp;par2;</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par3)&nbsp;print&nbsp;&quot;&nbsp;(lazy)&quot;;&nbsp;else&nbsp;print&nbsp;&quot;&nbsp;(greedy)&quot;;</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td">&nbsp;&nbsp;LITERAL_RE_CC:&nbsp;print&nbsp;&quot;LITERAL&quot;;</span></span>
<span class="tr"><span class="th" id="line365">365</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=par1:i&lt;par2:i++)&nbsp;print&nbsp;(char)&nbsp;BlkValueRead(ftxt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">&nbsp;&nbsp;DISJUNCTION_RE_CC:&nbsp;print&nbsp;&quot;DISJUNCTION&nbsp;of&nbsp;&quot;,&nbsp;par1,&nbsp;&quot;&nbsp;choices&quot;;</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;&nbsp;CHOICE_RE_CC:&nbsp;print&nbsp;&quot;CHOICE&nbsp;no&nbsp;&quot;,&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">&nbsp;&nbsp;SENSITIVITY_RE_CC:&nbsp;print&nbsp;&quot;SENSITIVITY&quot;;</span></span>
<span class="tr"><span class="th" id="line370">370</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(par1)&nbsp;print&nbsp;&quot;&nbsp;off&quot;;&nbsp;else&nbsp;print&nbsp;&quot;&nbsp;on&quot;;</span></span>
<span class="tr"><span class="th" id="line371">371</span><span class="td">&nbsp;&nbsp;IF_RE_CC:&nbsp;print&nbsp;&quot;IF&quot;;&nbsp;if&nbsp;(par1&nbsp;&gt;=&nbsp;1)&nbsp;print&nbsp;&quot;&nbsp;=&nbsp;V&quot;,&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line372">372</span><span class="td">&nbsp;&nbsp;CONDITION_RE_CC:&nbsp;print&nbsp;&quot;CONDITION&quot;;&nbsp;if&nbsp;(par1&nbsp;&gt;=&nbsp;1)&nbsp;print&nbsp;&quot;&nbsp;=&nbsp;V&quot;,&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line373">373</span><span class="td">&nbsp;&nbsp;THEN_RE_CC:&nbsp;print&nbsp;&quot;THEN&quot;;</span></span>
<span class="tr"><span class="th" id="line374">374</span><span class="td">&nbsp;&nbsp;ELSE_RE_CC:&nbsp;print&nbsp;&quot;ELSE&quot;;</span></span>
<span class="tr"><span class="th" id="line375">375</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;if&nbsp;(detail)</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;:&nbsp;&quot;,&nbsp;offset--&gt;RE_DATA1,&nbsp;&quot;,&nbsp;&quot;,&nbsp;offset--&gt;RE_DATA2,&nbsp;&quot;,&nbsp;&quot;,&nbsp;offset--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td"></span></span>
</div><div class='text'>
<h2>Compiling Tree For Substring Search.</h2><p><p> When we search for a literal substring, say looking for &quot;per&quot; in &quot;Supernumerary&quot;, we will in fact use the same apparatus as when searching for a regular expression: we compile a very simple node tree in which <span class="fixed">\0</span> as the root contains just one child node, a <a href="./RegExp.i6t.html#line91">LITERAL_RE_CC</a> matching exactly the text &quot;per&quot;. We return 2 since that&#39;s the number of nodes in the tree.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line389">389</span><span class="td">[&nbsp;TEXT_TY_CHR_CompileTree&nbsp;ftxt&nbsp;exactly</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;root&nbsp;literal&nbsp;fto&nbsp;no_packets&nbsp;token&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;fto&nbsp;=&nbsp;TEXT_TY_CharacterLength(ftxt);</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;root&nbsp;=&nbsp;TEXT_TY_RE_Node(0,&nbsp;SUBEXP_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;literal&nbsp;=&nbsp;TEXT_TY_RE_Node(1,&nbsp;LITERAL_RE_CC,&nbsp;0,&nbsp;fto,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;root--&gt;RE_DOWN&nbsp;=&nbsp;literal;</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;literal--&gt;RE_UP&nbsp;=&nbsp;root;</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">&nbsp;if&nbsp;(exactly)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">&nbsp;&nbsp;no_packets&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td">&nbsp;&nbsp;if&nbsp;(no_packets+3&nbsp;&gt;&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line403">403</span><span class="td">&nbsp;&nbsp;exactly&nbsp;=&nbsp;RE_PACKET_space--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line404">404</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;START_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line405">405</span><span class="td">&nbsp;&nbsp;RE_PACKET_space--&gt;RE_DOWN&nbsp;=&nbsp;token;&nbsp;token--&gt;RE_UP&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line406">406</span><span class="td">&nbsp;&nbsp;attach_to&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;SUBEXP_RE_CC,&nbsp;-1,&nbsp;3,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line407">407</span><span class="td">&nbsp;&nbsp;token--&gt;RE_NEXT&nbsp;=&nbsp;attach_to;&nbsp;attach_to--&gt;RE_PREVIOUS&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line408">408</span><span class="td">&nbsp;&nbsp;attach_to--&gt;RE_UP&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line409">409</span><span class="td">&nbsp;&nbsp;attach_to--&gt;RE_NEXT&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;END_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td">&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_PREVIOUS&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_UP&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">&nbsp;&nbsp;attach_to--&gt;RE_DOWN&nbsp;=&nbsp;exactly;</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td">&nbsp;&nbsp;while&nbsp;(exactly&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line414">414</span><span class="td">&nbsp;&nbsp;&nbsp;exactly--&gt;RE_UP&nbsp;=&nbsp;attach_to;&nbsp;exactly&nbsp;=&nbsp;exactly--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line415">415</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line416">416</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line417">417</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line418">418</span><span class="td">&nbsp;no_packets&nbsp;=&nbsp;TEXT_TY_RE_ExpandChoices(RE_PACKET_space,&nbsp;no_packets);</span></span>
<span class="tr"><span class="th" id="line419">419</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line420">420</span><span class="td"></span></span>
</div><div class='text'>
<h2>Compiling Tree For Regexp Search.</h2><p><p> But in general we need to compile a regular expression string into a tree of the kind described above, and here is the routine which does that, returning the number of nodes used to build the tree. The syntax it accepts is very fully documented in <strong> Writing with Inform</strong>, so no details are given here.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line429">429</span><span class="td">Array&nbsp;Subexp_Posns&nbsp;--&gt;&nbsp;20;</span></span>
<span class="tr"><span class="th" id="line430">430</span><span class="td">[&nbsp;TEXT_TY_RE_CompileTree&nbsp;ftxt&nbsp;exactly</span></span>
<span class="tr"><span class="th" id="line431">431</span><span class="td">&nbsp;no_packets&nbsp;ffrom&nbsp;fto&nbsp;cc&nbsp;par1&nbsp;par2&nbsp;par3</span></span>
<span class="tr"><span class="th" id="line432">432</span><span class="td">&nbsp;quantifiable&nbsp;token&nbsp;attach_to&nbsp;no_subs&nbsp;blevel&nbsp;bits;</span></span>
<span class="tr"><span class="th" id="line433">433</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line434">434</span><span class="td">&nbsp;fto&nbsp;=&nbsp;TEXT_TY_CharacterLength(ftxt);</span></span>
<span class="tr"><span class="th" id="line435">435</span><span class="td">&nbsp;if&nbsp;(fto&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line436">436</span><span class="td">&nbsp;&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;NEVER_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);&nbsp;!&nbsp;Empty&nbsp;regexp&nbsp;never&nbsp;matches</span></span>
<span class="tr"><span class="th" id="line437">437</span><span class="td">&nbsp;&nbsp;return&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td">&nbsp;attach_to&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;SUBEXP_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td">&nbsp;RE_Subexpressions--&gt;0&nbsp;=&nbsp;attach_to;&nbsp;RE_Subexpressions--&gt;10&nbsp;=&nbsp;1;&nbsp;no_subs&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td">&nbsp;quantifiable&nbsp;=&nbsp;false;&nbsp;blevel&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line444">444</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line445">445</span><span class="td">&nbsp;for&nbsp;(ffrom&nbsp;=&nbsp;0:&nbsp;ffrom&nbsp;&lt;&nbsp;fto:&nbsp;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line446">446</span><span class="td">&nbsp;&nbsp;cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom++);&nbsp;par1&nbsp;=&nbsp;0;&nbsp;par2&nbsp;=&nbsp;0;&nbsp;par3&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line447">447</span><span class="td">&nbsp;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;&#39;\&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line448">448</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ffrom&nbsp;==&nbsp;fto)&nbsp;return&nbsp;&quot;Search&nbsp;pattern&nbsp;not&nbsp;terminated&quot;;</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom++);</span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">&nbsp;&nbsp;&nbsp;switch&nbsp;(cc)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;b&#39;:&nbsp;cc&nbsp;=&nbsp;BOUNDARY_RE_CC;</span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;B&#39;:&nbsp;cc&nbsp;=&nbsp;NONBOUNDARY_RE_CC;</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;d&#39;:&nbsp;cc&nbsp;=&nbsp;DIGIT_RE_CC;</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;D&#39;:&nbsp;cc&nbsp;=&nbsp;NONDIGIT_RE_CC;</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;l&#39;:&nbsp;cc&nbsp;=&nbsp;LCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;L&#39;:&nbsp;cc&nbsp;=&nbsp;NONLCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line457">457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;n&#39;:&nbsp;cc&nbsp;=&nbsp;NEWLINE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line458">458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;p&#39;:&nbsp;cc&nbsp;=&nbsp;PUNCTUATION_RE_CC;</span></span>
<span class="tr"><span class="th" id="line459">459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;P&#39;:&nbsp;cc&nbsp;=&nbsp;NONPUNCTUATION_RE_CC;</span></span>
<span class="tr"><span class="th" id="line460">460</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;s&#39;:&nbsp;cc&nbsp;=&nbsp;WHITESPACE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;S&#39;:&nbsp;cc&nbsp;=&nbsp;NONWHITESPACE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;t&#39;:&nbsp;cc&nbsp;=&nbsp;TAB_RE_CC;</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;u&#39;:&nbsp;cc&nbsp;=&nbsp;UCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;U&#39;:&nbsp;cc&nbsp;=&nbsp;NONUCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;w&#39;:&nbsp;cc&nbsp;=&nbsp;WORD_RE_CC;</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;W&#39;:&nbsp;cc&nbsp;=&nbsp;NONWORD_RE_CC;</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;default:</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((cc&nbsp;&gt;=&nbsp;&#39;1&#39;)&nbsp;&amp;&amp;&nbsp;(cc&nbsp;&lt;=&nbsp;&#39;9&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;cc-&#39;0&#39;;</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;VARIABLE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(((cc&nbsp;&gt;=&nbsp;&#39;a&#39;)&nbsp;&amp;&amp;&nbsp;(cc&nbsp;&lt;=&nbsp;&#39;z&#39;))&nbsp;||</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((cc&nbsp;&gt;=&nbsp;&#39;A&#39;)&nbsp;&amp;&amp;&nbsp;(cc&nbsp;&lt;=&nbsp;&#39;Z&#39;)))&nbsp;return&nbsp;&quot;unknown&nbsp;escape&quot;;</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;LITERAL_RE_CC;</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;ffrom-1;&nbsp;par2&nbsp;=&nbsp;ffrom;</span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line478">478</span><span class="td">&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line479">479</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line480">480</span><span class="td">&nbsp;&nbsp;&nbsp;switch&nbsp;(cc)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line481">481</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;(&#39;:&nbsp;par2&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line482">482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;)&#39;)&nbsp;return&nbsp;&quot;empty&nbsp;subexpression&quot;;</span></span>
<span class="tr"><span class="th" id="line483">483</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;?&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line484">484</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ffrom++;</span></span>
<span class="tr"><span class="th" id="line485">485</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line486">486</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;-&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;bits&nbsp;=&nbsp;false;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line487">487</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;&lt;&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;bits&nbsp;=&nbsp;false;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line488">488</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom++))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line489">489</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;#&#39;:&nbsp;while&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom++)&nbsp;~=&nbsp;0&nbsp;or&nbsp;&#39;)&#39;)&nbsp;;</span></span>
<span class="tr"><span class="th" id="line490">490</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom-1)&nbsp;==&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line491">491</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;comment&nbsp;never&nbsp;ends&quot;;</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;(&#39;:&nbsp;cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom);</span></span>
<span class="tr"><span class="th" id="line494">494</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((cc&nbsp;==&nbsp;&#39;1&#39;&nbsp;or&nbsp;&#39;2&#39;&nbsp;or&nbsp;&#39;3&#39;&nbsp;or&nbsp;&#39;4&#39;&nbsp;or</span></span>
<span class="tr"><span class="th" id="line495">495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;5&#39;&nbsp;or&nbsp;&#39;6&#39;&nbsp;or&nbsp;&#39;7&#39;&nbsp;or&nbsp;&#39;8&#39;&nbsp;or&nbsp;&#39;9&#39;)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom+1)&nbsp;==&#39;)&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line497">497</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ffrom&nbsp;=&nbsp;ffrom&nbsp;+&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line498">498</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;cc&nbsp;-&nbsp;&#39;0&#39;;</span></span>
<span class="tr"><span class="th" id="line499">499</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;ffrom--;</span></span>
<span class="tr"><span class="th" id="line500">500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;IF_RE_CC;&nbsp;!&nbsp;(?(...)...)&nbsp;conditional</span></span>
<span class="tr"><span class="th" id="line501">501</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line502">502</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(blevel&nbsp;==&nbsp;20)&nbsp;return&nbsp;&quot;subexpressions&nbsp;too&nbsp;deep&quot;;</span></span>
<span class="tr"><span class="th" id="line503">503</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subexp_Posns--&gt;(blevel++)&nbsp;=&nbsp;TEXT_TY_RE_NodeAddress(no_packets);</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./RegExp.i6t.html#line616">CClassKnown</a>;</span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;=&#39;:&nbsp;par2&nbsp;=&nbsp;1;&nbsp;!&nbsp;(?=...)&nbsp;lookahead/behind</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par3&nbsp;=&nbsp;0;&nbsp;if&nbsp;(bits&nbsp;==&nbsp;false)&nbsp;par3&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;!&#39;:&nbsp;par2&nbsp;=&nbsp;2;&nbsp;!&nbsp;(?!...)&nbsp;negated&nbsp;lookahead/behind</span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par3&nbsp;=&nbsp;0;&nbsp;if&nbsp;(bits&nbsp;==&nbsp;false)&nbsp;par3&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line509">509</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;:&#39;:&nbsp;par2&nbsp;=&nbsp;3;&nbsp;!&nbsp;(?:...)&nbsp;uncollecting&nbsp;subexpression</span></span>
<span class="tr"><span class="th" id="line510">510</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;&gt;&#39;:&nbsp;par2&nbsp;=&nbsp;4;&nbsp;!&nbsp;(?&gt;...)&nbsp;possessive</span></span>
<span class="tr"><span class="th" id="line511">511</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</span></span>
<span class="tr"><span class="th" id="line512">512</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;)&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line513">513</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;&#39;i&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line514">514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;SENSITIVITY_RE_CC;&nbsp;par1&nbsp;=&nbsp;bits;&nbsp;ffrom++;</span></span>
<span class="tr"><span class="th" id="line515">515</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./RegExp.i6t.html#line616">CClassKnown</a>;</span></span>
<span class="tr"><span class="th" id="line516">516</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line517">517</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line518">518</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;:&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line519">519</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;&#39;i&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line520">520</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;bits;&nbsp;par2&nbsp;=&nbsp;3;&nbsp;par3&nbsp;=&nbsp;bits+1;&nbsp;ffrom++;</span></span>
<span class="tr"><span class="th" id="line521">521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./RegExp.i6t.html#line527">AllowForm</a>;</span></span>
<span class="tr"><span class="th" id="line522">522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line523">523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;unknown&nbsp;(?...)&nbsp;form&quot;;</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.AllowForm;</span></span>
<span class="tr"><span class="th" id="line528">528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;0)&nbsp;par1&nbsp;=&nbsp;no_subs++;&nbsp;else&nbsp;par1&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line529">529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;SUBEXP_RE_CC;&nbsp;</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(blevel&nbsp;==&nbsp;20)&nbsp;return&nbsp;&quot;subexpressions&nbsp;too&nbsp;deep&quot;;</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subexp_Posns--&gt;(blevel++)&nbsp;=&nbsp;TEXT_TY_RE_NodeAddress(no_packets);</span></span>
<span class="tr"><span class="th" id="line533">533</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;)&#39;:&nbsp;if&nbsp;(blevel&nbsp;==&nbsp;0)&nbsp;return&nbsp;&quot;subexpression&nbsp;bracket&nbsp;mismatch&quot;;</span></span>
<span class="tr"><span class="th" id="line534">534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blevel--;</span></span>
<span class="tr"><span class="th" id="line535">535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to&nbsp;=&nbsp;Subexp_Posns--&gt;blevel;</span></span>
<span class="tr"><span class="th" id="line536">536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(attach_to--&gt;RE_DOWN&nbsp;==&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line537">537</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line538">538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_DOWN&nbsp;=</span></span>
<span class="tr"><span class="th" id="line539">539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;ALWAYS_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_DOWN)--&gt;RE_UP&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;.&#39;:&nbsp;cc&nbsp;=&nbsp;ANYTHING_RE_CC;&nbsp;quantifiable&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;|&#39;:&nbsp;cc&nbsp;=&nbsp;CHOICE_RE_CC;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line546">546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;^&#39;:&nbsp;cc&nbsp;=&nbsp;START_RE_CC;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line547">547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;$&#39;:&nbsp;cc&nbsp;=&nbsp;END_RE_CC;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line548">548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;{&#39;:&nbsp;if&nbsp;(quantifiable&nbsp;==&nbsp;false)&nbsp;return&nbsp;&quot;quantifier&nbsp;misplaced&quot;;</span></span>
<span class="tr"><span class="th" id="line549">549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;0;&nbsp;par2&nbsp;=&nbsp;-1;&nbsp;bits&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((cc=BlkValueRead(ftxt,&nbsp;ffrom++))&nbsp;~=&nbsp;0&nbsp;or&nbsp;&#39;}&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;&#39;,&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits++;</span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bits&nbsp;&gt;=&nbsp;3)&nbsp;return&nbsp;&quot;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;?{...}&quot;;</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((cc&nbsp;&gt;=&nbsp;&#39;0&#39;)&nbsp;||&nbsp;(cc&nbsp;&lt;=&nbsp;&#39;9&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bits&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par1&nbsp;&lt;&nbsp;0)&nbsp;par1&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;par1*10&nbsp;+&nbsp;(cc-&#39;0&#39;);</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;&lt;&nbsp;0)&nbsp;par2&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par2&nbsp;=&nbsp;par2*10&nbsp;+&nbsp;(cc-&#39;0&#39;);</span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;return&nbsp;&quot;non-digit&nbsp;in&nbsp;?{...}&quot;;</span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;~=&nbsp;&#39;}&#39;)&nbsp;return&nbsp;&quot;{x,y}&nbsp;quantifier&nbsp;never&nbsp;ends&quot;;</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par2&nbsp;==&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bits&nbsp;==&nbsp;2)&nbsp;par2&nbsp;=&nbsp;30000;</span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;par2&nbsp;=&nbsp;par1;</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par1&nbsp;&gt;&nbsp;par2)&nbsp;return&nbsp;&quot;{x,y}&nbsp;with&nbsp;x&nbsp;greater&nbsp;than&nbsp;y&quot;;</span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;?&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;par3&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line574">574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line575">575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;&lt;&#39;,&nbsp;&#39;[&#39;:&nbsp;par3&nbsp;=&nbsp;false;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;&#39;&lt;&#39;)&nbsp;bits&nbsp;=&nbsp;&#39;&gt;&#39;;&nbsp;else&nbsp;bits&nbsp;=&nbsp;&#39;]&#39;;</span></span>
<span class="tr"><span class="th" id="line576">576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;^&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;par3&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line577">577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;ffrom;</span></span>
<span class="tr"><span class="th" id="line578">578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;bits)&nbsp;{&nbsp;ffrom++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line579">579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(cc&nbsp;~=&nbsp;bits&nbsp;or&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line580">580</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom++);</span></span>
<span class="tr"><span class="th" id="line581">581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;&#39;\&#39;)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line582">582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom++);</span></span>
<span class="tr"><span class="th" id="line583">583</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;~=&nbsp;0)&nbsp;cc&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;ffrom++);</span></span>
<span class="tr"><span class="th" id="line584">584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line585">585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line586">586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cc&nbsp;==&nbsp;0)&nbsp;return&nbsp;&quot;Character&nbsp;range&nbsp;never&nbsp;ends&quot;;</span></span>
<span class="tr"><span class="th" id="line587">587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par2&nbsp;=&nbsp;ffrom-1;</span></span>
<span class="tr"><span class="th" id="line588">588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((par2&nbsp;&gt;&nbsp;par1&nbsp;+&nbsp;1)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line589">589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt,&nbsp;par1)&nbsp;==&nbsp;&#39;:&#39;)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line590">590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt,&nbsp;par2-1)&nbsp;==&nbsp;&#39;:&#39;)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line591">591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt,&nbsp;par2-2)&nbsp;~=&nbsp;&#39;\&#39;))</span></span>
<span class="tr"><span class="th" id="line592">592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;POSIX&nbsp;named&nbsp;character&nbsp;classes&nbsp;unsupported&quot;;</span></span>
<span class="tr"><span class="th" id="line593">593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits&nbsp;=&nbsp;TEXT_TY_RE_RangeSyntaxCorrect(ftxt,&nbsp;par1,&nbsp;par2);</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(bits)&nbsp;return&nbsp;bits;</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(par1&nbsp;&lt;&nbsp;par2)&nbsp;cc&nbsp;=&nbsp;RANGE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line596">596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;cc&nbsp;=&nbsp;NOTHING_RE_CC;</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;*&#39;:&nbsp;if&nbsp;(quantifiable&nbsp;==&nbsp;false)&nbsp;return&nbsp;&quot;quantifier&nbsp;misplaced&quot;;</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;0;&nbsp;par2&nbsp;=&nbsp;30000;</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;?&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;par3&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;+&#39;:&nbsp;if&nbsp;(quantifiable&nbsp;==&nbsp;false)&nbsp;return&nbsp;&quot;quantifier&nbsp;misplaced&quot;;</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;1;&nbsp;par2&nbsp;=&nbsp;30000;</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;?&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;par3&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;?&#39;:&nbsp;if&nbsp;(quantifiable&nbsp;==&nbsp;false)&nbsp;return&nbsp;&quot;quantifier&nbsp;misplaced&quot;;</span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1&nbsp;=&nbsp;0;&nbsp;par2&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;==&nbsp;&#39;?&#39;)&nbsp;{&nbsp;ffrom++;&nbsp;par3&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;.CClassKnown;</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">&nbsp;&nbsp;if&nbsp;(cc&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line619">619</span><span class="td">&nbsp;&nbsp;&nbsp;quantifiable&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line620">620</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((attach_to--&gt;RE_CCLASS&nbsp;==&nbsp;LITERAL_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line621">621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt,&nbsp;ffrom)&nbsp;~=&nbsp;&#39;*&#39;&nbsp;or&nbsp;&#39;+&#39;&nbsp;or&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;{&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line622">622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_PAR2)++;</span></span>
<span class="tr"><span class="th" id="line623">623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Extending&nbsp;literal&nbsp;by&nbsp;&quot;,&nbsp;cc,&nbsp;&quot;=&quot;,&nbsp;(char)&nbsp;cc,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line627">627</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line628">628</span><span class="td">&nbsp;&nbsp;&nbsp;cc&nbsp;=&nbsp;LITERAL_RE_CC;&nbsp;par1&nbsp;=&nbsp;ffrom-1;&nbsp;par2&nbsp;=&nbsp;ffrom;</span></span>
<span class="tr"><span class="th" id="line629">629</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line630">630</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line631">631</span><span class="td">&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line632">632</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line633">633</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Attaching&nbsp;packet&nbsp;&quot;,&nbsp;no_packets+1,&nbsp;&quot;&nbsp;to&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(attach_to,&nbsp;ftxt);</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;cc,&nbsp;par1,&nbsp;par2,&nbsp;par3);</span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td">&nbsp;&nbsp;if&nbsp;((token--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;&amp;&amp;&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;0))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;RE_Subexpressions--&gt;(token--&gt;RE_PAR1)&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;(RE_Subexpressions--&gt;10)++;</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">&nbsp;&nbsp;if&nbsp;((attach_to--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC&nbsp;or&nbsp;CHOICE_RE_CC&nbsp;or&nbsp;IF_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td">&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_DOWN&nbsp;==&nbsp;NULL))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_DOWN&nbsp;=&nbsp;token;&nbsp;token--&gt;RE_UP&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line649">649</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line650">650</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line651">651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;((attach_to--&gt;RE_UP)--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line652">652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;no_packets--;&nbsp;token&nbsp;=&nbsp;attach_to--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(attach_to--&gt;RE_PREVIOUS&nbsp;~=&nbsp;NULL)</span></span>
<span class="tr"><span class="th" id="line656">656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to&nbsp;=&nbsp;attach_to--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line657">657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line658">658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CCLASS&nbsp;==&nbsp;QUANTIFIER_RE_CC&nbsp;or&nbsp;CHOICE_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line659">659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PREVIOUS&nbsp;=&nbsp;attach_to--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line660">660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_UP&nbsp;=&nbsp;attach_to--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line661">661</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((attach_to--&gt;RE_UP&nbsp;~=&nbsp;NULL)&nbsp;&amp;&amp;&nbsp;(attach_to--&gt;RE_PREVIOUS&nbsp;==&nbsp;NULL))</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_UP)--&gt;RE_DOWN&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DOWN&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(bits&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits--&gt;RE_UP&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits&nbsp;=&nbsp;bits--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_PREVIOUS&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PREVIOUS&nbsp;~=&nbsp;NULL)</span></span>
<span class="tr"><span class="th" id="line671">671</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_PREVIOUS)--&gt;RE_NEXT&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line672">672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_NEXT&nbsp;=&nbsp;token;&nbsp;token--&gt;RE_PREVIOUS&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_UP&nbsp;=&nbsp;attach_to--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;&nbsp;&nbsp;token--&gt;RE_NEXT&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;CHOICE_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;&nbsp;(token--&gt;RE_NEXT)--&gt;RE_PREVIOUS&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;&nbsp;&nbsp;(token--&gt;RE_NEXT)--&gt;RE_UP&nbsp;=&nbsp;token--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td">&nbsp;&nbsp;attach_to&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace&nbsp;==&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Result:^&quot;;</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;if&nbsp;(blevel&nbsp;~=&nbsp;0)&nbsp;return&nbsp;&quot;subexpression&nbsp;bracket&nbsp;mismatch&quot;;</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td">&nbsp;if&nbsp;(exactly)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">&nbsp;&nbsp;if&nbsp;(no_packets+3&nbsp;&gt;&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;exactly&nbsp;=&nbsp;RE_PACKET_space--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;START_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;RE_PACKET_space--&gt;RE_DOWN&nbsp;=&nbsp;token;&nbsp;token--&gt;RE_UP&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;attach_to&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;SUBEXP_RE_CC,&nbsp;-1,&nbsp;3,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td">&nbsp;&nbsp;token--&gt;RE_NEXT&nbsp;=&nbsp;attach_to;&nbsp;attach_to--&gt;RE_PREVIOUS&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;&nbsp;attach_to--&gt;RE_UP&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td">&nbsp;&nbsp;attach_to--&gt;RE_NEXT&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;END_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td">&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_PREVIOUS&nbsp;=&nbsp;attach_to;</span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_UP&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td">&nbsp;&nbsp;attach_to--&gt;RE_DOWN&nbsp;=&nbsp;exactly;</span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;while&nbsp;(exactly&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td">&nbsp;&nbsp;&nbsp;exactly--&gt;RE_UP&nbsp;=&nbsp;attach_to;&nbsp;exactly&nbsp;=&nbsp;exactly--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td">&nbsp;no_packets&nbsp;=&nbsp;TEXT_TY_RE_ExpandChoices(RE_PACKET_space,&nbsp;no_packets);</span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td">&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;Compiled&nbsp;pattern:^&quot;;</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line720">720</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line721">721</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line722">722</span><span class="td">&nbsp;bits&nbsp;=&nbsp;TEXT_TY_RE_CheckTree(RE_PACKET_space,&nbsp;no_subs);&nbsp;if&nbsp;(bits)&nbsp;return&nbsp;bits;</span></span>
<span class="tr"><span class="th" id="line723">723</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line724">724</span><span class="td">&nbsp;return&nbsp;no_packets;</span></span>
<span class="tr"><span class="th" id="line725">725</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line726">726</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td">[&nbsp;TEXT_TY_RE_RangeSyntaxCorrect&nbsp;ftxt&nbsp;rf&nbsp;rt</span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">&nbsp;i&nbsp;chm;</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">&nbsp;for&nbsp;(i=rf:&nbsp;i&lt;rt:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">&nbsp;&nbsp;chm&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">&nbsp;&nbsp;if&nbsp;((chm&nbsp;==&nbsp;&#39;\&#39;)&nbsp;&amp;&amp;&nbsp;(i+1&lt;rt))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">&nbsp;&nbsp;&nbsp;chm&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;++i);</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(((chm&nbsp;&gt;=&nbsp;&#39;a&#39;)&nbsp;&amp;&amp;&nbsp;(chm&nbsp;&lt;=&nbsp;&#39;z&#39;))&nbsp;||</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;((chm&nbsp;&gt;=&nbsp;&#39;A&#39;)&nbsp;&amp;&amp;&nbsp;(chm&nbsp;&lt;=&nbsp;&#39;Z&#39;)))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(chm&nbsp;~=&nbsp;&#39;s&#39;&nbsp;or&nbsp;&#39;S&#39;&nbsp;or&nbsp;&#39;p&#39;&nbsp;or&nbsp;&#39;P&#39;&nbsp;or&nbsp;&#39;w&#39;&nbsp;or&nbsp;&#39;W&#39;&nbsp;or&nbsp;&#39;d&#39;</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;D&#39;&nbsp;or&nbsp;&#39;n&#39;&nbsp;or&nbsp;&#39;t&#39;&nbsp;or&nbsp;&#39;l&#39;&nbsp;or&nbsp;&#39;L&#39;&nbsp;or&nbsp;&#39;u&#39;&nbsp;or&nbsp;&#39;U&#39;)</span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;Invalid&nbsp;escape&nbsp;in&nbsp;{}&nbsp;range&quot;;</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td">&nbsp;&nbsp;if&nbsp;((i+2&lt;rt)&nbsp;&amp;&amp;&nbsp;(BlkValueRead(ftxt,&nbsp;i+1)&nbsp;==&nbsp;&#39;-&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(chm&nbsp;&gt;&nbsp;BlkValueRead(ftxt,&nbsp;i+2))&nbsp;return&nbsp;&quot;Invalid&nbsp;{}&nbsp;range&quot;;</span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;&nbsp;&nbsp;i=i+2;</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td">[&nbsp;TEXT_TY_RE_ExpandChoices&nbsp;token&nbsp;no_packets</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">&nbsp;rv&nbsp;prev&nbsp;nex&nbsp;holder&nbsp;new&nbsp;ct&nbsp;n&nbsp;cond_node&nbsp;then_node&nbsp;else_node;</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CCLASS&nbsp;==&nbsp;IF_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_DOWN)--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(nex=token--&gt;RE_DOWN,&nbsp;n=0:&nbsp;nex~=NULL:&nbsp;nex=nex--&gt;RE_NEXT)&nbsp;n++;</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(n~=2)&nbsp;return&nbsp;&quot;conditional&nbsp;has&nbsp;too&nbsp;many&nbsp;clauses&quot;;</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cond_node&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;CONDITION_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR1&nbsp;&gt;=&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_PAR1&nbsp;=&nbsp;token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;then_node&nbsp;=&nbsp;token--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_CCLASS&nbsp;=&nbsp;THEN_RE_CC;</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else_node&nbsp;=&nbsp;then_node--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else_node--&gt;RE_CCLASS&nbsp;=&nbsp;ELSE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cond_node--&gt;RE_PAR1&nbsp;&lt;&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_DOWN&nbsp;=&nbsp;then_node--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line766">766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_DOWN&nbsp;=&nbsp;(then_node--&gt;RE_DOWN)--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line767">767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(then_node--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)</span></span>
<span class="tr"><span class="th" id="line768">768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(then_node--&gt;RE_DOWN)--&gt;RE_PREVIOUS&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line769">769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_NEXT&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line770">770</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_UP&nbsp;=&nbsp;cond_node;</span></span>
<span class="tr"><span class="th" id="line771">771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line772">772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DOWN&nbsp;=&nbsp;cond_node;&nbsp;cond_node--&gt;RE_UP&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line773">773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_NEXT&nbsp;=&nbsp;then_node;&nbsp;then_node--&gt;RE_PREVIOUS&nbsp;=&nbsp;cond_node;</span></span>
<span class="tr"><span class="th" id="line774">774</span><span class="td">&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line775">775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line776">776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cond_node&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;CONDITION_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line777">777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line778">778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;then_node&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;THEN_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line779">779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR1&nbsp;&gt;=&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line780">780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_PAR1&nbsp;=&nbsp;token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line781">781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_DOWN&nbsp;=&nbsp;token--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line782">782</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line783">783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_DOWN&nbsp;=&nbsp;token--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line784">784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_DOWN&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line785">785</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_NEXT&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line786">786</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_UP&nbsp;=&nbsp;cond_node;</span></span>
<span class="tr"><span class="th" id="line787">787</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line788">788</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DOWN&nbsp;=&nbsp;cond_node;</span></span>
<span class="tr"><span class="th" id="line789">789</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_UP&nbsp;=&nbsp;token;&nbsp;cond_node--&gt;RE_NEXT&nbsp;=&nbsp;then_node;</span></span>
<span class="tr"><span class="th" id="line790">790</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_PREVIOUS&nbsp;=&nbsp;cond_node;&nbsp;then_node--&gt;RE_UP&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line791">791</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_NEXT&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line792">792</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(then_node--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)</span></span>
<span class="tr"><span class="th" id="line793">793</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(then_node--&gt;RE_DOWN)--&gt;RE_PREVIOUS&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line794">794</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(nex&nbsp;=&nbsp;then_node--&gt;RE_DOWN:&nbsp;nex&nbsp;~=&nbsp;NULL:&nbsp;nex&nbsp;=&nbsp;nex--&gt;RE_NEXT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line795">795</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nex--&gt;RE_UP&nbsp;=&nbsp;then_node;</span></span>
<span class="tr"><span class="th" id="line796">796</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line797">797</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line798">798</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line799">799</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(cond_node--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line800">800</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;nex&nbsp;=&nbsp;cond_node--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line801">801</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((nex--&gt;RE_CCLASS&nbsp;~=&nbsp;SUBEXP_RE_CC)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line802">802</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(nex--&gt;RE_NEXT&nbsp;~=&nbsp;NULL)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line803">803</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(nex--&gt;RE_PAR2&nbsp;~=&nbsp;1&nbsp;or&nbsp;2))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line804">804</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!TEXT_TY_RE_DebugSubtree(0,&nbsp;0,&nbsp;nex,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line805">805</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;condition&nbsp;not&nbsp;lookahead/behind&quot;;</span></span>
<span class="tr"><span class="th" id="line806">806</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line807">807</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line808">808</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line809">809</span><span class="td">&nbsp;&nbsp;if&nbsp;((token--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC)&nbsp;&amp;&amp;&nbsp;(token--&gt;RE_PAR1&nbsp;&lt;&nbsp;1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line810">810</span><span class="td">&nbsp;&nbsp;&nbsp;prev&nbsp;=&nbsp;token--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line811">811</span><span class="td">&nbsp;&nbsp;&nbsp;nex&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line812">812</span><span class="td">&nbsp;&nbsp;&nbsp;while&nbsp;((nex&nbsp;~=&nbsp;NULL)&nbsp;&amp;&amp;&nbsp;(nex--&gt;RE_CCLASS&nbsp;==&nbsp;CHOICE_RE_CC))</span></span>
<span class="tr"><span class="th" id="line813">813</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;nex&nbsp;=&nbsp;nex--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line814">814</span><span class="td">&nbsp;&nbsp;&nbsp;holder&nbsp;=&nbsp;token--&gt;RE_UP;&nbsp;if&nbsp;(holder&nbsp;==&nbsp;NULL)&nbsp;return&nbsp;&quot;bang&quot;;</span></span>
<span class="tr"><span class="th" id="line815">815</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS)&nbsp;return&nbsp;&quot;regexp&nbsp;too&nbsp;complex&quot;;</span></span>
<span class="tr"><span class="th" id="line816">816</span><span class="td">&nbsp;&nbsp;&nbsp;new&nbsp;=&nbsp;TEXT_TY_RE_Node(no_packets++,&nbsp;DISJUNCTION_RE_CC,&nbsp;0,&nbsp;0,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line817">817</span><span class="td">&nbsp;&nbsp;&nbsp;holder--&gt;RE_DOWN&nbsp;=&nbsp;new;&nbsp;new--&gt;RE_UP&nbsp;=&nbsp;holder;</span></span>
<span class="tr"><span class="th" id="line818">818</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(prev&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line819">819</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;prev--&gt;RE_NEXT&nbsp;=&nbsp;new;&nbsp;new--&gt;RE_PREVIOUS&nbsp;=&nbsp;prev;</span></span>
<span class="tr"><span class="th" id="line820">820</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line821">821</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(nex&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line822">822</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;nex--&gt;RE_PREVIOUS&nbsp;=&nbsp;new;&nbsp;new--&gt;RE_NEXT&nbsp;=&nbsp;nex;</span></span>
<span class="tr"><span class="th" id="line823">823</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line824">824</span><span class="td">&nbsp;&nbsp;&nbsp;new--&gt;RE_DOWN&nbsp;=&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line825">825</span><span class="td">&nbsp;&nbsp;&nbsp;token--&gt;RE_PREVIOUS&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line826">826</span><span class="td">&nbsp;&nbsp;&nbsp;ct&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line827">827</span><span class="td">&nbsp;&nbsp;&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line828">828</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PAR1&nbsp;=&nbsp;ct++;</span></span>
<span class="tr"><span class="th" id="line829">829</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_UP&nbsp;=&nbsp;new;</span></span>
<span class="tr"><span class="th" id="line830">830</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_NEXT&nbsp;~=&nbsp;NULL)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line831">831</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((token--&gt;RE_NEXT)--&gt;RE_CCLASS&nbsp;~=&nbsp;CHOICE_RE_CC))</span></span>
<span class="tr"><span class="th" id="line832">832</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_NEXT&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line833">833</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line834">834</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line835">835</span><span class="td">&nbsp;&nbsp;&nbsp;new--&gt;RE_PAR1&nbsp;=&nbsp;ct-1;</span></span>
<span class="tr"><span class="th" id="line836">836</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;token--&gt;RE_NEXT&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line837">837</span><span class="td">&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;new;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line838">838</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line839">839</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line840">840</span><span class="td">&nbsp;&nbsp;&nbsp;no_packets&nbsp;=&nbsp;TEXT_TY_RE_ExpandChoices(token--&gt;RE_DOWN,&nbsp;no_packets);</span></span>
<span class="tr"><span class="th" id="line841">841</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((no_packets&lt;0)&nbsp;||&nbsp;(no_packets&nbsp;&gt;=&nbsp;RE_MAX_PACKETS))&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line842">842</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line843">843</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line844">844</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line845">845</span><span class="td">&nbsp;return&nbsp;no_packets;</span></span>
<span class="tr"><span class="th" id="line846">846</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line847">847</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line848">848</span><span class="td">[&nbsp;TEXT_TY_RE_CheckTree&nbsp;token&nbsp;no_subs</span></span>
<span class="tr"><span class="th" id="line849">849</span><span class="td">&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line850">850</span><span class="td">&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line851">851</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CCLASS&nbsp;==&nbsp;VARIABLE_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line852">852</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR1&nbsp;&gt;=&nbsp;no_subs)&nbsp;return&nbsp;&quot;reference&nbsp;to&nbsp;nonexistent&nbsp;group&quot;;</span></span>
<span class="tr"><span class="th" id="line853">853</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line854">854</span><span class="td">&nbsp;&nbsp;if&nbsp;((token--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line855">855</span><span class="td">&nbsp;&nbsp;&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;1&nbsp;or&nbsp;2)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line856">856</span><span class="td">&nbsp;&nbsp;&nbsp;(token--&gt;RE_PAR3&nbsp;==&nbsp;-1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line857">857</span><span class="td">&nbsp;&nbsp;&nbsp;token--&gt;RE_PAR3&nbsp;=&nbsp;TEXT_TY_RE_Width(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line858">858</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR3&nbsp;==&nbsp;-1)&nbsp;return&nbsp;&quot;variable&nbsp;length&nbsp;lookbehind&nbsp;not&nbsp;implemented&quot;;</span></span>
<span class="tr"><span class="th" id="line859">859</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line860">860</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line861">861</span><span class="td">&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_CheckTree(token--&gt;RE_DOWN,&nbsp;no_subs);</span></span>
<span class="tr"><span class="th" id="line862">862</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(rv)&nbsp;return&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line863">863</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line864">864</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line865">865</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line866">866</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line867">867</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line868">868</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line869">869</span><span class="td">[&nbsp;TEXT_TY_RE_Width&nbsp;token&nbsp;downwards</span></span>
<span class="tr"><span class="th" id="line870">870</span><span class="td">&nbsp;w&nbsp;rv&nbsp;aw&nbsp;choice;</span></span>
<span class="tr"><span class="th" id="line871">871</span><span class="td">&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line872">872</span><span class="td">&nbsp;&nbsp;switch&nbsp;(token--&gt;RE_CCLASS)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line873">873</span><span class="td">&nbsp;&nbsp;&nbsp;DIGIT_RE_CC,&nbsp;NONDIGIT_RE_CC,&nbsp;WHITESPACE_RE_CC,&nbsp;NONWHITESPACE_RE_CC,</span></span>
<span class="tr"><span class="th" id="line874">874</span><span class="td">&nbsp;&nbsp;&nbsp;PUNCTUATION_RE_CC,&nbsp;NONPUNCTUATION_RE_CC,&nbsp;WORD_RE_CC,&nbsp;NONWORD_RE_CC,</span></span>
<span class="tr"><span class="th" id="line875">875</span><span class="td">&nbsp;&nbsp;&nbsp;ANYTHING_RE_CC,&nbsp;NOTHING_RE_CC,&nbsp;RANGE_RE_CC,&nbsp;NEWLINE_RE_CC,&nbsp;TAB_RE_CC,</span></span>
<span class="tr"><span class="th" id="line876">876</span><span class="td">&nbsp;&nbsp;&nbsp;UCASE_RE_CC,&nbsp;NONUCASE_RE_CC,&nbsp;LCASE_RE_CC,&nbsp;NONLCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line877">877</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w++;</span></span>
<span class="tr"><span class="th" id="line878">878</span><span class="td">&nbsp;&nbsp;&nbsp;START_RE_CC,&nbsp;END_RE_CC,&nbsp;BOUNDARY_RE_CC,&nbsp;NONBOUNDARY_RE_CC,&nbsp;ALWAYS_RE_CC:</span></span>
<span class="tr"><span class="th" id="line879">879</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;;</span></span>
<span class="tr"><span class="th" id="line880">880</span><span class="td">&nbsp;&nbsp;&nbsp;LITERAL_RE_CC:</span></span>
<span class="tr"><span class="th" id="line881">881</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;w&nbsp;+&nbsp;token--&gt;RE_PAR2&nbsp;-&nbsp;token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line882">882</span><span class="td">&nbsp;&nbsp;&nbsp;VARIABLE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line883">883</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line884">884</span><span class="td">&nbsp;&nbsp;&nbsp;IF_RE_CC:</span></span>
<span class="tr"><span class="th" id="line885">885</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_Width((token--&gt;RE_DOWN)--&gt;RE_NEXT);</span></span>
<span class="tr"><span class="th" id="line886">886</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;==&nbsp;-1)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line887">887</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;~=&nbsp;TEXT_TY_RE_Width(((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_NEXT))</span></span>
<span class="tr"><span class="th" id="line888">888</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line889">889</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;w&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line890">890</span><span class="td">&nbsp;&nbsp;&nbsp;SUBEXP_RE_CC:</span></span>
<span class="tr"><span class="th" id="line891">891</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;1&nbsp;or&nbsp;2)&nbsp;rv&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line892">892</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line893">893</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_Width(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line894">894</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;==&nbsp;-1)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line895">895</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line896">896</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;w&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line897">897</span><span class="td">&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line898">898</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR1&nbsp;~=&nbsp;token--&gt;RE_PAR2)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line899">899</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_Width(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line900">900</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;==&nbsp;-1)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line901">901</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;w&nbsp;+&nbsp;rv*(token--&gt;RE_PAR1);&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line902">902</span><span class="td">&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line903">903</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;aw&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line904">904</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(choice&nbsp;=&nbsp;token--&gt;RE_DOWN:&nbsp;choice&nbsp;~=&nbsp;NULL:&nbsp;choice&nbsp;=&nbsp;choice--&gt;RE_NEXT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line905">905</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_Width(choice--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line906">906</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!print&nbsp;&quot;Option&nbsp;found&nbsp;&quot;,&nbsp;rv,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line907">907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;==&nbsp;-1)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line908">908</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((aw&nbsp;&gt;=&nbsp;0)&nbsp;&amp;&amp;&nbsp;(aw&nbsp;~=&nbsp;rv))&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line909">909</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aw&nbsp;=&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line910">910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line911">911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;w&nbsp;+&nbsp;aw;</span></span>
<span class="tr"><span class="th" id="line912">912</span><span class="td">&nbsp;&nbsp;&nbsp;SENSITIVITY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line913">913</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;;</span></span>
<span class="tr"><span class="th" id="line914">914</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line915">915</span><span class="td">&nbsp;&nbsp;if&nbsp;(downwards)&nbsp;return&nbsp;w;</span></span>
<span class="tr"><span class="th" id="line916">916</span><span class="td">&nbsp;&nbsp;if&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line917">917</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line918">918</span><span class="td">&nbsp;return&nbsp;w;</span></span>
<span class="tr"><span class="th" id="line919">919</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line920">920</span><span class="td"></span></span>
</div><div class='text'>
<h2>Parser.</h2><p><p> The virtue of all of that tree compilation is that the code which actually does the work &ndash; which parses the source text to see if the regular expression matches it &ndash; is much shorter and quicker: indeed, it takes up fewer lines than the compiler part, which goes to show that decoding regular expression syntax is a more complex task than acting upon it. This would have surprised the pioneers of regexp, but the syntax has become much more complicated over the decades because of a steady increase in the number of extended notations. The process shows no sign of stopping, with Python and PCRE continuing to push boundaries beyond Perl, which was once thought the superest, duperest regexp syntax there could be. However: to work.<p></p><p> The main matcher simply starts a recursive subroutine to perform the match. However, the subroutine tests for a match at a particular position in the source text; so the main routine tries the subroutine everywhere convenient in the source text, from left to right, until a match is made &ndash; unless the regexp is constrained by a <span class="fixed">^</span> glyph to begin matching at the start of the source text, which will cause a <a href="./RegExp.i6t.html#line95">START_RE_CC</a> node to be the eldest child of the <span class="fixed">\0</span> root.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line942">942</span><span class="td">Global&nbsp;TEXT_TY_RE_RewindCount;</span></span>
<span class="tr"><span class="th" id="line943">943</span><span class="td">[&nbsp;TEXT_TY_RE_PrintNoRewinds;&nbsp;print&nbsp;TEXT_TY_RE_RewindCount;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line944">944</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line945">945</span><span class="td">Constant&nbsp;CIS_MFLAG&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line946">946</span><span class="td">Constant&nbsp;ACCUM_MFLAG&nbsp;=&nbsp;2;</span></span>
<span class="tr"><span class="th" id="line947">947</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line948">948</span><span class="td">[&nbsp;TEXT_TY_RE_Parse&nbsp;ftxt&nbsp;txt&nbsp;ipos&nbsp;insens</span></span>
<span class="tr"><span class="th" id="line949">949</span><span class="td">&nbsp;ilen&nbsp;rv&nbsp;root&nbsp;i&nbsp;initial_mode;</span></span>
<span class="tr"><span class="th" id="line950">950</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line951">951</span><span class="td">&nbsp;ilen&nbsp;=&nbsp;TEXT_TY_CharacterLength(txt);</span></span>
<span class="tr"><span class="th" id="line952">952</span><span class="td">&nbsp;if&nbsp;((ipos&lt;0)&nbsp;||&nbsp;(ipos&gt;ilen))&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line953">953</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line954">954</span><span class="td">&nbsp;root&nbsp;=&nbsp;RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line955">955</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line956">956</span><span class="td">&nbsp;initial_mode&nbsp;=&nbsp;0;&nbsp;if&nbsp;(insens)&nbsp;initial_mode&nbsp;=&nbsp;CIS_MFLAG;</span></span>
<span class="tr"><span class="th" id="line957">957</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line958">958</span><span class="td">&nbsp;TEXT_TY_RE_Clear_Markers(RE_PACKET_space);</span></span>
<span class="tr"><span class="th" id="line959">959</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line960">960</span><span class="td">&nbsp;for&nbsp;(:ipos&lt;=ilen:ipos++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line961">961</span><span class="td">&nbsp;&nbsp;if&nbsp;((RE_PACKET_space--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line962">962</span><span class="td">&nbsp;&nbsp;&nbsp;((RE_PACKET_space--&gt;RE_DOWN)--&gt;RE_CCLASS&nbsp;==&nbsp;START_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line963">963</span><span class="td">&nbsp;&nbsp;&nbsp;(ipos&gt;0))&nbsp;{&nbsp;rv&nbsp;=&nbsp;-1;&nbsp;break;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line964">964</span><span class="td">&nbsp;&nbsp;if&nbsp;(ipos&nbsp;&gt;&nbsp;0)&nbsp;TEXT_TY_RE_EraseConstraints(RE_PACKET_space,&nbsp;initial_mode);</span></span>
<span class="tr"><span class="th" id="line965">965</span><span class="td">&nbsp;&nbsp;TEXT_TY_RE_RewindCount&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line966">966</span><span class="td">&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ilen,&nbsp;RE_PACKET_space,&nbsp;initial_mode);</span></span>
<span class="tr"><span class="th" id="line967">967</span><span class="td">&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line968">968</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line969">969</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line970">970</span><span class="td">&nbsp;if&nbsp;(rv&nbsp;==&nbsp;-1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line971">971</span><span class="td">&nbsp;&nbsp;root--&gt;RE_DATA1&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line972">972</span><span class="td">&nbsp;&nbsp;root--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line973">973</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line974">974</span><span class="td">&nbsp;&nbsp;root--&gt;RE_DATA1&nbsp;=&nbsp;ipos;</span></span>
<span class="tr"><span class="th" id="line975">975</span><span class="td">&nbsp;&nbsp;root--&gt;RE_DATA2&nbsp;=&nbsp;ipos+rv;</span></span>
<span class="tr"><span class="th" id="line976">976</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line977">977</span><span class="td">&nbsp;return&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line978">978</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line979">979</span><span class="td"></span></span>
</div><div class='text'>
<h2>Parse At Position.</h2><p><p> |TEXT_TY_RE_ParseAtPosition(ftxt, txt, ifrom, ito)| attempts to match text beginning at position <span class="fixed">ifrom</span> in the text <span class="fixed">txt</span> and extending for any length up to position <span class="fixed">ito</span>: it returns the number of characters which were matched (which can legitimately be 0), or $-1$ if no match could be made. <span class="fixed">ftxt</span> is the original text of the regular expression in its precompiled form, which we need partly to print good debugging information, but mostly in order to match against a <a href="./RegExp.i6t.html#line91">LITERAL_RE_CC</a> node.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line990">990</span><span class="td">[&nbsp;TEXT_TY_RE_ParseAtPosition&nbsp;ftxt&nbsp;txt&nbsp;ifrom&nbsp;ito&nbsp;token&nbsp;mode_flags</span></span>
<span class="tr"><span class="th" id="line991">991</span><span class="td">&nbsp;outcome&nbsp;ipos&nbsp;npos&nbsp;rv&nbsp;i&nbsp;ch&nbsp;edge&nbsp;rewind_this;</span></span>
<span class="tr"><span class="th" id="line992">992</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line993">993</span><span class="td">&nbsp;if&nbsp;(ifrom&nbsp;&gt;&nbsp;ito)&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line994">994</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line995">995</span><span class="td">&nbsp;ipos&nbsp;=&nbsp;ifrom;</span></span>
<span class="tr"><span class="th" id="line996">996</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line997">997</span><span class="td">&nbsp;.Rewind;</span></span>
<span class="tr"><span class="th" id="line998">998</span><span class="td">&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line999">999</span><span class="td">&nbsp;&nbsp;outcome&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1000">1000</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1001">1001</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Matching&nbsp;at&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1002">1002</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1003">1003</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1004">1004</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1005">1005</span><span class="td">&nbsp;&nbsp;if&nbsp;(ipos&lt;ito)&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt,&nbsp;ipos);&nbsp;else&nbsp;ch&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1006">1006</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1007">1007</span><span class="td">&nbsp;&nbsp;token--&gt;RE_MODES&nbsp;=&nbsp;mode_flags;&nbsp;!&nbsp;Save&nbsp;in&nbsp;case&nbsp;of&nbsp;backtrack</span></span>
<span class="tr"><span class="th" id="line1008">1008</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1009">1009</span><span class="td">&nbsp;&nbsp;switch&nbsp;(token--&gt;RE_CCLASS)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1010">1010</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1011">1011</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Should&nbsp;never&nbsp;happen</span></span>
<span class="tr"><span class="th" id="line1012">1012</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1013">1013</span><span class="td">&nbsp;&nbsp;&nbsp;CHOICE_RE_CC:&nbsp;return&nbsp;&quot;internal&nbsp;error&quot;;</span></span>
<span class="tr"><span class="th" id="line1014">1014</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1015">1015</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Mode&nbsp;switches</span></span>
<span class="tr"><span class="th" id="line1016">1016</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1017">1017</span><span class="td">&nbsp;&nbsp;&nbsp;SENSITIVITY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1018">1018</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR1)&nbsp;mode_flags&nbsp;=&nbsp;mode_flags&nbsp;|&nbsp;CIS_MFLAG;</span></span>
<span class="tr"><span class="th" id="line1019">1019</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;mode_flags&nbsp;=&nbsp;mode_flags&nbsp;&amp;&nbsp;(~CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1020">1020</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1021">1021</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1022">1022</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Zero-length&nbsp;positional&nbsp;markers</span></span>
<span class="tr"><span class="th" id="line1023">1023</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1024">1024</span><span class="td">&nbsp;&nbsp;&nbsp;ALWAYS_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1025">1025</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1026">1026</span><span class="td">&nbsp;&nbsp;&nbsp;NEVER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1027">1027</span><span class="td">&nbsp;&nbsp;&nbsp;START_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1028">1028</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ipos&nbsp;==&nbsp;0)&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1029">1029</span><span class="td">&nbsp;&nbsp;&nbsp;END_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1030">1030</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(txt,&nbsp;ipos)&nbsp;==&nbsp;0)&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1031">1031</span><span class="td">&nbsp;&nbsp;&nbsp;BOUNDARY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1032">1032</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1033">1033</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(txt,&nbsp;ipos)&nbsp;==&nbsp;0&nbsp;or&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1034">1034</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1035">1035</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1036">1036</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;rv++;</span></span>
<span class="tr"><span class="th" id="line1037">1037</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ipos&nbsp;==&nbsp;0)&nbsp;ch&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1038">1038</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt,&nbsp;ipos-1);</span></span>
<span class="tr"><span class="th" id="line1039">1039</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;0&nbsp;or&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1040">1040</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1041">1041</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1042">1042</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;rv++;</span></span>
<span class="tr"><span class="th" id="line1043">1043</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;==&nbsp;1)&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1044">1044</span><span class="td">&nbsp;&nbsp;&nbsp;NONBOUNDARY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1045">1045</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1046">1046</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(txt,&nbsp;ipos)&nbsp;==&nbsp;0&nbsp;or&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1047">1047</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1048">1048</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1049">1049</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;rv++;</span></span>
<span class="tr"><span class="th" id="line1050">1050</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ipos&nbsp;==&nbsp;0)&nbsp;ch&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1051">1051</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt,&nbsp;ipos-1);</span></span>
<span class="tr"><span class="th" id="line1052">1052</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;0&nbsp;or&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1053">1053</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1054">1054</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1055">1055</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;rv++;</span></span>
<span class="tr"><span class="th" id="line1056">1056</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;~=&nbsp;1)&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1057">1057</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1058">1058</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Control&nbsp;constructs</span></span>
<span class="tr"><span class="th" id="line1059">1059</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1060">1060</span><span class="td">&nbsp;&nbsp;&nbsp;IF_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1061">1061</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;token--&gt;RE_PAR1;&nbsp;ch&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1062">1062</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1063">1063</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Trying&nbsp;conditional&nbsp;from&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1064">1064</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1065">1065</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1066">1066</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&gt;=&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1067">1067</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((i&lt;RE_Subexpressions--&gt;10)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1068">1068</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((RE_Subexpressions--&gt;i)--&gt;RE_DATA1&nbsp;&gt;=&nbsp;0))&nbsp;ch&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1069">1069</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1070">1070</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,</span></span>
<span class="tr"><span class="th" id="line1071">1071</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DOWN,&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1072">1072</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;ch&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1073">1073</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1074">1074</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1075">1075</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Condition&nbsp;found&nbsp;to&nbsp;be&nbsp;&quot;,&nbsp;ch,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1076">1076</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1077">1077</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1078">1078</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,</span></span>
<span class="tr"><span class="th" id="line1079">1079</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_DOWN,&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1080">1080</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!print&nbsp;&quot;Then&nbsp;clause&nbsp;returned&nbsp;&quot;,&nbsp;rv,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1081">1081</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1082">1082</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_NEXT)&nbsp;==&nbsp;NULL)</span></span>
<span class="tr"><span class="th" id="line1083">1083</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;0;&nbsp;!&nbsp;The&nbsp;empty&nbsp;else&nbsp;clause&nbsp;matches</span></span>
<span class="tr"><span class="th" id="line1084">1084</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,</span></span>
<span class="tr"><span class="th" id="line1085">1085</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_NEXT)--&gt;RE_DOWN,&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1086">1086</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!print&nbsp;&quot;Else&nbsp;clause&nbsp;returned&nbsp;&quot;,&nbsp;rv,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1087">1087</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1088">1088</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1089">1089</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1090">1090</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos&nbsp;=&nbsp;ipos&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1091">1091</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1092">1092</span><span class="td">&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1093">1093</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1094">1094</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Trying&nbsp;disjunction&nbsp;from&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1095">1095</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1096">1096</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1097">1097</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(ch&nbsp;=&nbsp;token--&gt;RE_DOWN:&nbsp;ch&nbsp;~=&nbsp;NULL:&nbsp;ch&nbsp;=&nbsp;ch--&gt;RE_NEXT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1098">1098</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch--&gt;RE_PAR1&nbsp;&lt;=&nbsp;token--&gt;RE_CONSTRAINT)&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line1099">1099</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1100">1100</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Trying&nbsp;choice&nbsp;at&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1101">1101</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(ch,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1102">1102</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1103">1103</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,</span></span>
<span class="tr"><span class="th" id="line1104">1104</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch--&gt;RE_DOWN,&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1105">1105</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1106">1106</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;ipos;&nbsp;!&nbsp;Where&nbsp;match&nbsp;was&nbsp;made</span></span>
<span class="tr"><span class="th" id="line1107">1107</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;ch--&gt;RE_PAR1;&nbsp;!&nbsp;Option&nbsp;taken</span></span>
<span class="tr"><span class="th" id="line1108">1108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos&nbsp;=&nbsp;ipos&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1109">1109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1110">1110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1111">1111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Choice&nbsp;worked&nbsp;with&nbsp;width&nbsp;&quot;,&nbsp;rv,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1112">1112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(ch,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1113">1113</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1114">1114</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1115">1115</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1116">1116</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(mode_flags&nbsp;&amp;&nbsp;ACCUM_MFLAG&nbsp;==&nbsp;false)</span></span>
<span class="tr"><span class="th" id="line1117">1117</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(ch--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1118">1118</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1119">1119</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1120">1120</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(outcome&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1121">1121</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1122">1122</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Failed&nbsp;disjunction&nbsp;from&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1123">1123</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1124">1124</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1125">1125</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;ipos;&nbsp;!&nbsp;Where&nbsp;match&nbsp;was&nbsp;tried</span></span>
<span class="tr"><span class="th" id="line1126">1126</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;-1;&nbsp;!&nbsp;No&nbsp;option&nbsp;was&nbsp;taken</span></span>
<span class="tr"><span class="th" id="line1127">1127</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1128">1128</span><span class="td">&nbsp;&nbsp;&nbsp;SUBEXP_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1129">1129</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;1&nbsp;or&nbsp;2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1130">1130</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos&nbsp;=&nbsp;ipos&nbsp;-&nbsp;token--&gt;RE_PAR3;</span></span>
<span class="tr"><span class="th" id="line1131">1131</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(npos&lt;0)&nbsp;rv&nbsp;=&nbsp;-1;&nbsp;!&nbsp;Lookbehind&nbsp;fails:&nbsp;nothing&nbsp;behind</span></span>
<span class="tr"><span class="th" id="line1132">1132</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;npos,&nbsp;ito,&nbsp;token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1133">1133</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1134">1134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1135">1135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(token--&gt;RE_PAR3)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1136">1136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,&nbsp;token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1137">1137</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1138">1138</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,&nbsp;token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1139">1139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags&nbsp;&amp;&nbsp;(~CIS_MFLAG));</span></span>
<span class="tr"><span class="th" id="line1140">1140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;ipos,&nbsp;ito,&nbsp;token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1141">1141</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags&nbsp;|&nbsp;CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1142">1142</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1143">1143</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1144">1144</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;npos&nbsp;=&nbsp;ipos;</span></span>
<span class="tr"><span class="th" id="line1145">1145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;npos&nbsp;=&nbsp;ipos&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1146">1146</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(token--&gt;RE_PAR2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1147">1147</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;rv&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1148">1148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;rv&nbsp;=&nbsp;-1;&nbsp;else&nbsp;rv&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1149">1149</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1150">1150</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1151">1151</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;ipos;</span></span>
<span class="tr"><span class="th" id="line1152">1152</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos&nbsp;=&nbsp;ipos&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1153">1153</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;npos;</span></span>
<span class="tr"><span class="th" id="line1154">1154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1155">1155</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1156">1156</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(mode_flags&nbsp;&amp;&nbsp;ACCUM_MFLAG&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1157">1157</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1158">1158</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1159">1159</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1160">1160</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1161">1161</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;2)&nbsp;TEXT_TY_RE_FailSubexpressions(token,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1162">1162</span><span class="td">&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1163">1163</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;ipos;</span></span>
<span class="tr"><span class="th" id="line1164">1164</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_DOWN)--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1165">1165</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1166">1166</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2&nbsp;=&nbsp;-1;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1167">1167</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1168">1168</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1169">1169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Trying&nbsp;quantifier&nbsp;from&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1170">1170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1171">1171</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1172">1172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR3&nbsp;==&nbsp;false)&nbsp;{&nbsp;!&nbsp;Greedy&nbsp;quantifier</span></span>
<span class="tr"><span class="th" id="line1173">1173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!edge&nbsp;=&nbsp;ito;&nbsp;if&nbsp;(token--&gt;RE_CONSTRAINT&nbsp;&gt;=&nbsp;0)&nbsp;edge&nbsp;=&nbsp;token--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line1174">1174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge&nbsp;=&nbsp;token--&gt;RE_PAR2;</span></span>
<span class="tr"><span class="th" id="line1175">1175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CONSTRAINT&nbsp;&gt;=&nbsp;0)&nbsp;edge&nbsp;=&nbsp;token--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line1176">1176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1177">1177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0,&nbsp;npos=ipos:&nbsp;i&lt;edge:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1178">1178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1179">1179</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Trying&nbsp;quant&nbsp;rep&nbsp;&quot;,&nbsp;i+1,&nbsp;&quot;&nbsp;at&nbsp;&quot;,&nbsp;npos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1180">1180</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1181">1181</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1182">1182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;npos,&nbsp;ito,&nbsp;token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1183">1183</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags&nbsp;|&nbsp;ACCUM_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1184">1184</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&lt;&nbsp;0)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1185">1185</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_DOWN)--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1186">1186</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1187">1187</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA2;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1188">1188</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1189">1189</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((rv&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;30000)&nbsp;&amp;&amp;&nbsp;(i&gt;=1))&nbsp;{&nbsp;i++;&nbsp;break;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1190">1190</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos&nbsp;=&nbsp;npos&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1191">1191</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1192">1192</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((i&nbsp;&gt;=&nbsp;token--&gt;RE_PAR1)&nbsp;&amp;&amp;&nbsp;(i&nbsp;&lt;=&nbsp;token--&gt;RE_PAR2))</span></span>
<span class="tr"><span class="th" id="line1193">1193</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1194">1194</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;!&nbsp;Lazy&nbsp;quantifier</span></span>
<span class="tr"><span class="th" id="line1195">1195</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge&nbsp;=&nbsp;token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line1196">1196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CONSTRAINT&nbsp;&gt;&nbsp;edge)&nbsp;edge&nbsp;=&nbsp;token--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line1197">1197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=0,&nbsp;npos=ipos:&nbsp;(npos&lt;ito)&nbsp;&amp;&amp;&nbsp;(i&nbsp;&lt;&nbsp;token--&gt;RE_PAR2):&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1198">1198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&gt;=&nbsp;edge)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1199">1199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1200">1200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Trying&nbsp;quant&nbsp;rep&nbsp;&quot;,&nbsp;i+1,&nbsp;&quot;&nbsp;at&nbsp;&quot;,&nbsp;npos,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1201">1201</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1202">1202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1203">1203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_ParseAtPosition(ftxt,&nbsp;txt,&nbsp;npos,&nbsp;ito,&nbsp;token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1204">1204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags&nbsp;|&nbsp;ACCUM_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1205">1205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&lt;&nbsp;0)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1206">1206</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_DOWN)--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1207">1207</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1208">1208</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA2;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1209">1209</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1210">1210</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((rv&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;30000)&nbsp;&amp;&amp;&nbsp;(i&gt;=1))&nbsp;{&nbsp;i++;&nbsp;break;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1211">1211</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos&nbsp;=&nbsp;npos&nbsp;+&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line1212">1212</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1213">1213</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((i&nbsp;&gt;=&nbsp;edge)&nbsp;&amp;&amp;&nbsp;(i&nbsp;&lt;=&nbsp;token--&gt;RE_PAR2))</span></span>
<span class="tr"><span class="th" id="line1214">1214</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1215">1215</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1216">1216</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(outcome)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1217">1217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_PAR3&nbsp;==&nbsp;false)&nbsp;{&nbsp;!&nbsp;Greedy&nbsp;quantifier</span></span>
<span class="tr"><span class="th" id="line1218">1218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&gt;&nbsp;token--&gt;RE_PAR1)&nbsp;{&nbsp;!&nbsp;I.e.,&nbsp;if&nbsp;we&nbsp;have&nbsp;been&nbsp;greedy</span></span>
<span class="tr"><span class="th" id="line1219">1219</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;i-1;&nbsp;!&nbsp;And&nbsp;its&nbsp;edge&nbsp;limitation</span></span>
<span class="tr"><span class="th" id="line1220">1220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1221">1221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1222">1222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1223">1223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;!&nbsp;Lazy&nbsp;quantifier</span></span>
<span class="tr"><span class="th" id="line1224">1224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&lt;&nbsp;token--&gt;RE_PAR2)&nbsp;{&nbsp;!&nbsp;I.e.,&nbsp;if&nbsp;we&nbsp;have&nbsp;been&nbsp;lazy</span></span>
<span class="tr"><span class="th" id="line1225">1225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;i+1;&nbsp;!&nbsp;And&nbsp;its&nbsp;edge&nbsp;limitation</span></span>
<span class="tr"><span class="th" id="line1226">1226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1227">1227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1228">1228</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1229">1229</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1230">1230</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos&nbsp;=&nbsp;npos;</span></span>
<span class="tr"><span class="th" id="line1231">1231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((i&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(mode_flags&nbsp;&amp;&nbsp;ACCUM_MFLAG&nbsp;==&nbsp;false))</span></span>
<span class="tr"><span class="th" id="line1232">1232</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1233">1233</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_DOWN)--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1234">1234</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA1&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1;</span></span>
<span class="tr"><span class="th" id="line1235">1235</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA2&nbsp;=&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1236">1236</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1237">1237</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1238">1238</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Successful&nbsp;quant&nbsp;reps&nbsp;&quot;,&nbsp;i,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1239">1239</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1240">1240</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1241">1241</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1242">1242</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!token--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1243">1243</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(mode_flags&nbsp;&amp;&nbsp;ACCUM_MFLAG&nbsp;==&nbsp;false)</span></span>
<span class="tr"><span class="th" id="line1244">1244</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1245">1245</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1246">1246</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Failed&nbsp;quant&nbsp;reps&nbsp;&quot;,&nbsp;i,&nbsp;&quot;:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1247">1247</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1248">1248</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1249">1249</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1250">1250</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1251">1251</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Character&nbsp;classes</span></span>
<span class="tr"><span class="th" id="line1252">1252</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1253">1253</span><span class="td">&nbsp;&nbsp;&nbsp;NOTHING_RE_CC:&nbsp;;</span></span>
<span class="tr"><span class="th" id="line1254">1254</span><span class="td">&nbsp;&nbsp;&nbsp;ANYTHING_RE_CC:&nbsp;if&nbsp;(ch)&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;</span></span>
<span class="tr"><span class="th" id="line1255">1255</span><span class="td">&nbsp;&nbsp;&nbsp;WHITESPACE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1256">1256</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9)&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1257">1257</span><span class="td">&nbsp;&nbsp;&nbsp;NONWHITESPACE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1258">1258</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1259">1259</span><span class="td">&nbsp;&nbsp;&nbsp;PUNCTUATION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1260">1260</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1261">1261</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1262">1262</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1263">1263</span><span class="td">&nbsp;&nbsp;&nbsp;NONPUNCTUATION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1264">1264</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1265">1265</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1266">1266</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1267">1267</span><span class="td">&nbsp;&nbsp;&nbsp;WORD_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1268">1268</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1269">1269</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1270">1270</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1271">1271</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1272">1272</span><span class="td">&nbsp;&nbsp;&nbsp;NONWORD_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1273">1273</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1274">1274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1275">1275</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1276">1276</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1277">1277</span><span class="td">&nbsp;&nbsp;&nbsp;DIGIT_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1278">1278</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;0&#39;&nbsp;or&nbsp;&#39;1&#39;&nbsp;or&nbsp;&#39;2&#39;&nbsp;or&nbsp;&#39;3&#39;&nbsp;or&nbsp;&#39;4&#39;</span></span>
<span class="tr"><span class="th" id="line1279">1279</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;5&#39;&nbsp;or&nbsp;&#39;6&#39;&nbsp;or&nbsp;&#39;7&#39;&nbsp;or&nbsp;&#39;8&#39;&nbsp;or&nbsp;&#39;9&#39;)&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1280">1280</span><span class="td">&nbsp;&nbsp;&nbsp;NONDIGIT_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1281">1281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;&#39;0&#39;&nbsp;or&nbsp;&#39;1&#39;&nbsp;or&nbsp;&#39;2&#39;&nbsp;or&nbsp;&#39;3&#39;&nbsp;or&nbsp;&#39;4&#39;</span></span>
<span class="tr"><span class="th" id="line1282">1282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;5&#39;&nbsp;or&nbsp;&#39;6&#39;&nbsp;or&nbsp;&#39;7&#39;&nbsp;or&nbsp;&#39;8&#39;&nbsp;or&nbsp;&#39;9&#39;))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1283">1283</span><span class="td">&nbsp;&nbsp;&nbsp;LCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1284">1284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CharIsOfCase(ch,&nbsp;0))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1285">1285</span><span class="td">&nbsp;&nbsp;&nbsp;NONLCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1286">1286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(CharIsOfCase(ch,&nbsp;0)&nbsp;==&nbsp;false))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1287">1287</span><span class="td">&nbsp;&nbsp;&nbsp;UCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1288">1288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(CharIsOfCase(ch,&nbsp;1))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1289">1289</span><span class="td">&nbsp;&nbsp;&nbsp;NONUCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1290">1290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(CharIsOfCase(ch,&nbsp;1)&nbsp;==&nbsp;false))&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1291">1291</span><span class="td">&nbsp;&nbsp;&nbsp;NEWLINE_RE_CC:&nbsp;if&nbsp;(ch&nbsp;==&nbsp;10)&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1292">1292</span><span class="td">&nbsp;&nbsp;&nbsp;TAB_RE_CC:&nbsp;if&nbsp;(ch&nbsp;==&nbsp;9)&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1293">1293</span><span class="td">&nbsp;&nbsp;&nbsp;RANGE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1294">1294</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Range(ch,&nbsp;ftxt,</span></span>
<span class="tr"><span class="th" id="line1295">1295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PAR1,&nbsp;token--&gt;RE_PAR2,&nbsp;token--&gt;RE_PAR3,&nbsp;mode_flags&nbsp;&amp;&nbsp;CIS_MFLAG))</span></span>
<span class="tr"><span class="th" id="line1296">1296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;ipos++;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1297">1297</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1298">1298</span><span class="td">&nbsp;&nbsp;&nbsp;!&nbsp;Substring&nbsp;matches</span></span>
<span class="tr"><span class="th" id="line1299">1299</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1300">1300</span><span class="td">&nbsp;&nbsp;&nbsp;LITERAL_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1301">1301</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_MatchSubstring(txt,&nbsp;ipos,</span></span>
<span class="tr"><span class="th" id="line1302">1302</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ftxt,&nbsp;token--&gt;RE_PAR1,&nbsp;token--&gt;RE_PAR2,&nbsp;mode_flags&nbsp;&amp;&nbsp;CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1303">1303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;ipos&nbsp;=&nbsp;ipos&nbsp;+&nbsp;rv;&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1304">1304</span><span class="td">&nbsp;&nbsp;&nbsp;VARIABLE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1305">1305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line1306">1306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((RE_Subexpressions--&gt;i)--&gt;RE_DATA1&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1307">1307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv&nbsp;=&nbsp;TEXT_TY_RE_MatchSubstring(txt,&nbsp;ipos,</span></span>
<span class="tr"><span class="th" id="line1308">1308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;txt,&nbsp;(RE_Subexpressions--&gt;i)--&gt;RE_DATA1,</span></span>
<span class="tr"><span class="th" id="line1309">1309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RE_Subexpressions--&gt;i)--&gt;RE_DATA2,&nbsp;mode_flags&nbsp;&amp;&nbsp;CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1310">1310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rv&nbsp;&gt;=&nbsp;0)&nbsp;{&nbsp;ipos&nbsp;=&nbsp;ipos&nbsp;+&nbsp;rv;&nbsp;outcome&nbsp;=&nbsp;true;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1311">1311</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1312">1312</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;.NeverMatchIncompleteVar;</span></span>
<span class="tr"><span class="th" id="line1313">1313</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1314">1314</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1315">1315</span><span class="td">&nbsp;&nbsp;if&nbsp;(outcome&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1316">1316</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_RewindCount++&nbsp;&gt;=&nbsp;10000)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1317">1317</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_RewindCount&nbsp;==&nbsp;10001)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1318">1318</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style&nbsp;bold;&nbsp;print&nbsp;&quot;OVERFLOW^&quot;;&nbsp;style&nbsp;roman;</span></span>
<span class="tr"><span class="th" id="line1319">1319</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1320">1320</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1321">1321</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1322">1322</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1323">1323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Rewind&nbsp;sought&nbsp;from&nbsp;failure&nbsp;at&nbsp;pos&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;&nbsp;with:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1324">1324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1325">1325</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1326">1326</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_CCLASS&nbsp;==&nbsp;QUANTIFIER_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1327">1327</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;(TEXT_TY_RE_SeekBacktrack(token--&gt;RE_DOWN,&nbsp;ftxt,&nbsp;false,&nbsp;ito,&nbsp;false)))</span></span>
<span class="tr"><span class="th" id="line1328">1328</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./RegExp.i6t.html#line1333">RewindFound</a>;</span></span>
<span class="tr"><span class="th" id="line1329">1329</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(mode_flags&nbsp;&amp;&nbsp;ACCUM_MFLAG&nbsp;==&nbsp;false)&nbsp;TEXT_TY_RE_FailSubexpressions(token);</span></span>
<span class="tr"><span class="th" id="line1330">1330</span><span class="td">&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line1331">1331</span><span class="td">&nbsp;&nbsp;&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1332">1332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_SeekBacktrack(token,&nbsp;ftxt,&nbsp;true,&nbsp;ito,&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1333">1333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.RewindFound;</span></span>
<span class="tr"><span class="th" id="line1334">1334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos&nbsp;=&nbsp;token--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1335">1335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags&nbsp;=&nbsp;token--&gt;RE_MODES;</span></span>
<span class="tr"><span class="th" id="line1336">1336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(mode_flags&nbsp;&amp;&nbsp;ACCUM_MFLAG&nbsp;==&nbsp;false)</span></span>
<span class="tr"><span class="th" id="line1337">1337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(token,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1338">1338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ipos&nbsp;==&nbsp;-1)</span></span>
<span class="tr"><span class="th" id="line1339">1339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1340">1340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1341">1341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;^[&quot;,&nbsp;ifrom,&nbsp;&quot;,&quot;,&nbsp;ito,&nbsp;&quot;]&nbsp;rewinding&nbsp;to&nbsp;&quot;,&nbsp;ipos,&nbsp;&quot;&nbsp;at&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1342">1342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1343">1343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1344">1344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump&nbsp;<a href="./RegExp.i6t.html#line997">Rewind</a>;</span></span>
<span class="tr"><span class="th" id="line1345">1345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1346">1346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line1347">1347</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1348">1348</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)</span></span>
<span class="tr"><span class="th" id="line1349">1349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;^Rewind&nbsp;impossible^&quot;;</span></span>
<span class="tr"><span class="th" id="line1350">1350</span><span class="td">&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1351">1351</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1352">1352</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1353">1353</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line1354">1354</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1355">1355</span><span class="td">&nbsp;return&nbsp;ipos&nbsp;-&nbsp;ifrom;</span></span>
<span class="tr"><span class="th" id="line1356">1356</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1357">1357</span><span class="td"></span></span>
</div><div class='text'>
<h2>Backtracking.</h2><p><p> It would be very straightforward to match regular expressions with the above recursive code if, for every node, there were a fixed number of characters (depending on the node) such that there would either be a match eating that many characters, or else no match at all. If that were true, we could simply march through the text matching until we could match no more, and although some nodes might have ambiguous readings, we could always match the first possibility which worked. There would never be any need to retreat.<p></p><p> Well, in fact that happy state does apply to a surprising number of nodes, and some quite complicated regular expressions can be made which use only them: <span class="fixed">&lt;abc&gt;{2}\d\d\1</span>, for instance, matches a sequence of exactly 6 characters or else fails to match altogether, and there is never any need to backtrack. One reason why backtracking is a fairly good algorithm in practice is that these &quot;good&quot; cases occur fairly often, in subexpressions if not in the entire expression, and the simple method above disposes of them efficiently.<p></p><p> But in an expression like <span class="fixed">ab+bb</span>, there is no alternative to backtracking if we are going to try to match the nodes from left to right: we match the &quot;a&quot;, then we match as many &quot;b&quot;s as we can &ndash; but then we find that we have to match &quot;bb&quot;, and this is necessarily impossible because we have just eaten all of the &quot;b&quot;s available. We therefore backtrack one node to the <span class="fixed">b+</span> and try again. We obviously can&#39;t literally try again because that would give the same result: instead we impose a constraint. Suppose it previously matched a row of 23 letter &quot;b&quot;s, so that the quantifier <span class="fixed">+</span> resulted in a multiplicity of 23. We then constrain the node and in effect consider it to be <span class="fixed">b{1,22}</span>, that is, to match at least 1 and at most 22 letter &quot;b&quot;s. That still won&#39;t work, as it happens, so we backtrack again with a constraint tightened to make it <span class="fixed">b{1,21}</span>, and now the match occurs as we would hope. When the expression becomes more complex, backtracking becomes a longer-distance, recursive procedure &ndash; we have to exhaust all possibilities of a more recent node before tracking back to one from longer ago. (This is why the worst test cases are those which entice us into a long, long series of matches only to find that a guess made right back at the start was ill-fated.)<p></p><p> Rather than describing <a href="./RegExp.i6t.html#line1401">TEXT_TY_RE_SeekBacktrack</a> in detail here, it is probably more useful to suggest that the reader observe it in action by setting <a href="./RegExp.i6t.html#line11">TEXT_TY_RE_Trace</a> and trying a few regular expressions.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1401">1401</span><span class="td">[&nbsp;TEXT_TY_RE_SeekBacktrack&nbsp;token&nbsp;ftxt&nbsp;downwards&nbsp;ito&nbsp;report_only</span></span>
<span class="tr"><span class="th" id="line1402">1402</span><span class="td">&nbsp;untried;</span></span>
<span class="tr"><span class="th" id="line1403">1403</span><span class="td">&nbsp;for&nbsp;(:&nbsp;token&nbsp;~=&nbsp;NULL:&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1404">1404</span><span class="td">&nbsp;&nbsp;if&nbsp;((TEXT_TY_RE_Trace)&nbsp;&amp;&amp;&nbsp;(report_only&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1405">1405</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Scan&nbsp;for&nbsp;rewind:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1406">1406</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1407">1407</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1408">1408</span><span class="td">&nbsp;&nbsp;if&nbsp;((token--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1409">1409</span><span class="td">&nbsp;&nbsp;&nbsp;(token--&gt;RE_PAR2&nbsp;==&nbsp;1&nbsp;or&nbsp;2&nbsp;or&nbsp;4))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1410">1410</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(downwards)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1411">1411</span><span class="td">&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line1412">1412</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1413">1413</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1414">1414</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((TEXT_TY_RE_Trace)&nbsp;&amp;&amp;&nbsp;(report_only&nbsp;==&nbsp;false))&nbsp;print&nbsp;&quot;Descend^&quot;;</span></span>
<span class="tr"><span class="th" id="line1415">1415</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_SeekBacktrack(token--&gt;RE_DOWN,&nbsp;ftxt,&nbsp;false,&nbsp;ito,&nbsp;report_only))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1416">1416</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1417">1417</span><span class="td">&nbsp;&nbsp;untried&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line1418">1418</span><span class="td">&nbsp;&nbsp;switch&nbsp;(token--&gt;RE_CCLASS)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1419">1419</span><span class="td">&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1420">1420</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((token--&gt;RE_DATA2&nbsp;&gt;=&nbsp;1)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1421">1421</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DATA2&nbsp;&lt;&nbsp;token--&gt;RE_PAR1)&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1422">1422</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_CONSTRAINT&nbsp;&lt;&nbsp;token--&gt;RE_PAR1))&nbsp;{&nbsp;!&nbsp;Matched&nbsp;but&nbsp;earlier&nbsp;than&nbsp;last</span></span>
<span class="tr"><span class="th" id="line1423">1423</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(report_only)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1424">1424</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CONSTRAINT&nbsp;==&nbsp;-1)</span></span>
<span class="tr"><span class="th" id="line1425">1425</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_CONSTRAINT&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1426">1426</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1427">1427</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_CONSTRAINT)++;</span></span>
<span class="tr"><span class="th" id="line1428">1428</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;untried&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1429">1429</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1430">1430</span><span class="td">&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1431">1431</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CONSTRAINT&nbsp;~=&nbsp;-2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1432">1432</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((TEXT_TY_RE_Trace)&nbsp;&amp;&amp;&nbsp;(report_only&nbsp;==&nbsp;false))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1433">1433</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Quant&nbsp;with&nbsp;cons&nbsp;not&nbsp;-2:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1434">1434</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1435">1435</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1436">1436</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DATA2&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1437">1437</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(report_only)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1438">1438</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_CONSTRAINT&nbsp;=&nbsp;token--&gt;RE_DATA2;</span></span>
<span class="tr"><span class="th" id="line1439">1439</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;untried&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line1440">1440</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1441">1441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1442">1442</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1443">1443</span><span class="td">&nbsp;&nbsp;if&nbsp;(untried)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1444">1444</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1445">1445</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;Grounds&nbsp;for&nbsp;rewind&nbsp;at:&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1446">1446</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token,&nbsp;ftxt,&nbsp;true);</span></span>
<span class="tr"><span class="th" id="line1447">1447</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1448">1448</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_EraseConstraints(token--&gt;RE_NEXT);</span></span>
<span class="tr"><span class="th" id="line1449">1449</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_EraseConstraints(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1450">1450</span><span class="td">&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1451">1451</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1452">1452</span><span class="td">&nbsp;&nbsp;if&nbsp;(downwards)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1453">1453</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1454">1454</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1455">1455</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1456">1456</span><span class="td"></span></span>
</div><div class='text'>
<h2>Fail Subexpressions.</h2><p><p> Here, an attempt to make a complicated match against the node in <span class="fixed">token</span> has failed: that means that any subexpressions which were matched in the course of the attempt must also in retrospect be considered unmatched. So we work down through the subtree at <span class="fixed">token</span> and empty any markers for subexpressions, which in effect clears their backslash variables &ndash; this is important as, otherwise, the contents left over could cause the alternative reading of the <span class="fixed">token</span> to be misparsed if it refers to the backslash variables in question. (If you think nobody would ever be crazy enough to write a regular expression like that, you haven&#39;t see Perl&#39;s test suite.)<p></p><p> If the <span class="fixed">downwards</span> flag is clear, it not only invalidates subexpression matches below the node but also to the right of the node &ndash; this is useful for a backtrack which runs back quite some distance.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1473">1473</span><span class="td">[&nbsp;TEXT_TY_RE_FailSubexpressions&nbsp;token&nbsp;downwards;</span></span>
<span class="tr"><span class="th" id="line1474">1474</span><span class="td">&nbsp;for&nbsp;(:&nbsp;token&nbsp;~=&nbsp;NULL:&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1475">1475</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DOWN&nbsp;~=&nbsp;NULL)&nbsp;TEXT_TY_RE_FailSubexpressions(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1476">1476</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_CCLASS&nbsp;==&nbsp;SUBEXP_RE_CC)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1477">1477</span><span class="td">&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1478">1478</span><span class="td">&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1479">1479</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1480">1480</span><span class="td">&nbsp;&nbsp;if&nbsp;(downwards)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1481">1481</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1482">1482</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1483">1483</span><span class="td"></span></span>
</div><div class='text'>
<h2>Erasing Constraints.</h2><p><p> As explained above, temporary constraints are placed on some nodes when we are backtracking to test possible cases. When we do backtrack, though, it&#39;s important to lift any constraints left over from the previous attempt to parse material which is part of or subsequent to the token whose match attempt has been abandoned.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1492">1492</span><span class="td">[&nbsp;TEXT_TY_RE_EraseConstraints&nbsp;token;</span></span>
<span class="tr"><span class="th" id="line1493">1493</span><span class="td">&nbsp;while&nbsp;(token&nbsp;~=&nbsp;NULL)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1494">1494</span><span class="td">&nbsp;&nbsp;switch&nbsp;(token--&gt;RE_CCLASS)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1495">1495</span><span class="td">&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:&nbsp;token--&gt;RE_CONSTRAINT&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1496">1496</span><span class="td">&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:&nbsp;token--&gt;RE_CONSTRAINT&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1497">1497</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1498">1498</span><span class="td">&nbsp;&nbsp;if&nbsp;(token--&gt;RE_DOWN)&nbsp;TEXT_TY_RE_EraseConstraints(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1499">1499</span><span class="td">&nbsp;&nbsp;token&nbsp;=&nbsp;token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line1500">1500</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1501">1501</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1502">1502</span><span class="td"></span></span>
</div><div class='text'>
<h2>Matching Literal Text.</h2><p><p> Here we attempt to make a match of the substring of the text <span class="fixed">mtxt</span> which runs from character <span class="fixed">mfrom</span> to character <span class="fixed">mto</span>, looking for it at the given position <span class="fixed">ipos</span> in the source text <span class="fixed">txt</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1509">1509</span><span class="td">[&nbsp;TEXT_TY_RE_MatchSubstring&nbsp;txt&nbsp;ipos&nbsp;mtxt&nbsp;mfrom&nbsp;mto&nbsp;insens</span></span>
<span class="tr"><span class="th" id="line1510">1510</span><span class="td">&nbsp;i&nbsp;ch;</span></span>
<span class="tr"><span class="th" id="line1511">1511</span><span class="td">&nbsp;if&nbsp;(mfrom&nbsp;&lt;&nbsp;0)&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1512">1512</span><span class="td">&nbsp;if&nbsp;(insens)</span></span>
<span class="tr"><span class="th" id="line1513">1513</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=mfrom:i&lt;mto:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1514">1514</span><span class="td">&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(mtxt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line1515">1515</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(txt,&nbsp;ipos++)&nbsp;~=&nbsp;ch&nbsp;or&nbsp;TEXT_TY_RevCase(ch))</span></span>
<span class="tr"><span class="th" id="line1516">1516</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1517">1517</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1518">1518</span><span class="td">&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1519">1519</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=mfrom:i&lt;mto:i++)</span></span>
<span class="tr"><span class="th" id="line1520">1520</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueRead(txt,&nbsp;ipos++)&nbsp;~=&nbsp;BlkValueRead(mtxt,&nbsp;i))</span></span>
<span class="tr"><span class="th" id="line1521">1521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1522">1522</span><span class="td">&nbsp;return&nbsp;mto-mfrom;</span></span>
<span class="tr"><span class="th" id="line1523">1523</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1524">1524</span><span class="td"></span></span>
</div><div class='text'>
<h2>Matching Character Range.</h2><p><p> Suppose that a character range is stored in <span class="fixed">ftxt</span> between the character positions <span class="fixed">rf</span> and <span class="fixed">rt</span>. Then |TEXT_TY_RE_Range(ch, ftxt, rf, rt, negate, insens)| tests whether a given character <span class="fixed">ch</span> lies within that character range, negating the outcome if <span class="fixed">negate</span> is set, and performing comparisons case insensitively if <span class="fixed">insens</span> is set.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1533">1533</span><span class="td">[&nbsp;TEXT_TY_RE_Range&nbsp;ch&nbsp;ftxt&nbsp;rf&nbsp;rt&nbsp;negate&nbsp;insens</span></span>
<span class="tr"><span class="th" id="line1534">1534</span><span class="td">&nbsp;i&nbsp;chm&nbsp;upper&nbsp;crev;</span></span>
<span class="tr"><span class="th" id="line1535">1535</span><span class="td">&nbsp;if&nbsp;(ch&nbsp;==&nbsp;0)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1536">1536</span><span class="td">&nbsp;if&nbsp;(negate&nbsp;==&nbsp;true)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1537">1537</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Range(ch,&nbsp;ftxt,&nbsp;rf,&nbsp;rt,&nbsp;false,&nbsp;insens))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1538">1538</span><span class="td">&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1539">1539</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1540">1540</span><span class="td">&nbsp;for&nbsp;(i=rf:&nbsp;i&lt;rt:&nbsp;i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1541">1541</span><span class="td">&nbsp;&nbsp;chm&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line1542">1542</span><span class="td">&nbsp;&nbsp;if&nbsp;((chm&nbsp;==&nbsp;&#39;\&#39;)&nbsp;&amp;&amp;&nbsp;(i+1&lt;rt))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1543">1543</span><span class="td">&nbsp;&nbsp;&nbsp;chm&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;++i);</span></span>
<span class="tr"><span class="th" id="line1544">1544</span><span class="td">&nbsp;&nbsp;&nbsp;switch&nbsp;(chm)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1545">1545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;s&#39;:</span></span>
<span class="tr"><span class="th" id="line1546">1546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1547">1547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;S&#39;:</span></span>
<span class="tr"><span class="th" id="line1548">1548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1549">1549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;p&#39;:</span></span>
<span class="tr"><span class="th" id="line1550">1550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1551">1551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1552">1552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1553">1553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;P&#39;:</span></span>
<span class="tr"><span class="th" id="line1554">1554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1555">1555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1556">1556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1557">1557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;w&#39;:</span></span>
<span class="tr"><span class="th" id="line1558">1558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1559">1559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1560">1560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1561">1561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1562">1562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;W&#39;:</span></span>
<span class="tr"><span class="th" id="line1563">1563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;10&nbsp;or&nbsp;13&nbsp;or&nbsp;32&nbsp;or&nbsp;9</span></span>
<span class="tr"><span class="th" id="line1564">1564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;.&#39;&nbsp;or&nbsp;&#39;,&#39;&nbsp;or&nbsp;&#39;!&#39;&nbsp;or&nbsp;&#39;?&#39;</span></span>
<span class="tr"><span class="th" id="line1565">1565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;-&#39;&nbsp;or&nbsp;&#39;/&#39;&nbsp;or&nbsp;&#39;&quot;&#39;&nbsp;or&nbsp;&#39;:&#39;&nbsp;or&nbsp;&#39;;&#39;</span></span>
<span class="tr"><span class="th" id="line1566">1566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;(&#39;&nbsp;or&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;[&#39;&nbsp;or&nbsp;&#39;]&#39;&nbsp;or&nbsp;&#39;{&#39;&nbsp;or&nbsp;&#39;}&#39;)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1567">1567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;d&#39;:</span></span>
<span class="tr"><span class="th" id="line1568">1568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;0&#39;&nbsp;or&nbsp;&#39;1&#39;&nbsp;or&nbsp;&#39;2&#39;&nbsp;or&nbsp;&#39;3&#39;&nbsp;or&nbsp;&#39;4&#39;</span></span>
<span class="tr"><span class="th" id="line1569">1569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;5&#39;&nbsp;or&nbsp;&#39;6&#39;&nbsp;or&nbsp;&#39;7&#39;&nbsp;or&nbsp;&#39;8&#39;&nbsp;or&nbsp;&#39;9&#39;)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1570">1570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;D&#39;:</span></span>
<span class="tr"><span class="th" id="line1571">1571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;~=&nbsp;&#39;0&#39;&nbsp;or&nbsp;&#39;1&#39;&nbsp;or&nbsp;&#39;2&#39;&nbsp;or&nbsp;&#39;3&#39;&nbsp;or&nbsp;&#39;4&#39;</span></span>
<span class="tr"><span class="th" id="line1572">1572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&#39;5&#39;&nbsp;or&nbsp;&#39;6&#39;&nbsp;or&nbsp;&#39;7&#39;&nbsp;or&nbsp;&#39;8&#39;&nbsp;or&nbsp;&#39;9&#39;))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1573">1573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;l&#39;:&nbsp;if&nbsp;(CharIsOfCase(ch,&nbsp;0))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1574">1574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;L&#39;:&nbsp;if&nbsp;(CharIsOfCase(ch,&nbsp;0)&nbsp;==&nbsp;false)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1575">1575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;u&#39;:&nbsp;if&nbsp;(CharIsOfCase(ch,&nbsp;1))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1576">1576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;U&#39;:&nbsp;if&nbsp;(CharIsOfCase(ch,&nbsp;1)&nbsp;==&nbsp;false)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1577">1577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;n&#39;:&nbsp;if&nbsp;(ch&nbsp;==&nbsp;10)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1578">1578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&#39;t&#39;:&nbsp;if&nbsp;(ch&nbsp;==&nbsp;9)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1579">1579</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1580">1580</span><span class="td">&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1581">1581</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((i+2&lt;rt)&nbsp;&amp;&amp;&nbsp;(BlkValueRead(ftxt,&nbsp;i+1)&nbsp;==&nbsp;&#39;-&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1582">1582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;upper&nbsp;=&nbsp;BlkValueRead(ftxt,&nbsp;i+2);</span></span>
<span class="tr"><span class="th" id="line1583">1583</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ch&nbsp;&gt;=&nbsp;chm)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;&lt;=&nbsp;upper))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1584">1584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(insens)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1585">1585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crev&nbsp;=&nbsp;TEXT_TY_RevCase(ch);</span></span>
<span class="tr"><span class="th" id="line1586">1586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((crev&nbsp;&gt;=&nbsp;chm)&nbsp;&amp;&amp;&nbsp;(crev&nbsp;&lt;=&nbsp;upper))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1587">1587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1588">1588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i=i+2;</span></span>
<span class="tr"><span class="th" id="line1589">1589</span><span class="td">&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1590">1590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(chm&nbsp;==&nbsp;ch)&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1591">1591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((insens)&nbsp;&amp;&amp;&nbsp;(chm&nbsp;==&nbsp;TEXT_TY_RevCase(ch)))&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1592">1592</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1593">1593</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1594">1594</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1595">1595</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1596">1596</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1597">1597</span><span class="td"></span></span>
</div><div class='text'>
<h2>Search And Replace.</h2><p><p> And finally, last but not least: the routine which searches an indexed text <span class="fixed">txt</span> trying to match it against <span class="fixed">ftxt</span>. If <span class="fixed">ftxtype</span> is set to <a href="./Text.i6t.html#line620">REGEXP_BLOB</a> then <span class="fixed">ftxt</span> is expected to be a regular expression such as <span class="fixed">ab+(c*de)?</span>, whereas if <span class="fixed">ftxtype</span> is <a href="./Text.i6t.html#line613">CHR_BLOB</a> then it is expected only to be a simple string of characters taken literally, such as <span class="fixed">frog</span>.<p></p><p> Each match found is replaced with the contents of <span class="fixed">rtxt</span>, except that if the blob type is <a href="./Text.i6t.html#line620">REGEXP_BLOB</a> then we recognise a few syntaxes as special: for instance, <span class="fixed">\2</span> expands to the value of subexpression 2 as it was matched &ndash; see <strong> Writing with Inform</strong> for details.<p></p><p> The optional argument <span class="fixed">insens</span> is a flag which, if set, causes the matching to be done case insensitively; the optional argument <span class="fixed">exactly</span>, if set, causes the matching to work only if the entire <span class="fixed">txt</span> is matched. (This is not especially useful with regular expressions, because the effect can equally be achieved by turning <span class="fixed">ab+c</span>, say, into <span class="fixed">^ab+c$</span>, but it is indeed useful where the blob type is <a href="./Text.i6t.html#line613">CHR_BLOB</a>.)<p></p><p> For an explanation of the use of the word &quot;blob&quot;, see <a href="./Text.i6t.html">Text.i6t</a>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1620">1620</span><span class="td">[&nbsp;TEXT_TY_Replace_RE&nbsp;ftxtype&nbsp;txt&nbsp;ftxt&nbsp;rtxt&nbsp;insens&nbsp;exactly</span></span>
<span class="tr"><span class="th" id="line1621">1621</span><span class="td">&nbsp;r&nbsp;p&nbsp;p1&nbsp;p2&nbsp;cp&nbsp;cp1&nbsp;cp2;</span></span>
<span class="tr"><span class="th" id="line1622">1622</span><span class="td">&nbsp;!print&nbsp;&quot;Find:&nbsp;&quot;;&nbsp;BlkValueDebug(ftxt);&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1623">1623</span><span class="td">&nbsp;!print&nbsp;&quot;Rep:&nbsp;&quot;;&nbsp;BlkValueDebug(rtxt);&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1624">1624</span><span class="td">&nbsp;!print&nbsp;&quot;In:&nbsp;&quot;;&nbsp;BlkValueDebug(txt);&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line1625">1625</span><span class="td">&nbsp;if&nbsp;(rtxt&nbsp;==&nbsp;0&nbsp;or&nbsp;1)&nbsp;{&nbsp;cp&nbsp;=&nbsp;txt--&gt;0;&nbsp;p&nbsp;=&nbsp;TEXT_TY_Temporarily_Transmute(txt);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1626">1626</span><span class="td">&nbsp;else&nbsp;TEXT_TY_Transmute(txt);</span></span>
<span class="tr"><span class="th" id="line1627">1627</span><span class="td">&nbsp;cp1&nbsp;=&nbsp;ftxt--&gt;0;&nbsp;p1&nbsp;=&nbsp;TEXT_TY_Temporarily_Transmute(ftxt);</span></span>
<span class="tr"><span class="th" id="line1628">1628</span><span class="td">&nbsp;cp2&nbsp;=&nbsp;rtxt--&gt;0;&nbsp;p2&nbsp;=&nbsp;TEXT_TY_Temporarily_Transmute(rtxt);</span></span>
<span class="tr"><span class="th" id="line1629">1629</span><span class="td">&nbsp;r&nbsp;=&nbsp;TEXT_TY_Replace_REI(ftxtype,&nbsp;txt,&nbsp;ftxt,&nbsp;rtxt,&nbsp;insens,&nbsp;exactly);</span></span>
<span class="tr"><span class="th" id="line1630">1630</span><span class="td">&nbsp;TEXT_TY_Untransmute(ftxt,&nbsp;p1,&nbsp;cp1);</span></span>
<span class="tr"><span class="th" id="line1631">1631</span><span class="td">&nbsp;TEXT_TY_Untransmute(rtxt,&nbsp;p2,&nbsp;cp2);</span></span>
<span class="tr"><span class="th" id="line1632">1632</span><span class="td">&nbsp;if&nbsp;(rtxt&nbsp;==&nbsp;0&nbsp;or&nbsp;1)&nbsp;TEXT_TY_Untransmute(txt,&nbsp;p,&nbsp;cp);</span></span>
<span class="tr"><span class="th" id="line1633">1633</span><span class="td">&nbsp;return&nbsp;r;</span></span>
<span class="tr"><span class="th" id="line1634">1634</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1635">1635</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1636">1636</span><span class="td">[&nbsp;TEXT_TY_Replace_REI&nbsp;ftxtype&nbsp;txt&nbsp;ftxt&nbsp;rtxt&nbsp;insens&nbsp;exactly</span></span>
<span class="tr"><span class="th" id="line1637">1637</span><span class="td">&nbsp;ctxt&nbsp;csize&nbsp;ilen&nbsp;i&nbsp;cl&nbsp;mpos&nbsp;cpos&nbsp;ch&nbsp;chm;</span></span>
<span class="tr"><span class="th" id="line1638">1638</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1639">1639</span><span class="td">&nbsp;ilen&nbsp;=&nbsp;TEXT_TY_CharacterLength(txt);</span></span>
<span class="tr"><span class="th" id="line1640">1640</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1641">1641</span><span class="td">&nbsp;TEXT_TY_RE_Err&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1642">1642</span><span class="td">&nbsp;switch&nbsp;(ftxtype)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1643">1643</span><span class="td">&nbsp;&nbsp;REGEXP_BLOB:&nbsp;i&nbsp;=&nbsp;TEXT_TY_RE_CompileTree(ftxt,&nbsp;exactly);</span></span>
<span class="tr"><span class="th" id="line1644">1644</span><span class="td">&nbsp;&nbsp;CHR_BLOB:&nbsp;i&nbsp;=&nbsp;TEXT_TY_CHR_CompileTree(ftxt,&nbsp;exactly);</span></span>
<span class="tr"><span class="th" id="line1645">1645</span><span class="td">&nbsp;&nbsp;default:&nbsp;&quot;***&nbsp;bad&nbsp;ftxtype&nbsp;***&quot;;</span></span>
<span class="tr"><span class="th" id="line1646">1646</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1647">1647</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line1648">1648</span><span class="td">&nbsp;if&nbsp;((i&lt;0)&nbsp;||&nbsp;(i&gt;RE_MAX_PACKETS))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1649">1649</span><span class="td">&nbsp;&nbsp;TEXT_TY_RE_Err&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line1650">1650</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;***&nbsp;Regular&nbsp;expression&nbsp;error:&nbsp;&quot;,&nbsp;(string)&nbsp;TEXT_TY_RE_Err,&nbsp;&quot;&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line1651">1651</span><span class="td">&nbsp;&nbsp;RunTimeProblem(RTP_REGEXPSYNTAXERROR);</span></span>
<span class="tr"><span class="th" id="line1652">1652</span><span class="td">&nbsp;&nbsp;return&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1653">1653</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1654">1654</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1655">1655</span><span class="td">&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1656">1656</span><span class="td">&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line1657">1657</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;(compiled&nbsp;to&nbsp;&quot;,&nbsp;i,&nbsp;&quot;&nbsp;packets)^&quot;;</span></span>
<span class="tr"><span class="th" id="line1658">1658</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1659">1659</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line1660">1660</span><span class="td">&nbsp;if&nbsp;(ftxtype&nbsp;==&nbsp;REGEXP_BLOB)&nbsp;TEXT_TY_RE_EmptyMatchVars();</span></span>
<span class="tr"><span class="th" id="line1661">1661</span><span class="td">&nbsp;mpos&nbsp;=&nbsp;0;&nbsp;chm&nbsp;=&nbsp;0;&nbsp;cpos&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1662">1662</span><span class="td">&nbsp;while&nbsp;(TEXT_TY_RE_Parse(ftxt,&nbsp;txt,&nbsp;mpos,&nbsp;insens)&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1663">1663</span><span class="td">&nbsp;&nbsp;chm++;</span></span>
<span class="tr"><span class="th" id="line1664">1664</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1665">1665</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1666">1666</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;^***&nbsp;Match&nbsp;&quot;,&nbsp;chm,&nbsp;&quot;&nbsp;found&nbsp;(&quot;,&nbsp;RE_PACKET_space--&gt;RE_DATA1,&nbsp;&quot;,&quot;,</span></span>
<span class="tr"><span class="th" id="line1667">1667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;RE_PACKET_space--&gt;RE_DATA2,&nbsp;&quot;):&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line1668">1668</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(RE_PACKET_space--&gt;RE_DATA1&nbsp;==&nbsp;RE_PACKET_space--&gt;RE_DATA2)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1669">1669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&lt;empty&gt;&quot;;</span></span>
<span class="tr"><span class="th" id="line1670">1670</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1671">1671</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=RE_PACKET_space--&gt;RE_DATA1:i&lt;RE_PACKET_space--&gt;RE_DATA2:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1672">1672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(char)&nbsp;BlkValueRead(txt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line1673">1673</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1674">1674</span><span class="td">&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;***^&quot;;</span></span>
<span class="tr"><span class="th" id="line1675">1675</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1676">1676</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1677">1677</span><span class="td">&nbsp;&nbsp;if&nbsp;(rtxt&nbsp;==&nbsp;0)&nbsp;break;&nbsp;!&nbsp;Accept&nbsp;only&nbsp;one&nbsp;match,&nbsp;replace&nbsp;nothing</span></span>
<span class="tr"><span class="th" id="line1678">1678</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1679">1679</span><span class="td">&nbsp;&nbsp;if&nbsp;(rtxt&nbsp;~=&nbsp;0&nbsp;or&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1680">1680</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(chm&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1681">1681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ctxt&nbsp;=&nbsp;BlkValueCreate(TEXT_TY);</span></span>
<span class="tr"><span class="th" id="line1682">1682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Transmute(ctxt);</span></span>
<span class="tr"><span class="th" id="line1683">1683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;csize&nbsp;=&nbsp;BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1684">1684</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1685">1685</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1686">1686</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=cpos:i&lt;RE_PACKET_space--&gt;RE_DATA1:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1687">1687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line1688">1688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cl+1&nbsp;&gt;=&nbsp;csize)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1689">1689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueSetLBCapacity(ctxt,&nbsp;2*cl)&nbsp;==&nbsp;false)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1690">1690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize&nbsp;=&nbsp;BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1691">1691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1692">1692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt,&nbsp;cl++,&nbsp;ch);</span></span>
<span class="tr"><span class="th" id="line1693">1693</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1694">1694</span><span class="td">&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt,&nbsp;cl,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line1695">1695</span><span class="td">&nbsp;</span></span>
<span class="tr"><span class="th" id="line1696">1696</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_Concatenate(ctxt,&nbsp;rtxt,&nbsp;ftxtype,&nbsp;txt);</span></span>
<span class="tr"><span class="th" id="line1697">1697</span><span class="td">&nbsp;&nbsp;&nbsp;csize&nbsp;=&nbsp;BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1698">1698</span><span class="td">&nbsp;&nbsp;&nbsp;cl&nbsp;=&nbsp;TEXT_TY_CharacterLength(ctxt);&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1699">1699</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1700">1700</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1701">1701</span><span class="td">&nbsp;&nbsp;mpos&nbsp;=&nbsp;RE_PACKET_space--&gt;RE_DATA2;&nbsp;cpos&nbsp;=&nbsp;mpos;</span></span>
<span class="tr"><span class="th" id="line1702">1702</span><span class="td">&nbsp;&nbsp;if&nbsp;(RE_PACKET_space--&gt;RE_DATA1&nbsp;==&nbsp;RE_PACKET_space--&gt;RE_DATA2)</span></span>
<span class="tr"><span class="th" id="line1703">1703</span><span class="td">&nbsp;&nbsp;&nbsp;mpos++;</span></span>
<span class="tr"><span class="th" id="line1704">1704</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1705">1705</span><span class="td">&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1706">1706</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(chm&nbsp;==&nbsp;100)&nbsp;{&nbsp;!&nbsp;Purely&nbsp;to&nbsp;keep&nbsp;the&nbsp;output&nbsp;from&nbsp;being&nbsp;excessive</span></span>
<span class="tr"><span class="th" id="line1707">1707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;(Stopping&nbsp;after&nbsp;100&nbsp;matches.)^&quot;;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1708">1708</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1709">1709</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1710">1710</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1711">1711</span><span class="td">&nbsp;if&nbsp;(chm&nbsp;&gt;&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1712">1712</span><span class="td">&nbsp;&nbsp;if&nbsp;(rtxt&nbsp;~=&nbsp;0&nbsp;or&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1713">1713</span><span class="td">&nbsp;&nbsp;&nbsp;for&nbsp;(i=cpos:i&lt;ilen:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1714">1714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line1715">1715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cl+1&nbsp;&gt;=&nbsp;csize)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1716">1716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueSetLBCapacity(ctxt,&nbsp;2*cl)&nbsp;==&nbsp;false)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1717">1717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize&nbsp;=&nbsp;BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1718">1718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1719">1719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt,&nbsp;cl++,&nbsp;ch);</span></span>
<span class="tr"><span class="th" id="line1720">1720</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1721">1721</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1722">1722</span><span class="td">&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1723">1723</span><span class="td">&nbsp;&nbsp;if&nbsp;(ftxtype&nbsp;==&nbsp;REGEXP_BLOB)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1724">1724</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_RE_CreateMatchVars(txt);</span></span>
<span class="tr"><span class="th" id="line1725">1725</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(TEXT_TY_RE_Trace)</span></span>
<span class="tr"><span class="th" id="line1726">1726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugMatchVars(txt);</span></span>
<span class="tr"><span class="th" id="line1727">1727</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1728">1728</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1729">1729</span><span class="td">&nbsp;&nbsp;if&nbsp;(rtxt&nbsp;~=&nbsp;0&nbsp;or&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1730">1730</span><span class="td">&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt,&nbsp;cl,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line1731">1731</span><span class="td">&nbsp;&nbsp;&nbsp;BlkValueCopy(txt,&nbsp;ctxt);&nbsp;</span></span>
<span class="tr"><span class="th" id="line1732">1732</span><span class="td">&nbsp;&nbsp;&nbsp;BlkValueFree(ctxt);</span></span>
<span class="tr"><span class="th" id="line1733">1733</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1734">1734</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1735">1735</span><span class="td">&nbsp;return&nbsp;chm;</span></span>
<span class="tr"><span class="th" id="line1736">1736</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1737">1737</span><span class="td"></span></span>
</div><div class='text'>
<h2>Concatenation.</h2><p><p> See the corresponding routine in <a href="./Text.i6t.html">Text.i6t</a>: this is a variation which handles the special syntaxes used in search-and-replace.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1743">1743</span><span class="td">[&nbsp;TEXT_TY_RE_Concatenate&nbsp;txt_to&nbsp;txt_from&nbsp;blobtype&nbsp;txt_ref</span></span>
<span class="tr"><span class="th" id="line1744">1744</span><span class="td">&nbsp;pos&nbsp;len&nbsp;ch&nbsp;i&nbsp;tosize&nbsp;x&nbsp;y&nbsp;case;</span></span>
<span class="tr"><span class="th" id="line1745">1745</span><span class="td">&nbsp;if&nbsp;((txt_to==0)&nbsp;||&nbsp;(BlkValueWeakKind(txt_to)&nbsp;~=&nbsp;TEXT_TY))&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1746">1746</span><span class="td">&nbsp;if&nbsp;((txt_from==0)&nbsp;||&nbsp;(BlkValueWeakKind(txt_from)&nbsp;~=&nbsp;TEXT_TY))&nbsp;return&nbsp;txt_to;</span></span>
<span class="tr"><span class="th" id="line1747">1747</span><span class="td">&nbsp;pos&nbsp;=&nbsp;TEXT_TY_CharacterLength(txt_to);</span></span>
<span class="tr"><span class="th" id="line1748">1748</span><span class="td">&nbsp;tosize&nbsp;=&nbsp;BlkValueLBCapacity(txt_to);</span></span>
<span class="tr"><span class="th" id="line1749">1749</span><span class="td">&nbsp;len&nbsp;=&nbsp;TEXT_TY_CharacterLength(txt_from);</span></span>
<span class="tr"><span class="th" id="line1750">1750</span><span class="td">&nbsp;for&nbsp;(i=0:i&lt;len:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1751">1751</span><span class="td">&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt_from,&nbsp;i);</span></span>
<span class="tr"><span class="th" id="line1752">1752</span><span class="td">&nbsp;&nbsp;if&nbsp;((ch&nbsp;==&nbsp;&#39;\&#39;)&nbsp;&amp;&amp;&nbsp;(i&nbsp;&lt;&nbsp;len-1))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1753">1753</span><span class="td">&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt_from,&nbsp;++i);</span></span>
<span class="tr"><span class="th" id="line1754">1754</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;n&#39;)&nbsp;ch&nbsp;=&nbsp;10;</span></span>
<span class="tr"><span class="th" id="line1755">1755</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;t&#39;)&nbsp;ch&nbsp;=&nbsp;9;</span></span>
<span class="tr"><span class="th" id="line1756">1756</span><span class="td">&nbsp;&nbsp;&nbsp;case&nbsp;=&nbsp;-1;</span></span>
<span class="tr"><span class="th" id="line1757">1757</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;l&#39;)&nbsp;case&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line1758">1758</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;==&nbsp;&#39;u&#39;)&nbsp;case&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line1759">1759</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(case&nbsp;&gt;=&nbsp;0)&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt_from,&nbsp;++i);</span></span>
<span class="tr"><span class="th" id="line1760">1760</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;((ch&nbsp;&gt;=&nbsp;&#39;0&#39;)&nbsp;&amp;&amp;&nbsp;(ch&nbsp;&lt;=&nbsp;&#39;9&#39;))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1761">1761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;ch&nbsp;-&nbsp;&#39;0&#39;;</span></span>
<span class="tr"><span class="th" id="line1762">1762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ch&nbsp;&lt;&nbsp;RE_Subexpressions--&gt;10)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1763">1763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;(RE_Subexpressions--&gt;ch)--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1764">1764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;(RE_Subexpressions--&gt;ch)--&gt;RE_DATA2;</span></span>
<span class="tr"><span class="th" id="line1765">1765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(x&nbsp;&gt;=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1766">1766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(:x&lt;y:x++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1767">1767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch&nbsp;=&nbsp;BlkValueRead(txt_ref,&nbsp;x);</span></span>
<span class="tr"><span class="th" id="line1768">1768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pos+1&nbsp;&gt;=&nbsp;tosize)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1769">1769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueSetLBCapacity(txt_to,&nbsp;2*tosize)&nbsp;==&nbsp;false)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1770">1770</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tosize&nbsp;=&nbsp;BlkValueLBCapacity(txt_to);</span></span>
<span class="tr"><span class="th" id="line1771">1771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1772">1772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(case&nbsp;&gt;=&nbsp;0)</span></span>
<span class="tr"><span class="th" id="line1773">1773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(txt_to,&nbsp;pos++,&nbsp;CharToCase(ch,&nbsp;case));</span></span>
<span class="tr"><span class="th" id="line1774">1774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1775">1775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(txt_to,&nbsp;pos++,&nbsp;ch);</span></span>
<span class="tr"><span class="th" id="line1776">1776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1777">1777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1778">1778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1779">1779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line1780">1780</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1781">1781</span><span class="td">&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1782">1782</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1783">1783</span><span class="td">&nbsp;&nbsp;if&nbsp;(pos+1&nbsp;&gt;=&nbsp;tosize)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line1784">1784</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(BlkValueSetLBCapacity(txt_to,&nbsp;2*tosize)&nbsp;==&nbsp;false)&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1785">1785</span><span class="td">&nbsp;&nbsp;&nbsp;tosize&nbsp;=&nbsp;BlkValueLBCapacity(txt_to);</span></span>
<span class="tr"><span class="th" id="line1786">1786</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1787">1787</span><span class="td">&nbsp;&nbsp;BlkValueWrite(txt_to,&nbsp;pos++,&nbsp;ch);</span></span>
<span class="tr"><span class="th" id="line1788">1788</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1789">1789</span><span class="td">&nbsp;BlkValueWrite(txt_to,&nbsp;pos,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line1790">1790</span><span class="td">&nbsp;return&nbsp;txt_to;</span></span>
<span class="tr"><span class="th" id="line1791">1791</span><span class="td">];</span></span>
</div><footer><hr><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
