<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>RegExp</title>
  <style>
li { padding-bottom: .16rem; padding-top: .16rem; }
ul.unloaded { list-style-type: none; margin-top: 0; margin-bottom: 0; padding-left: 1rem; }
details summary { 
  cursor: pointer;
}
a { text-decoration: none;
padding-bottom: .5px;
border-bottom: 1px dotted black;
}
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; padding-top: .1rem; padding-bottom: .1rem; }
span.th { width:4rem; text-align: right; }
td { padding-bottom: .16rem; padding-top: .16rem; }
span.tr { display: table-row; }
.pre-lines { font-family: monospace; margin-left: 3rem; line-height: 1.5rem; }
h1 { margin: 0; }
.fixed { font-family: monospace; background-color: #e7e7d7; }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: .75rem 0 3rem 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 48rem; }
/* h3 { margin-top: 1.5rem; padding-top: 1.5rem; }*/
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: .5rem; margin-bottom: 1.5rem; margin-top: 1.75rem; padding-top: .25rem;}
footer { margin-top: 3rem; padding-top: 1rem; border-top: .5px solid black; margin-bottom: 0;}
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
.dstring { font-weight: bold;
  color: #095097; }
.sstring { font-weight: bold;
  color: #095097; }
.comment {  
  color: #156D15; } /* #207D20; */
td.content { padding-right: 2rem; vertical-align: top;}
header { border-bottom: 1px solid black; padding-top: .75rem; padding-bottom: .75rem; margin-bottom: 1rem;}
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Contents</a> &bull; <a href="./Introduction.i6t.html">Introduction</a> 
&bull; <a href="fn_index.html">Function Index</a> 
&bull; <a href="rules_index.html">Rules Index</a> 
</div></header>
<div id="front_matter">
<h2><a href="./RegExp.i6t.txt">RegExp.i6t</a></h2><details><summary>RegExp contents</summary><ul class="unloaded"><li><a href="./RegExp.i6t.html#regexp-debugging">Debugging</a></li><li><a href="./RegExp.i6t.html#regexp-algorithm">Algorithm</a></li><li><a href="./RegExp.i6t.html#regexp-class-codes">Class Codes</a></li><li><a href="./RegExp.i6t.html#regexp-packets">Packets</a></li><li><a href="./RegExp.i6t.html#regexp-nodes">Nodes</a></li><li><a href="./RegExp.i6t.html#regexp-match-variables">Match Variables</a></li><li><a href="./RegExp.i6t.html#regexp-markers">Markers</a></li><li><a href="./RegExp.i6t.html#regexp-debugging">Debugging</a></li><li><a href="./RegExp.i6t.html#regexp-compiling-tree-for-substring-search">Compiling Tree For Substring Search</a></li><li><a href="./RegExp.i6t.html#regexp-compiling-tree-for-regexp-search">Compiling Tree For Regexp Search</a></li><li><a href="./RegExp.i6t.html#regexp-parser">Parser</a></li><li><a href="./RegExp.i6t.html#regexp-parse-at-position">Parse At Position</a></li><li><a href="./RegExp.i6t.html#regexp-backtracking">Backtracking</a></li><li><a href="./RegExp.i6t.html#regexp-fail-subexpressions">Fail Subexpressions</a></li><li><a href="./RegExp.i6t.html#regexp-erasing-constraints">Erasing Constraints</a></li><li><a href="./RegExp.i6t.html#regexp-matching-literal-text">Matching Literal Text</a></li><li><a href="./RegExp.i6t.html#regexp-matching-character-range">Matching Character Range</a></li><li><a href="./RegExp.i6t.html#regexp-search-and-replace">Search And Replace</a></li><li><a href="./RegExp.i6t.html#regexp-concatenation">Concatenation</a></li></ul></details><h3 id="regexp-debugging">Debugging.</h3><p><p> Set this to true at your peril.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line12">12</span><span class="td">Global TEXT_TY_RE_Trace = false; <span class="comment">! Change to true for (a lot of) debugging data in use</span></span></span>
<span class="tr"><span class="th" id="line13">13</span><span class="td">[ TEXT_TY_RE_SetTrace F; TEXT_TY_RE_Trace = F; ];</span></span>
</div><div class='text'>
<h3 id="regexp-algorithm">Algorithm.</h3><p><p> Once Inform 7 supported (indexed) text, regular-expression matching became an obvious goal: regexp-based features offer more or less the gold standard in text search and replace facilities, and I7 is so concerned with text that we shouldn&#39;t make do with less. But the best and most portable implementation of regular expression matching, PCRE by Philip Hazel, is about a hundred times larger than the code in this section, and also had unacceptable memory needs: there was no practicable way to make it small enough to do useful work on the Z-machine. Nor could an I6 regexp-matcher compile just-in-time code, or translate the expression into a suitable deterministic finite state machine. One day, though, I read one of the papers which Brian Kernighan writes every few years to the effect that regular-expression matching is much easier than you think. Kernighan is right: writing a regexp matcher is indeed easier than you think (one day&#39;s worth of cheerful hacking), but debugging one until it passes the trickiest hundred of Perl&#39;s 645 test cases is another matter (and it took a whole week more). Still, the result seems to be robust. The main compromise made is that backtracking is not always comprehensive with regexps like <span class="fixed">^(a\1?){4}$</span>, because we do not allocate individual storage to backtrack individually through all possibilities of each of the four uses of the bracketed subexpression &ndash; which means we miss some cases, since the subexpression contains a reference to itself, so that its content can vary in the four uses. PCRE&#39;s approach here is to expand the expression as if it were a sequence of four bracketed expressions, thus removing the awkward quantifier <span class="fixed">{4}</span>, but that costs memory: indeed this is why PCRE cannot solve all of Perl&#39;s test cases without its default memory allocation being raised. In other respects, the algorithm below appears to be accurate if not very fast.<p></p><p><h3 id="regexp-class-codes">Class Codes.</h3><p><p> While in principle we could keep the match expression in textual form, in practice the syntax of regular expressions is complex enough that this would be tricky and rather slow: we would be parsing the same notations over and over again. So we begin by compiling it to a simple tree structure. The tree is made up of nodes, and each node has a &quot;class code&quot;: these are identified by the <span class="fixed">*_RE_CC</span> constants below. Note that the class codes below are all negative: this is so that they are distinct from all valid ZSCII or Unicode characters. (ZSCII is used only on the Z-machine, which has a 16-bit word but an 8-bit character set, so that all character values are positive; similarly, Unicode is (for our purposes) a 16-bit character set on a 32-bit virtual machine.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line58">58</span><span class="td"><span class="comment">! Character classes</span></span></span>
<span class="tr"><span class="th" id="line59">59</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line60">60</span><span class="td">Constant NEWLINE_RE_CC = -1;</span></span>
<span class="tr"><span class="th" id="line61">61</span><span class="td">Constant TAB_RE_CC = -2;</span></span>
<span class="tr"><span class="th" id="line62">62</span><span class="td">Constant DIGIT_RE_CC = -3;</span></span>
<span class="tr"><span class="th" id="line63">63</span><span class="td">Constant NONDIGIT_RE_CC = -4;</span></span>
<span class="tr"><span class="th" id="line64">64</span><span class="td">Constant WHITESPACE_RE_CC = -5;</span></span>
<span class="tr"><span class="th" id="line65">65</span><span class="td">Constant NONWHITESPACE_RE_CC = -6;</span></span>
<span class="tr"><span class="th" id="line66">66</span><span class="td">Constant PUNCTUATION_RE_CC = -7;</span></span>
<span class="tr"><span class="th" id="line67">67</span><span class="td">Constant NONPUNCTUATION_RE_CC = -8;</span></span>
<span class="tr"><span class="th" id="line68">68</span><span class="td">Constant WORD_RE_CC = -9;</span></span>
<span class="tr"><span class="th" id="line69">69</span><span class="td">Constant NONWORD_RE_CC = -10;</span></span>
<span class="tr"><span class="th" id="line70">70</span><span class="td">Constant ANYTHING_RE_CC = -11;</span></span>
<span class="tr"><span class="th" id="line71">71</span><span class="td">Constant NOTHING_RE_CC = -12;</span></span>
<span class="tr"><span class="th" id="line72">72</span><span class="td">Constant RANGE_RE_CC = -13;</span></span>
<span class="tr"><span class="th" id="line73">73</span><span class="td">Constant LCASE_RE_CC = -14;</span></span>
<span class="tr"><span class="th" id="line74">74</span><span class="td">Constant NONLCASE_RE_CC = -15;</span></span>
<span class="tr"><span class="th" id="line75">75</span><span class="td">Constant UCASE_RE_CC = -16;</span></span>
<span class="tr"><span class="th" id="line76">76</span><span class="td">Constant NONUCASE_RE_CC = -17;</span></span>
<span class="tr"><span class="th" id="line77">77</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line78">78</span><span class="td"><span class="comment">! Control structures</span></span></span>
<span class="tr"><span class="th" id="line79">79</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line80">80</span><span class="td">Constant SUBEXP_RE_CC = -20;</span></span>
<span class="tr"><span class="th" id="line81">81</span><span class="td">Constant DISJUNCTION_RE_CC = -21;</span></span>
<span class="tr"><span class="th" id="line82">82</span><span class="td">Constant CHOICE_RE_CC = -22;</span></span>
<span class="tr"><span class="th" id="line83">83</span><span class="td">Constant QUANTIFIER_RE_CC = -23;</span></span>
<span class="tr"><span class="th" id="line84">84</span><span class="td">Constant IF_RE_CC = -24;</span></span>
<span class="tr"><span class="th" id="line85">85</span><span class="td">Constant CONDITION_RE_CC = -25;</span></span>
<span class="tr"><span class="th" id="line86">86</span><span class="td">Constant THEN_RE_CC = -26;</span></span>
<span class="tr"><span class="th" id="line87">87</span><span class="td">Constant ELSE_RE_CC = -27;</span></span>
<span class="tr"><span class="th" id="line88">88</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line89">89</span><span class="td"><span class="comment">! Substring matchers</span></span></span>
<span class="tr"><span class="th" id="line90">90</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line91">91</span><span class="td">Constant VARIABLE_RE_CC = -30;</span></span>
<span class="tr"><span class="th" id="line92">92</span><span class="td">Constant LITERAL_RE_CC = -31;</span></span>
<span class="tr"><span class="th" id="line93">93</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line94">94</span><span class="td"><span class="comment">! Positional matchers</span></span></span>
<span class="tr"><span class="th" id="line95">95</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line96">96</span><span class="td">Constant START_RE_CC = -40;</span></span>
<span class="tr"><span class="th" id="line97">97</span><span class="td">Constant END_RE_CC = -41;</span></span>
<span class="tr"><span class="th" id="line98">98</span><span class="td">Constant BOUNDARY_RE_CC = -42;</span></span>
<span class="tr"><span class="th" id="line99">99</span><span class="td">Constant NONBOUNDARY_RE_CC = -43;</span></span>
<span class="tr"><span class="th" id="line100">100</span><span class="td">Constant ALWAYS_RE_CC = -44;</span></span>
<span class="tr"><span class="th" id="line101">101</span><span class="td">Constant NEVER_RE_CC = -45;</span></span>
<span class="tr"><span class="th" id="line102">102</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line103">103</span><span class="td"><span class="comment">! Mode switches</span></span></span>
<span class="tr"><span class="th" id="line104">104</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line105">105</span><span class="td">Constant SENSITIVITY_RE_CC = -50;</span></span>
</div><div class='text'>
<h3 id="regexp-packets">Packets.</h3><p><p> The nodes of the compiled expression tree are stored in &quot;packets&quot;, which are segments of a fixed array. A regexp complicated enough that it cannot be stored in <span class="fixed"><a href="./RegExp.i6t.html#line122">RE_MAX_PACKETS</a></span> packets will be rejected with an error: it looks like a rather low limit, but in fact suffices to handle all of Perl&#39;s test cases, some of which are works of diabolism.<p></p><p> A packet is then a record containing 14 fields, with offsets defined by the constants defined below. These fields combine the compilation of the corresponding fragment of the regexp with both the tree structure holding these packets together and also the current state of the temporary variables recording how far we have progressed in trying all of the possible ways to match the packet.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line122">122</span><span class="td">Constant RE_MAX_PACKETS = 32;</span></span>
<span class="tr"><span class="th" id="line123">123</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line124">124</span><span class="td">Constant RE_PACKET_SIZE = 14; <span class="comment">! Words of memory used per packet</span></span></span>
<span class="tr"><span class="th" id="line125">125</span><span class="td">Constant RE_PACKET_SIZE_IN_BYTES = WORDSIZE*RE_PACKET_SIZE; <span class="comment">! Bytes used per packet</span></span></span>
<span class="tr"><span class="th" id="line126">126</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line127">127</span><span class="td">Array RE_PACKET_space --&gt; RE_MAX_PACKETS*RE_PACKET_SIZE;</span></span>
<span class="tr"><span class="th" id="line128">128</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line129">129</span><span class="td">Constant RE_CCLASS = 0;      <span class="comment">! One of the class codes defined above</span></span></span>
<span class="tr"><span class="th" id="line130">130</span><span class="td">Constant RE_PAR1 = 1;        <span class="comment">! Three parameters whose meaning depends on class code</span></span></span>
<span class="tr"><span class="th" id="line131">131</span><span class="td">Constant RE_PAR2 = 2;</span></span>
<span class="tr"><span class="th" id="line132">132</span><span class="td">Constant RE_PAR3 = 3;</span></span>
<span class="tr"><span class="th" id="line133">133</span><span class="td">Constant RE_NEXT = 4;        <span class="comment">! Younger sibling in the compiled tree</span></span></span>
<span class="tr"><span class="th" id="line134">134</span><span class="td">Constant RE_PREVIOUS = 5;    <span class="comment">! Elder sibling</span></span></span>
<span class="tr"><span class="th" id="line135">135</span><span class="td">Constant RE_DOWN = 6;        <span class="comment">! Child</span></span></span>
<span class="tr"><span class="th" id="line136">136</span><span class="td">Constant RE_UP = 7;          <span class="comment">! Parent</span></span></span>
<span class="tr"><span class="th" id="line137">137</span><span class="td">Constant RE_DATA1 = 8;       <span class="comment">! Backtracking data</span></span></span>
<span class="tr"><span class="th" id="line138">138</span><span class="td">Constant RE_DATA2 = 9;</span></span>
<span class="tr"><span class="th" id="line139">139</span><span class="td">Constant RE_CONSTRAINT = 10;</span></span>
<span class="tr"><span class="th" id="line140">140</span><span class="td">Constant RE_CACHE1 = 11;</span></span>
<span class="tr"><span class="th" id="line141">141</span><span class="td">Constant RE_CACHE2 = 12;</span></span>
<span class="tr"><span class="th" id="line142">142</span><span class="td">Constant RE_MODES = 13;</span></span>
</div><div class='text'>
<h3 id="regexp-nodes">Nodes.</h3><p><p> The routine to create a node, something which happens only during the compilation phase, and also the routine which returns the address of a given node. Nodes are numbered from 0 up to <em>M-1</em>, where <em>M</em> is the constant <span class="fixed"><a href="./RegExp.i6t.html#line122">RE_MAX_PACKETS</a></span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line151">151</span><span class="td">[ TEXT_TY_RE_Node n cc par1 par2 par3  offset;</span></span>
<span class="tr"><span class="th" id="line152">152</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((n&lt;0) || (n &gt;= RE_MAX_PACKETS)) rfalse;</span></span>
<span class="tr"><span class="th" id="line153">153</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset = RE_PACKET_space + n*RE_PACKET_SIZE_IN_BYTES;</span></span>
<span class="tr"><span class="th" id="line154">154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_CCLASS = cc;</span></span>
<span class="tr"><span class="th" id="line155">155</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_PAR1 = par1;</span></span>
<span class="tr"><span class="th" id="line156">156</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_PAR2 = par2;</span></span>
<span class="tr"><span class="th" id="line157">157</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_PAR3 = par3;</span></span>
<span class="tr"><span class="th" id="line158">158</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_NEXT = NULL;</span></span>
<span class="tr"><span class="th" id="line159">159</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_PREVIOUS = NULL;</span></span>
<span class="tr"><span class="th" id="line160">160</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_DOWN = NULL;</span></span>
<span class="tr"><span class="th" id="line161">161</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_UP = NULL;</span></span>
<span class="tr"><span class="th" id="line162">162</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_DATA1 = -1; <span class="comment">! Match start</span></span></span>
<span class="tr"><span class="th" id="line163">163</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_DATA2 = -1; <span class="comment">! Match end</span></span></span>
<span class="tr"><span class="th" id="line164">164</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset--&gt;RE_CONSTRAINT = -1; <span class="comment">! Rewind edge</span></span></span>
<span class="tr"><span class="th" id="line165">165</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return offset;</span></span>
<span class="tr"><span class="th" id="line166">166</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line167">167</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td">[ TEXT_TY_RE_NodeAddress n;</span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((n&lt;0) || (n &gt;= RE_MAX_PACKETS)) return -1;</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return RE_PACKET_space + n*RE_PACKET_SIZE_IN_BYTES;</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-match-variables">Match Variables.</h3><p><p> A bracketed subexpression can be used as a variable: we support <span class="fixed">\1</span>, ..., <span class="fixed">\9</span> to mean &quot;the value of subexpression 1 to 9&quot;, and <span class="fixed">\0</span> to mean &quot;the whole text matched&quot;, as if the entire regexp were bracketed. (PCRE and Perl also allow <span class="fixed">\10</span>, <span class="fixed">\11</span>, ..., but we don&#39;t, because it complicates parsing and memory is too short.)<p></p><p> <span class="fixed">RE_Subexpressions--&gt;10</span> stores the number of subexpressions in use, not counting <span class="fixed">\0</span>. During the compiling stage, <span class="fixed">RE_Subexpressions--&gt;N</span> is set to point to the node representating <span class="fixed">\N</span>, where <span class="fixed">N</span> varies from 1 to 9. When matching is complete, and assuming we care about the contents of these variables &ndash; which we might not, and if not we certainly don&#39;t want to waste time and memory &ndash; we call <span class="fixed"><a href="./RegExp.i6t.html#line208">TEXT_TY_RE_CreateMatchVars</a></span> to allocate text variables and fill them in as appropriate, memory permitting.<p></p><p> <span class="fixed"><a href="./RegExp.i6t.html#line230">TEXT_TY_RE_EmptyMatchVars</a></span> empties any such variables which may survive from a previous match, setting them to the empty text.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line192">192</span><span class="td">Array RE_Subexpressions --&gt; 11; <span class="comment">! Address of node for this subexpression</span></span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">Array Allocated_Match_Vars --&gt; 10; <span class="comment">! Indexed text to hold values of the variables</span></span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">[ TEXT_TY_RE_DebugMatchVars txt</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset n i;</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print RE_Subexpressions--&gt;10, <span class="dstring">&quot; collecting subexps^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (n=0:(n&lt;RE_Subexpressions--&gt;10) &amp;&amp; (n&lt;10): n++) {</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset = RE_Subexpressions--&gt;n;</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Subexp &quot;</span>, offset--&gt;RE_PAR1,</span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="dstring">&quot; = [&quot;</span>, offset--&gt;RE_DATA1, <span class="dstring">&quot;,&quot;</span>, offset--&gt;RE_DATA2, <span class="dstring">&quot;] = &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=offset--&gt;RE_DATA1:i&lt;offset--&gt;RE_DATA2:i++)</span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print (char) BlkValueRead(txt, i);</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">[ TEXT_TY_RE_CreateMatchVars txt</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset n i ch ctxt cl csize;</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (n=0:(n&lt;RE_Subexpressions--&gt;10) &amp;&amp; (n&lt;10): n++) {</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset = RE_Subexpressions--&gt;n;</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (Allocated_Match_Vars--&gt;n) BlkValueFree(Allocated_Match_Vars--&gt;n);</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Allocated_Match_Vars--&gt;n = BlkValueCreate(TEXT_TY);</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Transmute(Allocated_Match_Vars--&gt;n);</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctxt = Allocated_Match_Vars--&gt;n;</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize = BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cl = 0;</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=offset--&gt;RE_DATA1:i&lt;offset--&gt;RE_DATA2:i++) {</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(txt, i);</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cl+1 &gt;= csize) {</span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueSetLBCapacity(ctxt, 2*cl) == false) break;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize = BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt, cl++, ch);</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt, cl, 0);</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">[ TEXT_TY_RE_EmptyMatchVars txt</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;n;</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (n=0:(n&lt;RE_Subexpressions--&gt;10) &amp;&amp; (n&lt;10): n++)</span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (Allocated_Match_Vars--&gt;n ~= 0)</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(Allocated_Match_Vars--&gt;n, 0, 0);</span></span>
<span class="tr"><span class="th" id="line235">235</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line236">236</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line237">237</span><span class="td">[ TEXT_TY_RE_GetMatchVar vn</span></span>
<span class="tr"><span class="th" id="line238">238</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line239">239</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((vn&lt;0) || (vn&gt;=10) || (vn &gt;= RE_Subexpressions--&gt;10)) return EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line240">240</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset = RE_Subexpressions--&gt;vn;</span></span>
<span class="tr"><span class="th" id="line241">241</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (offset == 0) return EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line242">242</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (offset--&gt;RE_DATA1 &lt; 0) return EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (Allocated_Match_Vars--&gt;vn == 0) {</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;*** &quot;</span>, vn, <span class="dstring">&quot; unallocated ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line245">245</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return EMPTY_TEXT_VALUE;</span></span>
<span class="tr"><span class="th" id="line246">246</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return Allocated_Match_Vars--&gt;vn;</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-markers">Markers.</h3><p><p> At each node, the <span class="fixed">--&gt;RE_DATA1</span> and <span class="fixed">--&gt;RE_DATA2</span> fields represent the character positions of the start and end of the text matched by the node and its subtree (if any). These are called markers.<p></p><p> Thus <span class="fixed"><a href="./RegExp.i6t.html#line259">TEXT_TY_MV_End(N, 0)</a></span> returns the start of <span class="fixed">\N</span> and <span class="fixed"><a href="./RegExp.i6t.html#line259">TEXT_TY_MV_End(N, 1)</a></span> the end of <span class="fixed">\N</span>, according to the current match of subexpression <span class="fixed">N</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line259">259</span><span class="td">[ TEXT_TY_MV_End n end</span></span>
<span class="tr"><span class="th" id="line260">260</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset;</span></span>
<span class="tr"><span class="th" id="line261">261</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;offset = RE_Subexpressions--&gt;n;</span></span>
<span class="tr"><span class="th" id="line262">262</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (end==0) return offset--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line263">263</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return offset--&gt;RE_DATA2;</span></span>
<span class="tr"><span class="th" id="line264">264</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line265">265</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line266">266</span><span class="td">[ TEXT_TY_RE_Clear_Markers token;</span></span>
<span class="tr"><span class="th" id="line267">267</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (: token ~= NULL: token = token--&gt;RE_NEXT) {</span></span>
<span class="tr"><span class="th" id="line268">268</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DOWN ~= NULL) TEXT_TY_RE_Clear_Markers(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line269">269</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = -1;</span></span>
<span class="tr"><span class="th" id="line270">270</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = -1;</span></span>
<span class="tr"><span class="th" id="line271">271</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_CONSTRAINT = -1;</span></span>
<span class="tr"><span class="th" id="line272">272</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-debugging">Debugging.</h3><p><p> Code in this paragraph simply prints a convenient screen representation of the compiled regexp, together with the current values of its markers. It is invaluable for debugging purposes and, touch wood, may not be needed again, but it is relatively compact and we keep it just in case.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line282">282</span><span class="td">[ TEXT_TY_RE_DebugTree ftxt detail;</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Pattern: &quot;</span>, (TEXT_TY_Say) ftxt, <span class="dstring">&quot;^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugSubtree(ftxt, 1, RE_PACKET_space, detail);</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">[ TEXT_TY_RE_DebugSubtree ftxt depth offset detail</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cup;</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (offset ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cup = offset--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (offset--&gt;RE_PREVIOUS ~= NULL) print <span class="dstring">&quot;*** broken initial previous ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line293">293</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (offset ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line294">294</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (offset--&gt;RE_UP ~= cup) print <span class="dstring">&quot;*** broken up matching ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line295">295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spaces(depth*2);</span></span>
<span class="tr"><span class="th" id="line296">296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(offset, ftxt, detail);</span></span>
<span class="tr"><span class="th" id="line297">297</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (offset--&gt;RE_DOWN ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line298">298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((offset--&gt;RE_DOWN)--&gt;RE_UP ~= offset)</span></span>
<span class="tr"><span class="th" id="line299">299</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;*** broken down/up ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line300">300</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugSubtree(ftxt, depth+1, offset--&gt;RE_DOWN, detail);</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (offset--&gt;RE_NEXT ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((offset--&gt;RE_NEXT)--&gt;RE_PREVIOUS ~= offset)</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;*** broken next/previous ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset = offset--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">[ TEXT_TY_RE_DebugNode offset ftxt detail</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i par1 par2 par3;</span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (offset == NULL) <span class="dstring">&quot;[NULL]&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line313">313</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;[&quot;</span>, (offset-RE_PACKET_space)/(RE_PACKET_SIZE_IN_BYTES), <span class="dstring">&quot;] &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line314">314</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! for (i=0:i&lt;RE_PACKET_SIZE:i++) print offset--&gt;i, &quot; &quot;;</span></span></span>
<span class="tr"><span class="th" id="line315">315</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;par1 = offset--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line316">316</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;par2 = offset--&gt;RE_PAR2;</span></span>
<span class="tr"><span class="th" id="line317">317</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;par3 = offset--&gt;RE_PAR3;</span></span>
<span class="tr"><span class="th" id="line318">318</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;switch (offset--&gt;RE_CCLASS) {</span></span>
<span class="tr"><span class="th" id="line319">319</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGIT_RE_CC: print <span class="dstring">&quot;DIGIT&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line320">320</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONDIGIT_RE_CC: print <span class="dstring">&quot;NONDIGIT&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line321">321</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCASE_RE_CC: print <span class="dstring">&quot;UCASE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line322">322</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONUCASE_RE_CC: print <span class="dstring">&quot;NONUCASE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line323">323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LCASE_RE_CC: print <span class="dstring">&quot;LCASE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONLCASE_RE_CC: print <span class="dstring">&quot;NONLCASE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHITESPACE_RE_CC: print <span class="dstring">&quot;WHITESPACE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONWHITESPACE_RE_CC: print <span class="dstring">&quot;NONWHITESPACE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUNCTUATION_RE_CC: print <span class="dstring">&quot;PUNCTUATION&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONPUNCTUATION_RE_CC: print <span class="dstring">&quot;NONPUNCTUATION&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WORD_RE_CC: print <span class="dstring">&quot;WORD&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONWORD_RE_CC: print <span class="dstring">&quot;NONWORD&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALWAYS_RE_CC: print <span class="dstring">&quot;ALWAYS&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEVER_RE_CC: print <span class="dstring">&quot;NEVER&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_RE_CC: print <span class="dstring">&quot;START&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END_RE_CC: print <span class="dstring">&quot;END&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOUNDARY_RE_CC: print <span class="dstring">&quot;BOUNDARY&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONBOUNDARY_RE_CC: print <span class="dstring">&quot;NONBOUNDARY&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANYTHING_RE_CC: print <span class="dstring">&quot;ANYTHING&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTHING_RE_CC: print <span class="dstring">&quot;NOTHING&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RANGE_RE_CC: print <span class="dstring">&quot;RANGE&quot;</span>; if (par3 == true) print <span class="dstring">&quot; (negated)&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot; &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=par1:i&lt;par2:i++) print (char) BlkValueRead(ftxt, i);</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARIABLE_RE_CC: print <span class="dstring">&quot;VARIABLE &quot;</span>, par1;</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBEXP_RE_CC:</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par1 == 0) print <span class="dstring">&quot;EXP&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else print <span class="dstring">&quot;SUBEXP &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par1 &gt;= 0) print <span class="dstring">&quot;= V&quot;</span>, par1;</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == 1) {</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par3 == 0) print <span class="dstring">&quot; (?=...) lookahead&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else print <span class="dstring">&quot; (?&lt;=...) lookbehind of width &quot;</span>, par3;</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line351">351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == 2) {</span></span>
<span class="tr"><span class="th" id="line352">352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par3 == 0) print <span class="dstring">&quot; (?...) negated lookahead&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line353">353</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else print <span class="dstring">&quot; (?&lt;...) negated lookbehind of width &quot;</span>, par3;</span></span>
<span class="tr"><span class="th" id="line354">354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line355">355</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == 3) print <span class="dstring">&quot; uncollecting&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line356">356</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == 0 or 3) {</span></span>
<span class="tr"><span class="th" id="line357">357</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par3 == 1) print <span class="dstring">&quot; forcing case sensitivity&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line358">358</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par3 == 2) print <span class="dstring">&quot; forcing case insensitivity&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == 4) print <span class="dstring">&quot; (?&gt;...) possessive&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWLINE_RE_CC: print <span class="dstring">&quot;NEWLINE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAB_RE_CC: print <span class="dstring">&quot;TAB&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC: print <span class="dstring">&quot;QUANTIFIER min=&quot;</span>, par1, <span class="dstring">&quot; max=&quot;</span>, par2;</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par3) print <span class="dstring">&quot; (lazy)&quot;</span>; else print <span class="dstring">&quot; (greedy)&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line365">365</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LITERAL_RE_CC: print <span class="dstring">&quot;LITERAL&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot; &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=par1:i&lt;par2:i++) print (char) BlkValueRead(ftxt, i);</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC: print <span class="dstring">&quot;DISJUNCTION of &quot;</span>, par1, <span class="dstring">&quot; choices&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHOICE_RE_CC: print <span class="dstring">&quot;CHOICE no &quot;</span>, par1;</span></span>
<span class="tr"><span class="th" id="line370">370</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SENSITIVITY_RE_CC: print <span class="dstring">&quot;SENSITIVITY&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line371">371</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par1) print <span class="dstring">&quot; off&quot;</span>; else print <span class="dstring">&quot; on&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line372">372</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF_RE_CC: print <span class="dstring">&quot;IF&quot;</span>; if (par1 &gt;= 1) print <span class="dstring">&quot; = V&quot;</span>, par1;</span></span>
<span class="tr"><span class="th" id="line373">373</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDITION_RE_CC: print <span class="dstring">&quot;CONDITION&quot;</span>; if (par1 &gt;= 1) print <span class="dstring">&quot; = V&quot;</span>, par1;</span></span>
<span class="tr"><span class="th" id="line374">374</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THEN_RE_CC: print <span class="dstring">&quot;THEN&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line375">375</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ELSE_RE_CC: print <span class="dstring">&quot;ELSE&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (detail)</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;: &quot;</span>, offset--&gt;RE_DATA1, <span class="dstring">&quot;, &quot;</span>, offset--&gt;RE_DATA2, <span class="dstring">&quot;, &quot;</span>, offset--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-compiling-tree-for-substring-search">Compiling Tree For Substring Search.</h3><p><p> When we search for a literal substring, say looking for &quot;per&quot; in &quot;Supernumerary&quot;, we will in fact use the same apparatus as when searching for a regular expression: we compile a very simple node tree in which <span class="fixed">\0</span> as the root contains just one child node, a <span class="fixed"><a href="./RegExp.i6t.html#line92">LITERAL_RE_CC</a></span> matching exactly the text &quot;per&quot;. We return 2 since that&#39;s the number of nodes in the tree.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line390">390</span><span class="td">[ TEXT_TY_CHR_CompileTree ftxt exactly</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;root literal fto no_packets token attach_to;</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;fto = TEXT_TY_CharacterLength(ftxt);</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;root = TEXT_TY_RE_Node(0, SUBEXP_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;literal = TEXT_TY_RE_Node(1, LITERAL_RE_CC, 0, fto, 0);</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;root--&gt;RE_DOWN = literal;</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;literal--&gt;RE_UP = root;</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (exactly) {</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_packets = 2;</span></span>
<span class="tr"><span class="th" id="line403">403</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets+3 &gt; RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line404">404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exactly = RE_PACKET_space--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line405">405</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = TEXT_TY_RE_Node(no_packets++, START_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line406">406</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RE_PACKET_space--&gt;RE_DOWN = token; token--&gt;RE_UP = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line407">407</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to = TEXT_TY_RE_Node(no_packets++, SUBEXP_RE_CC, -1, 3, 0);</span></span>
<span class="tr"><span class="th" id="line408">408</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_NEXT = attach_to; attach_to--&gt;RE_PREVIOUS = token;</span></span>
<span class="tr"><span class="th" id="line409">409</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_UP = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_NEXT = TEXT_TY_RE_Node(no_packets++, END_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_PREVIOUS = attach_to;</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_UP = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_DOWN = exactly;</span></span>
<span class="tr"><span class="th" id="line414">414</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (exactly ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line415">415</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exactly--&gt;RE_UP = attach_to; exactly = exactly--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line416">416</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line417">417</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line418">418</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line419">419</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;no_packets = TEXT_TY_RE_ExpandChoices(RE_PACKET_space, no_packets);</span></span>
<span class="tr"><span class="th" id="line420">420</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-compiling-tree-for-regexp-search">Compiling Tree For Regexp Search.</h3><p><p> But in general we need to compile a regular expression string into a tree of the kind described above, and here is the routine which does that, returning the number of nodes used to build the tree. The syntax it accepts is very fully documented in <strong> Writing with Inform</strong>, so no details are given here.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line430">430</span><span class="td">Array Subexp_Posns --&gt; 20;</span></span>
<span class="tr"><span class="th" id="line431">431</span><span class="td">[ TEXT_TY_RE_CompileTree ftxt exactly</span></span>
<span class="tr"><span class="th" id="line432">432</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;no_packets ffrom fto cc par1 par2 par3</span></span>
<span class="tr"><span class="th" id="line433">433</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;quantifiable token attach_to no_subs blevel bits;</span></span>
<span class="tr"><span class="th" id="line434">434</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line435">435</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;fto = TEXT_TY_CharacterLength(ftxt);</span></span>
<span class="tr"><span class="th" id="line436">436</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (fto == 0) {</span></span>
<span class="tr"><span class="th" id="line437">437</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_Node(no_packets++, NEVER_RE_CC, 0, 0, 0); <span class="comment">! Empty regexp never matches</span></span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1;</span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;attach_to = TEXT_TY_RE_Node(no_packets++, SUBEXP_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;RE_Subexpressions--&gt;0 = attach_to; RE_Subexpressions--&gt;10 = 1; no_subs = 1;</span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line444">444</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false; blevel = 0;</span></span>
<span class="tr"><span class="th" id="line445">445</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line446">446</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (ffrom = 0: ffrom &lt; fto: ) {</span></span>
<span class="tr"><span class="th" id="line447">447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = BlkValueRead(ftxt, ffrom++); par1 = 0; par2 = 0; par3 = 0;</span></span>
<span class="tr"><span class="th" id="line448">448</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc == <span class="sstring">&#39;\&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ffrom == fto) return <span class="dstring">&quot;Search pattern not terminated&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = BlkValueRead(ftxt, ffrom++);</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (cc) {</span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;b&#39;</span>: cc = BOUNDARY_RE_CC;</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;B&#39;</span>: cc = NONBOUNDARY_RE_CC;</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;d&#39;</span>: cc = DIGIT_RE_CC;</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;D&#39;</span>: cc = NONDIGIT_RE_CC;</span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;l&#39;</span>: cc = LCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line457">457</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;L&#39;</span>: cc = NONLCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line458">458</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;n&#39;</span>: cc = NEWLINE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line459">459</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;p&#39;</span>: cc = PUNCTUATION_RE_CC;</span></span>
<span class="tr"><span class="th" id="line460">460</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;P&#39;</span>: cc = NONPUNCTUATION_RE_CC;</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;s&#39;</span>: cc = WHITESPACE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;S&#39;</span>: cc = NONWHITESPACE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;t&#39;</span>: cc = TAB_RE_CC;</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;u&#39;</span>: cc = UCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;U&#39;</span>: cc = NONUCASE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;w&#39;</span>: cc = WORD_RE_CC;</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;W&#39;</span>: cc = NONWORD_RE_CC;</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((cc &gt;= <span class="sstring">&#39;1&#39;</span>) &amp;&amp; (cc &lt;= <span class="sstring">&#39;9&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = cc-<span class="sstring">&#39;0&#39;</span>;</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = VARIABLE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (((cc &gt;= <span class="sstring">&#39;a&#39;</span>) &amp;&amp; (cc &lt;= <span class="sstring">&#39;z&#39;</span>)) ||</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((cc &gt;= <span class="sstring">&#39;A&#39;</span>) &amp;&amp; (cc &lt;= <span class="sstring">&#39;Z&#39;</span>))) return <span class="dstring">&quot;unknown escape&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = LITERAL_RE_CC;</span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = ffrom-1; par2 = ffrom;</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line478">478</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line479">479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = true;</span></span>
<span class="tr"><span class="th" id="line480">480</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line481">481</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (cc) {</span></span>
<span class="tr"><span class="th" id="line482">482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;(&#39;</span>: par2 = 0;</span></span>
<span class="tr"><span class="th" id="line483">483</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!if (BlkValueRead(ftxt, ffrom) == &#39;)&#39;) return &quot;empty subexpression&quot;;</span></span></span>
<span class="tr"><span class="th" id="line484">484</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;?&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line485">485</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ffrom++;</span></span>
<span class="tr"><span class="th" id="line486">486</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits = true;</span></span>
<span class="tr"><span class="th" id="line487">487</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;-&#39;</span>) { ffrom++; bits = false; }</span></span>
<span class="tr"><span class="th" id="line488">488</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;&lt;&#39;</span>) { ffrom++; bits = false; }</span></span>
<span class="tr"><span class="th" id="line489">489</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (cc = BlkValueRead(ftxt, ffrom++)) {</span></span>
<span class="tr"><span class="th" id="line490">490</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;#&#39;</span>: while (BlkValueRead(ftxt, ffrom++) ~= 0 or <span class="sstring">&#39;)&#39;</span>) ;</span></span>
<span class="tr"><span class="th" id="line491">491</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom-1) == 0)</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="dstring">&quot;comment never ends&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line494">494</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;(&#39;</span>: cc = BlkValueRead(ftxt, ffrom);</span></span>
<span class="tr"><span class="th" id="line495">495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((cc == <span class="sstring">&#39;1&#39;</span> or <span class="sstring">&#39;2&#39;</span> or <span class="sstring">&#39;3&#39;</span> or <span class="sstring">&#39;4&#39;</span> or</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;5&#39;</span> or <span class="sstring">&#39;6&#39;</span> or <span class="sstring">&#39;7&#39;</span> or <span class="sstring">&#39;8&#39;</span> or <span class="sstring">&#39;9&#39;</span>) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line497">497</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt, ffrom+1) ==<span class="sstring">&#39;)&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line498">498</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ffrom = ffrom + 2;</span></span>
<span class="tr"><span class="th" id="line499">499</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = cc - <span class="sstring">&#39;0&#39;</span>;</span></span>
<span class="tr"><span class="th" id="line500">500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else ffrom--;</span></span>
<span class="tr"><span class="th" id="line501">501</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = IF_RE_CC; <span class="comment">! (?(...)...) conditional</span></span></span>
<span class="tr"><span class="th" id="line502">502</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line503">503</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (blevel == 20) return <span class="dstring">&quot;subexpressions too deep&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subexp_Posns--&gt;(blevel++) = TEXT_TY_RE_NodeAddress(no_packets);</span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump <a href="./RegExp.i6t.html#line617">CClassKnown</a>;</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;=&#39;</span>: par2 = 1; <span class="comment">! (?=...) lookahead/behind</span></span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par3 = 0; if (bits == false) par3 = -1;</span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;&#39;</span>: par2 = 2; <span class="comment">! (?!...) negated lookahead/behind</span></span></span>
<span class="tr"><span class="th" id="line509">509</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par3 = 0; if (bits == false) par3 = -1;</span></span>
<span class="tr"><span class="th" id="line510">510</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;:&#39;</span>: par2 = 3; <span class="comment">! (?:...) uncollecting subexpression</span></span></span>
<span class="tr"><span class="th" id="line511">511</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;&gt;&#39;</span>: par2 = 4; <span class="comment">! (?&gt;...) possessive</span></span></span>
<span class="tr"><span class="th" id="line512">512</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</span></span>
<span class="tr"><span class="th" id="line513">513</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;)&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line514">514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc == <span class="sstring">&#39;i&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line515">515</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = SENSITIVITY_RE_CC; par1 = bits; ffrom++;</span></span>
<span class="tr"><span class="th" id="line516">516</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump <a href="./RegExp.i6t.html#line617">CClassKnown</a>;</span></span>
<span class="tr"><span class="th" id="line517">517</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line518">518</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line519">519</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;:&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line520">520</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc == <span class="sstring">&#39;i&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line521">521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = bits; par2 = 3; par3 = bits+1; ffrom++;</span></span>
<span class="tr"><span class="th" id="line522">522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump <a href="./RegExp.i6t.html#line528">AllowForm</a>;</span></span>
<span class="tr"><span class="th" id="line523">523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="dstring">&quot;unknown (?...) form&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line528">528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.AllowForm;</span></span>
<span class="tr"><span class="th" id="line529">529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == 0) par1 = no_subs++; else par1 = -1;</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = SUBEXP_RE_CC; </span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (blevel == 20) return <span class="dstring">&quot;subexpressions too deep&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line533">533</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subexp_Posns--&gt;(blevel++) = TEXT_TY_RE_NodeAddress(no_packets);</span></span>
<span class="tr"><span class="th" id="line534">534</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;)&#39;</span>: if (blevel == 0) return <span class="dstring">&quot;subexpression bracket mismatch&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line535">535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blevel--;</span></span>
<span class="tr"><span class="th" id="line536">536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to = Subexp_Posns--&gt;blevel;</span></span>
<span class="tr"><span class="th" id="line537">537</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (attach_to--&gt;RE_DOWN == NULL) {</span></span>
<span class="tr"><span class="th" id="line538">538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line539">539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_DOWN =</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_Node(no_packets++, ALWAYS_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_DOWN)--&gt;RE_UP = attach_to;</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = true;</span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;.&#39;</span>: cc = ANYTHING_RE_CC; quantifiable = true;</span></span>
<span class="tr"><span class="th" id="line546">546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;|&#39;</span>: cc = CHOICE_RE_CC; quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line547">547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;^&#39;</span>: cc = START_RE_CC; quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line548">548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;$&#39;</span>: cc = END_RE_CC; quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line549">549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;{&#39;</span>: if (quantifiable == false) return <span class="dstring">&quot;quantifier misplaced&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = 0; par2 = -1; bits = 1;</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ((cc=BlkValueRead(ftxt, ffrom++)) ~= 0 or <span class="sstring">&#39;}&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc == <span class="sstring">&#39;,&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits++;</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bits &gt;= 3) return <span class="dstring">&quot;too many colons in ?{...}&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((cc &gt;= <span class="sstring">&#39;0&#39;</span>) || (cc &lt;= <span class="sstring">&#39;9&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bits == 1) {</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par1 &lt; 0) par1 = 0;</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = par1*10 + (cc-<span class="sstring">&#39;0&#39;</span>);</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 &lt; 0) par2 = 0;</span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par2 = par2*10 + (cc-<span class="sstring">&#39;0&#39;</span>);</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else return <span class="dstring">&quot;non-digit in ?{...}&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc ~= <span class="sstring">&#39;}&#39;</span>) return <span class="dstring">&quot;{x,y} quantifier never ends&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par2 == -1) {</span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bits == 2) par2 = 30000;</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else par2 = par1;</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par1 &gt; par2) return <span class="dstring">&quot;{x,y} with x greater than y&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line574">574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;?&#39;</span>) { ffrom++; par3 = true; }</span></span>
<span class="tr"><span class="th" id="line575">575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line576">576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;&lt;&#39;</span>, <span class="sstring">&#39;[&#39;</span>: par3 = false; if (cc == <span class="sstring">&#39;&lt;&#39;</span>) bits = <span class="sstring">&#39;&gt;&#39;</span>; else bits = <span class="sstring">&#39;]&#39;</span>;</span></span>
<span class="tr"><span class="th" id="line577">577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;^&#39;</span>) { ffrom++; par3 = true; }</span></span>
<span class="tr"><span class="th" id="line578">578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = ffrom;</span></span>
<span class="tr"><span class="th" id="line579">579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == bits) { ffrom++; }</span></span>
<span class="tr"><span class="th" id="line580">580</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (cc ~= bits or 0) {</span></span>
<span class="tr"><span class="th" id="line581">581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = BlkValueRead(ftxt, ffrom++);</span></span>
<span class="tr"><span class="th" id="line582">582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc == <span class="sstring">&#39;\&#39;</span>) {</span></span>
<span class="tr"><span class="th" id="line583">583</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = BlkValueRead(ftxt, ffrom++);</span></span>
<span class="tr"><span class="th" id="line584">584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc ~= 0) cc = BlkValueRead(ftxt, ffrom++);</span></span>
<span class="tr"><span class="th" id="line585">585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line586">586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line587">587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc == 0) return <span class="dstring">&quot;Character range never ends&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line588">588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par2 = ffrom-1;</span></span>
<span class="tr"><span class="th" id="line589">589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((par2 &gt; par1 + 1) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line590">590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt, par1) == <span class="sstring">&#39;:&#39;</span>) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line591">591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt, par2-1) == <span class="sstring">&#39;:&#39;</span>) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line592">592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt, par2-2) ~= <span class="sstring">&#39;\&#39;</span>))</span></span>
<span class="tr"><span class="th" id="line593">593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="dstring">&quot;POSIX named character classes unsupported&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits = TEXT_TY_RE_RangeSyntaxCorrect(ftxt, par1, par2);</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bits) return bits;</span></span>
<span class="tr"><span class="th" id="line596">596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (par1 &lt; par2) cc = RANGE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else cc = NOTHING_RE_CC;</span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = true;</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;*&#39;</span>: if (quantifiable == false) return <span class="dstring">&quot;quantifier misplaced&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = 0; par2 = 30000;</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;?&#39;</span>) { ffrom++; par3 = true; }</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;+&#39;</span>: if (quantifiable == false) return <span class="dstring">&quot;quantifier misplaced&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = 1; par2 = 30000;</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;?&#39;</span>) { ffrom++; par3 = true; }</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;?&#39;</span>: if (quantifiable == false) return <span class="dstring">&quot;quantifier misplaced&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = QUANTIFIER_RE_CC;</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;par1 = 0; par2 = 1;</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(ftxt, ffrom) == <span class="sstring">&#39;?&#39;</span>) { ffrom++; par3 = true; }</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = false;</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.CClassKnown;</span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line619">619</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cc &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line620">620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quantifiable = true;</span></span>
<span class="tr"><span class="th" id="line621">621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((attach_to--&gt;RE_CCLASS == LITERAL_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line622">622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BlkValueRead(ftxt, ffrom) ~= <span class="sstring">&#39;*&#39;</span> or <span class="sstring">&#39;+&#39;</span> or <span class="sstring">&#39;?&#39;</span> or <span class="sstring">&#39;{&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line623">623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_PAR2)++;</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace == 2) {</span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Extending literal by &quot;</span>, cc, <span class="dstring">&quot;=&quot;</span>, (char) cc, <span class="dstring">&quot;^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line627">627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line628">628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line629">629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cc = LITERAL_RE_CC; par1 = ffrom-1; par2 = ffrom;</span></span>
<span class="tr"><span class="th" id="line630">630</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line631">631</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line632">632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line633">633</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace == 2) {</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Attaching packet &quot;</span>, no_packets+1, <span class="dstring">&quot; to &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(attach_to, ftxt);</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = TEXT_TY_RE_Node(no_packets++, cc, par1, par2, par3);</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_CCLASS == SUBEXP_RE_CC) &amp;&amp; (token--&gt;RE_PAR2 == 0)) {</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RE_Subexpressions--&gt;(token--&gt;RE_PAR1) = token;</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RE_Subexpressions--&gt;10)++;</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((attach_to--&gt;RE_CCLASS == SUBEXP_RE_CC or CHOICE_RE_CC or IF_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_DOWN == NULL)) {</span></span>
<span class="tr"><span class="th" id="line649">649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_DOWN = token; token--&gt;RE_UP = attach_to;</span></span>
<span class="tr"><span class="th" id="line650">650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line651">651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_CCLASS == CHOICE_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line652">652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((attach_to--&gt;RE_UP)--&gt;RE_CCLASS == CHOICE_RE_CC)) {</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_packets--; token = attach_to--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CCLASS == CHOICE_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line656">656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (attach_to--&gt;RE_PREVIOUS ~= NULL)</span></span>
<span class="tr"><span class="th" id="line657">657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to = attach_to--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line658">658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line659">659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CCLASS == QUANTIFIER_RE_CC or CHOICE_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line660">660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PREVIOUS = attach_to--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line661">661</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_UP = attach_to--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((attach_to--&gt;RE_UP ~= NULL) &amp;&amp; (attach_to--&gt;RE_PREVIOUS == NULL))</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_UP)--&gt;RE_DOWN = token;</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DOWN = attach_to;</span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits = attach_to;</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (bits ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits--&gt;RE_UP = token;</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bits = bits--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_PREVIOUS = NULL;</span></span>
<span class="tr"><span class="th" id="line671">671</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PREVIOUS ~= NULL)</span></span>
<span class="tr"><span class="th" id="line672">672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_PREVIOUS)--&gt;RE_NEXT = token;</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_NEXT = token; token--&gt;RE_PREVIOUS = attach_to;</span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_UP = attach_to--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CCLASS == CHOICE_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_NEXT = TEXT_TY_RE_Node(no_packets++, CHOICE_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_NEXT)--&gt;RE_PREVIOUS = token;</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_NEXT)--&gt;RE_UP = token--&gt;RE_UP;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to = token;</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace == 2) {</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Result:^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (blevel ~= 0) return <span class="dstring">&quot;subexpression bracket mismatch&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (exactly) {</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets+3 &gt; RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exactly = RE_PACKET_space--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = TEXT_TY_RE_Node(no_packets++, START_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RE_PACKET_space--&gt;RE_DOWN = token; token--&gt;RE_UP = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to = TEXT_TY_RE_Node(no_packets++, SUBEXP_RE_CC, -1, 3, 0);</span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_NEXT = attach_to; attach_to--&gt;RE_PREVIOUS = token;</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_UP = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_NEXT = TEXT_TY_RE_Node(no_packets++, END_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_PREVIOUS = attach_to;</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(attach_to--&gt;RE_NEXT)--&gt;RE_UP = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attach_to--&gt;RE_DOWN = exactly;</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (exactly ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exactly--&gt;RE_UP = attach_to; exactly = exactly--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;no_packets = TEXT_TY_RE_ExpandChoices(RE_PACKET_space, no_packets);</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Compiled pattern:^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line720">720</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line721">721</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line722">722</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line723">723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;bits = TEXT_TY_RE_CheckTree(RE_PACKET_space, no_subs); if (bits) return bits;</span></span>
<span class="tr"><span class="th" id="line724">724</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line725">725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return no_packets;</span></span>
<span class="tr"><span class="th" id="line726">726</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">[ TEXT_TY_RE_RangeSyntaxCorrect ftxt rf rt</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i chm;</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (i=rf: i&lt;rt: i++) {</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chm = BlkValueRead(ftxt, i);</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((chm == <span class="sstring">&#39;\&#39;</span>) &amp;&amp; (i+1&lt;rt)) {</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chm = BlkValueRead(ftxt, ++i);</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (((chm &gt;= <span class="sstring">&#39;a&#39;</span>) &amp;&amp; (chm &lt;= <span class="sstring">&#39;z&#39;</span>)) ||</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((chm &gt;= <span class="sstring">&#39;A&#39;</span>) &amp;&amp; (chm &lt;= <span class="sstring">&#39;Z&#39;</span>))) {</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (chm ~= <span class="sstring">&#39;s&#39;</span> or <span class="sstring">&#39;S&#39;</span> or <span class="sstring">&#39;p&#39;</span> or <span class="sstring">&#39;P&#39;</span> or <span class="sstring">&#39;w&#39;</span> or <span class="sstring">&#39;W&#39;</span> or <span class="sstring">&#39;d&#39;</span></span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;D&#39;</span> or <span class="sstring">&#39;n&#39;</span> or <span class="sstring">&#39;t&#39;</span> or <span class="sstring">&#39;l&#39;</span> or <span class="sstring">&#39;L&#39;</span> or <span class="sstring">&#39;u&#39;</span> or <span class="sstring">&#39;U&#39;</span>)</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="dstring">&quot;Invalid escape in {} range&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((i+2&lt;rt) &amp;&amp; (BlkValueRead(ftxt, i+1) == <span class="sstring">&#39;-&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (chm &gt; BlkValueRead(ftxt, i+2)) return <span class="dstring">&quot;Invalid {} range&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i=i+2;</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">[ TEXT_TY_RE_ExpandChoices token no_packets</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv prev nex holder new ct n cond_node then_node else_node;</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CCLASS == IF_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_DOWN)--&gt;RE_CCLASS == CHOICE_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (nex=token--&gt;RE_DOWN, n=0: nex~=NULL: nex=nex--&gt;RE_NEXT) n++;</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (n~=2) return <span class="dstring">&quot;conditional has too many clauses&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node = TEXT_TY_RE_Node(no_packets++, CONDITION_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR1 &gt;= 1) {</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_PAR1 = token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node = token--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_CCLASS = THEN_RE_CC;</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else_node = then_node--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else_node--&gt;RE_CCLASS = ELSE_RE_CC;</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cond_node--&gt;RE_PAR1 &lt; 1) {</span></span>
<span class="tr"><span class="th" id="line766">766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_DOWN = then_node--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line767">767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_DOWN = (then_node--&gt;RE_DOWN)--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line768">768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (then_node--&gt;RE_DOWN ~= NULL)</span></span>
<span class="tr"><span class="th" id="line769">769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(then_node--&gt;RE_DOWN)--&gt;RE_PREVIOUS = NULL;</span></span>
<span class="tr"><span class="th" id="line770">770</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_NEXT = NULL;</span></span>
<span class="tr"><span class="th" id="line771">771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_UP = cond_node;</span></span>
<span class="tr"><span class="th" id="line772">772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line773">773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DOWN = cond_node; cond_node--&gt;RE_UP = token;</span></span>
<span class="tr"><span class="th" id="line774">774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_NEXT = then_node; then_node--&gt;RE_PREVIOUS = cond_node;</span></span>
<span class="tr"><span class="th" id="line775">775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line776">776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line777">777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node = TEXT_TY_RE_Node(no_packets++, CONDITION_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line778">778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line779">779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node = TEXT_TY_RE_Node(no_packets++, THEN_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line780">780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR1 &gt;= 1) {</span></span>
<span class="tr"><span class="th" id="line781">781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_PAR1 = token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line782">782</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_DOWN = token--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line783">783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line784">784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_DOWN = token--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line785">785</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_DOWN = (token--&gt;RE_DOWN)--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line786">786</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_NEXT = NULL;</span></span>
<span class="tr"><span class="th" id="line787">787</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond_node--&gt;RE_DOWN)--&gt;RE_UP = cond_node;</span></span>
<span class="tr"><span class="th" id="line788">788</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line789">789</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DOWN = cond_node;</span></span>
<span class="tr"><span class="th" id="line790">790</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cond_node--&gt;RE_UP = token; cond_node--&gt;RE_NEXT = then_node;</span></span>
<span class="tr"><span class="th" id="line791">791</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_PREVIOUS = cond_node; then_node--&gt;RE_UP = token;</span></span>
<span class="tr"><span class="th" id="line792">792</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then_node--&gt;RE_NEXT = NULL;</span></span>
<span class="tr"><span class="th" id="line793">793</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (then_node--&gt;RE_DOWN ~= NULL)</span></span>
<span class="tr"><span class="th" id="line794">794</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(then_node--&gt;RE_DOWN)--&gt;RE_PREVIOUS = NULL;</span></span>
<span class="tr"><span class="th" id="line795">795</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (nex = then_node--&gt;RE_DOWN: nex ~= NULL: nex = nex--&gt;RE_NEXT) {</span></span>
<span class="tr"><span class="th" id="line796">796</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nex--&gt;RE_UP = then_node;</span></span>
<span class="tr"><span class="th" id="line797">797</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line798">798</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line799">799</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line800">800</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cond_node--&gt;RE_DOWN ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line801">801</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nex = cond_node--&gt;RE_DOWN;</span></span>
<span class="tr"><span class="th" id="line802">802</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((nex--&gt;RE_CCLASS ~= SUBEXP_RE_CC) ||</span></span>
<span class="tr"><span class="th" id="line803">803</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(nex--&gt;RE_NEXT ~= NULL) ||</span></span>
<span class="tr"><span class="th" id="line804">804</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(nex--&gt;RE_PAR2 ~= 1 or 2)) {</span></span>
<span class="tr"><span class="th" id="line805">805</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!TEXT_TY_RE_DebugSubtree(0, 0, nex, true);</span></span></span>
<span class="tr"><span class="th" id="line806">806</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return <span class="dstring">&quot;condition not lookahead/behind&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line807">807</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line808">808</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line809">809</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line810">810</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_CCLASS == CHOICE_RE_CC) &amp;&amp; (token--&gt;RE_PAR1 &lt; 1)) {</span></span>
<span class="tr"><span class="th" id="line811">811</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prev = token--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line812">812</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nex = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line813">813</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ((nex ~= NULL) &amp;&amp; (nex--&gt;RE_CCLASS == CHOICE_RE_CC))</span></span>
<span class="tr"><span class="th" id="line814">814</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nex = nex--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line815">815</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;holder = token--&gt;RE_UP; if (holder == NULL) return <span class="dstring">&quot;bang&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line816">816</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (no_packets &gt;= RE_MAX_PACKETS) return <span class="dstring">&quot;regexp too complex&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line817">817</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new = TEXT_TY_RE_Node(no_packets++, DISJUNCTION_RE_CC, 0, 0, 0);</span></span>
<span class="tr"><span class="th" id="line818">818</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;holder--&gt;RE_DOWN = new; new--&gt;RE_UP = holder;</span></span>
<span class="tr"><span class="th" id="line819">819</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (prev ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line820">820</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prev--&gt;RE_NEXT = new; new--&gt;RE_PREVIOUS = prev;</span></span>
<span class="tr"><span class="th" id="line821">821</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line822">822</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (nex ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line823">823</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nex--&gt;RE_PREVIOUS = new; new--&gt;RE_NEXT = nex;</span></span>
<span class="tr"><span class="th" id="line824">824</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line825">825</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new--&gt;RE_DOWN = token;</span></span>
<span class="tr"><span class="th" id="line826">826</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PREVIOUS = NULL;</span></span>
<span class="tr"><span class="th" id="line827">827</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ct = 1;</span></span>
<span class="tr"><span class="th" id="line828">828</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line829">829</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PAR1 = ct++;</span></span>
<span class="tr"><span class="th" id="line830">830</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_UP = new;</span></span>
<span class="tr"><span class="th" id="line831">831</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_NEXT ~= NULL) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line832">832</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((token--&gt;RE_NEXT)--&gt;RE_CCLASS ~= CHOICE_RE_CC))</span></span>
<span class="tr"><span class="th" id="line833">833</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_NEXT = NULL;</span></span>
<span class="tr"><span class="th" id="line834">834</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line835">835</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line836">836</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new--&gt;RE_PAR1 = ct-1;</span></span>
<span class="tr"><span class="th" id="line837">837</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token ~= NULL) token--&gt;RE_NEXT = NULL;</span></span>
<span class="tr"><span class="th" id="line838">838</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = new; continue;</span></span>
<span class="tr"><span class="th" id="line839">839</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line840">840</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DOWN ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line841">841</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_packets = TEXT_TY_RE_ExpandChoices(token--&gt;RE_DOWN, no_packets);</span></span>
<span class="tr"><span class="th" id="line842">842</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((no_packets&lt;0) || (no_packets &gt;= RE_MAX_PACKETS)) break;</span></span>
<span class="tr"><span class="th" id="line843">843</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line844">844</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line845">845</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line846">846</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return no_packets;</span></span>
<span class="tr"><span class="th" id="line847">847</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line848">848</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line849">849</span><span class="td">[ TEXT_TY_RE_CheckTree token no_subs</span></span>
<span class="tr"><span class="th" id="line850">850</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rv;</span></span>
<span class="tr"><span class="th" id="line851">851</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line852">852</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CCLASS == VARIABLE_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line853">853</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR1 &gt;= no_subs) return <span class="dstring">&quot;reference to nonexistent group&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line854">854</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line855">855</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_CCLASS == SUBEXP_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line856">856</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_PAR2 == 1 or 2) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line857">857</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_PAR3 == -1)) {</span></span>
<span class="tr"><span class="th" id="line858">858</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PAR3 = TEXT_TY_RE_Width(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line859">859</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR3 == -1) return <span class="dstring">&quot;variable length lookbehind not implemented&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line860">860</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line861">861</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DOWN ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line862">862</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_CheckTree(token--&gt;RE_DOWN, no_subs);</span></span>
<span class="tr"><span class="th" id="line863">863</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv) return rv;</span></span>
<span class="tr"><span class="th" id="line864">864</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line865">865</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line866">866</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line867">867</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line868">868</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line869">869</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line870">870</span><span class="td">[ TEXT_TY_RE_Width token downwards</span></span>
<span class="tr"><span class="th" id="line871">871</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;w rv aw choice;</span></span>
<span class="tr"><span class="th" id="line872">872</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line873">873</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token--&gt;RE_CCLASS) {</span></span>
<span class="tr"><span class="th" id="line874">874</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGIT_RE_CC, NONDIGIT_RE_CC, WHITESPACE_RE_CC, NONWHITESPACE_RE_CC,</span></span>
<span class="tr"><span class="th" id="line875">875</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUNCTUATION_RE_CC, NONPUNCTUATION_RE_CC, WORD_RE_CC, NONWORD_RE_CC,</span></span>
<span class="tr"><span class="th" id="line876">876</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANYTHING_RE_CC, NOTHING_RE_CC, RANGE_RE_CC, NEWLINE_RE_CC, TAB_RE_CC,</span></span>
<span class="tr"><span class="th" id="line877">877</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCASE_RE_CC, NONUCASE_RE_CC, LCASE_RE_CC, NONLCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line878">878</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w++;</span></span>
<span class="tr"><span class="th" id="line879">879</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_RE_CC, END_RE_CC, BOUNDARY_RE_CC, NONBOUNDARY_RE_CC, ALWAYS_RE_CC:</span></span>
<span class="tr"><span class="th" id="line880">880</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span>
<span class="tr"><span class="th" id="line881">881</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LITERAL_RE_CC:</span></span>
<span class="tr"><span class="th" id="line882">882</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = w + token--&gt;RE_PAR2 - token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line883">883</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARIABLE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line884">884</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -1;</span></span>
<span class="tr"><span class="th" id="line885">885</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF_RE_CC:</span></span>
<span class="tr"><span class="th" id="line886">886</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_Width((token--&gt;RE_DOWN)--&gt;RE_NEXT);</span></span>
<span class="tr"><span class="th" id="line887">887</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv == -1) return -1;</span></span>
<span class="tr"><span class="th" id="line888">888</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv ~= TEXT_TY_RE_Width(((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_NEXT))</span></span>
<span class="tr"><span class="th" id="line889">889</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -1;</span></span>
<span class="tr"><span class="th" id="line890">890</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = w + rv;</span></span>
<span class="tr"><span class="th" id="line891">891</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBEXP_RE_CC:</span></span>
<span class="tr"><span class="th" id="line892">892</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR2 == 1 or 2) rv = 0;</span></span>
<span class="tr"><span class="th" id="line893">893</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else {</span></span>
<span class="tr"><span class="th" id="line894">894</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_Width(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line895">895</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv == -1) return -1;</span></span>
<span class="tr"><span class="th" id="line896">896</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line897">897</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = w + rv;</span></span>
<span class="tr"><span class="th" id="line898">898</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line899">899</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR1 ~= token--&gt;RE_PAR2) return -1;</span></span>
<span class="tr"><span class="th" id="line900">900</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_Width(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line901">901</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv == -1) return -1;</span></span>
<span class="tr"><span class="th" id="line902">902</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = w + rv*(token--&gt;RE_PAR1);                </span></span>
<span class="tr"><span class="th" id="line903">903</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line904">904</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aw = -1;</span></span>
<span class="tr"><span class="th" id="line905">905</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (choice = token--&gt;RE_DOWN: choice ~= NULL: choice = choice--&gt;RE_NEXT) {</span></span>
<span class="tr"><span class="th" id="line906">906</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_Width(choice--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line907">907</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;Option found &quot;, rv, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line908">908</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv == -1) return -1;</span></span>
<span class="tr"><span class="th" id="line909">909</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((aw &gt;= 0) &amp;&amp; (aw ~= rv)) return -1;</span></span>
<span class="tr"><span class="th" id="line910">910</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aw = rv;</span></span>
<span class="tr"><span class="th" id="line911">911</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line912">912</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w = w + aw;</span></span>
<span class="tr"><span class="th" id="line913">913</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SENSITIVITY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line914">914</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span>
<span class="tr"><span class="th" id="line915">915</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line916">916</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (downwards) return w;</span></span>
<span class="tr"><span class="th" id="line917">917</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token ~= NULL) token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line918">918</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line919">919</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return w;</span></span>
<span class="tr"><span class="th" id="line920">920</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-parser">Parser.</h3><p><p> The virtue of all of that tree compilation is that the code which actually does the work &ndash; which parses the source text to see if the regular expression matches it &ndash; is much shorter and quicker: indeed, it takes up fewer lines than the compiler part, which goes to show that decoding regular expression syntax is a more complex task than acting upon it. This would have surprised the pioneers of regexp, but the syntax has become much more complicated over the decades because of a steady increase in the number of extended notations. The process shows no sign of stopping, with Python and PCRE continuing to push boundaries beyond Perl, which was once thought the superest, duperest regexp syntax there could be. However: to work.<p></p><p> The main matcher simply starts a recursive subroutine to perform the match. However, the subroutine tests for a match at a particular position in the source text; so the main routine tries the subroutine everywhere convenient in the source text, from left to right, until a match is made &ndash; unless the regexp is constrained by a <span class="fixed">^</span> glyph to begin matching at the start of the source text, which will cause a <span class="fixed"><a href="./RegExp.i6t.html#line96">START_RE_CC</a></span> node to be the eldest child of the <span class="fixed">\0</span> root.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line943">943</span><span class="td">Global TEXT_TY_RE_RewindCount;</span></span>
<span class="tr"><span class="th" id="line944">944</span><span class="td">[ TEXT_TY_RE_PrintNoRewinds; print TEXT_TY_RE_RewindCount; ];</span></span>
<span class="tr"><span class="th" id="line945">945</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line946">946</span><span class="td">Constant CIS_MFLAG = 1;</span></span>
<span class="tr"><span class="th" id="line947">947</span><span class="td">Constant ACCUM_MFLAG = 2;</span></span>
<span class="tr"><span class="th" id="line948">948</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line949">949</span><span class="td">[ TEXT_TY_RE_Parse ftxt txt ipos insens</span></span>
<span class="tr"><span class="th" id="line950">950</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ilen rv root i initial_mode;</span></span>
<span class="tr"><span class="th" id="line951">951</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line952">952</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ilen = TEXT_TY_CharacterLength(txt);</span></span>
<span class="tr"><span class="th" id="line953">953</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((ipos&lt;0) || (ipos&gt;ilen)) return -1;</span></span>
<span class="tr"><span class="th" id="line954">954</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line955">955</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;root = RE_PACKET_space;</span></span>
<span class="tr"><span class="th" id="line956">956</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line957">957</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;initial_mode = 0; if (insens) initial_mode = CIS_MFLAG;</span></span>
<span class="tr"><span class="th" id="line958">958</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line959">959</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_Clear_Markers(RE_PACKET_space);</span></span>
<span class="tr"><span class="th" id="line960">960</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line961">961</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (:ipos&lt;=ilen:ipos++) {</span></span>
<span class="tr"><span class="th" id="line962">962</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((RE_PACKET_space--&gt;RE_DOWN ~= NULL) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line963">963</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((RE_PACKET_space--&gt;RE_DOWN)--&gt;RE_CCLASS == START_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line964">964</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ipos&gt;0)) { rv = -1; break; }</span></span>
<span class="tr"><span class="th" id="line965">965</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ipos &gt; 0) TEXT_TY_RE_EraseConstraints(RE_PACKET_space, initial_mode);</span></span>
<span class="tr"><span class="th" id="line966">966</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_RewindCount = 0;</span></span>
<span class="tr"><span class="th" id="line967">967</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ilen, RE_PACKET_space, initial_mode);</span></span>
<span class="tr"><span class="th" id="line968">968</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) break;</span></span>
<span class="tr"><span class="th" id="line969">969</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line970">970</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line971">971</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (rv == -1) {</span></span>
<span class="tr"><span class="th" id="line972">972</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root--&gt;RE_DATA1 = -1;</span></span>
<span class="tr"><span class="th" id="line973">973</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root--&gt;RE_DATA2 = -1;</span></span>
<span class="tr"><span class="th" id="line974">974</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line975">975</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root--&gt;RE_DATA1 = ipos;</span></span>
<span class="tr"><span class="th" id="line976">976</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root--&gt;RE_DATA2 = ipos+rv;</span></span>
<span class="tr"><span class="th" id="line977">977</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line978">978</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return rv;</span></span>
<span class="tr"><span class="th" id="line979">979</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-parse-at-position">Parse At Position.</h3><p><p> <span class="fixed"><a href="./RegExp.i6t.html#line991">TEXT_TY_RE_ParseAtPosition(ftxt, txt, ifrom, ito)</a></span> attempts to match text beginning at position <span class="fixed">ifrom</span> in the text <span class="fixed">txt</span> and extending for any length up to position <span class="fixed">ito</span>: it returns the number of characters which were matched (which can legitimately be 0), or <em>-1</em> if no match could be made. <span class="fixed">ftxt</span> is the original text of the regular expression in its precompiled form, which we need partly to print good debugging information, but mostly in order to match against a <span class="fixed"><a href="./RegExp.i6t.html#line92">LITERAL_RE_CC</a></span> node.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line991">991</span><span class="td">[ TEXT_TY_RE_ParseAtPosition ftxt txt ifrom ito token mode_flags</span></span>
<span class="tr"><span class="th" id="line992">992</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;outcome ipos npos rv i ch edge rewind_this;</span></span>
<span class="tr"><span class="th" id="line993">993</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line994">994</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (ifrom &gt; ito) return -1;</span></span>
<span class="tr"><span class="th" id="line995">995</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line996">996</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ipos = ifrom;</span></span>
<span class="tr"><span class="th" id="line997">997</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line998">998</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;.Rewind;</span></span>
<span class="tr"><span class="th" id="line999">999</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line1000">1000</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = false;</span></span>
<span class="tr"><span class="th" id="line1001">1001</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1002">1002</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Matching at &quot;</span>, ipos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1003">1003</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1004">1004</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1005">1005</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1006">1006</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ipos&lt;ito) ch = BlkValueRead(txt, ipos); else ch = 0;</span></span>
<span class="tr"><span class="th" id="line1007">1007</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1008">1008</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_MODES = mode_flags; <span class="comment">! Save in case of backtrack</span></span></span>
<span class="tr"><span class="th" id="line1009">1009</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1010">1010</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token--&gt;RE_CCLASS) {</span></span>
<span class="tr"><span class="th" id="line1011">1011</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1012">1012</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! Should never happen</span></span></span>
<span class="tr"><span class="th" id="line1013">1013</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1014">1014</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHOICE_RE_CC: return <span class="dstring">&quot;internal error&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1015">1015</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1016">1016</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! Mode switches</span></span></span>
<span class="tr"><span class="th" id="line1017">1017</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1018">1018</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SENSITIVITY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1019">1019</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR1) mode_flags = mode_flags | CIS_MFLAG;</span></span>
<span class="tr"><span class="th" id="line1020">1020</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else mode_flags = mode_flags &amp; (~CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1021">1021</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1022">1022</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1023">1023</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! Zero-length positional markers</span></span></span>
<span class="tr"><span class="th" id="line1024">1024</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1025">1025</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALWAYS_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1026">1026</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1027">1027</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEVER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1028">1028</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;START_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1029">1029</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ipos == 0) outcome = true;</span></span>
<span class="tr"><span class="th" id="line1030">1030</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1031">1031</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(txt, ipos) == 0) outcome = true;</span></span>
<span class="tr"><span class="th" id="line1032">1032</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOUNDARY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1033">1033</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = 0;</span></span>
<span class="tr"><span class="th" id="line1034">1034</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(txt, ipos) == 0 or 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1035">1035</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1036">1036</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1037">1037</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) rv++;</span></span>
<span class="tr"><span class="th" id="line1038">1038</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ipos == 0) ch = 0;</span></span>
<span class="tr"><span class="th" id="line1039">1039</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else ch = BlkValueRead(txt, ipos-1);</span></span>
<span class="tr"><span class="th" id="line1040">1040</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 0 or 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1041">1041</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1042">1042</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1043">1043</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) rv++;</span></span>
<span class="tr"><span class="th" id="line1044">1044</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv == 1) outcome = true;</span></span>
<span class="tr"><span class="th" id="line1045">1045</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONBOUNDARY_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1046">1046</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = 0;</span></span>
<span class="tr"><span class="th" id="line1047">1047</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(txt, ipos) == 0 or 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1048">1048</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1049">1049</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1050">1050</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) rv++;</span></span>
<span class="tr"><span class="th" id="line1051">1051</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ipos == 0) ch = 0;</span></span>
<span class="tr"><span class="th" id="line1052">1052</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else ch = BlkValueRead(txt, ipos-1);</span></span>
<span class="tr"><span class="th" id="line1053">1053</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 0 or 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1054">1054</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1055">1055</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1056">1056</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) rv++;</span></span>
<span class="tr"><span class="th" id="line1057">1057</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv ~= 1) outcome = true;</span></span>
<span class="tr"><span class="th" id="line1058">1058</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1059">1059</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! Control constructs</span></span></span>
<span class="tr"><span class="th" id="line1060">1060</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1061">1061</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1062">1062</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i = token--&gt;RE_PAR1; ch = false;</span></span>
<span class="tr"><span class="th" id="line1063">1063</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1064">1064</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Trying conditional from &quot;</span>, ipos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1065">1065</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1066">1066</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1067">1067</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i &gt;= 1) {</span></span>
<span class="tr"><span class="th" id="line1068">1068</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((i&lt;RE_Subexpressions--&gt;10) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1069">1069</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((RE_Subexpressions--&gt;i)--&gt;RE_DATA1 &gt;= 0)) ch = true;</span></span>
<span class="tr"><span class="th" id="line1070">1070</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {                         </span></span>
<span class="tr"><span class="th" id="line1071">1071</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito,</span></span>
<span class="tr"><span class="th" id="line1072">1072</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DOWN, mode_flags);</span></span>
<span class="tr"><span class="th" id="line1073">1073</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) ch = true;</span></span>
<span class="tr"><span class="th" id="line1074">1074</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1075">1075</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1076">1076</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Condition found to be &quot;</span>, ch, <span class="dstring">&quot;^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1077">1077</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1078">1078</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch) {</span></span>
<span class="tr"><span class="th" id="line1079">1079</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito,</span></span>
<span class="tr"><span class="th" id="line1080">1080</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_DOWN, mode_flags);</span></span>
<span class="tr"><span class="th" id="line1081">1081</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;Then clause returned &quot;, rv, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line1082">1082</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1083">1083</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_NEXT) == NULL)</span></span>
<span class="tr"><span class="th" id="line1084">1084</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = 0; <span class="comment">! The empty else clause matches</span></span></span>
<span class="tr"><span class="th" id="line1085">1085</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito,</span></span>
<span class="tr"><span class="th" id="line1086">1086</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((token--&gt;RE_DOWN)--&gt;RE_NEXT)--&gt;RE_NEXT)--&gt;RE_DOWN, mode_flags);</span></span>
<span class="tr"><span class="th" id="line1087">1087</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;Else clause returned &quot;, rv, &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line1088">1088</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1089">1089</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1090">1090</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1091">1091</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos = ipos + rv;</span></span>
<span class="tr"><span class="th" id="line1092">1092</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1093">1093</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1094">1094</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1095">1095</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Trying disjunction from &quot;</span>, ipos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1096">1096</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1097">1097</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1098">1098</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (ch = token--&gt;RE_DOWN: ch ~= NULL: ch = ch--&gt;RE_NEXT) {</span></span>
<span class="tr"><span class="th" id="line1099">1099</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch--&gt;RE_PAR1 &lt;= token--&gt;RE_CONSTRAINT) continue;</span></span>
<span class="tr"><span class="th" id="line1100">1100</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1101">1101</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Trying choice at &quot;</span>, ipos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1102">1102</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(ch, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1103">1103</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1104">1104</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito,</span></span>
<span class="tr"><span class="th" id="line1105">1105</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch--&gt;RE_DOWN, mode_flags);</span></span>
<span class="tr"><span class="th" id="line1106">1106</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1107">1107</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = ipos; <span class="comment">! Where match was made</span></span></span>
<span class="tr"><span class="th" id="line1108">1108</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = ch--&gt;RE_PAR1; <span class="comment">! Option taken</span></span></span>
<span class="tr"><span class="th" id="line1109">1109</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos = ipos + rv;</span></span>
<span class="tr"><span class="th" id="line1110">1110</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1111">1111</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1112">1112</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Choice worked with width &quot;</span>, rv, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1113">1113</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(ch, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1114">1114</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1115">1115</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span>
<span class="tr"><span class="th" id="line1116">1116</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1117">1117</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mode_flags &amp; ACCUM_MFLAG == false)</span></span>
<span class="tr"><span class="th" id="line1118">1118</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(ch--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1119">1119</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}                        </span></span>
<span class="tr"><span class="th" id="line1120">1120</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1121">1121</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (outcome == false) {</span></span>
<span class="tr"><span class="th" id="line1122">1122</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1123">1123</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Failed disjunction from &quot;</span>, ipos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1124">1124</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1125">1125</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1126">1126</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = ipos; <span class="comment">! Where match was tried</span></span></span>
<span class="tr"><span class="th" id="line1127">1127</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = -1; <span class="comment">! No option was taken</span></span></span>
<span class="tr"><span class="th" id="line1128">1128</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1129">1129</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SUBEXP_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1130">1130</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR2 == 1 or 2) {</span></span>
<span class="tr"><span class="th" id="line1131">1131</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos = ipos - token--&gt;RE_PAR3;</span></span>
<span class="tr"><span class="th" id="line1132">1132</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (npos&lt;0) rv = -1; <span class="comment">! Lookbehind fails: nothing behind</span></span></span>
<span class="tr"><span class="th" id="line1133">1133</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, npos, ito, token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1134">1134</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1135">1135</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1136">1136</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token--&gt;RE_PAR3) {</span></span>
<span class="tr"><span class="th" id="line1137">1137</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0: rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito, token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1138">1138</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags);</span></span>
<span class="tr"><span class="th" id="line1139">1139</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito, token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1140">1140</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags &amp; (~CIS_MFLAG));</span></span>
<span class="tr"><span class="th" id="line1141">1141</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, ipos, ito, token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1142">1142</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags | CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1143">1143</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1144">1144</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1145">1145</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos = ipos;</span></span>
<span class="tr"><span class="th" id="line1146">1146</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) npos = ipos + rv;</span></span>
<span class="tr"><span class="th" id="line1147">1147</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token--&gt;RE_PAR2) {</span></span>
<span class="tr"><span class="th" id="line1148">1148</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: if (rv &gt;= 0) rv = 0;</span></span>
<span class="tr"><span class="th" id="line1149">1149</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2: if (rv &gt;= 0) rv = -1; else rv = 0;</span></span>
<span class="tr"><span class="th" id="line1150">1150</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1151">1151</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1152">1152</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = ipos;</span></span>
<span class="tr"><span class="th" id="line1153">1153</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos = ipos + rv;</span></span>
<span class="tr"><span class="th" id="line1154">1154</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = npos;</span></span>
<span class="tr"><span class="th" id="line1155">1155</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1156">1156</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1157">1157</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mode_flags &amp; ACCUM_MFLAG == false) {</span></span>
<span class="tr"><span class="th" id="line1158">1158</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = -1;</span></span>
<span class="tr"><span class="th" id="line1159">1159</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = -1;</span></span>
<span class="tr"><span class="th" id="line1160">1160</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1161">1161</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1162">1162</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR2 == 2) TEXT_TY_RE_FailSubexpressions(token, true);</span></span>
<span class="tr"><span class="th" id="line1163">1163</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1164">1164</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = ipos;</span></span>
<span class="tr"><span class="th" id="line1165">1165</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_DOWN)--&gt;RE_CCLASS == SUBEXP_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line1166">1166</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1 = -1;</span></span>
<span class="tr"><span class="th" id="line1167">1167</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2 = -1;    </span></span>
<span class="tr"><span class="th" id="line1168">1168</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1169">1169</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1170">1170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Trying quantifier from &quot;</span>, ipos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1171">1171</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1172">1172</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1173">1173</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR3 == false) { <span class="comment">! Greedy quantifier</span></span></span>
<span class="tr"><span class="th" id="line1174">1174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!edge = ito; if (token--&gt;RE_CONSTRAINT &gt;= 0) edge = token--&gt;RE_CONSTRAINT;</span></span></span>
<span class="tr"><span class="th" id="line1175">1175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge = token--&gt;RE_PAR2;</span></span>
<span class="tr"><span class="th" id="line1176">1176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CONSTRAINT &gt;= 0) edge = token--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line1177">1177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = -1;</span></span>
<span class="tr"><span class="th" id="line1178">1178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0, npos=ipos: i&lt;edge: i++) {</span></span>
<span class="tr"><span class="th" id="line1179">1179</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1180">1180</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Trying quant rep &quot;</span>, i+1, <span class="dstring">&quot; at &quot;</span>, npos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1181">1181</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1182">1182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1183">1183</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, npos, ito, token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1184">1184</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags | ACCUM_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1185">1185</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &lt; 0) break;</span></span>
<span class="tr"><span class="th" id="line1186">1186</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_DOWN)--&gt;RE_CCLASS == SUBEXP_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line1187">1187</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1 = (token--&gt;RE_DOWN)--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1188">1188</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2 = (token--&gt;RE_DOWN)--&gt;RE_DATA2;    </span></span>
<span class="tr"><span class="th" id="line1189">1189</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1190">1190</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((rv == 0) &amp;&amp; (token--&gt;RE_PAR2 == 30000) &amp;&amp; (i&gt;=1)) { i++; break; }</span></span>
<span class="tr"><span class="th" id="line1191">1191</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos = npos + rv;</span></span>
<span class="tr"><span class="th" id="line1192">1192</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1193">1193</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((i &gt;= token--&gt;RE_PAR1) &amp;&amp; (i &lt;= token--&gt;RE_PAR2))</span></span>
<span class="tr"><span class="th" id="line1194">1194</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1195">1195</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { <span class="comment">! Lazy quantifier</span></span></span>
<span class="tr"><span class="th" id="line1196">1196</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge = token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line1197">1197</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CONSTRAINT &gt; edge) edge = token--&gt;RE_CONSTRAINT;</span></span>
<span class="tr"><span class="th" id="line1198">1198</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0, npos=ipos: (npos&lt;ito) &amp;&amp; (i &lt; token--&gt;RE_PAR2): i++) {</span></span>
<span class="tr"><span class="th" id="line1199">1199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i &gt;= edge) break;</span></span>
<span class="tr"><span class="th" id="line1200">1200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1201">1201</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Trying quant rep &quot;</span>, i+1, <span class="dstring">&quot; at &quot;</span>, npos, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1202">1202</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1203">1203</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1204">1204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_ParseAtPosition(ftxt, txt, npos, ito, token--&gt;RE_DOWN,</span></span>
<span class="tr"><span class="th" id="line1205">1205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags | ACCUM_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1206">1206</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &lt; 0) break;</span></span>
<span class="tr"><span class="th" id="line1207">1207</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_DOWN)--&gt;RE_CCLASS == SUBEXP_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line1208">1208</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE1 = (token--&gt;RE_DOWN)--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1209">1209</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_CACHE2 = (token--&gt;RE_DOWN)--&gt;RE_DATA2;    </span></span>
<span class="tr"><span class="th" id="line1210">1210</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1211">1211</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((rv == 0) &amp;&amp; (token--&gt;RE_PAR2 == 30000) &amp;&amp; (i&gt;=1)) { i++; break; }</span></span>
<span class="tr"><span class="th" id="line1212">1212</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npos = npos + rv;</span></span>
<span class="tr"><span class="th" id="line1213">1213</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1214">1214</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((i &gt;= edge) &amp;&amp; (i &lt;= token--&gt;RE_PAR2))</span></span>
<span class="tr"><span class="th" id="line1215">1215</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outcome = true;</span></span>
<span class="tr"><span class="th" id="line1216">1216</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1217">1217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (outcome) {</span></span>
<span class="tr"><span class="th" id="line1218">1218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_PAR3 == false) { <span class="comment">! Greedy quantifier</span></span></span>
<span class="tr"><span class="th" id="line1219">1219</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i &gt; token--&gt;RE_PAR1) { <span class="comment">! I.e., if we have been greedy</span></span></span>
<span class="tr"><span class="th" id="line1220">1220</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = i-1; <span class="comment">! And its edge limitation</span></span></span>
<span class="tr"><span class="th" id="line1221">1221</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1222">1222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = -1;</span></span>
<span class="tr"><span class="th" id="line1223">1223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1224">1224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { <span class="comment">! Lazy quantifier</span></span></span>
<span class="tr"><span class="th" id="line1225">1225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i &lt; token--&gt;RE_PAR2) { <span class="comment">! I.e., if we have been lazy</span></span></span>
<span class="tr"><span class="th" id="line1226">1226</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = i+1; <span class="comment">! And its edge limitation</span></span></span>
<span class="tr"><span class="th" id="line1227">1227</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1228">1228</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = -1;</span></span>
<span class="tr"><span class="th" id="line1229">1229</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1230">1230</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1231">1231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos = npos;</span></span>
<span class="tr"><span class="th" id="line1232">1232</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((i == 0) &amp;&amp; (mode_flags &amp; ACCUM_MFLAG == false))</span></span>
<span class="tr"><span class="th" id="line1233">1233</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1234">1234</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_DOWN)--&gt;RE_CCLASS == SUBEXP_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line1235">1235</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA1 = (token--&gt;RE_DOWN)--&gt;RE_CACHE1;</span></span>
<span class="tr"><span class="th" id="line1236">1236</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DOWN)--&gt;RE_DATA2 = (token--&gt;RE_DOWN)--&gt;RE_CACHE2;    </span></span>
<span class="tr"><span class="th" id="line1237">1237</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1238">1238</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1239">1239</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Successful quant reps &quot;</span>, i, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1240">1240</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1241">1241</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1242">1242</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1243">1243</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!token--&gt;RE_DATA2 = -1;</span></span></span>
<span class="tr"><span class="th" id="line1244">1244</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mode_flags &amp; ACCUM_MFLAG == false)</span></span>
<span class="tr"><span class="th" id="line1245">1245</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1246">1246</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1247">1247</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Failed quant reps &quot;</span>, i, <span class="dstring">&quot;: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1248">1248</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1249">1249</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1250">1250</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1251">1251</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1252">1252</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! Character classes</span></span></span>
<span class="tr"><span class="th" id="line1253">1253</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1254">1254</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NOTHING_RE_CC: ;</span></span>
<span class="tr"><span class="th" id="line1255">1255</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ANYTHING_RE_CC: if (ch) outcome = true; ipos++;</span></span>
<span class="tr"><span class="th" id="line1256">1256</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHITESPACE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1257">1257</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 10 or 13 or 32 or 9) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1258">1258</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONWHITESPACE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1259">1259</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= 10 or 13 or 32 or 9)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1260">1260</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PUNCTUATION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1261">1261</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1262">1262</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1263">1263</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1264">1264</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONPUNCTUATION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1265">1265</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1266">1266</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1267">1267</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1268">1268</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WORD_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1269">1269</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1270">1270</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1271">1271</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1272">1272</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1273">1273</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONWORD_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1274">1274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1275">1275</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1276">1276</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1277">1277</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1278">1278</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DIGIT_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1279">1279</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;0&#39;</span> or <span class="sstring">&#39;1&#39;</span> or <span class="sstring">&#39;2&#39;</span> or <span class="sstring">&#39;3&#39;</span> or <span class="sstring">&#39;4&#39;</span></span></span>
<span class="tr"><span class="th" id="line1280">1280</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;5&#39;</span> or <span class="sstring">&#39;6&#39;</span> or <span class="sstring">&#39;7&#39;</span> or <span class="sstring">&#39;8&#39;</span> or <span class="sstring">&#39;9&#39;</span>) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1281">1281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONDIGIT_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1282">1282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= <span class="sstring">&#39;0&#39;</span> or <span class="sstring">&#39;1&#39;</span> or <span class="sstring">&#39;2&#39;</span> or <span class="sstring">&#39;3&#39;</span> or <span class="sstring">&#39;4&#39;</span></span></span>
<span class="tr"><span class="th" id="line1283">1283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;5&#39;</span> or <span class="sstring">&#39;6&#39;</span> or <span class="sstring">&#39;7&#39;</span> or <span class="sstring">&#39;8&#39;</span> or <span class="sstring">&#39;9&#39;</span>)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1284">1284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1285">1285</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (CharIsOfCase(ch, 0)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1286">1286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONLCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1287">1287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (CharIsOfCase(ch, 0) == false)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1288">1288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1289">1289</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (CharIsOfCase(ch, 1)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1290">1290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NONUCASE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1291">1291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (CharIsOfCase(ch, 1) == false)) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1292">1292</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWLINE_RE_CC: if (ch == 10) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1293">1293</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TAB_RE_CC: if (ch == 9) { outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1294">1294</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RANGE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1295">1295</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Range(ch, ftxt,</span></span>
<span class="tr"><span class="th" id="line1296">1296</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_PAR1, token--&gt;RE_PAR2, token--&gt;RE_PAR3, mode_flags &amp; CIS_MFLAG))</span></span>
<span class="tr"><span class="th" id="line1297">1297</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ outcome = true; ipos++; }</span></span>
<span class="tr"><span class="th" id="line1298">1298</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1299">1299</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">! Substring matches</span></span></span>
<span class="tr"><span class="th" id="line1300">1300</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1301">1301</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LITERAL_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1302">1302</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_MatchSubstring(txt, ipos,</span></span>
<span class="tr"><span class="th" id="line1303">1303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ftxt, token--&gt;RE_PAR1, token--&gt;RE_PAR2, mode_flags &amp; CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1304">1304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) { ipos = ipos + rv; outcome = true; }</span></span>
<span class="tr"><span class="th" id="line1305">1305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARIABLE_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1306">1306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i = token--&gt;RE_PAR1;</span></span>
<span class="tr"><span class="th" id="line1307">1307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((RE_Subexpressions--&gt;i)--&gt;RE_DATA1 &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1308">1308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rv = TEXT_TY_RE_MatchSubstring(txt, ipos,</span></span>
<span class="tr"><span class="th" id="line1309">1309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;txt, (RE_Subexpressions--&gt;i)--&gt;RE_DATA1,</span></span>
<span class="tr"><span class="th" id="line1310">1310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RE_Subexpressions--&gt;i)--&gt;RE_DATA2, mode_flags &amp; CIS_MFLAG);</span></span>
<span class="tr"><span class="th" id="line1311">1311</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rv &gt;= 0) { ipos = ipos + rv; outcome = true; }</span></span>
<span class="tr"><span class="th" id="line1312">1312</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1313">1313</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.NeverMatchIncompleteVar;</span></span>
<span class="tr"><span class="th" id="line1314">1314</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1315">1315</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1316">1316</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (outcome == false) {</span></span>
<span class="tr"><span class="th" id="line1317">1317</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_RewindCount++ &gt;= 10000) {</span></span>
<span class="tr"><span class="th" id="line1318">1318</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_RewindCount == 10001) {</span></span>
<span class="tr"><span class="th" id="line1319">1319</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;style bold; print <span class="dstring">&quot;OVERFLOW^&quot;</span>; style roman;</span></span>
<span class="tr"><span class="th" id="line1320">1320</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1321">1321</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -1;</span></span>
<span class="tr"><span class="th" id="line1322">1322</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1323">1323</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1324">1324</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Rewind sought from failure at pos &quot;</span>, ipos, <span class="dstring">&quot; with: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1325">1325</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1326">1326</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1327">1327</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_CCLASS == QUANTIFIER_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1328">1328</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(TEXT_TY_RE_SeekBacktrack(token--&gt;RE_DOWN, ftxt, false, ito, false)))</span></span>
<span class="tr"><span class="th" id="line1329">1329</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump <a href="./RegExp.i6t.html#line1334">RewindFound</a>;</span></span>
<span class="tr"><span class="th" id="line1330">1330</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mode_flags &amp; ACCUM_MFLAG == false) TEXT_TY_RE_FailSubexpressions(token);</span></span>
<span class="tr"><span class="th" id="line1331">1331</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line1332">1332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line1333">1333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_SeekBacktrack(token, ftxt, true, ito, false)) {</span></span>
<span class="tr"><span class="th" id="line1334">1334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.RewindFound;</span></span>
<span class="tr"><span class="th" id="line1335">1335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipos = token--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1336">1336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode_flags = token--&gt;RE_MODES;</span></span>
<span class="tr"><span class="th" id="line1337">1337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (mode_flags &amp; ACCUM_MFLAG == false)</span></span>
<span class="tr"><span class="th" id="line1338">1338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_FailSubexpressions(token, true);</span></span>
<span class="tr"><span class="th" id="line1339">1339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ipos == -1)</span></span>
<span class="tr"><span class="th" id="line1340">1340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1341">1341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1342">1342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;^[&quot;</span>, ifrom, <span class="dstring">&quot;,&quot;</span>, ito, <span class="dstring">&quot;] rewinding to &quot;</span>, ipos, <span class="dstring">&quot; at &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1343">1343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1344">1344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1345">1345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jump <a href="./RegExp.i6t.html#line998">Rewind</a>;</span></span>
<span class="tr"><span class="th" id="line1346">1346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1347">1347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_PREVIOUS;</span></span>
<span class="tr"><span class="th" id="line1348">1348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1349">1349</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace)</span></span>
<span class="tr"><span class="th" id="line1350">1350</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;^Rewind impossible^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1351">1351</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -1;</span></span>
<span class="tr"><span class="th" id="line1352">1352</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1353">1353</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1354">1354</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line1355">1355</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1356">1356</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return ipos - ifrom;</span></span>
<span class="tr"><span class="th" id="line1357">1357</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-backtracking">Backtracking.</h3><p><p> It would be very straightforward to match regular expressions with the above recursive code if, for every node, there were a fixed number of characters (depending on the node) such that there would either be a match eating that many characters, or else no match at all. If that were true, we could simply march through the text matching until we could match no more, and although some nodes might have ambiguous readings, we could always match the first possibility which worked. There would never be any need to retreat.<p></p><p> Well, in fact that happy state does apply to a surprising number of nodes, and some quite complicated regular expressions can be made which use only them: <span class="fixed">&lt;abc&gt;{2}\d\d\1</span>, for instance, matches a sequence of exactly 6 characters or else fails to match altogether, and there is never any need to backtrack. One reason why backtracking is a fairly good algorithm in practice is that these &quot;good&quot; cases occur fairly often, in subexpressions if not in the entire expression, and the simple method above disposes of them efficiently.<p></p><p> But in an expression like <span class="fixed">ab+bb</span>, there is no alternative to backtracking if we are going to try to match the nodes from left to right: we match the &quot;a&quot;, then we match as many &quot;b&quot;s as we can &ndash; but then we find that we have to match &quot;bb&quot;, and this is necessarily impossible because we have just eaten all of the &quot;b&quot;s available. We therefore backtrack one node to the <span class="fixed">b+</span> and try again. We obviously can&#39;t literally try again because that would give the same result: instead we impose a constraint. Suppose it previously matched a row of 23 letter &quot;b&quot;s, so that the quantifier <span class="fixed">+</span> resulted in a multiplicity of 23. We then constrain the node and in effect consider it to be <span class="fixed">b{1,22}</span>, that is, to match at least 1 and at most 22 letter &quot;b&quot;s. That still won&#39;t work, as it happens, so we backtrack again with a constraint tightened to make it <span class="fixed">b{1,21}</span>, and now the match occurs as we would hope. When the expression becomes more complex, backtracking becomes a longer-distance, recursive procedure &ndash; we have to exhaust all possibilities of a more recent node before tracking back to one from longer ago. (This is why the worst test cases are those which entice us into a long, long series of matches only to find that a guess made right back at the start was ill-fated.)<p></p><p> Rather than describing <span class="fixed"><a href="./RegExp.i6t.html#line1402">TEXT_TY_RE_SeekBacktrack</a></span> in detail here, it is probably more useful to suggest that the reader observe it in action by setting <span class="fixed"><a href="./RegExp.i6t.html#line12">TEXT_TY_RE_Trace</a></span> and trying a few regular expressions.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1402">1402</span><span class="td">[ TEXT_TY_RE_SeekBacktrack token ftxt downwards ito report_only</span></span>
<span class="tr"><span class="th" id="line1403">1403</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;untried;</span></span>
<span class="tr"><span class="th" id="line1404">1404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (: token ~= NULL: token = token--&gt;RE_NEXT) {</span></span>
<span class="tr"><span class="th" id="line1405">1405</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((TEXT_TY_RE_Trace) &amp;&amp; (report_only == false)) {</span></span>
<span class="tr"><span class="th" id="line1406">1406</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Scan for rewind: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1407">1407</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1408">1408</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1409">1409</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_CCLASS == SUBEXP_RE_CC) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1410">1410</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_PAR2 == 1 or 2 or 4)) {</span></span>
<span class="tr"><span class="th" id="line1411">1411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (downwards) rfalse;</span></span>
<span class="tr"><span class="th" id="line1412">1412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line1413">1413</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1414">1414</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DOWN ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line1415">1415</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((TEXT_TY_RE_Trace) &amp;&amp; (report_only == false)) print <span class="dstring">&quot;Descend^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1416">1416</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_SeekBacktrack(token--&gt;RE_DOWN, ftxt, false, ito, report_only)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1417">1417</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1418">1418</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;untried = false;</span></span>
<span class="tr"><span class="th" id="line1419">1419</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token--&gt;RE_CCLASS) {</span></span>
<span class="tr"><span class="th" id="line1420">1420</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1421">1421</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((token--&gt;RE_DATA2 &gt;= 1) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1422">1422</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_DATA2 &lt; token--&gt;RE_PAR1) &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line1423">1423</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_CONSTRAINT &lt; token--&gt;RE_PAR1)) { <span class="comment">! Matched but earlier than last</span></span></span>
<span class="tr"><span class="th" id="line1424">1424</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (report_only) rtrue;</span></span>
<span class="tr"><span class="th" id="line1425">1425</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CONSTRAINT == -1)</span></span>
<span class="tr"><span class="th" id="line1426">1426</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_CONSTRAINT = 1;</span></span>
<span class="tr"><span class="th" id="line1427">1427</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1428">1428</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(token--&gt;RE_CONSTRAINT)++;</span></span>
<span class="tr"><span class="th" id="line1429">1429</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;untried = true;</span></span>
<span class="tr"><span class="th" id="line1430">1430</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1431">1431</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC:</span></span>
<span class="tr"><span class="th" id="line1432">1432</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CONSTRAINT ~= -2) {</span></span>
<span class="tr"><span class="th" id="line1433">1433</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((TEXT_TY_RE_Trace) &amp;&amp; (report_only == false)) {</span></span>
<span class="tr"><span class="th" id="line1434">1434</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Quant with cons not -2: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1435">1435</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1436">1436</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1437">1437</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DATA2 &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1438">1438</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (report_only) rtrue;</span></span>
<span class="tr"><span class="th" id="line1439">1439</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_CONSTRAINT = token--&gt;RE_DATA2;</span></span>
<span class="tr"><span class="th" id="line1440">1440</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;untried = true;</span></span>
<span class="tr"><span class="th" id="line1441">1441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1442">1442</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1443">1443</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1444">1444</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (untried) {</span></span>
<span class="tr"><span class="th" id="line1445">1445</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1446">1446</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;Grounds for rewind at: &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1447">1447</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugNode(token, ftxt, true);</span></span>
<span class="tr"><span class="th" id="line1448">1448</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1449">1449</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_EraseConstraints(token--&gt;RE_NEXT);</span></span>
<span class="tr"><span class="th" id="line1450">1450</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_EraseConstraints(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1451">1451</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1452">1452</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1453">1453</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (downwards) rfalse;</span></span>
<span class="tr"><span class="th" id="line1454">1454</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1455">1455</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1456">1456</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-fail-subexpressions">Fail Subexpressions.</h3><p><p> Here, an attempt to make a complicated match against the node in <span class="fixed">token</span> has failed: that means that any subexpressions which were matched in the course of the attempt must also in retrospect be considered unmatched. So we work down through the subtree at <span class="fixed">token</span> and empty any markers for subexpressions, which in effect clears their backslash variables &ndash; this is important as, otherwise, the contents left over could cause the alternative reading of the <span class="fixed">token</span> to be misparsed if it refers to the backslash variables in question. (If you think nobody would ever be crazy enough to write a regular expression like that, you haven&#39;t see Perl&#39;s test suite.)<p></p><p> If the <span class="fixed">downwards</span> flag is clear, it not only invalidates subexpression matches below the node but also to the right of the node &ndash; this is useful for a backtrack which runs back quite some distance.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1474">1474</span><span class="td">[ TEXT_TY_RE_FailSubexpressions token downwards;</span></span>
<span class="tr"><span class="th" id="line1475">1475</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (: token ~= NULL: token = token--&gt;RE_NEXT) {</span></span>
<span class="tr"><span class="th" id="line1476">1476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DOWN ~= NULL) TEXT_TY_RE_FailSubexpressions(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1477">1477</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_CCLASS == SUBEXP_RE_CC) {</span></span>
<span class="tr"><span class="th" id="line1478">1478</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA1 = -1;</span></span>
<span class="tr"><span class="th" id="line1479">1479</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token--&gt;RE_DATA2 = -1;</span></span>
<span class="tr"><span class="th" id="line1480">1480</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1481">1481</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (downwards) break;</span></span>
<span class="tr"><span class="th" id="line1482">1482</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1483">1483</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-erasing-constraints">Erasing Constraints.</h3><p><p> As explained above, temporary constraints are placed on some nodes when we are backtracking to test possible cases. When we do backtrack, though, it&#39;s important to lift any constraints left over from the previous attempt to parse material which is part of or subsequent to the token whose match attempt has been abandoned.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1493">1493</span><span class="td">[ TEXT_TY_RE_EraseConstraints token;</span></span>
<span class="tr"><span class="th" id="line1494">1494</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (token ~= NULL) {</span></span>
<span class="tr"><span class="th" id="line1495">1495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (token--&gt;RE_CCLASS) {</span></span>
<span class="tr"><span class="th" id="line1496">1496</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISJUNCTION_RE_CC: token--&gt;RE_CONSTRAINT = -1;</span></span>
<span class="tr"><span class="th" id="line1497">1497</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTIFIER_RE_CC: token--&gt;RE_CONSTRAINT = -1;</span></span>
<span class="tr"><span class="th" id="line1498">1498</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1499">1499</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (token--&gt;RE_DOWN) TEXT_TY_RE_EraseConstraints(token--&gt;RE_DOWN);</span></span>
<span class="tr"><span class="th" id="line1500">1500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;token = token--&gt;RE_NEXT;</span></span>
<span class="tr"><span class="th" id="line1501">1501</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1502">1502</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-matching-literal-text">Matching Literal Text.</h3><p><p> Here we attempt to make a match of the substring of the text <span class="fixed">mtxt</span> which runs from character <span class="fixed">mfrom</span> to character <span class="fixed">mto</span>, looking for it at the given position <span class="fixed">ipos</span> in the source text <span class="fixed">txt</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1510">1510</span><span class="td">[ TEXT_TY_RE_MatchSubstring txt ipos mtxt mfrom mto insens</span></span>
<span class="tr"><span class="th" id="line1511">1511</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i ch;</span></span>
<span class="tr"><span class="th" id="line1512">1512</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (mfrom &lt; 0) return 0;</span></span>
<span class="tr"><span class="th" id="line1513">1513</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (insens)</span></span>
<span class="tr"><span class="th" id="line1514">1514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=mfrom:i&lt;mto:i++) {</span></span>
<span class="tr"><span class="th" id="line1515">1515</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(mtxt, i);</span></span>
<span class="tr"><span class="th" id="line1516">1516</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(txt, ipos++) ~= ch or TEXT_TY_RevCase(ch))</span></span>
<span class="tr"><span class="th" id="line1517">1517</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -1;</span></span>
<span class="tr"><span class="th" id="line1518">1518</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1519">1519</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1520">1520</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=mfrom:i&lt;mto:i++)</span></span>
<span class="tr"><span class="th" id="line1521">1521</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueRead(txt, ipos++) ~= BlkValueRead(mtxt, i))</span></span>
<span class="tr"><span class="th" id="line1522">1522</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return -1;</span></span>
<span class="tr"><span class="th" id="line1523">1523</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return mto-mfrom;</span></span>
<span class="tr"><span class="th" id="line1524">1524</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-matching-character-range">Matching Character Range.</h3><p><p> Suppose that a character range is stored in <span class="fixed">ftxt</span> between the character positions <span class="fixed">rf</span> and <span class="fixed">rt</span>. Then <span class="fixed"><a href="./RegExp.i6t.html#line1534">TEXT_TY_RE_Range(ch, ftxt, rf, rt, negate, insens)</a></span> tests whether a given character <span class="fixed">ch</span> lies within that character range, negating the outcome if <span class="fixed">negate</span> is set, and performing comparisons case insensitively if <span class="fixed">insens</span> is set.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1534">1534</span><span class="td">[ TEXT_TY_RE_Range ch ftxt rf rt negate insens</span></span>
<span class="tr"><span class="th" id="line1535">1535</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i chm upper crev;</span></span>
<span class="tr"><span class="th" id="line1536">1536</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 0) rfalse;</span></span>
<span class="tr"><span class="th" id="line1537">1537</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (negate == true) {</span></span>
<span class="tr"><span class="th" id="line1538">1538</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Range(ch, ftxt, rf, rt, false, insens)) rfalse;</span></span>
<span class="tr"><span class="th" id="line1539">1539</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line1540">1540</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1541">1541</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (i=rf: i&lt;rt: i++) {</span></span>
<span class="tr"><span class="th" id="line1542">1542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chm = BlkValueRead(ftxt, i);</span></span>
<span class="tr"><span class="th" id="line1543">1543</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((chm == <span class="sstring">&#39;\&#39;</span>) &amp;&amp; (i+1&lt;rt)) {</span></span>
<span class="tr"><span class="th" id="line1544">1544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chm = BlkValueRead(ftxt, ++i);</span></span>
<span class="tr"><span class="th" id="line1545">1545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch (chm) {</span></span>
<span class="tr"><span class="th" id="line1546">1546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;s&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1547">1547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 10 or 13 or 32 or 9) rtrue;</span></span>
<span class="tr"><span class="th" id="line1548">1548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;S&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1549">1549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= 10 or 13 or 32 or 9)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1550">1550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;p&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1551">1551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1552">1552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1553">1553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) rtrue;</span></span>
<span class="tr"><span class="th" id="line1554">1554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;P&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1555">1555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1556">1556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1557">1557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1558">1558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;w&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1559">1559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1560">1560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1561">1561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1562">1562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1563">1563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;W&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1564">1564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == 10 or 13 or 32 or 9</span></span>
<span class="tr"><span class="th" id="line1565">1565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;.&#39;</span> or <span class="sstring">&#39;,&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;?&#39;</span></span></span>
<span class="tr"><span class="th" id="line1566">1566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;-&#39;</span> or <span class="sstring">&#39;/&#39;</span> or <span class="sstring">&#39;&#39;</span> or <span class="sstring">&#39;:&#39;</span> or <span class="sstring">&#39;;&#39;</span></span></span>
<span class="tr"><span class="th" id="line1567">1567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;(&#39;</span> or <span class="sstring">&#39;)&#39;</span> or <span class="sstring">&#39;[&#39;</span> or <span class="sstring">&#39;]&#39;</span> or <span class="sstring">&#39;{&#39;</span> or <span class="sstring">&#39;}&#39;</span>) rtrue;</span></span>
<span class="tr"><span class="th" id="line1568">1568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;d&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1569">1569</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;0&#39;</span> or <span class="sstring">&#39;1&#39;</span> or <span class="sstring">&#39;2&#39;</span> or <span class="sstring">&#39;3&#39;</span> or <span class="sstring">&#39;4&#39;</span></span></span>
<span class="tr"><span class="th" id="line1570">1570</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;5&#39;</span> or <span class="sstring">&#39;6&#39;</span> or <span class="sstring">&#39;7&#39;</span> or <span class="sstring">&#39;8&#39;</span> or <span class="sstring">&#39;9&#39;</span>) rtrue;</span></span>
<span class="tr"><span class="th" id="line1571">1571</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;D&#39;</span>:</span></span>
<span class="tr"><span class="th" id="line1572">1572</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch) &amp;&amp; (ch ~= <span class="sstring">&#39;0&#39;</span> or <span class="sstring">&#39;1&#39;</span> or <span class="sstring">&#39;2&#39;</span> or <span class="sstring">&#39;3&#39;</span> or <span class="sstring">&#39;4&#39;</span></span></span>
<span class="tr"><span class="th" id="line1573">1573</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or <span class="sstring">&#39;5&#39;</span> or <span class="sstring">&#39;6&#39;</span> or <span class="sstring">&#39;7&#39;</span> or <span class="sstring">&#39;8&#39;</span> or <span class="sstring">&#39;9&#39;</span>)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1574">1574</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;l&#39;</span>: if (CharIsOfCase(ch, 0)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1575">1575</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;L&#39;</span>: if (CharIsOfCase(ch, 0) == false) rtrue;</span></span>
<span class="tr"><span class="th" id="line1576">1576</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;u&#39;</span>: if (CharIsOfCase(ch, 1)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1577">1577</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;U&#39;</span>: if (CharIsOfCase(ch, 1) == false) rtrue;</span></span>
<span class="tr"><span class="th" id="line1578">1578</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;n&#39;</span>: if (ch == 10) rtrue;</span></span>
<span class="tr"><span class="th" id="line1579">1579</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sstring">&#39;t&#39;</span>: if (ch == 9) rtrue;</span></span>
<span class="tr"><span class="th" id="line1580">1580</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1581">1581</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1582">1582</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((i+2&lt;rt) &amp;&amp; (BlkValueRead(ftxt, i+1) == <span class="sstring">&#39;-&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line1583">1583</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upper = BlkValueRead(ftxt, i+2);</span></span>
<span class="tr"><span class="th" id="line1584">1584</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch &gt;= chm) &amp;&amp; (ch &lt;= upper)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1585">1585</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (insens) {</span></span>
<span class="tr"><span class="th" id="line1586">1586</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;crev = TEXT_TY_RevCase(ch);</span></span>
<span class="tr"><span class="th" id="line1587">1587</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((crev &gt;= chm) &amp;&amp; (crev &lt;= upper)) rtrue;</span></span>
<span class="tr"><span class="th" id="line1588">1588</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1589">1589</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i=i+2;</span></span>
<span class="tr"><span class="th" id="line1590">1590</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</span></span>
<span class="tr"><span class="th" id="line1591">1591</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (chm == ch) rtrue;</span></span>
<span class="tr"><span class="th" id="line1592">1592</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((insens) &amp;&amp; (chm == TEXT_TY_RevCase(ch))) rtrue;</span></span>
<span class="tr"><span class="th" id="line1593">1593</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1594">1594</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1595">1595</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1596">1596</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line1597">1597</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-search-and-replace">Search And Replace.</h3><p><p> And finally, last but not least: the routine which searches an indexed text <span class="fixed">txt</span> trying to match it against <span class="fixed">ftxt</span>. If <span class="fixed">ftxtype</span> is set to <span class="fixed"><a href="./Text.i6t.html#line621">REGEXP_BLOB</a></span> then <span class="fixed">ftxt</span> is expected to be a regular expression such as <span class="fixed">ab+(c*de)?</span>, whereas if <span class="fixed">ftxtype</span> is <span class="fixed"><a href="./Text.i6t.html#line614">CHR_BLOB</a></span> then it is expected only to be a simple string of characters taken literally, such as <span class="fixed">frog</span>.<p></p><p> Each match found is replaced with the contents of <span class="fixed">rtxt</span>, except that if the blob type is <span class="fixed"><a href="./Text.i6t.html#line621">REGEXP_BLOB</a></span> then we recognise a few syntaxes as special: for instance, <span class="fixed">\2</span> expands to the value of subexpression 2 as it was matched &ndash; see <strong> Writing with Inform</strong> for details.<p></p><p> The optional argument <span class="fixed">insens</span> is a flag which, if set, causes the matching to be done case insensitively; the optional argument <span class="fixed">exactly</span>, if set, causes the matching to work only if the entire <span class="fixed">txt</span> is matched. (This is not especially useful with regular expressions, because the effect can equally be achieved by turning <span class="fixed">ab+c</span>, say, into <span class="fixed">^ab+c$</span>, but it is indeed useful where the blob type is <span class="fixed"><a href="./Text.i6t.html#line614">CHR_BLOB</a></span>.)<p></p><p> For an explanation of the use of the word &quot;blob&quot;, see <a href="./Text.i6t.html">Text.i6t</a>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1621">1621</span><span class="td">[ TEXT_TY_Replace_RE ftxtype txt ftxt rtxt insens exactly</span></span>
<span class="tr"><span class="th" id="line1622">1622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;r p p1 p2 cp cp1 cp2;</span></span>
<span class="tr"><span class="th" id="line1623">1623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;Find: &quot;; BlkValueDebug(ftxt); print &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line1624">1624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;Rep: &quot;; BlkValueDebug(rtxt); print &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line1625">1625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">!print &quot;In: &quot;; BlkValueDebug(txt); print &quot;^&quot;;</span></span></span>
<span class="tr"><span class="th" id="line1626">1626</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (rtxt == 0 or 1) { cp = txt--&gt;0; p = TEXT_TY_Temporarily_Transmute(txt); }</span></span>
<span class="tr"><span class="th" id="line1627">1627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else TEXT_TY_Transmute(txt);</span></span>
<span class="tr"><span class="th" id="line1628">1628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cp1 = ftxt--&gt;0; p1 = TEXT_TY_Temporarily_Transmute(ftxt);</span></span>
<span class="tr"><span class="th" id="line1629">1629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;cp2 = rtxt--&gt;0; p2 = TEXT_TY_Temporarily_Transmute(rtxt);</span></span>
<span class="tr"><span class="th" id="line1630">1630</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;r = TEXT_TY_Replace_REI(ftxtype, txt, ftxt, rtxt, insens, exactly);</span></span>
<span class="tr"><span class="th" id="line1631">1631</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Untransmute(ftxt, p1, cp1);</span></span>
<span class="tr"><span class="th" id="line1632">1632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Untransmute(rtxt, p2, cp2);</span></span>
<span class="tr"><span class="th" id="line1633">1633</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (rtxt == 0 or 1) TEXT_TY_Untransmute(txt, p, cp);</span></span>
<span class="tr"><span class="th" id="line1634">1634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return r;</span></span>
<span class="tr"><span class="th" id="line1635">1635</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line1636">1636</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1637">1637</span><span class="td">[ TEXT_TY_Replace_REI ftxtype txt ftxt rtxt insens exactly</span></span>
<span class="tr"><span class="th" id="line1638">1638</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ctxt csize ilen i cl mpos cpos ch chm;</span></span>
<span class="tr"><span class="th" id="line1639">1639</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1640">1640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;ilen = TEXT_TY_CharacterLength(txt);</span></span>
<span class="tr"><span class="th" id="line1641">1641</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1642">1642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_Err = 0;</span></span>
<span class="tr"><span class="th" id="line1643">1643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;switch (ftxtype) {</span></span>
<span class="tr"><span class="th" id="line1644">1644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REGEXP_BLOB: i = TEXT_TY_RE_CompileTree(ftxt, exactly);</span></span>
<span class="tr"><span class="th" id="line1645">1645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHR_BLOB: i = TEXT_TY_CHR_CompileTree(ftxt, exactly);</span></span>
<span class="tr"><span class="th" id="line1646">1646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default: <span class="dstring">&quot;*** bad ftxtype ***&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1647">1647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1648">1648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1649">1649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((i&lt;0) || (i&gt;RE_MAX_PACKETS)) {</span></span>
<span class="tr"><span class="th" id="line1650">1650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_Err = i;</span></span>
<span class="tr"><span class="th" id="line1651">1651</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;*** Regular expression error: &quot;</span>, (string) TEXT_TY_RE_Err, <span class="dstring">&quot; ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1652">1652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunTimeProblem(RTP_REGEXPSYNTAXERROR);</span></span>
<span class="tr"><span class="th" id="line1653">1653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</span></span>
<span class="tr"><span class="th" id="line1654">1654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1655">1655</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1656">1656</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1657">1657</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugTree(ftxt);</span></span>
<span class="tr"><span class="th" id="line1658">1658</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;(compiled to &quot;</span>, i, <span class="dstring">&quot; packets)^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1659">1659</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1660">1660</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1661">1661</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (ftxtype == REGEXP_BLOB) TEXT_TY_RE_EmptyMatchVars();</span></span>
<span class="tr"><span class="th" id="line1662">1662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;mpos = 0; chm = 0; cpos = 0;</span></span>
<span class="tr"><span class="th" id="line1663">1663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;while (TEXT_TY_RE_Parse(ftxt, txt, mpos, insens) &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1664">1664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chm++;</span></span>
<span class="tr"><span class="th" id="line1665">1665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1666">1666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1667">1667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;^*** Match &quot;</span>, chm, <span class="dstring">&quot; found (&quot;</span>, RE_PACKET_space--&gt;RE_DATA1, <span class="dstring">&quot;,&quot;</span>,</span></span>
<span class="tr"><span class="th" id="line1668">1668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RE_PACKET_space--&gt;RE_DATA2, <span class="dstring">&quot;): &quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1669">1669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (RE_PACKET_space--&gt;RE_DATA1 == RE_PACKET_space--&gt;RE_DATA2) {</span></span>
<span class="tr"><span class="th" id="line1670">1670</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;&lt;empty&gt;&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1671">1671</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1672">1672</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=RE_PACKET_space--&gt;RE_DATA1:i&lt;RE_PACKET_space--&gt;RE_DATA2:i++) {</span></span>
<span class="tr"><span class="th" id="line1673">1673</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print (char) BlkValueRead(txt, i);</span></span>
<span class="tr"><span class="th" id="line1674">1674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1675">1675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot; ***^&quot;</span>;</span></span>
<span class="tr"><span class="th" id="line1676">1676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1677">1677</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1678">1678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rtxt == 0) break; <span class="comment">! Accept only one match, replace nothing</span></span></span>
<span class="tr"><span class="th" id="line1679">1679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1680">1680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rtxt ~= 0 or 1) {</span></span>
<span class="tr"><span class="th" id="line1681">1681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (chm == 1) {</span></span>
<span class="tr"><span class="th" id="line1682">1682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctxt = BlkValueCreate(TEXT_TY);</span></span>
<span class="tr"><span class="th" id="line1683">1683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Transmute(ctxt);</span></span>
<span class="tr"><span class="th" id="line1684">1684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize = BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1685">1685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1686">1686</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1687">1687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=cpos:i&lt;RE_PACKET_space--&gt;RE_DATA1:i++) {</span></span>
<span class="tr"><span class="th" id="line1688">1688</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(txt, i);</span></span>
<span class="tr"><span class="th" id="line1689">1689</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cl+1 &gt;= csize) {</span></span>
<span class="tr"><span class="th" id="line1690">1690</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueSetLBCapacity(ctxt, 2*cl) == false) break;</span></span>
<span class="tr"><span class="th" id="line1691">1691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize = BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1692">1692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1693">1693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt, cl++, ch);</span></span>
<span class="tr"><span class="th" id="line1694">1694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1695">1695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt, cl, 0);</span></span>
<span class="tr"><span class="th" id="line1696">1696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1697">1697</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Concatenate(ctxt, rtxt, ftxtype, txt);</span></span>
<span class="tr"><span class="th" id="line1698">1698</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize = BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1699">1699</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cl = TEXT_TY_CharacterLength(ctxt);            </span></span>
<span class="tr"><span class="th" id="line1700">1700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1701">1701</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1702">1702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mpos = RE_PACKET_space--&gt;RE_DATA2; cpos = mpos;</span></span>
<span class="tr"><span class="th" id="line1703">1703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (RE_PACKET_space--&gt;RE_DATA1 == RE_PACKET_space--&gt;RE_DATA2)</span></span>
<span class="tr"><span class="th" id="line1704">1704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mpos++;</span></span>
<span class="tr"><span class="th" id="line1705">1705</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1706">1706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace) {</span></span>
<span class="tr"><span class="th" id="line1707">1707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (chm == 100) { <span class="comment">! Purely to keep the output from being excessive</span></span></span>
<span class="tr"><span class="th" id="line1708">1708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print <span class="dstring">&quot;(Stopping after 100 matches.)^&quot;</span>; break;</span></span>
<span class="tr"><span class="th" id="line1709">1709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1710">1710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1711">1711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1712">1712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if (chm &gt; 0) {</span></span>
<span class="tr"><span class="th" id="line1713">1713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rtxt ~= 0 or 1) {</span></span>
<span class="tr"><span class="th" id="line1714">1714</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=cpos:i&lt;ilen:i++) {</span></span>
<span class="tr"><span class="th" id="line1715">1715</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(txt, i);</span></span>
<span class="tr"><span class="th" id="line1716">1716</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (cl+1 &gt;= csize) {</span></span>
<span class="tr"><span class="th" id="line1717">1717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueSetLBCapacity(ctxt, 2*cl) == false) break;</span></span>
<span class="tr"><span class="th" id="line1718">1718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;csize = BlkValueLBCapacity(ctxt);</span></span>
<span class="tr"><span class="th" id="line1719">1719</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1720">1720</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt, cl++, ch);</span></span>
<span class="tr"><span class="th" id="line1721">1721</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1722">1722</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1723">1723</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1724">1724</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ftxtype == REGEXP_BLOB) {</span></span>
<span class="tr"><span class="th" id="line1725">1725</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_CreateMatchVars(txt);</span></span>
<span class="tr"><span class="th" id="line1726">1726</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (TEXT_TY_RE_Trace)</span></span>
<span class="tr"><span class="th" id="line1727">1727</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_RE_DebugMatchVars(txt);</span></span>
<span class="tr"><span class="th" id="line1728">1728</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1729">1729</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line1730">1730</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (rtxt ~= 0 or 1) {</span></span>
<span class="tr"><span class="th" id="line1731">1731</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(ctxt, cl, 0);</span></span>
<span class="tr"><span class="th" id="line1732">1732</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueCopy(txt, ctxt);    </span></span>
<span class="tr"><span class="th" id="line1733">1733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueFree(ctxt);</span></span>
<span class="tr"><span class="th" id="line1734">1734</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1735">1735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1736">1736</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return chm;</span></span>
<span class="tr"><span class="th" id="line1737">1737</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="regexp-concatenation">Concatenation.</h3><p><p> See the corresponding routine in <a href="./Text.i6t.html">Text.i6t</a>: this is a variation which handles the special syntaxes used in search-and-replace.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line1744">1744</span><span class="td">[ TEXT_TY_RE_Concatenate txt_to txt_from blobtype txt_ref</span></span>
<span class="tr"><span class="th" id="line1745">1745</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pos len ch i tosize x y case;</span></span>
<span class="tr"><span class="th" id="line1746">1746</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((txt_to==0) || (BlkValueWeakKind(txt_to) ~= TEXT_TY)) rfalse;</span></span>
<span class="tr"><span class="th" id="line1747">1747</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if ((txt_from==0) || (BlkValueWeakKind(txt_from) ~= TEXT_TY)) return txt_to;</span></span>
<span class="tr"><span class="th" id="line1748">1748</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pos = TEXT_TY_CharacterLength(txt_to);</span></span>
<span class="tr"><span class="th" id="line1749">1749</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;tosize = BlkValueLBCapacity(txt_to);</span></span>
<span class="tr"><span class="th" id="line1750">1750</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;len = TEXT_TY_CharacterLength(txt_from);</span></span>
<span class="tr"><span class="th" id="line1751">1751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for (i=0:i&lt;len:i++) {</span></span>
<span class="tr"><span class="th" id="line1752">1752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(txt_from, i);</span></span>
<span class="tr"><span class="th" id="line1753">1753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch == <span class="sstring">&#39;\&#39;</span>) &amp;&amp; (i &lt; len-1)) {</span></span>
<span class="tr"><span class="th" id="line1754">1754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(txt_from, ++i);</span></span>
<span class="tr"><span class="th" id="line1755">1755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;n&#39;</span>) ch = 10;</span></span>
<span class="tr"><span class="th" id="line1756">1756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;t&#39;</span>) ch = 9;</span></span>
<span class="tr"><span class="th" id="line1757">1757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case = -1;</span></span>
<span class="tr"><span class="th" id="line1758">1758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;l&#39;</span>) case = 0;</span></span>
<span class="tr"><span class="th" id="line1759">1759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch == <span class="sstring">&#39;u&#39;</span>) case = 1;</span></span>
<span class="tr"><span class="th" id="line1760">1760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (case &gt;= 0) ch = BlkValueRead(txt_from, ++i);</span></span>
<span class="tr"><span class="th" id="line1761">1761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ch &gt;= <span class="sstring">&#39;0&#39;</span>) &amp;&amp; (ch &lt;= <span class="sstring">&#39;9&#39;</span>)) {</span></span>
<span class="tr"><span class="th" id="line1762">1762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = ch - <span class="sstring">&#39;0&#39;</span>;</span></span>
<span class="tr"><span class="th" id="line1763">1763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ch &lt; RE_Subexpressions--&gt;10) {</span></span>
<span class="tr"><span class="th" id="line1764">1764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = (RE_Subexpressions--&gt;ch)--&gt;RE_DATA1;</span></span>
<span class="tr"><span class="th" id="line1765">1765</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y = (RE_Subexpressions--&gt;ch)--&gt;RE_DATA2;</span></span>
<span class="tr"><span class="th" id="line1766">1766</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (x &gt;= 0) {</span></span>
<span class="tr"><span class="th" id="line1767">1767</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (:x&lt;y:x++) {</span></span>
<span class="tr"><span class="th" id="line1768">1768</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch = BlkValueRead(txt_ref, x);</span></span>
<span class="tr"><span class="th" id="line1769">1769</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (pos+1 &gt;= tosize) {</span></span>
<span class="tr"><span class="th" id="line1770">1770</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueSetLBCapacity(txt_to, 2*tosize) == false) break;</span></span>
<span class="tr"><span class="th" id="line1771">1771</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tosize = BlkValueLBCapacity(txt_to);</span></span>
<span class="tr"><span class="th" id="line1772">1772</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1773">1773</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (case &gt;= 0)</span></span>
<span class="tr"><span class="th" id="line1774">1774</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(txt_to, pos++, CharToCase(ch, case));</span></span>
<span class="tr"><span class="th" id="line1775">1775</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line1776">1776</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(txt_to, pos++, ch);</span></span>
<span class="tr"><span class="th" id="line1777">1777</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1778">1778</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1779">1779</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1780">1780</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;</span></span>
<span class="tr"><span class="th" id="line1781">1781</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1782">1782</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
<span class="tr"><span class="th" id="line1783">1783</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1784">1784</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (pos+1 &gt;= tosize) {</span></span>
<span class="tr"><span class="th" id="line1785">1785</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (BlkValueSetLBCapacity(txt_to, 2*tosize) == false) break;</span></span>
<span class="tr"><span class="th" id="line1786">1786</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tosize = BlkValueLBCapacity(txt_to);</span></span>
<span class="tr"><span class="th" id="line1787">1787</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1788">1788</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(txt_to, pos++, ch);</span></span>
<span class="tr"><span class="th" id="line1789">1789</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line1790">1790</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;BlkValueWrite(txt_to, pos, 0);</span></span>
<span class="tr"><span class="th" id="line1791">1791</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return txt_to;</span></span>
<span class="tr"><span class="th" id="line1792">1792</span><span class="td">];</span></span>
</div><footer><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
