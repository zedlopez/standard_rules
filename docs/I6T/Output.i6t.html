<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Output</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 0 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 50rem; }
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: 1rem; margin-bottom: 2rem; }
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Index</a> &bull; <a href="./Introduction.html">Introduction</a></div><hr></header>
<div id="front_matter">
<h2><a href="./Output.i6t">Output.i6t</a></h2><h3>ICL Commands.</h3><p><p> The Inform Control Language is a mini-language for controlling the I6 compiler, able to set command-line switches, memory settings and so on. I6 ordinarily discards lines beginning with exclamation marks as comments, but at the very top of the file, lines beginning <span class="fixed">!%</span> are read as ICL commands: as soon as any line (including a blank line) doesn&#39;t have this signature, I6 exits ICL mode. So, basically, we&#39;d better do this here:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line17">17</span><span class="td">{-call:UseOptions::compile_icl_commands}</span></span>
</div><div class='text'>
<h3>Other Configuration.</h3><p><p> Setting the <span class="fixed"><a href="./Output.i6t.html#line25">Grammar__Version</a></span> constant is a rather creaky old way to tell the I6 compiler to use more detailed grammar tables: GV1 has not in fact been used since about 1994.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line25">25</span><span class="td">Constant&nbsp;Grammar__Version&nbsp;2;</span></span>
</div><div class='text'>
<h3>Identification.</h3><p><p> Both of the compiler and template layer, and of the story file to be produced.<p></p><p> The &quot;library&quot; identifying texts are now a little anachronistic, since the template layer is not strictly speaking an I6 library in the same way as the original: but it is surely the spiritual successor to 6/11N, so we may as well mark it 6/12N.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line36">36</span><span class="td">!&nbsp;This&nbsp;file&nbsp;was&nbsp;compiled&nbsp;by&nbsp;Inform&nbsp;7:&nbsp;the&nbsp;build&nbsp;number&nbsp;and&nbsp;version&nbsp;of&nbsp;the</span></span>
<span class="tr"><span class="th" id="line37">37</span><span class="td">!&nbsp;I6&nbsp;template&nbsp;layer&nbsp;used&nbsp;are&nbsp;as&nbsp;follows.</span></span>
<span class="tr"><span class="th" id="line38">38</span><span class="td">{-call:TemplateFiles::compile_build_number}</span></span>
<span class="tr"><span class="th" id="line39">39</span><span class="td">Constant&nbsp;LibSerial&nbsp;=&nbsp;&quot;080126&quot;;</span></span>
<span class="tr"><span class="th" id="line40">40</span><span class="td">Constant&nbsp;LibRelease&nbsp;=&nbsp;&quot;6/12N&quot;;</span></span>
<span class="tr"><span class="th" id="line41">41</span><span class="td">Constant&nbsp;LIBRARY_VERSION&nbsp;=&nbsp;612;</span></span>
<span class="tr"><span class="th" id="line42">42</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line43">43</span><span class="td">{-call:Plugins::Manage::define_IFDEF_symbols}</span></span>
<span class="tr"><span class="th" id="line44">44</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line45">45</span><span class="td">{-array:PL::Bibliographic::IFID::UUID_ARRAY}</span></span>
<span class="tr"><span class="th" id="line46">46</span><span class="td">{-call:PL::Bibliographic::compile_constants}</span></span>
<span class="tr"><span class="th" id="line47">47</span><span class="td">Default&nbsp;Story&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line48">48</span><span class="td">Default&nbsp;Headline&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line49">49</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line50">50</span><span class="td">{-routine:Extensions::Files::ShowExtensionVersions}</span></span>
</div><div class='text'>
<h3>Use options.</h3><p><p> Use options are translated into I6 constant declarations, and NI puts them here:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line57">57</span><span class="td">{-call:UseOptions::compile}</span></span>
<span class="tr"><span class="th" id="line58">58</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line59">59</span><span class="td">#Ifndef&nbsp;USE_SCORING;</span></span>
<span class="tr"><span class="th" id="line60">60</span><span class="td">Constant&nbsp;USE_SCORING&nbsp;=&nbsp;{-value:default_scoring_setting};</span></span>
<span class="tr"><span class="th" id="line61">61</span><span class="td">#Endif;</span></span>
</div><div class='text'>
<h3>Constants.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line66">66</span><span class="td">{-segment:<a&nbsp;href="./Definitions.html">Definitions.i6t</a>}</span></span>
</div><div class='text'>
<h3>Global Variables.</h3><p><p> These are not the only global variables defined in the template layer: those needed locally only by single sections (and not used in definitions of phrases in the Standard Rules, or referred to by NI directly) are defined within those sections &ndash; they can be regarded as unimportant implementation details, subject to change at whim. The variables here, on the other hand, are more important to understand.<p></p><p> (1) The first three variables to be defined are special in that they are significant to very early-style Z-machine interpreters, where they are used to produce the status line display (hence <span class="fixed"><a href="./Output.i6t.html#line170">sline1</a></span> and <span class="fixed">sline2</span>). The first variable must always equal a valid object number, which is why we &ndash; pretty weirdly &ndash; set it equal to the placeholder object <span class="fixed">InformLibrary</span>, which takes no part in play, and is not a valid I7 object. This is not typesafe in I7 terms, but that doesn&#39;t matter because initialisation will correct it to a typesafe value before any I7 source text can execute. (<span class="fixed"><a href="./Output.i6t.html#line170">sline1</a></span> and <span class="fixed">sline2</span> are entirely unused on when we target Glulx.) Once these variables are defined, the sequence of definition of the rest is not significant.<p></p><p> (2) The <span class="fixed">say__*</span> are used for the finite state machine used in printing text, which keeps track of automatic paragraph breaking and the like. For details see the <span class="fixed"><a href="./Printing.i6t.html">Printing.i6t</a></span> section.<p></p><p> (3) <span class="fixed"><a href="./Output.i6t.html#line198">standard_interpreter</a></span> is used only for the Z-machine VM, and is always 0 for Glulx. For Z, a non-zero value here is the version number of the <strong> Z-Machine Standards Document</strong> which the interpreter claims to support, in the form (upper byte).(lower). <span class="fixed"><a href="./Output.i6t.html#line199">undo_flag</a></span>, similarly, behaves slightly differently on the two platforms according to whether they support multiple consecutive UNDOs. UNDO basically works by taking memory snapshots of the whole VM (&quot;saving UNDO&quot;) to revert to at a later point (&quot;performing UNDO&quot;), so it is expensive on memory, and traditional VMs can only store a single memory snapshot &ndash; making two UNDOs in a row, going back two steps, impossible. Given this, <span class="fixed"><a href="./Output.i6t.html#line199">undo_flag</a></span> has three possible states: 0 means UNDO is not available at all, 1 means it is not available now because there is no further saved state to go back to from here, and 2 means it is available.<p></p><p> (4) <span class="fixed"><a href="./Output.i6t.html#line202">deadflag</a></span> in normally 0, or false, meaning play continues; 1 means the game ended in death; 2 for ended in victory; higher numbers represent exotic endings. (As from May 2010, the use of 2 for victory is deprecated, and a separate flag, <span class="fixed"><a href="./Output.i6t.html#line203">story_complete</a></span>, records whether the story is &quot;complete&quot; in the sense that we don&#39;t expect the player to replay.) <span class="fixed"><a href="./Output.i6t.html#line202">deadflag</a></span> switching state normally triggers an end to rulebook processing, so is the single most important global variable to the running of a story file.<p></p><p> (5) At present, <span class="fixed"><a href="./Output.i6t.html#line210">time_rate</a></span> is not made use of in I7: if positive, it is the number of minutes which pass each turn; if negative, the number of turns which pass each minute. This is quite a neat way to approximate a wide range of time steps with an integer such that fractions are exact and we can approximate any duration to a fair accuracy (the worst case being <em></em> minute, where we have to choose between 1 minute or <em></em> minute).<p></p><p> (6) Note that <span class="fixed"><a href="./Output.i6t.html#line223">notify_mode</a></span> is irrelevant if the use option &quot;Use no scoring&quot; is in force: it isn&#39;t looked at, and can&#39;t be changed, and shouldn&#39;t have an effect anyway since <span class="fixed"><a href="./Output.i6t.html#line221">score</a></span> will never be altered.<p></p><p> (7) <span class="fixed"><a href="./Output.i6t.html#line228">player</a></span> is a variable, not a constant, since the focus of play can change. <span class="fixed"><a href="./Output.i6t.html#line233">SACK_OBJECT</a></span> is likewise an unexpected variable: in the I6 library, there could only be one player&#39;s holdall, a single rucksack-like possession which had to be the value of the constant <span class="fixed"><a href="./Output.i6t.html#line233">SACK_OBJECT</a></span>. Here we define <span class="fixed"><a href="./Output.i6t.html#line233">SACK_OBJECT</a></span> as a global variable instead, the value of which is the player&#39;s holdall currently in use. <span class="fixed"><a href="./Output.i6t.html#line230">visibility_ceiling</a></span> is the highest object in the tree visible from the player&#39;s point of view: usually the room, but sometimes nothing (in darkness), and sometimes a closed non-transparent container.<p></p><p> (8) See <span class="fixed"><a href="./OrderOfPlay.i6t.html">OrderOfPlay.i6t</a></span> for the meaning of action variables.<p></p><p> (9) This is a slate of global variables used by the parser to give some context to the general parsing routines (GPRs) which it calls; in the I6 design, any object can provide its own GPR, in the form of a <span class="fixed">parse_name</span> property. GPRs are in effect parser plug-ins, and I7 makes extensive use of them.<p></p><p> (10) Similarly, variables for the parser to give context to another sort of plug-in routine: a scope filter. I7 uses these too.<p></p><p> (11) The <span class="fixed">move_*</span> variables are specific to the <span class="fixed">##Going</span> action.<p></p><p> (12) These variables hold current settings for listing objects and, more elaborately, performing room descriptions.<p></p><p> (13) The current colour scheme is stored in variables in order that it can be saved in the save game state, and changed correctly on an UNDO: if it were a transient state inside the VM interpreter&#39;s screen model, then a RESTORE or UNDO will upset what the original author may have intended the appearance of text in particular scenes to be. (Cf. Adam Cadre&#39;s I6 patch <span class="fixed">L61007</span>.)<p></p><p> (14) These pixel dimensions are used both for the Glulx and v6 Z-machines, but not for the more commonly used versions 5 or 8, whose screen model is based on character cells.<p></p><p> (15) For debugging. <span class="fixed"><a href="./Output.i6t.html#line346">debug_flag</a></span> is traditionally called so, but is actually now a bitmap of flags for tracing actions, calls to object routines, and so on.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line168">168</span><span class="td">!&nbsp;[1]</span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">Global&nbsp;location&nbsp;=&nbsp;InformLibrary;&nbsp;!&nbsp;does&nbsp;not&nbsp;=&nbsp;I7&nbsp;&quot;location&quot;:&nbsp;see&nbsp;below</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">Global&nbsp;sline1;&nbsp;Global&nbsp;sline2;</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td">!&nbsp;[2]</span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">Global&nbsp;say__p&nbsp;=&nbsp;1;&nbsp;Global&nbsp;say__pc&nbsp;=&nbsp;0;&nbsp;Global&nbsp;say__pc_save&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">Global&nbsp;say__n;&nbsp;Global&nbsp;say__comp;</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">Global&nbsp;los_rv&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">Global&nbsp;parameter_object;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;parameter-object&quot;&nbsp;=&nbsp;I7&nbsp;&quot;container&nbsp;in&nbsp;question&quot;</span></span>
<span class="tr"><span class="th" id="line177">177</span><span class="td">Global&nbsp;parameter_value;&nbsp;!&nbsp;not&nbsp;typesafe&nbsp;in&nbsp;I7</span></span>
<span class="tr"><span class="th" id="line178">178</span><span class="td">Array&nbsp;deferred_calling_list&nbsp;--&gt;&nbsp;27;</span></span>
<span class="tr"><span class="th" id="line179">179</span><span class="td">Global&nbsp;property_to_be_totalled;&nbsp;!&nbsp;used&nbsp;to&nbsp;implement&nbsp;&quot;total&nbsp;P&nbsp;of...&quot;</span></span>
<span class="tr"><span class="th" id="line180">180</span><span class="td">Global&nbsp;property_loop_sign;&nbsp;!&nbsp;$+1$&nbsp;for&nbsp;increasing&nbsp;order,&nbsp;$-1$&nbsp;for&nbsp;decreasing</span></span>
<span class="tr"><span class="th" id="line181">181</span><span class="td">Global&nbsp;suppress_scope_loops;</span></span>
<span class="tr"><span class="th" id="line182">182</span><span class="td">Global&nbsp;temporary_value;&nbsp;!&nbsp;can&nbsp;be&nbsp;used&nbsp;anywhere&nbsp;side-effects&nbsp;can&#39;t&nbsp;occur</span></span>
<span class="tr"><span class="th" id="line183">183</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line184">184</span><span class="td">#ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line185">185</span><span class="td">Constant&nbsp;BLOCKV_STACK_SIZE&nbsp;=&nbsp;224;</span></span>
<span class="tr"><span class="th" id="line186">186</span><span class="td">#ifnot;</span></span>
<span class="tr"><span class="th" id="line187">187</span><span class="td">Constant&nbsp;BLOCKV_STACK_SIZE&nbsp;=&nbsp;DynamicMemoryAllocation/4;</span></span>
<span class="tr"><span class="th" id="line188">188</span><span class="td">#endif;</span></span>
<span class="tr"><span class="th" id="line189">189</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line190">190</span><span class="td">Array&nbsp;blockv_stack&nbsp;--&gt;&nbsp;BLOCKV_STACK_SIZE;</span></span>
<span class="tr"><span class="th" id="line191">191</span><span class="td">Global&nbsp;I7SFRAME;</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">Global&nbsp;TEXT_TY_RE_Err&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">Array&nbsp;LocalParking&nbsp;--&gt;&nbsp;64;</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td">!&nbsp;[3]</span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">Global&nbsp;standard_interpreter&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">Global&nbsp;undo_flag;</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">!&nbsp;[4]</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td">Global&nbsp;deadflag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">Global&nbsp;story_complete&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">Global&nbsp;resurrect_please&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">!&nbsp;[5]</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td">Global&nbsp;not_yet_in_play&nbsp;=&nbsp;true;&nbsp;!&nbsp;set&nbsp;false&nbsp;when&nbsp;first&nbsp;command&nbsp;received</span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">Global&nbsp;turns&nbsp;=&nbsp;1;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;turn&nbsp;count&quot;</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">Global&nbsp;the_time&nbsp;=&nbsp;NULL;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;time&nbsp;of&nbsp;day&quot;</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">Global&nbsp;time_rate&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">Constant&nbsp;NUMBER_SCENES_CREATED&nbsp;=&nbsp;{-value:NUMBER_CREATED(scene)};</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">Constant&nbsp;SCENE_ARRAY_SIZE&nbsp;=&nbsp;(NUMBER_SCENES_CREATED+2);</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td">Array&nbsp;scene_started&nbsp;--&gt;&nbsp;SCENE_ARRAY_SIZE;</span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">Array&nbsp;scene_ended&nbsp;--&gt;&nbsp;SCENE_ARRAY_SIZE;</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">Array&nbsp;scene_status&nbsp;--&gt;&nbsp;SCENE_ARRAY_SIZE;</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">Array&nbsp;scene_endings&nbsp;--&gt;&nbsp;SCENE_ARRAY_SIZE;</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">Array&nbsp;scene_latest_ending&nbsp;--&gt;&nbsp;SCENE_ARRAY_SIZE;</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td">!&nbsp;[6]</span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">Global&nbsp;score;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;score&quot;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">Global&nbsp;last_score;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;last&nbsp;notified&nbsp;score&quot;</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">Global&nbsp;notify_mode&nbsp;=&nbsp;1;&nbsp;!&nbsp;score&nbsp;notification&nbsp;on&nbsp;or&nbsp;off</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">Global&nbsp;left_hand_status_line&nbsp;=&nbsp;T_SL_Location;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;left&nbsp;hand&nbsp;status&nbsp;line&quot;</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">Global&nbsp;right_hand_status_line&nbsp;=&nbsp;T_SL_Score_Moves;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;right&nbsp;hand&nbsp;status&nbsp;line&quot;</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td">!&nbsp;[7]</span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">Global&nbsp;player;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;player&quot;</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">Global&nbsp;real_location;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;location&quot;</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">Global&nbsp;visibility_ceiling;&nbsp;!&nbsp;highest&nbsp;object&nbsp;in&nbsp;tree&nbsp;visible&nbsp;to&nbsp;player</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">Global&nbsp;visibility_levels;&nbsp;!&nbsp;distance&nbsp;in&nbsp;tree&nbsp;to&nbsp;that</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">Global&nbsp;SACK_OBJECT;&nbsp;!&nbsp;current&nbsp;player&#39;s&nbsp;holdall&nbsp;item&nbsp;in&nbsp;use</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line235">235</span><span class="td">!&nbsp;[8]</span></span>
<span class="tr"><span class="th" id="line236">236</span><span class="td">Global&nbsp;act_requester;</span></span>
<span class="tr"><span class="th" id="line237">237</span><span class="td">Global&nbsp;actor;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;person&nbsp;asked&quot;&nbsp;=&nbsp;I7&nbsp;&quot;person&nbsp;reaching&quot;</span></span>
<span class="tr"><span class="th" id="line238">238</span><span class="td">Global&nbsp;actors_location;&nbsp;!&nbsp;like&nbsp;real_location,&nbsp;but&nbsp;for&nbsp;the&nbsp;actor</span></span>
<span class="tr"><span class="th" id="line239">239</span><span class="td">Global&nbsp;actor_location;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;actor-location&quot;</span></span>
<span class="tr"><span class="th" id="line240">240</span><span class="td">Global&nbsp;action;</span></span>
<span class="tr"><span class="th" id="line241">241</span><span class="td">Global&nbsp;meta;&nbsp;!&nbsp;action&nbsp;is&nbsp;out&nbsp;of&nbsp;world</span></span>
<span class="tr"><span class="th" id="line242">242</span><span class="td">Global&nbsp;inp1;</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">Global&nbsp;inp2;</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td">Array&nbsp;&nbsp;multiple_object&nbsp;--&gt;&nbsp;MATCH_LIST_WORDS;&nbsp;!&nbsp;multiple-object&nbsp;list&nbsp;(I6&nbsp;table&nbsp;array)</span></span>
<span class="tr"><span class="th" id="line245">245</span><span class="td">Global&nbsp;toomany_flag;&nbsp;!&nbsp;multiple-object&nbsp;list&nbsp;overflowed</span></span>
<span class="tr"><span class="th" id="line246">246</span><span class="td">Global&nbsp;multiflag;&nbsp;!&nbsp;multiple-object&nbsp;being&nbsp;processed</span></span>
<span class="tr"><span class="th" id="line247">247</span><span class="td">Global&nbsp;multiple_object_item;&nbsp;!&nbsp;item&nbsp;currently&nbsp;being&nbsp;processed&nbsp;in&nbsp;multiple-object&nbsp;list</span></span>
<span class="tr"><span class="th" id="line248">248</span><span class="td">Global&nbsp;noun;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;noun&quot;</span></span>
<span class="tr"><span class="th" id="line249">249</span><span class="td">Global&nbsp;second;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;second&nbsp;noun&quot;</span></span>
<span class="tr"><span class="th" id="line250">250</span><span class="td">Global&nbsp;keep_silent;&nbsp;!&nbsp;true&nbsp;if&nbsp;current&nbsp;action&nbsp;is&nbsp;being&nbsp;tried&nbsp;silently</span></span>
<span class="tr"><span class="th" id="line251">251</span><span class="td">Global&nbsp;etype;&nbsp;!&nbsp;parser&nbsp;error&nbsp;number&nbsp;if&nbsp;command&nbsp;not&nbsp;recognised</span></span>
<span class="tr"><span class="th" id="line252">252</span><span class="td">Global&nbsp;trace_actions&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line253">253</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line254">254</span><span class="td">Global&nbsp;untouchable_object;</span></span>
<span class="tr"><span class="th" id="line255">255</span><span class="td">Global&nbsp;untouchable_silence;</span></span>
<span class="tr"><span class="th" id="line256">256</span><span class="td">Global&nbsp;touch_persona;</span></span>
<span class="tr"><span class="th" id="line257">257</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line258">258</span><span class="td">Global&nbsp;special_word;&nbsp;!&nbsp;dictionary&nbsp;address&nbsp;of&nbsp;first&nbsp;word&nbsp;in&nbsp;&quot;[text]&quot;&nbsp;token</span></span>
<span class="tr"><span class="th" id="line259">259</span><span class="td">Global&nbsp;consult_from;&nbsp;!&nbsp;word&nbsp;number&nbsp;of&nbsp;start&nbsp;of&nbsp;&quot;[text]&quot;&nbsp;token</span></span>
<span class="tr"><span class="th" id="line260">260</span><span class="td">Global&nbsp;consult_words;&nbsp;!&nbsp;number&nbsp;of&nbsp;words&nbsp;in&nbsp;&quot;[text]&quot;&nbsp;token</span></span>
<span class="tr"><span class="th" id="line261">261</span><span class="td">Global&nbsp;parsed_number;&nbsp;!&nbsp;value&nbsp;from&nbsp;any&nbsp;token&nbsp;not&nbsp;an&nbsp;object</span></span>
<span class="tr"><span class="th" id="line262">262</span><span class="td">Global&nbsp;special_number1;&nbsp;!&nbsp;first&nbsp;value,&nbsp;if&nbsp;token&nbsp;not&nbsp;an&nbsp;object</span></span>
<span class="tr"><span class="th" id="line263">263</span><span class="td">Global&nbsp;special_number2;&nbsp;!&nbsp;second&nbsp;value,&nbsp;if&nbsp;token&nbsp;not&nbsp;an&nbsp;object</span></span>
<span class="tr"><span class="th" id="line264">264</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line265">265</span><span class="td">Array&nbsp;&nbsp;parser_results&nbsp;--&gt;&nbsp;16;&nbsp;!&nbsp;for&nbsp;parser&nbsp;to&nbsp;write&nbsp;its&nbsp;results&nbsp;in</span></span>
<span class="tr"><span class="th" id="line266">266</span><span class="td">Global&nbsp;parser_trace&nbsp;=&nbsp;0;&nbsp;!&nbsp;normally&nbsp;0,&nbsp;but&nbsp;1&nbsp;to&nbsp;5&nbsp;traces&nbsp;parser&nbsp;workings</span></span>
<span class="tr"><span class="th" id="line267">267</span><span class="td">Global&nbsp;pronoun_word;&nbsp;!&nbsp;records&nbsp;which&nbsp;pronoun&nbsp;(&quot;it&quot;,&nbsp;&quot;them&quot;,&nbsp;...)&nbsp;caused&nbsp;an&nbsp;error</span></span>
<span class="tr"><span class="th" id="line268">268</span><span class="td">Global&nbsp;pronoun_obj;&nbsp;!&nbsp;and&nbsp;what&nbsp;object&nbsp;it&nbsp;was&nbsp;thought&nbsp;to&nbsp;refer&nbsp;to</span></span>
<span class="tr"><span class="th" id="line269">269</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line270">270</span><span class="td">Global&nbsp;players_command&nbsp;=&nbsp;100;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;player&#39;s&nbsp;command&quot;</span></span>
<span class="tr"><span class="th" id="line271">271</span><span class="td">Global&nbsp;matched_text;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;matched&nbsp;text&quot;</span></span>
<span class="tr"><span class="th" id="line272">272</span><span class="td">Global&nbsp;reason_the_action_failed;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;reason&nbsp;the&nbsp;action&nbsp;failed&quot;</span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td">Global&nbsp;understand_as_mistake_number;&nbsp;!&nbsp;which&nbsp;form&nbsp;of&nbsp;&quot;Understand...&nbsp;as&nbsp;a&nbsp;mistake&quot;</span></span>
<span class="tr"><span class="th" id="line274">274</span><span class="td">Global&nbsp;particular_possession;&nbsp;!&nbsp;=&nbsp;I7&nbsp;&quot;particular&nbsp;possession&quot;</span></span>
<span class="tr"><span class="th" id="line275">275</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td">!&nbsp;[9]</span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">Global&nbsp;parser_action;&nbsp;!&nbsp;written&nbsp;by&nbsp;the&nbsp;parser&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;GPRs</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">Global&nbsp;parser_one;</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">Global&nbsp;parser_two;</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">Global&nbsp;parameters;&nbsp;!&nbsp;number&nbsp;of&nbsp;I7&nbsp;tokens&nbsp;parsed&nbsp;on&nbsp;the&nbsp;current&nbsp;line</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">Global&nbsp;action_to_be;&nbsp;!&nbsp;(if&nbsp;the&nbsp;current&nbsp;line&nbsp;were&nbsp;accepted)</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">Global&nbsp;action_reversed;&nbsp;!&nbsp;(parameters&nbsp;would&nbsp;be&nbsp;reversed&nbsp;in&nbsp;order)</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">Global&nbsp;wn;&nbsp;!&nbsp;word&nbsp;number&nbsp;within&nbsp;&quot;parse&quot;&nbsp;buffer&nbsp;(from&nbsp;1)</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">Global&nbsp;num_words;&nbsp;!&nbsp;number&nbsp;of&nbsp;words&nbsp;in&nbsp;buffer</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td">Global&nbsp;verb_word;&nbsp;!&nbsp;dictionary&nbsp;address&nbsp;of&nbsp;command&nbsp;verb</span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">Global&nbsp;verb_wordnum;&nbsp;!&nbsp;word&nbsp;number&nbsp;of&nbsp;command&nbsp;verb</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">!&nbsp;[10]</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td">Global&nbsp;scope_reason&nbsp;=&nbsp;PARSING_REASON;&nbsp;!&nbsp;current&nbsp;reason&nbsp;for&nbsp;searching&nbsp;scope</span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">Global&nbsp;scope_token;&nbsp;!&nbsp;for&nbsp;&quot;scope=Routine&quot;&nbsp;grammar&nbsp;tokens</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">Global&nbsp;scope_error;</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">Global&nbsp;scope_stage;&nbsp;!&nbsp;1,&nbsp;2&nbsp;then&nbsp;3</span></span>
<span class="tr"><span class="th" id="line293">293</span><span class="td">Global&nbsp;advance_warning;&nbsp;!&nbsp;what&nbsp;a&nbsp;later-named&nbsp;thing&nbsp;will&nbsp;be</span></span>
<span class="tr"><span class="th" id="line294">294</span><span class="td">Global&nbsp;reason_code&nbsp;=&nbsp;NULL;&nbsp;!&nbsp;for&nbsp;the&nbsp;I6&nbsp;veneer</span></span>
<span class="tr"><span class="th" id="line295">295</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line296">296</span><span class="td">Global&nbsp;ats_flag&nbsp;=&nbsp;0;&nbsp;!&nbsp;for&nbsp;AddToScope&nbsp;routines</span></span>
<span class="tr"><span class="th" id="line297">297</span><span class="td">Global&nbsp;ats_hls;</span></span>
<span class="tr"><span class="th" id="line298">298</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line299">299</span><span class="td">!&nbsp;[11]</span></span>
<span class="tr"><span class="th" id="line300">300</span><span class="td">Global&nbsp;move_pushing;</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">Global&nbsp;move_from;</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">Global&nbsp;move_to;</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">Global&nbsp;move_by;</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">Global&nbsp;move_through;</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">!&nbsp;[12]</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">#Ifdef&nbsp;DEFAULT_BRIEF_DESCRIPTIONS;</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">Global&nbsp;lookmode&nbsp;=&nbsp;1;&nbsp;!&nbsp;1&nbsp;=&nbsp;BRIEF,&nbsp;2&nbsp;=&nbsp;VERBOSE,&nbsp;3&nbsp;=&nbsp;SUPERBRIEF</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">#Ifdef&nbsp;DEFAULT_VERBOSE_DESCRIPTIONS;&nbsp;</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">Global&nbsp;lookmode&nbsp;=&nbsp;2;&nbsp;!&nbsp;1&nbsp;=&nbsp;BRIEF,&nbsp;2&nbsp;=&nbsp;VERBOSE,&nbsp;3&nbsp;=&nbsp;SUPERBRIEF</span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line313">313</span><span class="td">#Ifdef&nbsp;DEFAULT_SUPERBRIEF_DESCRIPTIONS;&nbsp;</span></span>
<span class="tr"><span class="th" id="line314">314</span><span class="td">Global&nbsp;lookmode&nbsp;=&nbsp;3;&nbsp;!&nbsp;1&nbsp;=&nbsp;BRIEF,&nbsp;2&nbsp;=&nbsp;VERBOSE,&nbsp;3&nbsp;=&nbsp;SUPERBRIEF</span></span>
<span class="tr"><span class="th" id="line315">315</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line316">316</span><span class="td">#Ifndef&nbsp;lookmode;</span></span>
<span class="tr"><span class="th" id="line317">317</span><span class="td">Global&nbsp;lookmode&nbsp;=&nbsp;2;&nbsp;!&nbsp;1&nbsp;=&nbsp;BRIEF,&nbsp;2&nbsp;=&nbsp;VERBOSE,&nbsp;3&nbsp;=&nbsp;SUPERBRIEF</span></span>
<span class="tr"><span class="th" id="line318">318</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line319">319</span><span class="td">Global&nbsp;c_style;&nbsp;!&nbsp;current&nbsp;list-writer&nbsp;style</span></span>
<span class="tr"><span class="th" id="line320">320</span><span class="td">Global&nbsp;c_depth;&nbsp;!&nbsp;current&nbsp;recursion&nbsp;depth</span></span>
<span class="tr"><span class="th" id="line321">321</span><span class="td">Global&nbsp;c_iterator;&nbsp;!&nbsp;current&nbsp;iteration&nbsp;function</span></span>
<span class="tr"><span class="th" id="line322">322</span><span class="td">Global&nbsp;lt_value&nbsp;=&nbsp;EMPTY_TEXT_VALUE;&nbsp;!&nbsp;common&nbsp;value&nbsp;of&nbsp;list_together</span></span>
<span class="tr"><span class="th" id="line323">323</span><span class="td">Global&nbsp;listing_together;&nbsp;!&nbsp;object&nbsp;number&nbsp;of&nbsp;one&nbsp;member&nbsp;of&nbsp;a&nbsp;group&nbsp;being&nbsp;listed&nbsp;together</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">Global&nbsp;listing_size;&nbsp;!&nbsp;size&nbsp;of&nbsp;such&nbsp;a&nbsp;group</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">Global&nbsp;c_margin;&nbsp;!&nbsp;current&nbsp;level&nbsp;of&nbsp;indentation&nbsp;printed&nbsp;by&nbsp;WriteListFrom()</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">Global&nbsp;inventory_stage&nbsp;=&nbsp;1;&nbsp;!&nbsp;1&nbsp;or&nbsp;2&nbsp;according&nbsp;to&nbsp;the&nbsp;context&nbsp;in&nbsp;which&nbsp;list_together&nbsp;uses</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">Global&nbsp;prior_named_noun;&nbsp;!&nbsp;for&nbsp;adaptive&nbsp;text&nbsp;generation</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td">Global&nbsp;prior_named_list;&nbsp;!&nbsp;ditto:&nbsp;length&nbsp;of&nbsp;list&nbsp;of&nbsp;items</span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">Global&nbsp;prior_named_list_gender;&nbsp;!&nbsp;ditto:&nbsp;common&nbsp;gender&nbsp;of&nbsp;list&nbsp;of&nbsp;items,&nbsp;or&nbsp;-1</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">Global&nbsp;story_tense&nbsp;=&nbsp;1;&nbsp;!&nbsp;ditto:&nbsp;present&nbsp;tense</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">Global&nbsp;story_viewpoint&nbsp;=&nbsp;2;&nbsp;!&nbsp;ditto:&nbsp;second&nbsp;person&nbsp;singular</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">!&nbsp;[13]</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">Global&nbsp;clr_fg&nbsp;=&nbsp;1;&nbsp;!&nbsp;foreground&nbsp;colour</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">Global&nbsp;clr_bg&nbsp;=&nbsp;1;&nbsp;!&nbsp;background&nbsp;colour</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">Global&nbsp;clr_fgstatus&nbsp;=&nbsp;1;&nbsp;!&nbsp;foreground&nbsp;colour&nbsp;of&nbsp;statusline</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">Global&nbsp;clr_bgstatus&nbsp;=&nbsp;1;&nbsp;!&nbsp;background&nbsp;colour&nbsp;of&nbsp;statusline</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">Global&nbsp;clr_on;&nbsp;!&nbsp;has&nbsp;colour&nbsp;been&nbsp;enabled&nbsp;by&nbsp;the&nbsp;player?</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">Global&nbsp;statuswin_current;&nbsp;!&nbsp;if&nbsp;writing&nbsp;to&nbsp;top&nbsp;window</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">!&nbsp;[14]</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">Global&nbsp;statuswin_cursize&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">Global&nbsp;statuswin_size&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">!&nbsp;[16]</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">Global&nbsp;debug_flag&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">Global&nbsp;debug_rules&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">Global&nbsp;debug_scenes&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">Global&nbsp;debug_rule_nesting;</span></span>
</div><div class='text'>
<h3>VM-Specific Code.</h3><p><p> These sections of code contain different definitions of the same routines, and in some cases the same arrays, to handle low-level functions in the virtual machine &ndash; saving the game, performing UNDO, parsing typed text into dictionary word addresses and so on.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line358">358</span><span class="td">#Ifdef&nbsp;TARGET_GLULX;</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td">{-segment:<a&nbsp;href="./Glulx.html">Glulx.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">{-segment:<a&nbsp;href="./ZMachine.html">ZMachine.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td">#Endif;</span></span>
</div><div class='text'>
<h3>Compass.</h3><p><p> I6 identified compass directions as being children of the pseudo-object <span class="fixed">Compass</span>, so we define it. (Note that <span class="fixed">Compass</span> is not a valid I7 object, and is used for no other purpose.) Because of the traditional structure of language definitions, this needs to come first.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line373">373</span><span class="td">Object&nbsp;Compass&nbsp;&quot;compass&quot;&nbsp;has&nbsp;concealed;</span></span>
</div><div class='text'>
<h3>Language of Play.</h3><p><p> The equivalent of I6&#39;s language definition file, though here the idea is that a translation should have an inclusion to replace the <span class="fixed"><a href="./Language.i6t.html">Language.i6t</a></span> segment, which contains the English definition.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line381">381</span><span class="td">{-segment:<a&nbsp;href="./Language.html">Language.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line382">382</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line383">383</span><span class="td">Default&nbsp;LanguageCases&nbsp;1;</span></span>
</div><div class='text'>
<h3>The Old Library.</h3><p><p> The I6 library consisted essentially of the parser, the verb routines, and a pile of utilities and world-modelling code, of which the biggest single component was the list-writer. The parser lives on below; the verb routines are gone, with the equivalent functionality having moved upstairs into I7 source text in the Standard Rules; and the rest of the library largely lives here:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line394">394</span><span class="td">{-segment:<a&nbsp;href="./Light.html">Light.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">{-segment:<a&nbsp;href="./ListWriter.html">ListWriter.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">{-segment:<a&nbsp;href="./Utilities.html">Utilities.i6t</a>}</span></span>
</div><div class='text'>
<h3>Parser.</h3><p><p> The largest single block of code in the traditional I6 library part of the template layer is the parser.<p></p><p> The two pseudo-objects <span class="fixed">InformParser</span> and <span class="fixed">InformLibrary</span> are relics of the object-oriented approach in I6, and are used only very slightly in the template layer; they are not used at all in I7, and are not valid for the &quot;object&quot; kind of value.<p></p><p> The parser includes arrays for typed text and some parsing information derived from it, and if these should overrun it would cause enigmatic bugs, as the next arrays in memory would be corrupted: as a tripwire, the <span class="fixed">Protect_I7_Arrays</span> array consists of two magic values in sequence. If it is ever discovered to contain the wrong data, the alarm sounds.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line414">414</span><span class="td">Object&nbsp;InformParser&nbsp;&quot;(Inform&nbsp;Parser)&quot;&nbsp;has&nbsp;proper;</span></span>
<span class="tr"><span class="th" id="line415">415</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line416">416</span><span class="td">{-segment:<a&nbsp;href="./Parser.html">Parser.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line417">417</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line418">418</span><span class="td">[&nbsp;ParserError&nbsp;error_type;</span></span>
<span class="tr"><span class="th" id="line419">419</span><span class="td">&nbsp;if&nbsp;(error_type)&nbsp;PrintSingleParagraph(error_type);</span></span>
<span class="tr"><span class="th" id="line420">420</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line421">421</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line422">422</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line423">423</span><span class="td">Object&nbsp;InformLibrary&nbsp;&quot;(Inform&nbsp;Library)&quot;&nbsp;has&nbsp;proper;</span></span>
<span class="tr"><span class="th" id="line424">424</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line425">425</span><span class="td">Array&nbsp;Protect_I7_Arrays&nbsp;--&gt;&nbsp;16339&nbsp;12345;</span></span>
</div><div class='text'>
<h3>Order of Play.</h3><p><p> The <span class="fixed"><a href="./Output-Stub.i6t.html#line12">Main</a></span> routine, where execution begins, and the primitive rules in the principal rulebooks.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line432">432</span><span class="td">{-segment:<a&nbsp;href="./OrderOfPlay.html">OrderOfPlay.i6t</a>}</span></span>
</div><div class='text'>
<h3>Properties.</h3><p><p> Some either/or properties are compiled to I6 attributes, which must be predeclared, so we do that first. (All other properties can simply be used without declaration.)<p></p><p> What then follows is a table of property metadata: in particular, specifying which properties can be used with which I6 classes or objects. Policing this at run-time costs a little speed, but traps many errors of programming, and keeps everything typesafe. It is the price we pay for the relatively lenient compile-time checking of I7&#39;s &quot;object&quot; kind of value. To make it as efficient as possible, we calculate offsets into the metadata: this has to be done (once) at run-time, with the routine compiled.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line448">448</span><span class="td">{-call:Properties::alias_translations}</span></span>
<span class="tr"><span class="th" id="line449">449</span><span class="td">{-call:Properties::ObjectImplementation::compile_attributes}</span></span>
<span class="tr"><span class="th" id="line450">450</span><span class="td">{-array:Properties::ObjectImplementation::property_metadata}</span></span>
<span class="tr"><span class="th" id="line451">451</span><span class="td">Constant&nbsp;attributed_property_offsets_SIZE&nbsp;48;</span></span>
<span class="tr"><span class="th" id="line452">452</span><span class="td">Array&nbsp;attributed_property_offsets&nbsp;--&gt;&nbsp;attributed_property_offsets_SIZE;</span></span>
<span class="tr"><span class="th" id="line453">453</span><span class="td">Constant&nbsp;valued_property_offsets_SIZE&nbsp;(100&nbsp;+&nbsp;{-value:NUMBER_CREATED(property)}&nbsp;+&nbsp;INDIV_PROP_START-48);</span></span>
<span class="tr"><span class="th" id="line454">454</span><span class="td">Array&nbsp;valued_property_offsets&nbsp;--&gt;&nbsp;valued_property_offsets_SIZE;</span></span>
<span class="tr"><span class="th" id="line455">455</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line456">456</span><span class="td">{-routine:Properties::ObjectImplementation::CreatePropertyOffsets}</span></span>
</div><div class='text'>
<h3>Activities.</h3><p><p> These are numbered upwards from 0 in order of creation. The following arrays taken together provide, for each activity number: (i) the rulebook numbers for the before, for, and after stages of the activity, and (ii) a flag indicating whether the activity is &quot;future action&quot;-capable, that is, is a parsing activity allowed to make use of the action which conjecturally might result from the current grammar line being parsed. (This is called the &quot;action to be&quot;, hence &quot;atb&quot;.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line468">468</span><span class="td">Constant&nbsp;NUMBER_RULEBOOKS_CREATED&nbsp;=&nbsp;{-value:NUMBER_CREATED(rulebook)};</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">{-call:Activities::compile_activity_constants}</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">{-array:Activities::Activity_before_rulebooks}</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">{-array:Activities::Activity_for_rulebooks}</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">{-array:Activities::Activity_after_rulebooks}</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">{-array:Activities::Activity_atb_rulebooks}</span></span>
</div><div class='text'>
<h3>Relations.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line478">478</span><span class="td">{-call:Relations::compile_defined_relation_constants}</span></span>
</div><div class='text'>
<h3>Printing Routines.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line483">483</span><span class="td">{-call:Kinds::RunTime::compile_data_type_support_routines}</span></span>
<span class="tr"><span class="th" id="line484">484</span><span class="td">{-routine:Kinds::RunTime::I7_Kind_Name}</span></span>
<span class="tr"><span class="th" id="line485">485</span><span class="td">{-routine:Rulebooks::Outcomes::RulebookOutcomePrintingRule}</span></span>
</div><div class='text'>
<h3>Object Tree.</h3><p><p> The I6 object tree contains <span class="fixed">Class</span> definitions as well as objects, but we precede both with a pseudo-object called <span class="fixed">property_numberspace_forcer</span>. It does nothing except to ensure that properties are declared in I6 in the same sequence as I7 (which need not otherwise happen); it plays no part in play, and is not a valid I7 &quot;object&quot; value.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line495">495</span><span class="td">{-log:Compiling&nbsp;the&nbsp;storage&nbsp;for&nbsp;the&nbsp;model&nbsp;world}</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">{-call:World::Compile::compile}</span></span>
</div><div class='text'>
<h3>Tables.</h3><p><p> The initial state of the I6 arrays corresponding to each I7 table: see <span class="fixed"><a href="./Tables.i6t.html">Tables.i6t</a></span> for details.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line503">503</span><span class="td">{-log:Compiling&nbsp;the&nbsp;tables}</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td">{-callv:Tables::complete}</span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">{-call:Tables::Support::compile}</span></span>
</div><div class='text'>
<h3>Equations.</h3><p><p> Routines to evaluate from equations.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line511">511</span><span class="td">{-log:Compiling&nbsp;the&nbsp;equations}</span></span>
<span class="tr"><span class="th" id="line512">512</span><span class="td">{-call:Equations::compile}</span></span>
</div><div class='text'>
<h3>Actions.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line517">517</span><span class="td">{-log:Compiling&nbsp;the&nbsp;named&nbsp;action&nbsp;patterns}</span></span>
<span class="tr"><span class="th" id="line518">518</span><span class="td">{-call:PL::Actions::Patterns::Named::compile}</span></span>
<span class="tr"><span class="th" id="line519">519</span><span class="td">{-log:Compiling&nbsp;the&nbsp;action&nbsp;routines}</span></span>
<span class="tr"><span class="th" id="line520">520</span><span class="td">{-array:PL::Actions::ActionData}</span></span>
<span class="tr"><span class="th" id="line521">521</span><span class="td">{-array:PL::Actions::ActionCoding}</span></span>
<span class="tr"><span class="th" id="line522">522</span><span class="td">{-array:PL::Actions::ActionHappened}</span></span>
<span class="tr"><span class="th" id="line523">523</span><span class="td">{-call:PL::Actions::compile_action_routines}</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">{-routine:PL::Parsing::Lines::MistakeActionSub}</span></span>
</div><div class='text'>
<h3>Phrases.</h3><p><p> The following innocent-looking commands tell NI to compile I6 definitions for all of the rules which are not I6-written primitives, and also for adjective definitions, so it results in a fairly enormous cataract of code.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line532">532</span><span class="td">{-log:Compiling&nbsp;first&nbsp;block&nbsp;of&nbsp;phrases}</span></span>
<span class="tr"><span class="th" id="line533">533</span><span class="td">{-call:Phrases::Manager::compile_first_block}</span></span>
</div><div class='text'>
<h3>Timed Events.</h3><p><p> Some of the phrases are simply called in the course of other phrases, but some are rules in rulebooks or in the table of timed events, so those come next:<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line541">541</span><span class="td">{-array:Phrases::Manager::TimedEventsTable}</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">{-array:Phrases::Manager::TimedEventTimesTable}</span></span>
</div><div class='text'>
<h3>Rulebooks.</h3><p><p> The literally hundreds of rulebooks are set up here. (In the end a rulebook is only a (word) array of rule addresses, terminated with a <span class="fixed"><a href="./Definitions.i6t.html#line71">NULL</a></span>.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line549">549</span><span class="td">{-log:Compiling&nbsp;the&nbsp;rulebooks}</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">{-array:Phrases::Manager::rulebooks_array}</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">{-call:Phrases::Manager::compile_rulebooks}</span></span>
</div><div class='text'>
<h3>Scenes.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line556">556</span><span class="td">{-log:Compiling&nbsp;scene&nbsp;details}</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">{-routine:PL::Scenes::DetectSceneChange}</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">#IFDEF&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">{-routine:PL::Scenes::ShowSceneStatus}</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">#ENDIF;</span></span>
</div><div class='text'>
<h3>The New Library.</h3><p><p> The gleaming, aluminium and glass extension to the library: almost all of it material new in I7 usage.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line567">567</span><span class="td">{-log:CTNL}</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">{-segment:<a&nbsp;href="./Actions.html">Actions.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line570">570</span><span class="td">{-segment:<a&nbsp;href="./Activities.html">Activities.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line571">571</span><span class="td">{-segment:<a&nbsp;href="./Figures.html">Figures.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line572">572</span><span class="td">{-segment:<a&nbsp;href="./FileIO.html">FileIO.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line573">573</span><span class="td">{-segment:<a&nbsp;href="./MStack.html">MStack.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line574">574</span><span class="td">{-segment:<a&nbsp;href="./OutOfWorld.html">OutOfWorld.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line575">575</span><span class="td">{-segment:<a&nbsp;href="./Printing.html">Printing.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line576">576</span><span class="td">{-segment:<a&nbsp;href="./Relations.html">Relations.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line577">577</span><span class="td">{-segment:<a&nbsp;href="./RTP.html">RTP.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line578">578</span><span class="td">{-segment:<a&nbsp;href="./Rulebooks.html">Rulebooks.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line579">579</span><span class="td">{-segment:<a&nbsp;href="./Sort.html">Sort.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line580">580</span><span class="td">{-segment:<a&nbsp;href="./Tables.html">Tables.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line581">581</span><span class="td">{-segment:<a&nbsp;href="./WorldModel.html">WorldModel.i6t</a>}</span></span>
</div><div class='text'>
<h3>Parsing Tokens.</h3><p><p> GPRs, scope and noun filters to be used in grammar lines, but no actual grammar lines as yet.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line588">588</span><span class="td">{-callv:PL::Parsing::Verbs::prepare}</span></span>
<span class="tr"><span class="th" id="line589">589</span><span class="td">{-call:PL::Parsing::Verbs::compile_conditions}</span></span>
<span class="tr"><span class="th" id="line590">590</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line591">591</span><span class="td">{-log:Compiling&nbsp;GPR&nbsp;tokens&nbsp;for&nbsp;parsing&nbsp;various&nbsp;kinds&nbsp;of&nbsp;value}</span></span>
<span class="tr"><span class="th" id="line592">592</span><span class="td">{-segment:<a&nbsp;href="./Number.html">Number.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line593">593</span><span class="td">{-segment:<a&nbsp;href="./RealNumber.html">RealNumber.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line594">594</span><span class="td">{-segment:<a&nbsp;href="./Time.html">Time.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line595">595</span><span class="td">{-call:PL::Parsing::Tokens::Values::compile_type_gprs}</span></span>
</div><div class='text'>
<h3>Text generation.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line600">600</span><span class="td">{-routine:Verbs::ConjugateVerb}</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">{-call:Adjectives::Meanings::agreements}</span></span>
</div><div class='text'>
<h3>Testing commands.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line606">606</span><span class="td">#IFDEF&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">{-call:PL::Parsing::TestScripts::write_text}</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td">{-segment:<a&nbsp;href="./Tests.html">Tests.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">{-routine:PL::Parsing::TestScripts::InternalTestCases}</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">#ENDIF;&nbsp;!&nbsp;DEBUG</span></span>
</div><div class='text'>
<h3>I6 Inclusions.</h3><p><p> This paragraph contains no code, by default: it&#39;s a hook on which to hang verbatim I6 material.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line617">617</span><span class="td">!&nbsp;&quot;Include&nbsp;(-&nbsp;...&nbsp;-)&quot;&nbsp;inclusions&nbsp;with&nbsp;no&nbsp;specified&nbsp;position&nbsp;appear&nbsp;here.</span></span>
</div><div class='text'>
<h3>Entries in constant lists.</h3><p><p> Well: most of them, anyway. In particular, all of those which are lists of texts with substitution will be swept up, which is important for timing reasons. A second round later on will catch any later ones.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line625">625</span><span class="td">{-call:Lists::check}</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">{-call:Lists::compile}</span></span>
</div><div class='text'>
<h3>To Phrases.</h3><p><p> We now compile all of the remaining code in the source text: the &quot;To...&quot; phrases and all of their attendant text routines, loop-over-scope routines and so on.<p></p><p> We now have to be quite careful about the sequence of events. Compiling the text routines is an irrevocable step, after which we must not compile any new text with substitutions. On the other hand we mustn&#39;t leave it any later, because a text substitution might contain references to the past, or involve propositions which must be deferred into routines.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line640">640</span><span class="td">{-log:Compiling&nbsp;second&nbsp;block&nbsp;of&nbsp;phrases}</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td">{-call:Phrases::Manager::compile_as_needed}</span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">{-call:Strings::compile_responses}</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">{-call:Lists::check}</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">{-call:Lists::compile}</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">{-call:Relations::compile_defined_relations}</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">{-call:Phrases::Manager::compile_as_needed}</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">{-callv:Strings::TextSubstitutions::allow_no_further_text_subs}</span></span>
<span class="tr"><span class="th" id="line649">649</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line650">650</span><span class="td">{-log:Compiling&nbsp;noun&nbsp;and&nbsp;scope&nbsp;filter&nbsp;tokens}</span></span>
<span class="tr"><span class="th" id="line651">651</span><span class="td">{-call:PL::Parsing::Tokens::Filters::compile}</span></span>
</div><div class='text'>
<h3>Chronology.</h3><p><p> Similarly, this is where we wrap up all references to past tenses: after this point, we cannot safely compile any I7 condition in the past tense.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line658">658</span><span class="td">{-log:Compiling&nbsp;chronology}</span></span>
<span class="tr"><span class="th" id="line659">659</span><span class="td">{-segment:<a&nbsp;href="./Chronology.html">Chronology.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line660">660</span><span class="td">{-callv:Chronology::allow_no_further_past_tenses}</span></span>
</div><div class='text'>
<h3>Grammar.</h3><p><p> This is the trickiest matter of timing. We had to leave the grammar lines until now because the past-tense code above might have needed to investigate whether the player&#39;s command matched a given pattern at some time in the past (a case which arose naturally in one of the example games, so which should not be dismissed as an aberration). This is therefore the earliest point at which we can know for sure that no further grammar lines are needed.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line672">672</span><span class="td">{-log:Compiling&nbsp;I6&nbsp;Verb&nbsp;directives}</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">{-call:PL::Parsing::Verbs::compile_all}</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td">{-log:Compiling&nbsp;noun&nbsp;and&nbsp;scope&nbsp;filter&nbsp;tokens}</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">{-call:PL::Parsing::Tokens::Filters::compile}</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">#IFTRUE&nbsp;({-value:no_verb_verb_defined}&nbsp;==&nbsp;1);</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">[&nbsp;UnknownVerb;&nbsp;verb_wordnum&nbsp;=&nbsp;0;&nbsp;return&nbsp;&#39;no.verb&#39;;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">[&nbsp;PrintVerb&nbsp;v;</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;if&nbsp;(v&nbsp;==&nbsp;&#39;no.verb&#39;)&nbsp;{&nbsp;print&nbsp;&quot;do&nbsp;something&nbsp;to&quot;;&nbsp;rtrue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">#Ifnot;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">[&nbsp;UnknownVerb;&nbsp;rfalse;&nbsp;];&nbsp;[&nbsp;PrintVerb&nbsp;v;&nbsp;rfalse;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">#ENDIF;</span></span>
</div><div class='text'>
<h3>Deferred Propositions.</h3><p><p> Most conditions, such as &quot;the score is 10&quot;, and descriptions, such as &quot;open doors which are in lighted rooms&quot;, are translated by NI into propositions in a form of predicate calculus. Sometimes these can be compiled immediately to I6 code, but other times they involve complicated searches and have to be &quot;deferred&quot; into special routines which will perform them. This is where we compile those routines.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line697">697</span><span class="td">{-log:Compiling&nbsp;routines&nbsp;from&nbsp;predicate&nbsp;calculus}</span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td">{-call:Properties::Measurement::compile_MADJ_routines}</span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">{-call:Calculus::Propositions::Deferred::compile_remaining_deferred}</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">{-callv:Calculus::Deferrals::allow_no_further_deferrals}</span></span>
</div><div class='text'>
<h3>Miscellaneous Loose Ends.</h3><p><p> And we still aren&#39;t done, because we still have:<p></p><p> (1) Routines which switch between possible interpretations of phrases by performing run-time type checking. (Note that these cannot involve grammar, or the past tenses, or text substitutions, or deferred propositions.)<p></p><p> (2) Arrays holding constant lists, such as |{2, 3, 4}|, if any.<p></p><p> (3) The string constants, named in the pattern <span class="fixed">SC_*</span>, in alphabetical order. (This ensures that their packed addresses will have unsigned comparison ordering equivalent to alphabetical order.)<p></p><p> (4) &quot;Stub&quot; I6 constants for property names where properties aren&#39;t used, to prevent them causing errors if they are referred to in code but not actually present in any object (as can easily happen with extensions presenting optional features which the user chooses not to employ). <span class="fixed"><a href="./Output.i6t.html#line736">cap_short_name</a></span> is similarly stubbed: this doesn&#39;t correspond to any I7 property, but is used by NI to record capitalised forms of the printed name (which in turn goes into <span class="fixed">short_name</span>).<p></p><p> (5) Counters are used to allocate cells of storage to inline phrases which need a permanent state associated with them: see the Standard Rules. Since all I7 source text has been compiled by now, we know the final values of the counters, and therefore the amount of storage we need to allocate.<p></p><p> (6) Similarly, each &quot;quotation&quot; box needs its own cell of memory.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line731">731</span><span class="td">{-call:Lists::check}</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">{-call:Lists::compile}</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">{-call:Strings::TextLiterals::compile}</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">{-call:Properties::ObjectImplementation::compile_stub_properties}</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">#IFNDEF&nbsp;cap_short_name;</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">Constant&nbsp;cap_short_name&nbsp;=&nbsp;short_name;</span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">#ENDIF;</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td">{-call:JumpLabels::compile_necessary_storage}</span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">Array&nbsp;Runtime_Quotations_Displayed&nbsp;--&gt;&nbsp;{-value:extent_of_runtime_quotations_array};</span></span>
</div><div class='text'>
<h3>Block Values.</h3><p><p> These are values which are pointers to more elaborate data on the memory heap, rather than values in themselves: they point to &quot;blocks&quot;. A section of code handles the heap, and there is then one further section to support each of the kinds of value in question.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line748">748</span><span class="td">{-call:Kinds::RunTime::compile_heap_allocator}</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">{-call:Phrases::Constants::compile_closures}</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">{-call:Kinds::RunTime::compile_structures}</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">{-segment:<a&nbsp;href="./Flex.html">Flex.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">{-segment:<a&nbsp;href="./BlockValues.html">BlockValues.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">{-segment:<a&nbsp;href="./Text.html">Text.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">{-segment:<a&nbsp;href="./RegExp.html">RegExp.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">{-segment:<a&nbsp;href="./StoredAction.html">StoredAction.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">{-segment:<a&nbsp;href="./Lists.html">Lists.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">{-segment:<a&nbsp;href="./Combinations.html">Combinations.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">{-segment:<a&nbsp;href="./RelationKind.html">RelationKind.i6t</a>}</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">{-array:PL::Figures::tableoffigures}</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">{-array:PL::Sounds::tableofsounds}</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">{-callv:Rules::check_response_usages}</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">{-call:Kinds::RunTime::compile_block_constants}</span></span>
<span class="tr"><span class="th" id="line766">766</span><span class="td">{-callv:Phrases::Timed::check_for_unused}</span></span>
</div><div class='text'>
<h3>Signing off.</h3><p><p> And that&#39;s all, folks.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line772">772</span><span class="td">!&nbsp;End&nbsp;of&nbsp;automatically&nbsp;generated&nbsp;I6&nbsp;source</span></span>
<span class="tr"><span class="th" id="line773">773</span><span class="td">!&nbsp;--------------------------------------------------------------------------</span></span>
</div><footer><hr><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
