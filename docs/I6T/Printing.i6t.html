<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Printing</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
.pre-lines { font-family: monospace; margin-left: 3rem; line-height: 1.5rem; }
/*span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}*/
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 3rem 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 48rem; }
/* h3 { margin-top: 1.5rem; padding-top: 1.5rem; }*/
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: .5rem; margin-bottom: 1.5rem; margin-top: 1.75rem; padding-top: .25rem;}
footer { margin-top: 3rem; padding-top: 1rem; border-top: .5px solid black; margin-bottom: 0;}
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Index</a> &bull; <a href="./Introduction.i6t.html">Introduction</a></div><hr></header>
<div id="front_matter">
<h2><a href="./Printing.i6t.txt">Printing.i6t</a></h2><h3 id="#printing-paragraph-control">Paragraph Control.</h3><p><p> Ah, yes: the paragraph breaking algorithm. In <strong> T<sub>E</sub>X: The Program</strong>, Donald Knuth writes at <em>&sect; 768</em>: &quot;It&#39;s sort of a miracle whenever <span class="fixed">\halign</span> and <span class="fixed">\valign</span> work, because they cut across so many of the control structures of T<sub>E</sub>X.&quot; It&#39;s sort of a miracle whenever Inform 7&#39;s paragraph breaking system works, too. Most users probably imagine that it&#39;s implemented by having I7 look at where the cursor currently is (at the start of a line or not) and whether a line has just been skipped. In fact, the virtual machines simply do not offer facilities like that, and so we have to use our own book-keeping. Given the huge number of ways in which text can be printed, this is a delicate business. For some years now, &quot;spacing bugs&quot; &ndash; those where a spurious extra skipped line appears in a paragraph break, or where, conversely, no line is skipped at all &ndash; have been the least welcome in the Inform bugs database.<p></p><p> The basic method is to set <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span>, the paragraph flag, when we print any matter; every so often we reach a &quot;divide paragraph&quot; point &ndash; for instance when one rule has finished and before another is about to start &ndash; and at those positions we look for <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span>, and print a skipped line (and clear <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span> again) if we find it. Thus:<p></p><p><div class="pre-lines">&gt; WAIT</div><div class="pre-lines">The clock ticks ominously. <em> ...first rule</em></div><div class="pre-lines"> <em> ...skipped line printed at a Divide Paragraph point</em></div><div class="pre-lines">Mme Tourmalet rises from her chair and slips out. <em> second rule</em></div><div class="pre-lines"> <em> ...skipped line printed at a Divide Paragraph point</em></div><div class="pre-lines">&gt; </div><p></p><p> A divide paragraph point occurs between any two rules in an action rulebook, but not an activity rulebook: many activities exist to print text, such as the names of objects, and there would be wild spacing accidents if paragraphs were divided there. Inform places DPPs elsewhere, too: and the text substitution &quot;[conditional paragraph break]&quot; allows the user to place one anywhere.<p></p><p> A traditional layout convention handed down from Infocom makes an exception of the first paragraph to appear after the prompt, but only in one situation. Ordinarily, the first paragraph of any turn appears straight after the prompt:<p></p><p><div class="pre-lines">&gt; EXAMINE DOG</div><div class="pre-lines">Mme Tourmalet&#39;s borzoi looks as if it means fashion, not business.</div><p></p><p> The command is echoed on screen as the player types, but this doesn&#39;t set the paragraph flag, which is still clear when the text &quot;Mme Tourmalet&#39;s...&quot; begins to be printed. The single exception occurs when the command calls for the player to go to a new location, when a skipped line is printed before the room description for the new room. Thus:<p></p><p><div class="pre-lines">&gt; SOUTH</div><div class="pre-lines"> <em> ...the &quot;going look break&quot;</em></div><div class="pre-lines">Rocky Beach</div><p></p><p> (Note that this is not inherent in the looking action:<p></p><p><div class="pre-lines">&gt; LOOK</div><div class="pre-lines">Rocky Beach</div><p></p><p> ...which obeys the standard paragraphing conventions.)<p></p><p> So much for automatic paragraph breaks. However, we need a variety of different ways explicitly to control paragraphs, in order to accommodate traditional layout conventions handed down from Infocom.<p></p><p> The simplest exceptional kind of paragraph break is a &quot;command clarification break&quot;, in which a single new-line is printed but there is no skipped line: as the name implies, it&#39;s traditionally used when a command such as OPEN DOOR is clarified. For example:<p></p><p><div class="pre-lines">(first unlocking the oak door) <em> ...now a command clarification break</em></div><div class="pre-lines">You open the oak door.</div><p></p><p> This is not quite the same thing as a &quot;run paragraph on&quot; break, in which we also deliberately suppress the skipped line, but make an exception for the skipped line which ought to appear last before the prompt: the idea is to merge two or more paragraphs together.<p></p><p><div class="pre-lines">&gt; TAKE ALL</div><div class="pre-lines">marmot: Taken. <em> ...we run paragraph on here</em></div><div class="pre-lines">weasel: Taken. <em> ...and also here</em></div><div class="pre-lines"> <em> ...despite which the final skip does occur</em></div><div class="pre-lines">&gt; <em> ...before the next prompt</em></div><p></p><p> A more complicated case is &quot;special look spacing&quot;, used for the break which occurs after the (boldface) short name of a room description is printed. This is tricky because it is sometimes followed directly by a long description, and we don&#39;t want a skipped line:<p></p><p><div class="pre-lines">Villa Christiane <em> ...a special look spacing break</em></div><div class="pre-lines">The walled garden of a villa in Cap d&#39;Agde.</div><div class="pre-lines"> <em> ...a Divide Paragraph break</em></div><div class="pre-lines">Mme Tourmalet&#39;s borzoi lazes in the long grass.</div><p></p><p> But sometimes it is followed directly by a subsequent paragraph, and again we want no skip:<p></p><p><div class="pre-lines">Villa Christiane <em> ...a special look spacing break</em></div><div class="pre-lines">Mme Tourmalet&#39;s borzoi lazes in the long grass.</div><p></p><p> And sometimes it is the only content of the room description and is followed only by the prompt:<p></p><p><div class="pre-lines">Villa Christiane <em> ...a special look spacing break</em></div><div class="pre-lines"> <em> ...a break inserted before the prompt</em></div><div class="pre-lines">&gt; </div><p></p><p> To recap, we have five kinds of paragraph break:<p></p><p> (a) Standard breaks at &quot;divide paragraph points&quot;, used between rules. (b) The &quot;going look break&quot;, used before the room description after going to a new room. (c) A &quot;command clarification break&quot;, used after text clarifying a command. (d) A &quot;run paragraph on&quot; break, used to merge multiple paragraphs into a single block of text. (e) The &quot;special look spacing&quot; break, used after the boldface headline of a room description.<p></p><p> We now have to implement all of these behaviours. The code, while very simple, is highly prone to behaving unexpectedly if changes are made, simply because of the huge number of circumstances in which paragraphs are printed: so change nothing without very careful testing.<p></p><p><h3 id="#printing-state">State.</h3><p><p> The current state is stored in a combination of two global variables:<p></p><p> (1) <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span>, the &quot;say paragraph&quot; flag, which is set if a paragraph break needs to be printed before the next text can begin; (2) <span class="fixed">say__pc</span>, originally named as the &quot;paragraph completed&quot; flag, but which is now a bitmap: (-2a) <span class="fixed"><a href="./Definitions.i6t.html#line261">PARA_COMPLETED</a></span> is set if a standard paragraph break has been made since the last time the flag was cleared; (-2b) <span class="fixed"><a href="./Definitions.i6t.html#line262">PARA_PROMPTSKIP</a></span> is set to indicate that the current printing position does not follow a skipped line, and that further material is expected which will run on from the previous paragraph, but that if no further material turns up then a skipped line would be needed before the next prompt; (-2c) <span class="fixed"><a href="./Definitions.i6t.html#line263">PARA_SUPPRESSPROMPTSKIP</a></span> is set to indicate that, despite <span class="fixed"><a href="./Definitions.i6t.html#line262">PARA_PROMPTSKIP</a></span> being set, no skipped line is needed before the prompt after all; (-2d) <span class="fixed"><a href="./Definitions.i6t.html#line264">PARA_NORULEBOOKBREAKS</a></span> suppresses divide paragraph points in between rules in rulebooks; it treats all rulebooks, and in particular action rulebooks, the way activity rulebooks are treated. (The flag is used for short periods only and never across turn boundaries, prompts and so on.) (-2e) <span class="fixed"><a href="./Definitions.i6t.html#line265">PARA_CONTENTEXPECTED</a></span> is set after a paragraph division as a signal that if any contents looks likely to be printed soon then <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span> needs to be set, because a successor paragraph will then have started. This is checked by calling <span class="fixed"><a href="./Printing.i6t.html#line191">ParaContent()</a></span> &ndash; while it&#39;s slow to have to call this routine so often, that&#39;s better than compiling inline code with the same effect, because minimising compiled code size is more important, and speed is never a big deal when printing.<p></p><p> Not all printing is to the screen: sometimes the output is to a file, or to memory, and in that case we want to start the switched output at a clear paragraphing state and then go back to the screen afterwards without any sign of change. The correct way to do this is to push the <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span> and <span class="fixed">say__pc</span> variables onto the VM stack and call <span class="fixed"><a href="./Printing.i6t.html#line169">ClearParagraphing()</a></span> before starting to print to the new stream, and then pull the variables back again before resuming printing to the old stream.<p></p><p> In no other case should any code alter <span class="fixed">say__pc</span> except via the routines below.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line167">167</span><span class="td">!Constant TRACE_I7_SPACING;</span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">[ ClearParagraphing r;</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__p = 0; say__pc = 0;</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">[ DivideParagraphPoint;</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #ifdef TRACE_I7_SPACING; print &quot;[DPP&quot;, say__p, say__pc, &quot;]&quot;; #endif;</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (say__p) {</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new_line; say__p = 0; say__pc = say__pc | PARA_COMPLETED;</span></span>
<span class="tr"><span class="th" id="line177">177</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        say__pc_save = true;</span></span>
<span class="tr"><span class="th" id="line178">178</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (say__pc &amp; PARA_PROMPTSKIP) say__pc = say__pc - PARA_PROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line179">179</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (say__pc &amp; PARA_SUPPRESSPROMPTSKIP) say__pc = say__pc - PARA_SUPPRESSPROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line180">180</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line181">181</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #ifdef TRACE_I7_SPACING; print &quot;[--&gt;&quot;, say__p, say__pc, &quot;]&quot;; #endif;</span></span>
<span class="tr"><span class="th" id="line182">182</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc = say__pc | PARA_CONTENTEXPECTED;</span></span>
<span class="tr"><span class="th" id="line183">183</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc_save = (say__pc &amp; PARA_COMPLETED);</span></span>
<span class="tr"><span class="th" id="line184">184</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line185">185</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line186">186</span><span class="td">[ AdjustParagraphPoint;</span></span>
<span class="tr"><span class="th" id="line187">187</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #ifdef TRACE_I7_SPACING; print &quot;[APP &quot;, say__p, &quot; &quot;, say__pc, &quot; &quot;, say__pc_save, &quot;]^&quot;; #endif;</span></span>
<span class="tr"><span class="th" id="line188">188</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (say__pc_save) say__pc = (say__pc | PARA_COMPLETED);</span></span>
<span class="tr"><span class="th" id="line189">189</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line190">190</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line191">191</span><span class="td">[ ParaContent;</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (say__pc &amp; PARA_CONTENTEXPECTED) {</span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        say__pc = say__pc - PARA_CONTENTEXPECTED;</span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        say__p = 1;</span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">[ GoingLookBreak;</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (say__pc &amp; PARA_COMPLETED == 0) new_line;</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearParagraphing(10);</span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">[ CommandClarificationBreak;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    new_line;</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearParagraphing(11);</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">[ RunParagraphOn;</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #ifdef TRACE_I7_SPACING; print &quot;[RPO&quot;, say__p, say__pc, &quot;]&quot;; #endif;</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__p = 0;</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc = say__pc | PARA_PROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc = say__pc | PARA_SUPPRESSPROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">[ SpecialLookSpacingBreak;</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #ifdef TRACE_I7_SPACING; print &quot;[SLS&quot;, say__p, say__pc, &quot;]&quot;; #endif;</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__p = 0;</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc = say__pc | PARA_PROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">[ EnsureBreakBeforePrompt;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((say__p) ||</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ((say__pc &amp; PARA_PROMPTSKIP) &amp;&amp; ((say__pc &amp; PARA_SUPPRESSPROMPTSKIP)==0)))</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new_line;</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearParagraphing(12);</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">[ PrintSingleParagraph matter;</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__p = 1;</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc = say__pc | PARA_NORULEBOOKBREAKS;</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    TEXT_TY_Say(matter);</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    DivideParagraphPoint(13);</span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    say__pc = 0;</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-say-number">Say Number.</h3><p><p> The global variable <span class="fixed"><a href="./Output.i6t.html#line174">say__n</a></span> is set to the numerical value of any quantity printed, and this is used for the text substitution &quot;[s]&quot;, so that &quot;You have been awake for [turn count] turn[s].&quot; will expand correctly.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line242">242</span><span class="td">[ STextSubstitution;</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (say__n ~= 1) print &quot;s&quot;;</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-prompt">Prompt.</h3><p><p> This is the text printed just before we wait for the player&#39;s command: it prompts him to type.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line251">251</span><span class="td">[ PrintPrompt i;</span></span>
<span class="tr"><span class="th" id="line252">252</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    RunTimeProblemShow();</span></span>
<span class="tr"><span class="th" id="line253">253</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearRTP();</span></span>
<span class="tr"><span class="th" id="line254">254</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    style roman;</span></span>
<span class="tr"><span class="th" id="line255">255</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    EnsureBreakBeforePrompt();</span></span>
<span class="tr"><span class="th" id="line256">256</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    TEXT_TY_Say( (+ command prompt +) );</span></span>
<span class="tr"><span class="th" id="line257">257</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearBoxedText();</span></span>
<span class="tr"><span class="th" id="line258">258</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearParagraphing(14);</span></span>
<span class="tr"><span class="th" id="line259">259</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-boxed-quotations">Boxed Quotations.</h3><p><p> These appear once only, and happen outside of the paragraphing scheme: they are normally overlaid as windows on top of the regular text. We can request one at any time, but it will appear only at prompt time, when the screen is fairly well guaranteed not to be scrolling. (Only fairly well since it&#39;s just possible that <strong> Border Zone</strong>-like tricks with real-time play might be going on, but whatever happens, there is at least a human-appreciable pause in which the quotation can be read before being taken away again.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line271">271</span><span class="td">Global pending_boxed_quotation; ! a routine to overlay the quotation on screen</span></span>
<span class="tr"><span class="th" id="line272">272</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td">[ DisplayBoxedQuotation Q;</span></span>
<span class="tr"><span class="th" id="line274">274</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    pending_boxed_quotation = Q;</span></span>
<span class="tr"><span class="th" id="line275">275</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">[ ClearBoxedText i;</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (pending_boxed_quotation) {</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=0: Runtime_Quotations_Displayed--&gt;i: i++)</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            if (Runtime_Quotations_Displayed--&gt;i == pending_boxed_quotation) {</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                pending_boxed_quotation = 0;</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                return;</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            }</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Runtime_Quotations_Displayed--&gt;i = pending_boxed_quotation;</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ClearParagraphing(15);</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        pending_boxed_quotation();</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ClearParagraphing(16);</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        pending_boxed_quotation = 0;</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-score-notification">Score Notification.</h3><p><p> This doesn&#39;t really deserve to be at I6 level at all, but since for traditional reasons we need to use conditional compilation on <span class="fixed"><a href="./Output.i6t.html#line60">USE_SCORING</a></span>, and since we want a fancy text style for Glulx, ...<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line300">300</span><span class="td">[ NotifyTheScore d;</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">#Iftrue USE_SCORING ~= 0;</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (notify_mode == 1) {</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        VM_Style(NOTE_VMSTY);</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        d = score-last_score;</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (d &gt; 0) { ANNOUNCE_SCORE_RM(&#39;D&#39;, d); }</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else if (d &lt; 0) { ANNOUNCE_SCORE_RM(&#39;E&#39;, -d); }</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new_line;</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        VM_Style(NORMAL_VMSTY);</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-status-line">Status Line.</h3><p><p> Status line printing happens on the upper screen window, and outside of the paragraph control system.<p></p><p> Support for version 6 of the Z-machine is best described as grudging. It requires a heavily rewritten <span class="fixed"><a href="./Printing.i6t.html#line330">DrawStatusLine</a></span> equivalent, to be found in <a href="./ZMachine.i6t.html">ZMachine.i6t</a>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line323">323</span><span class="td">#Ifdef TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">#Iftrue (#version_number == 6);</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">[ DrawStatusLine; Z6_DrawStatusLine(); ];</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">#Ifndef DrawStatusLine;</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">[ DrawStatusLine width posb;</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    @push say__p; @push say__pc;</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    BeginActivity(CONSTRUCTING_STATUS_LINE_ACT);</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    VM_StatusLineHeight(1); VM_MoveCursorInStatusLine(1, 1); </span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (statuswin_current) {</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        width = VM_ScreenWidth(); posb = width-15;</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        spaces width;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ClearParagraphing(17);</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (ForActivity(CONSTRUCTING_STATUS_LINE_ACT) == false) {</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            VM_MoveCursorInStatusLine(1, 2);</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            TEXT_TY_Say(left_hand_status_line);</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            VM_MoveCursorInStatusLine(1, posb);</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            TEXT_TY_Say(right_hand_status_line);</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        VM_MoveCursorInStatusLine(1, 1); VM_MainWindow();</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    ClearParagraphing(18);</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    EndActivity(CONSTRUCTING_STATUS_LINE_ACT);</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    @pull say__pc; @pull say__p;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">#Endif;</span></span>
</div><div class='text'>
<h3 id="#printing-status-line-utilities">Status Line Utilities.</h3><p><p> Two convenient routines for the default values of <span class="fixed"><a href="./Output.i6t.html#line225">right_hand_status_line</a></span> and <span class="fixed"><a href="./Output.i6t.html#line224">left_hand_status_line</a></span> respectively. <span class="fixed"><a href="./Printing.i6t.html#line367">SL_Location</a></span> also implements the text substitution &quot;[player&#39;s surroundings]&quot;.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line358">358</span><span class="td">Array T_SL_Score_Moves --&gt; CONSTANT_PACKED_TEXT_STORAGE SL_Score_Moves;</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">[ SL_Score_Moves;</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (not_yet_in_play) return;</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Iftrue USE_SCORING &gt; 0; print sline1, &quot;/&quot;, sline2; #endif;</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line365">365</span><span class="td">Array T_SL_Location --&gt; CONSTANT_PACKED_TEXT_STORAGE SL_Location;</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">[ SL_Location even_before;</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((not_yet_in_play) &amp;&amp; (even_before == false)) return;</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (location == thedark) {</span></span>
<span class="tr"><span class="th" id="line370">370</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        BeginActivity(PRINTING_NAME_OF_DARK_ROOM_ACT);</span></span>
<span class="tr"><span class="th" id="line371">371</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (ForActivity(PRINTING_NAME_OF_DARK_ROOM_ACT) == false)</span></span>
<span class="tr"><span class="th" id="line372">372</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;             DARKNESS_NAME_INTERNAL_RM(&#39;A&#39;);</span></span>
<span class="tr"><span class="th" id="line373">373</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        EndActivity(PRINTING_NAME_OF_DARK_ROOM_ACT);</span></span>
<span class="tr"><span class="th" id="line374">374</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line375">375</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        FindVisibilityLevels();</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (visibility_ceiling == location) print (name) location;</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else print (The) visibility_ceiling;</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">[ DARKNESS_NAME_INTERNAL_R; ];</span></span>
</div><div class='text'>
<h3 id="#printing-banner">Banner.</h3><p><p> Note that NI always compiles <span class="fixed">Story</span> and <span class="fixed">Headline</span> texts, but does not always compile a <span class="fixed">Story_Author</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line388">388</span><span class="td">[ Banner;</span></span>
<span class="tr"><span class="th" id="line389">389</span><span class="td">&nbsp;&nbsp;&nbsp;   BeginActivity(PRINTING_BANNER_TEXT_ACT);</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;&nbsp;&nbsp;   if (ForActivity(PRINTING_BANNER_TEXT_ACT) == false) {</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           VM_Style(HEADER_VMSTY);</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TEXT_TY_Say(Story);</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        VM_Style(NORMAL_VMSTY);</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new_line;</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TEXT_TY_Say(Headline);</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        #ifdef Story_Author;</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot; by &quot;; TEXT_TY_Say(Story_Author);</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        #endif; ! Story_Author</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new_line;</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        VM_Describe_Release();</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot; / Inform 7 build &quot;, (PrintI6Text) NI_BUILD_COUNT, &quot; &quot;;</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;(I6/v&quot;; inversion;</span></span>
<span class="tr"><span class="th" id="line403">403</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot; lib &quot;, (PrintI6Text) LibRelease, &quot;) &quot;;</span></span>
<span class="tr"><span class="th" id="line404">404</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        #Ifdef STRICT_MODE;</span></span>
<span class="tr"><span class="th" id="line405">405</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;S&quot;;</span></span>
<span class="tr"><span class="th" id="line406">406</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        #Endif; ! STRICT_MODE</span></span>
<span class="tr"><span class="th" id="line407">407</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        #Ifdef DEBUG;</span></span>
<span class="tr"><span class="th" id="line408">408</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print &quot;D&quot;;</span></span>
<span class="tr"><span class="th" id="line409">409</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        #Endif; ! DEBUG</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        new_line;</span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    EndActivity(PRINTING_BANNER_TEXT_ACT);</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-print-decimal-number">Print Decimal Number.</h3><p><p> <span class="fixed"><a href="./Printing.i6t.html#line423">DecimalNumber</a></span> is a trivial function which just prints a number, in decimal digits. It is left over from the I6 library&#39;s support routines for Glulx, where it was intended as a stub to pass to the Glulx <span class="fixed"><a href="./Glulx.i6t.html#line1661">Glulx_PrintAnything</a></span> routine (which I7 does not use). In I7, however, it&#39;s also used as the default printing routine for new kinds of value.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line423">423</span><span class="td">[ DecimalNumber num; print num; ];</span></span>
</div><div class='text'>
<h3 id="#printing-print-english-number">Print English Number.</h3><p><p> Another traditional name, this: in fact it prints the number as text in whatever is the current language of play.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line430">430</span><span class="td">[ EnglishNumber n; LanguageNumber(n); ];</span></span>
</div><div class='text'>
<h3 id="#printing-print-text">Print Text.</h3><p><p> The routine for printing an I7 &quot;text&quot; value, which might be text with or without substitutions.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line437">437</span><span class="td">[ PrintI6Text x;</span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (x ofclass String) print (string) x;</span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (x ofclass Routine) return (x)();</span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (x == EMPTY_TEXT_PACKED) rfalse;</span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rtrue;</span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td">[ I7_String x; TEXT_TY_Say(x); ]; ! An alternative name now used only by extensions</span></span>
</div><div class='text'>
<h3 id="#printing-print-or-run">Print Or Run.</h3><p><p> This utility remains from the old I6 library: it essentially treats a property as textual and prints it where possible. Where the <span class="fixed">no_break</span> flag is set, we expect the text to form only a small part of a paragraph, and it&#39;s inappropriate to break here: for instance, for printing the &quot;printed name&quot; of an object. Where the flag is clear, however, the text is expected to form its own paragraph.<p></p><p> Where <span class="fixed"><a href="./Printing.i6t.html#line460">PrintOrRun</a></span> is used in breaking mode, which is only for a very few properties in I7 (indeed at present only <span class="fixed">initial</span> and <span class="fixed">description</span>), the routine called is given the chance to decide whether to print or not. It should return <span class="fixed">true</span> or <span class="fixed">false</span> according to whether it did so; this allows us to divide the paragraph or not accordingly.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line460">460</span><span class="td">[ PrintOrRun obj prop no_break  pv st routine_return_value;</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    @push self; self = obj;</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (prop == 0) {</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print (name) prop; routine_return_value = true;</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    } else {</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        routine_return_value = TEXT_TY_Say(obj.prop);</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    @pull self;</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (routine_return_value) {</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        say__p = 1;</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (no_break == false) {</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            new_line;</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return routine_return_value;</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-short-name-storage">Short Name Storage.</h3><p><p> None of the following functions should be called for the Z-machine if the short name exceeds the size of the following buffer: whereas the Glulx implementation of <span class="fixed"><a href="./Glulx.i6t.html#line1363">VM_PrintToBuffer</a></span> will safely truncate overlong text, that&#39;s impossible for the Z-machine, and horrible results will follow.<p></p><p> <span class="fixed"><a href="./Printing.i6t.html#line493">CPrintOrRun</a></span> is a variation on <span class="fixed"><a href="./Printing.i6t.html#line460">PrintOrRun</a></span>, simplified by not needing to handle entire paragraphs (so, no fuss about dividing) but complicated by having to capitalise the first letter. We do this by writing to the buffer and then altering the first character.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line491">491</span><span class="td">Array StorageForShortName buffer 250;</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">[ CPrintOrRun obj prop  v length i;</span></span>
<span class="tr"><span class="th" id="line494">494</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((obj ofclass String or Routine) || (prop == 0))</span></span>
<span class="tr"><span class="th" id="line495">495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        VM_PrintToBuffer (StorageForShortName, 160, obj);</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    else {</span></span>
<span class="tr"><span class="th" id="line497">497</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (obj.prop == NULL) rfalse;</span></span>
<span class="tr"><span class="th" id="line498">498</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (metaclass(obj.prop) == Routine or String)</span></span>
<span class="tr"><span class="th" id="line499">499</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            VM_PrintToBuffer(StorageForShortName, 160, obj, prop);</span></span>
<span class="tr"><span class="th" id="line500">500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else return RunTimeError(2, obj, prop);</span></span>
<span class="tr"><span class="th" id="line501">501</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line502">502</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line503">503</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    length = StorageForShortName--&gt;0;</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    StorageForShortName-&gt;WORDSIZE = VM_LowerToUpperCase(StorageForShortName-&gt;WORDSIZE);</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    for (i=WORDSIZE: i&lt;length+WORDSIZE: i++) print (char) StorageForShortName-&gt;i;</span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (i&gt;WORDSIZE) say__p = 1;</span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line509">509</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return;</span></span>
<span class="tr"><span class="th" id="line510">510</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line511">511</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line512">512</span><span class="td">[ Cap str nocaps;</span></span>
<span class="tr"><span class="th" id="line513">513</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (nocaps) print (string) str;</span></span>
<span class="tr"><span class="th" id="line514">514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    else CPrintOrRun(str, 0);</span></span>
<span class="tr"><span class="th" id="line515">515</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-object-names-i">Object Names I.</h3><p><p> We now begin the work of printing object names. In the lowest level of this process we print just the name itself (without articles attached), and we do it by carrying out an activity.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line523">523</span><span class="td">[ PSN__ o;</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (o == 0) { LIST_WRITER_INTERNAL_RM(&#39;Y&#39;); rtrue; }</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    switch (metaclass(o)) {</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Routine:  print &quot;&lt;routine &quot;, o, &quot;&gt;&quot;; rtrue;</span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String:   print &quot;&lt;string ~&quot;, (string) o, &quot;~&gt;&quot;; rtrue;</span></span>
<span class="tr"><span class="th" id="line528">528</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        nothing:  print &quot;&lt;illegal object number &quot;, o, &quot;&gt;&quot;; rtrue;</span></span>
<span class="tr"><span class="th" id="line529">529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    RegardingSingleObject(o);</span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    CarryOutActivity(PRINTING_THE_NAME_ACT, o);</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-standard-name-printing-rule">Standard Name Printing Rule.</h3><p><p> In its initial state, the &quot;printing the name of&quot; activity has just one rule: the following &quot;for&quot; rule.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line539">539</span><span class="td">Global caps_mode = false;</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">[ STANDARD_NAME_PRINTING_R obj;</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    obj = parameter_value;</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj == 0) {</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        LIST_WRITER_INTERNAL_RM(&#39;Y&#39;); return;</span></span>
<span class="tr"><span class="th" id="line546">546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line547">547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    switch (metaclass(obj)) {</span></span>
<span class="tr"><span class="th" id="line548">548</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        Routine:  print &quot;&lt;routine &quot;, obj, &quot;&gt;&quot;; return;</span></span>
<span class="tr"><span class="th" id="line549">549</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        String:   print &quot;&lt;string ~&quot;, (string) obj, &quot;~&gt;&quot;; return;</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        nothing:  print &quot;&lt;illegal object number &quot;, obj, &quot;&gt;&quot;; return;</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj == player) { </span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           if (indef_mode == NULL &amp;&amp; caps_mode) PRINT_PROTAGONIST_INTERNAL_RM(&#39;A&#39;);</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           else PRINT_PROTAGONIST_INTERNAL_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           return;</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       }</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Ifdef LanguagePrintShortName;</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (LanguagePrintShortName(obj)) return;</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Endif; ! LanguagePrintShortName</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (indef_mode &amp;&amp; obj.&amp;short_name_indef ~= 0 &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PrintOrRun(obj, short_name_indef, true) ~= 0) return;</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (caps_mode &amp;&amp;</span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        obj.&amp;cap_short_name ~= 0 &amp;&amp; PrintOrRun(obj, cap_short_name, true) ~= 0) {</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        caps_mode = false;</span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj.&amp;short_name ~= 0 &amp;&amp; PrintOrRun(obj, short_name, true) ~= 0) return;</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    print (object) obj;</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-internal-rule">Internal Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line574">574</span><span class="td">[ PRINT_PROTAGONIST_INTERNAL_R; ];</span></span>
</div><div class='text'>
<h3 id="#printing-object-names-ii">Object Names II.</h3><p><p> The second level of the system for printing object names handles the placing of articles in front of them: <strong> the</strong> red herring, <strong> an</strong> elephant, <strong> Some</strong> bread. The following routine allows us to choose:<p></p><p> (a) <span class="fixed">obj</span>, the object whose name is to be printed; (b) <span class="fixed">acode</span>, the kind of article needed: capitalised definite (0), lower case uncapitalised definite (1), or uncapitalised indefinite (2); (c) <span class="fixed">pluralise</span>, a flag forcing to a plural form (e.g., &quot;some&quot; being the pluralised form of an indefinite article in English); (d) <span class="fixed">capitalise</span>, a flag forcing us to capitalise the article &ndash; it&#39;s by setting this that we can achieve the fourth option missing from (b), viz., capitalised indefinite. (All of this is a legacy design from a time when the I6 library did not support capitalised indefinite articles.)<p></p><p> The routine then looks after issues such as which contraction form to use: for instance, in English, whether to use &quot;a&quot; or &quot;an&quot; for the indefinite singular depends on the text of the object&#39;s name.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line596">596</span><span class="td">Global short_name_case;</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">[ PrefaceByArticle obj acode pluralise capitalise  i artform findout artval;</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj provides articles) {</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        artval=(obj.&amp;articles)--&gt;(acode+short_name_case*LanguageCases);</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (capitalise)</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            print (Cap) artval, &quot; &quot;;</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            print (string) artval, &quot; &quot;;</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (pluralise) return;</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print (PSN__) obj; return;</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = GetGNAOfObject(obj);</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (pluralise) {</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (i &lt; 3 || (i &gt;= 6 &amp;&amp; i &lt; 9)) i = i + 3;</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = LanguageGNAsToArticles--&gt;i;</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    artform = LanguageArticles</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        + 3*WORDSIZE*LanguageContractionForms*(short_name_case + i*LanguageCases);</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Iftrue (LanguageContractionForms == 2);</span></span>
<span class="tr"><span class="th" id="line619">619</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (artform--&gt;acode ~= artform--&gt;(acode+3)) findout = true;</span></span>
<span class="tr"><span class="th" id="line620">620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Endif; ! LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line621">621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Iftrue (LanguageContractionForms == 3);</span></span>
<span class="tr"><span class="th" id="line622">622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (artform--&gt;acode ~= artform--&gt;(acode+3)) findout = true;</span></span>
<span class="tr"><span class="th" id="line623">623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (artform--&gt;(acode+3) ~= artform--&gt;(acode+6)) findout = true;</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Endif; ! LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Iftrue (LanguageContractionForms == 4);</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (artform--&gt;acode ~= artform--&gt;(acode+3)) findout = true;</span></span>
<span class="tr"><span class="th" id="line627">627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (artform--&gt;(acode+3) ~= artform--&gt;(acode+6)) findout = true;</span></span>
<span class="tr"><span class="th" id="line628">628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (artform--&gt;(acode+6) ~= artform--&gt;(acode+9)) findout = true;</span></span>
<span class="tr"><span class="th" id="line629">629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Endif; ! LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line630">630</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Iftrue (LanguageContractionForms &gt; 4);</span></span>
<span class="tr"><span class="th" id="line631">631</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    findout = true;</span></span>
<span class="tr"><span class="th" id="line632">632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Endif; ! LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line633">633</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Ifdef TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (standard_interpreter ~= 0 &amp;&amp; findout) {</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        StorageForShortName--&gt;0 = 160;</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        @output_stream 3 StorageForShortName;</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (pluralise) print (number) pluralise; else print (PSN__) obj;</span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        @output_stream -3;</span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        acode = acode + 3*LanguageContraction(StorageForShortName + 2);</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Ifnot; ! TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (findout) {</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (pluralise)</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Glulx_PrintAnyToArray(StorageForShortName, 160, EnglishNumber, pluralise);</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        else</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            Glulx_PrintAnyToArray(StorageForShortName, 160, PSN__, obj);</span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        acode = acode + 3*LanguageContraction(StorageForShortName);</span></span>
<span class="tr"><span class="th" id="line649">649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line650">650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    #Endif; ! TARGET_</span></span>
<span class="tr"><span class="th" id="line651">651</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line652">652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    Cap (artform--&gt;acode, ~~capitalise); ! print article</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (pluralise) return;</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    print (PSN__) obj;</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-object-names-iii">Object Names III.</h3><p><p> The routines accessible from outside this segment.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line661">661</span><span class="td">[ IndefArt obj i;</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj == 0) { LIST_WRITER_INTERNAL_RM(&#39;Y&#39;); rtrue; }</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = indef_mode; indef_mode = true;</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj has proper) { indef_mode = NULL; print (PSN__) obj; indef_mode = i; return; }</span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((obj provides article) &amp;&amp; (TEXT_TY_Compare(obj.article, EMPTY_TEXT_VALUE) ~= 0)) {</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        PrintOrRun(obj, article, true); print &quot; &quot;, (PSN__) obj; indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    PrefaceByArticle(obj, 2); indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line671">671</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line672">672</span><span class="td">[ CIndefArt obj i;</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj == 0) { LIST_WRITER_INTERNAL_RM(&#39;X&#39;); rtrue; }</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = indef_mode; indef_mode = true;</span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (obj has proper) {</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        indef_mode = NULL;</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        caps_mode = true;</span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print (PSN__) obj;</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        caps_mode = false;</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((obj provides article) &amp;&amp; (TEXT_TY_Compare(obj.article, EMPTY_TEXT_VALUE) ~= 0)) {</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        TEXT_TY_Say_Capitalised(obj.article); print &quot; &quot;, (PSN__) obj; indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    PrefaceByArticle(obj, 2, 0, 1); indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">[ DefArt obj i;</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = indef_mode; indef_mode = false;</span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((~~obj ofclass Object) || obj has proper) {</span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        indef_mode = NULL; print (PSN__) obj; indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    PrefaceByArticle(obj, 1); indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">[ CDefArt obj i;</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = indef_mode; indef_mode = false;</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((obj ofclass Object) &amp;&amp; (obj has proper || obj == player)) {</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        indef_mode = NULL;</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        caps_mode = true;</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        print (PSN__) obj;</span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        caps_mode = false;</span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if ((~~obj ofclass Object) || obj has proper) {</span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        indef_mode = NULL; print (PSN__) obj; indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        return;</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    PrefaceByArticle(obj, 0); indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">[ PrintShortName obj i;</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    i = indef_mode; indef_mode = NULL;</span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    PSN__(obj); indef_mode = i;</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-say-one-of">Say One Of.</h3><p><p> These routines are described in the Extensions chapter of the Inform documentation.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line726">726</span><span class="td">[ I7_SOO_PAR oldval count; if (count &lt;= 1) return count; return random(count); ];</span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td">[ I7_SOO_RAN oldval count v; if (count &lt;= 1) return count;</span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    v = oldval; while (v == oldval) v = random(count); return v; ];</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">[ I7_SOO_STI oldval count v; if (oldval) return oldval; return I7_SOO_PAR(oldval, count); ];</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">[ I7_SOO_CYC oldval count; oldval++; if (oldval &gt; count) oldval = 1; return oldval; ];</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">[ I7_SOO_STOP oldval count; oldval++; if (oldval &gt; count) oldval = count; return oldval; ];</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">[ I7_SOO_TAP oldval count tn rn c; if (count &lt;= 1) return count; tn = count*(count+1)/2;</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    rn = random(tn); for (c=1:c&lt;=count:c++) { rn = rn - c; if (rn&lt;=0) return (count-c+1); } ];</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">[ I7_SOO_TRAN oldval count; if (oldval&lt;count) return oldval+1; </span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return count + 1 + I7_SOO_RAN(oldval%(count+1), count); ];</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">[ I7_SOO_TPAR oldval count; if (oldval&lt;count) return oldval+1; </span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return count + 1 + I7_SOO_PAR(oldval%(count+1), count); ];</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">Array I7_SOO_SHUF-&gt;32;</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td">[ I7_SOO_SHU oldval count sd ct v i j s ssd scope cc base;</span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    base = count+1;</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    v = oldval%base; oldval = oldval/base; ct = oldval%base; sd = oldval/base;</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (count &gt; 32) return I7_SOO_PAR(oldval, count);</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    if (count &lt;= 1) v = count;</span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    else {</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        !print &quot;^In v=&quot;, v, &quot; ct=&quot;, ct, &quot; sd=&quot;, sd, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        cc = base*base;</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        scope = (MAX_POSITIVE_NUMBER-1)/cc;</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        !print &quot;Scope = &quot;, scope, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        if (sd == 0) { sd = random(scope); ct=0; }</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=0:i&lt;count:i++) I7_SOO_SHUF-&gt;i = i;</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ssd = sd;</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        for (i=0:i&lt;count-1:i++) {</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            j = (sd)%(count-i)+i; sd = (sd*31973)+17; if (sd&lt;0) sd=-sd;</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;            s = I7_SOO_SHUF-&gt;j; I7_SOO_SHUF-&gt;j = I7_SOO_SHUF-&gt;i; I7_SOO_SHUF-&gt;i = s;</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        }</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        !for (i=0:i&lt;count:i++) print I7_SOO_SHUF-&gt;i, &quot; &quot;; print &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        v = (I7_SOO_SHUF-&gt;ct)+1;</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        ct++; if (ct &gt;= count) { ct = 0; ssd = 0; }</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    }</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    !print &quot;Out v=&quot;, v, &quot; ct=&quot;, ct, &quot; ssd=&quot;, sd, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    !print &quot;Return &quot;, v + ct*base + ssd*base*base, &quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;    return v + ct*base + ssd*base*base;</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">];</span></span>
</div><footer><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
