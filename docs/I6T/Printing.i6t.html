<!doctype html>
<html lang="en">
<meta charset="utf-8">
<head><title>Printing</title>
  <style>
span.th, span.td { display: table-cell; }
span.td { padding-left: 2rem; }
span.th { width:4rem; text-align: right; }
span.tr { display: table-row;     counter-increment: linenum; }
span.line_no::before {
    content: counter(linenum);
    text-align: right;
    display: block;
    font-family: monospace;
    font-weight: normal;
}
h1 { margin: 0; }
.fixed { font-family: monospace }
.em { font-style: italic; }
.center { text-align: center; }
    body { font-family: sans-serif; margin: 1.5rem 0 0 3rem; background-color: #fafaf0; width: 80rem; }
    .pre { font-family: monospace; margin: auto; width: 80rem; }
#front_matter,.text { width: 50rem; }
.text { border-bottom: .5px solid black; border-top: .5px solid black; margin-top: 1rem;
padding-bottom: 1rem; margin-bottom: 2rem; }
/*.subtitle { font-weight: bold; font-size: 1.2rem; }*/
    </style>
</head>
<body>
<header>
<h1>I6 Template Layer</h1>
<div class="subtitle"><a href="http://inform7.com/">Inform 7 6M62</a> &bull; <a href="./index.html">Index</a> &bull; <a href="./Introduction.html">Introduction</a></div><hr></header>
<div id="front_matter">
<h2><a href="./Printing.i6t">Printing.i6t</a></h2><h3 id="#printing-paragraph-control">Paragraph Control.</h3><p><p> Ah, yes: the paragraph breaking algorithm. In <em> \TeX: The Program</em>,Donald Knuth writes at <em>\S 768</em>: &quot;It&#39;s sort of a miracle whenever <span class="fixed">\halign</span><br> and <span class="fixed">\valign</span> work, because they cut across so many of the control structures of \TeX.&quot; It&#39;s sort of a miracle whenever Inform 7&#39;s paragraph breaking system works, too. Most users probably imagine that it&#39;s implemented by having I7 look at where the cursor currently is (at the start of a line or not) and whether a line has just been skipped. In fact, the virtual machines simply do not offer facilities like that, and so we have to use our own book-keeping. Given the huge number of ways in which text can be printed, this is a delicate business. For some years now, &quot;spacing bugs&quot; &ndash; those where a spurious extra skipped line appears in a paragraph break, or where, conversely, no line is skipped at all &ndash; have been the least welcome in the Inform bugs database.<p></p><p> The basic method is to set <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span>, the paragraph flag, when we print any matter; every so often we reach a &quot;divide paragraph&quot; point &ndash; for instance when one rule has finished and before another is about to start &ndash; and at those positions we look for <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span>, and print a skipped line (and clear <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span> again) if we find it. Thus:<p></p><p>	<span class="fixed">&gt; WAIT</span><br>	<span class="fixed">The clock ticks ominously.</span> <em> ...first rule</em><br>	<span class="fixed">    </span> <em> ...skipped line printed at a Divide Paragraph point</em><br>	<span class="fixed">Mme Tourmalet rises from her chair and slips out.</span> <em> second rule</em><br>	<span class="fixed">    </span> <em> ...skipped line printed at a Divide Paragraph point</em><br>	<span class="fixed">&gt; </span><br><p></p><p> A divide paragraph point occurs between any two rules in an action rulebook, but not an activity rulebook: many activities exist to print text, such as the names of objects, and there would be wild spacing accidents if paragraphs were divided there. Inform places DPPs elsewhere, too: and the text substitution &quot;[conditional paragraph break]&quot; allows the user to place one anywhere.<p></p><p> A traditional layout convention handed down from Infocom makes an exception of the first paragraph to appear after the prompt, but only in one situation. Ordinarily, the first paragraph of any turn appears straight after the prompt:<p></p><p>	<span class="fixed">&gt; EXAMINE DOG</span><br>	<span class="fixed">Mme Tourmalet&#39;s borzoi looks as if it means fashion, not business.</span><br><p></p><p> The command is echoed on screen as the player types, but this doesn&#39;t set the paragraph flag, which is still clear when the text &quot;Mme Tourmalet&#39;s...&quot; begins to be printed. The single exception occurs when the command calls for the player to go to a new location, when a skipped line is printed before the room description for the new room. Thus:<p></p><p>	<span class="fixed">&gt; SOUTH</span><br>	<span class="fixed">    </span> <em> ...the &quot;going look break&quot;</em><br>	<span class="fixed">Rocky Beach</span><br><p></p><p> (Note that this is not inherent in the looking action:<p></p><p>	<span class="fixed">&gt; LOOK</span><br>	<span class="fixed">Rocky Beach</span><br><p></p><p> ...which obeys the standard paragraphing conventions.)<p></p><p> So much for automatic paragraph breaks. However, we need a variety of different ways explicitly to control paragraphs, in order to accommodate traditional layout conventions handed down from Infocom.<p></p><p> The simplest exceptional kind of paragraph break is a &quot;command clarification break&quot;, in which a single new-line is printed but there is no skipped line: as the name implies, it&#39;s traditionally used when a command such as OPEN DOOR is clarified. For example:<p></p><p>	<span class="fixed">(first unlocking the oak door)</span> <em> ...now a command clarification break</em><br>	<span class="fixed">You open the oak door.</span><br><p></p><p> This is not quite the same thing as a &quot;run paragraph on&quot; break, in which we also deliberately suppress the skipped line, but make an exception for the skipped line which ought to appear last before the prompt: the idea is to merge two or more paragraphs together.<p></p><p>	<span class="fixed">&gt; TAKE ALL</span><br>	<span class="fixed">marmot: Taken.</span> <em> ...we run paragraph on here</em><br>	<span class="fixed">weasel: Taken.</span> <em> ...and also here</em><br>	<span class="fixed">    </span> <em> ...despite which the final skip does occur</em><br>	<span class="fixed">&gt; </span> <em> ...before the next prompt</em><br><p></p><p> A more complicated case is &quot;special look spacing&quot;, used for the break which occurs after the (boldface) short name of a room description is printed. This is tricky because it is sometimes followed directly by a long description, and we don&#39;t want a skipped line:<p></p><p>	<span class="fixed">Villa Christiane</span> <em> ...a special look spacing break</em><br>	<span class="fixed">The walled garden of a villa in Cap d&#39;Agde.</span><br>	<span class="fixed">    </span> <em> ...a Divide Paragraph break</em><br>	<span class="fixed">Mme Tourmalet&#39;s borzoi lazes in the long grass.</span><br><p></p><p> But sometimes it is followed directly by a subsequent paragraph, and again we want no skip:<p></p><p>	<span class="fixed">Villa Christiane</span> <em> ...a special look spacing break</em><br>	<span class="fixed">Mme Tourmalet&#39;s borzoi lazes in the long grass.</span><br><p></p><p> And sometimes it is the only content of the room description and is followed only by the prompt:<p></p><p>	<span class="fixed">Villa Christiane</span> <em> ...a special look spacing break</em><br>	<span class="fixed">    </span> <em> ...a break inserted before the prompt</em><br>	<span class="fixed">&gt; </span><br><p></p><p> To recap, we have five kinds of paragraph break:<p></p><p> (a) Standard breaks at &quot;divide paragraph points&quot;, used between rules. (b) The &quot;going look break&quot;, used before the room description after going to a new room. (c) A &quot;command clarification break&quot;, used after text clarifying a command. (d) A &quot;run paragraph on&quot; break, used to merge multiple paragraphs into a single block of text. (e) The &quot;special look spacing&quot; break, used after the boldface headline of a room description.<p></p><p> We now have to implement all of these behaviours. The code, while very simple, is highly prone to behaving unexpectedly if changes are made, simply because of the huge number of circumstances in which paragraphs are printed: so change nothing without very careful testing.<p></p><p><h3 id="#printing-state">State.</h3><p><p> The current state is stored in a combination of two global variables:<p></p><p> (1) <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span>, the &quot;say paragraph&quot; flag, which is set if a paragraph break needs to be printed before the next text can begin; (2) <span class="fixed">say__pc</span>, originally named as the &quot;paragraph completed&quot; flag, but which is now a bitmap: (-2a) <span class="fixed"><a href="./Definitions.i6t.html#line261">PARA_COMPLETED</a></span> is set if a standard paragraph break has been made since the last time the flag was cleared; (-2b) <span class="fixed"><a href="./Definitions.i6t.html#line262">PARA_PROMPTSKIP</a></span> is set to indicate that the current printing position does not follow a skipped line, and that further material is expected which will run on from the previous paragraph, but that if no further material turns up then a skipped line would be needed before the next prompt;(-2c) <span class="fixed"><a href="./Definitions.i6t.html#line263">PARA_SUPPRESSPROMPTSKIP</a></span> is set to indicate that, despite <span class="fixed"><a href="./Definitions.i6t.html#line262">PARA_PROMPTSKIP</a></span><br> being set, no skipped line is needed before the prompt after all; (-2d) <span class="fixed"><a href="./Definitions.i6t.html#line264">PARA_NORULEBOOKBREAKS</a></span> suppresses divide paragraph points in between rules in rulebooks; it treats all rulebooks, and in particular action rulebooks, the way activity rulebooks are treated. (The flag is used for short periods only and never across turn boundaries, prompts and so on.) (-2e) <span class="fixed"><a href="./Definitions.i6t.html#line265">PARA_CONTENTEXPECTED</a></span> is set after a paragraph division as a signal that if any contents looks likely to be printed soon then <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span> needs to be set, because a successor paragraph will then have started. This is checked by calling <span class="fixed"><a href="./Printing.i6t.html#line191">ParaContent()</a></span> &ndash; while it&#39;s slow to have to call this routine so often, that&#39;s better than compiling inline code with the same effect, because minimising compiled code size is more important, and speed is never a big deal when printing.<p></p><p> Not all printing is to the screen: sometimes the output is to a file, or to memory, and in that case we want to start the switched output at a clear paragraphing state and then go back to the screen afterwards without any sign of change. The correct way to do this is to push the <span class="fixed"><a href="./Output.i6t.html#line173">say__p</a></span> and <span class="fixed">say__pc</span> variables onto the VM stack and call <span class="fixed"><a href="./Printing.i6t.html#line169">ClearParagraphing()</a></span> before starting to print to the new stream, and then pull the variables back again before resuming printing to the old stream.<p></p><p> In no other case should any code alter <span class="fixed">say__pc</span> except via the routines below.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line167">167</span><span class="td">!Constant&nbsp;TRACE_I7_SPACING;</span></span>
<span class="tr"><span class="th" id="line168">168</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line169">169</span><span class="td">[&nbsp;ClearParagraphing&nbsp;r;</span></span>
<span class="tr"><span class="th" id="line170">170</span><span class="td">&nbsp;say__p&nbsp;=&nbsp;0;&nbsp;say__pc&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line171">171</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line172">172</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line173">173</span><span class="td">[&nbsp;DivideParagraphPoint;</span></span>
<span class="tr"><span class="th" id="line174">174</span><span class="td">&nbsp;#ifdef&nbsp;TRACE_I7_SPACING;&nbsp;print&nbsp;&quot;[DPP&quot;,&nbsp;say__p,&nbsp;say__pc,&nbsp;&quot;]&quot;;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line175">175</span><span class="td">&nbsp;if&nbsp;(say__p)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line176">176</span><span class="td">&nbsp;&nbsp;new_line;&nbsp;say__p&nbsp;=&nbsp;0;&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;|&nbsp;PARA_COMPLETED;</span></span>
<span class="tr"><span class="th" id="line177">177</span><span class="td">&nbsp;&nbsp;say__pc_save&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line178">178</span><span class="td">&nbsp;&nbsp;if&nbsp;(say__pc&nbsp;&amp;&nbsp;PARA_PROMPTSKIP)&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;-&nbsp;PARA_PROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line179">179</span><span class="td">&nbsp;&nbsp;if&nbsp;(say__pc&nbsp;&amp;&nbsp;PARA_SUPPRESSPROMPTSKIP)&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;-&nbsp;PARA_SUPPRESSPROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line180">180</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line181">181</span><span class="td">&nbsp;#ifdef&nbsp;TRACE_I7_SPACING;&nbsp;print&nbsp;&quot;[--&gt;&quot;,&nbsp;say__p,&nbsp;say__pc,&nbsp;&quot;]&quot;;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line182">182</span><span class="td">&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;|&nbsp;PARA_CONTENTEXPECTED;</span></span>
<span class="tr"><span class="th" id="line183">183</span><span class="td">&nbsp;say__pc_save&nbsp;=&nbsp;(say__pc&nbsp;&amp;&nbsp;PARA_COMPLETED);</span></span>
<span class="tr"><span class="th" id="line184">184</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line185">185</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line186">186</span><span class="td">[&nbsp;AdjustParagraphPoint;</span></span>
<span class="tr"><span class="th" id="line187">187</span><span class="td">&nbsp;#ifdef&nbsp;TRACE_I7_SPACING;&nbsp;print&nbsp;&quot;[APP&nbsp;&quot;,&nbsp;say__p,&nbsp;&quot;&nbsp;&quot;,&nbsp;say__pc,&nbsp;&quot;&nbsp;&quot;,&nbsp;say__pc_save,&nbsp;&quot;]^&quot;;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line188">188</span><span class="td">&nbsp;if&nbsp;(say__pc_save)&nbsp;say__pc&nbsp;=&nbsp;(say__pc&nbsp;|&nbsp;PARA_COMPLETED);</span></span>
<span class="tr"><span class="th" id="line189">189</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line190">190</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line191">191</span><span class="td">[&nbsp;ParaContent;</span></span>
<span class="tr"><span class="th" id="line192">192</span><span class="td">&nbsp;if&nbsp;(say__pc&nbsp;&amp;&nbsp;PARA_CONTENTEXPECTED)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line193">193</span><span class="td">&nbsp;&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;-&nbsp;PARA_CONTENTEXPECTED;</span></span>
<span class="tr"><span class="th" id="line194">194</span><span class="td">&nbsp;&nbsp;say__p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line195">195</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line196">196</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line197">197</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line198">198</span><span class="td">[&nbsp;GoingLookBreak;</span></span>
<span class="tr"><span class="th" id="line199">199</span><span class="td">&nbsp;if&nbsp;(say__pc&nbsp;&amp;&nbsp;PARA_COMPLETED&nbsp;==&nbsp;0)&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line200">200</span><span class="td">&nbsp;ClearParagraphing(10);</span></span>
<span class="tr"><span class="th" id="line201">201</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line202">202</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line203">203</span><span class="td">[&nbsp;CommandClarificationBreak;</span></span>
<span class="tr"><span class="th" id="line204">204</span><span class="td">&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line205">205</span><span class="td">&nbsp;ClearParagraphing(11);</span></span>
<span class="tr"><span class="th" id="line206">206</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line207">207</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line208">208</span><span class="td">[&nbsp;RunParagraphOn;</span></span>
<span class="tr"><span class="th" id="line209">209</span><span class="td">&nbsp;#ifdef&nbsp;TRACE_I7_SPACING;&nbsp;print&nbsp;&quot;[RPO&quot;,&nbsp;say__p,&nbsp;say__pc,&nbsp;&quot;]&quot;;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line210">210</span><span class="td">&nbsp;say__p&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line211">211</span><span class="td">&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;|&nbsp;PARA_PROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line212">212</span><span class="td">&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;|&nbsp;PARA_SUPPRESSPROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line213">213</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line214">214</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line215">215</span><span class="td">[&nbsp;SpecialLookSpacingBreak;</span></span>
<span class="tr"><span class="th" id="line216">216</span><span class="td">&nbsp;#ifdef&nbsp;TRACE_I7_SPACING;&nbsp;print&nbsp;&quot;[SLS&quot;,&nbsp;say__p,&nbsp;say__pc,&nbsp;&quot;]&quot;;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line217">217</span><span class="td">&nbsp;say__p&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line218">218</span><span class="td">&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;|&nbsp;PARA_PROMPTSKIP;</span></span>
<span class="tr"><span class="th" id="line219">219</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line220">220</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line221">221</span><span class="td">[&nbsp;EnsureBreakBeforePrompt;</span></span>
<span class="tr"><span class="th" id="line222">222</span><span class="td">&nbsp;if&nbsp;((say__p)&nbsp;||</span></span>
<span class="tr"><span class="th" id="line223">223</span><span class="td">&nbsp;&nbsp;((say__pc&nbsp;&amp;&nbsp;PARA_PROMPTSKIP)&nbsp;&amp;&amp;&nbsp;((say__pc&nbsp;&amp;&nbsp;PARA_SUPPRESSPROMPTSKIP)==0)))</span></span>
<span class="tr"><span class="th" id="line224">224</span><span class="td">&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line225">225</span><span class="td">&nbsp;ClearParagraphing(12);</span></span>
<span class="tr"><span class="th" id="line226">226</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line227">227</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line228">228</span><span class="td">[&nbsp;PrintSingleParagraph&nbsp;matter;</span></span>
<span class="tr"><span class="th" id="line229">229</span><span class="td">&nbsp;say__p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line230">230</span><span class="td">&nbsp;say__pc&nbsp;=&nbsp;say__pc&nbsp;|&nbsp;PARA_NORULEBOOKBREAKS;</span></span>
<span class="tr"><span class="th" id="line231">231</span><span class="td">&nbsp;TEXT_TY_Say(matter);</span></span>
<span class="tr"><span class="th" id="line232">232</span><span class="td">&nbsp;DivideParagraphPoint(13);</span></span>
<span class="tr"><span class="th" id="line233">233</span><span class="td">&nbsp;say__pc&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line234">234</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-say-number">Say Number.</h3><p><p> The global variable <span class="fixed"><a href="./Output.i6t.html#line174">say__n</a></span> is set to the numerical value of any quantity printed, and this is used for the text substitution &quot;[s]&quot;, so that &quot;You have been awake for [turn count] turn[s].&quot; will expand correctly.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line242">242</span><span class="td">[&nbsp;STextSubstitution;</span></span>
<span class="tr"><span class="th" id="line243">243</span><span class="td">&nbsp;if&nbsp;(say__n&nbsp;~=&nbsp;1)&nbsp;print&nbsp;&quot;s&quot;;</span></span>
<span class="tr"><span class="th" id="line244">244</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-prompt">Prompt.</h3><p><p> This is the text printed just before we wait for the player&#39;s command: it prompts him to type.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line251">251</span><span class="td">[&nbsp;PrintPrompt&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line252">252</span><span class="td">&nbsp;RunTimeProblemShow();</span></span>
<span class="tr"><span class="th" id="line253">253</span><span class="td">&nbsp;ClearRTP();</span></span>
<span class="tr"><span class="th" id="line254">254</span><span class="td">&nbsp;style&nbsp;roman;</span></span>
<span class="tr"><span class="th" id="line255">255</span><span class="td">&nbsp;EnsureBreakBeforePrompt();</span></span>
<span class="tr"><span class="th" id="line256">256</span><span class="td">&nbsp;TEXT_TY_Say(&nbsp;(+&nbsp;command&nbsp;prompt&nbsp;+)&nbsp;);</span></span>
<span class="tr"><span class="th" id="line257">257</span><span class="td">&nbsp;ClearBoxedText();</span></span>
<span class="tr"><span class="th" id="line258">258</span><span class="td">&nbsp;ClearParagraphing(14);</span></span>
<span class="tr"><span class="th" id="line259">259</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-boxed-quotations">Boxed Quotations.</h3><p><p> These appear once only, and happen outside of the paragraphing scheme: they are normally overlaid as windows on top of the regular text. We can request one at any time, but it will appear only at prompt time, when the screen is fairly well guaranteed not to be scrolling. (Only fairly well since it&#39;s just possible that <em> Border Zone</em>-like tricks with real-time play might be going on, but whatever happens, there is at least a human-appreciable pause in which the quotation can be read before being taken away again.)<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line271">271</span><span class="td">Global&nbsp;pending_boxed_quotation;&nbsp;!&nbsp;a&nbsp;routine&nbsp;to&nbsp;overlay&nbsp;the&nbsp;quotation&nbsp;on&nbsp;screen</span></span>
<span class="tr"><span class="th" id="line272">272</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line273">273</span><span class="td">[&nbsp;DisplayBoxedQuotation&nbsp;Q;</span></span>
<span class="tr"><span class="th" id="line274">274</span><span class="td">&nbsp;pending_boxed_quotation&nbsp;=&nbsp;Q;</span></span>
<span class="tr"><span class="th" id="line275">275</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line276">276</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line277">277</span><span class="td">[&nbsp;ClearBoxedText&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line278">278</span><span class="td">&nbsp;if&nbsp;(pending_boxed_quotation)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line279">279</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=0:&nbsp;Runtime_Quotations_Displayed--&gt;i:&nbsp;i++)</span></span>
<span class="tr"><span class="th" id="line280">280</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(Runtime_Quotations_Displayed--&gt;i&nbsp;==&nbsp;pending_boxed_quotation)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line281">281</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;pending_boxed_quotation&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line282">282</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line283">283</span><span class="td">&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line284">284</span><span class="td">&nbsp;&nbsp;Runtime_Quotations_Displayed--&gt;i&nbsp;=&nbsp;pending_boxed_quotation;</span></span>
<span class="tr"><span class="th" id="line285">285</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line286">286</span><span class="td">&nbsp;&nbsp;ClearParagraphing(15);</span></span>
<span class="tr"><span class="th" id="line287">287</span><span class="td">&nbsp;&nbsp;pending_boxed_quotation();</span></span>
<span class="tr"><span class="th" id="line288">288</span><span class="td">&nbsp;&nbsp;ClearParagraphing(16);</span></span>
<span class="tr"><span class="th" id="line289">289</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line290">290</span><span class="td">&nbsp;&nbsp;pending_boxed_quotation&nbsp;=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line291">291</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line292">292</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-score-notification">Score Notification.</h3><p><p> This doesn&#39;t really deserve to be at I6 level at all, but since for traditional reasons we need to use conditional compilation on <span class="fixed"><a href="./Output.i6t.html#line60">USE_SCORING</a></span>, and since we want a fancy text style for Glulx, ...<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line300">300</span><span class="td">[&nbsp;NotifyTheScore&nbsp;d;</span></span>
<span class="tr"><span class="th" id="line301">301</span><span class="td">#Iftrue&nbsp;USE_SCORING&nbsp;~=&nbsp;0;</span></span>
<span class="tr"><span class="th" id="line302">302</span><span class="td">&nbsp;if&nbsp;(notify_mode&nbsp;==&nbsp;1)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line303">303</span><span class="td">&nbsp;&nbsp;DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line304">304</span><span class="td">&nbsp;&nbsp;VM_Style(NOTE_VMSTY);</span></span>
<span class="tr"><span class="th" id="line305">305</span><span class="td">&nbsp;&nbsp;d&nbsp;=&nbsp;score-last_score;</span></span>
<span class="tr"><span class="th" id="line306">306</span><span class="td">&nbsp;&nbsp;if&nbsp;(d&nbsp;&gt;&nbsp;0)&nbsp;{&nbsp;ANNOUNCE_SCORE_RM(&#39;D&#39;,&nbsp;d);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line307">307</span><span class="td">&nbsp;&nbsp;else&nbsp;if&nbsp;(d&nbsp;&lt;&nbsp;0)&nbsp;{&nbsp;ANNOUNCE_SCORE_RM(&#39;E&#39;,&nbsp;-d);&nbsp;}</span></span>
<span class="tr"><span class="th" id="line308">308</span><span class="td">&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line309">309</span><span class="td">&nbsp;&nbsp;VM_Style(NORMAL_VMSTY);</span></span>
<span class="tr"><span class="th" id="line310">310</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line311">311</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line312">312</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-status-line">Status Line.</h3><p><p> Status line printing happens on the upper screen window, and outside of the paragraph control system.<p></p><p> Support for version 6 of the Z-machine is best described as grudging. It requires a heavily rewritten <span class="fixed"><a href="./Printing.i6t.html#line330">DrawStatusLine</a></span> equivalent, to be found in <span class="fixed"><a href="./ZMachine.i6t.html">ZMachine.i6t</a></span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line323">323</span><span class="td">#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line324">324</span><span class="td">#Iftrue&nbsp;(#version_number&nbsp;==&nbsp;6);</span></span>
<span class="tr"><span class="th" id="line325">325</span><span class="td">[&nbsp;DrawStatusLine;&nbsp;Z6_DrawStatusLine();&nbsp;];</span></span>
<span class="tr"><span class="th" id="line326">326</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line327">327</span><span class="td">#Endif;</span></span>
<span class="tr"><span class="th" id="line328">328</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line329">329</span><span class="td">#Ifndef&nbsp;DrawStatusLine;</span></span>
<span class="tr"><span class="th" id="line330">330</span><span class="td">[&nbsp;DrawStatusLine&nbsp;width&nbsp;posb;</span></span>
<span class="tr"><span class="th" id="line331">331</span><span class="td">&nbsp;@push&nbsp;say__p;&nbsp;@push&nbsp;say__pc;</span></span>
<span class="tr"><span class="th" id="line332">332</span><span class="td">&nbsp;BeginActivity(CONSTRUCTING_STATUS_LINE_ACT);</span></span>
<span class="tr"><span class="th" id="line333">333</span><span class="td">&nbsp;VM_StatusLineHeight(1);&nbsp;VM_MoveCursorInStatusLine(1,&nbsp;1);&nbsp;</span></span>
<span class="tr"><span class="th" id="line334">334</span><span class="td">&nbsp;if&nbsp;(statuswin_current)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line335">335</span><span class="td">&nbsp;&nbsp;width&nbsp;=&nbsp;VM_ScreenWidth();&nbsp;posb&nbsp;=&nbsp;width-15;</span></span>
<span class="tr"><span class="th" id="line336">336</span><span class="td">&nbsp;&nbsp;spaces&nbsp;width;</span></span>
<span class="tr"><span class="th" id="line337">337</span><span class="td">&nbsp;&nbsp;ClearParagraphing(17);</span></span>
<span class="tr"><span class="th" id="line338">338</span><span class="td">&nbsp;&nbsp;if&nbsp;(ForActivity(CONSTRUCTING_STATUS_LINE_ACT)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line339">339</span><span class="td">&nbsp;&nbsp;&nbsp;VM_MoveCursorInStatusLine(1,&nbsp;2);</span></span>
<span class="tr"><span class="th" id="line340">340</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_Say(left_hand_status_line);</span></span>
<span class="tr"><span class="th" id="line341">341</span><span class="td">&nbsp;&nbsp;&nbsp;VM_MoveCursorInStatusLine(1,&nbsp;posb);</span></span>
<span class="tr"><span class="th" id="line342">342</span><span class="td">&nbsp;&nbsp;&nbsp;TEXT_TY_Say(right_hand_status_line);</span></span>
<span class="tr"><span class="th" id="line343">343</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line344">344</span><span class="td">&nbsp;&nbsp;VM_MoveCursorInStatusLine(1,&nbsp;1);&nbsp;VM_MainWindow();</span></span>
<span class="tr"><span class="th" id="line345">345</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line346">346</span><span class="td">&nbsp;ClearParagraphing(18);</span></span>
<span class="tr"><span class="th" id="line347">347</span><span class="td">&nbsp;EndActivity(CONSTRUCTING_STATUS_LINE_ACT);</span></span>
<span class="tr"><span class="th" id="line348">348</span><span class="td">&nbsp;@pull&nbsp;say__pc;&nbsp;@pull&nbsp;say__p;</span></span>
<span class="tr"><span class="th" id="line349">349</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line350">350</span><span class="td">#Endif;</span></span>
</div><div class='text'>
<h3 id="#printing-status-line-utilities">Status Line Utilities.</h3><p><p>Two convenient routines for the default values of <span class="fixed"><a href="./Output.i6t.html#line225">right_hand_status_line</a></span><br> and <span class="fixed"><a href="./Output.i6t.html#line224">left_hand_status_line</a></span> respectively. <span class="fixed"><a href="./Printing.i6t.html#line367">SL_Location</a></span> also implements the text substitution &quot;[player&#39;s surroundings]&quot;.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line358">358</span><span class="td">Array&nbsp;T_SL_Score_Moves&nbsp;--&gt;&nbsp;CONSTANT_PACKED_TEXT_STORAGE&nbsp;SL_Score_Moves;</span></span>
<span class="tr"><span class="th" id="line359">359</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line360">360</span><span class="td">[&nbsp;SL_Score_Moves;</span></span>
<span class="tr"><span class="th" id="line361">361</span><span class="td">&nbsp;if&nbsp;(not_yet_in_play)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line362">362</span><span class="td">&nbsp;#Iftrue&nbsp;USE_SCORING&nbsp;&gt;&nbsp;0;&nbsp;print&nbsp;sline1,&nbsp;&quot;/&quot;,&nbsp;sline2;&nbsp;#endif;</span></span>
<span class="tr"><span class="th" id="line363">363</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line364">364</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line365">365</span><span class="td">Array&nbsp;T_SL_Location&nbsp;--&gt;&nbsp;CONSTANT_PACKED_TEXT_STORAGE&nbsp;SL_Location;</span></span>
<span class="tr"><span class="th" id="line366">366</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line367">367</span><span class="td">[&nbsp;SL_Location&nbsp;even_before;</span></span>
<span class="tr"><span class="th" id="line368">368</span><span class="td">&nbsp;if&nbsp;((not_yet_in_play)&nbsp;&amp;&amp;&nbsp;(even_before&nbsp;==&nbsp;false))&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line369">369</span><span class="td">&nbsp;if&nbsp;(location&nbsp;==&nbsp;thedark)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line370">370</span><span class="td">&nbsp;&nbsp;BeginActivity(PRINTING_NAME_OF_DARK_ROOM_ACT);</span></span>
<span class="tr"><span class="th" id="line371">371</span><span class="td">&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_NAME_OF_DARK_ROOM_ACT)&nbsp;==&nbsp;false)</span></span>
<span class="tr"><span class="th" id="line372">372</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;DARKNESS_NAME_INTERNAL_RM(&#39;A&#39;);</span></span>
<span class="tr"><span class="th" id="line373">373</span><span class="td">&nbsp;&nbsp;EndActivity(PRINTING_NAME_OF_DARK_ROOM_ACT);</span></span>
<span class="tr"><span class="th" id="line374">374</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line375">375</span><span class="td">&nbsp;&nbsp;FindVisibilityLevels();</span></span>
<span class="tr"><span class="th" id="line376">376</span><span class="td">&nbsp;&nbsp;if&nbsp;(visibility_ceiling&nbsp;==&nbsp;location)&nbsp;print&nbsp;(name)&nbsp;location;</span></span>
<span class="tr"><span class="th" id="line377">377</span><span class="td">&nbsp;&nbsp;else&nbsp;print&nbsp;(The)&nbsp;visibility_ceiling;</span></span>
<span class="tr"><span class="th" id="line378">378</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line379">379</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line380">380</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line381">381</span><span class="td">[&nbsp;DARKNESS_NAME_INTERNAL_R;&nbsp;];</span></span>
</div><div class='text'>
<h3 id="#printing-banner">Banner.</h3><p><p> Note that NI always compiles <span class="fixed">Story</span> and <span class="fixed">Headline</span> texts, but does not always compile a <span class="fixed">Story_Author</span>.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line388">388</span><span class="td">[&nbsp;Banner;</span></span>
<span class="tr"><span class="th" id="line389">389</span><span class="td">&nbsp;&nbsp;&nbsp;BeginActivity(PRINTING_BANNER_TEXT_ACT);</span></span>
<span class="tr"><span class="th" id="line390">390</span><span class="td">&nbsp;&nbsp;&nbsp;if&nbsp;(ForActivity(PRINTING_BANNER_TEXT_ACT)&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line391">391</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_Style(HEADER_VMSTY);</span></span>
<span class="tr"><span class="th" id="line392">392</span><span class="td">&nbsp;&nbsp;TEXT_TY_Say(Story);</span></span>
<span class="tr"><span class="th" id="line393">393</span><span class="td">&nbsp;&nbsp;VM_Style(NORMAL_VMSTY);</span></span>
<span class="tr"><span class="th" id="line394">394</span><span class="td">&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line395">395</span><span class="td">&nbsp;&nbsp;TEXT_TY_Say(Headline);</span></span>
<span class="tr"><span class="th" id="line396">396</span><span class="td">&nbsp;&nbsp;#ifdef&nbsp;Story_Author;</span></span>
<span class="tr"><span class="th" id="line397">397</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;&nbsp;by&nbsp;&quot;;&nbsp;TEXT_TY_Say(Story_Author);</span></span>
<span class="tr"><span class="th" id="line398">398</span><span class="td">&nbsp;&nbsp;#endif;&nbsp;!&nbsp;Story_Author</span></span>
<span class="tr"><span class="th" id="line399">399</span><span class="td">&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line400">400</span><span class="td">&nbsp;&nbsp;VM_Describe_Release();</span></span>
<span class="tr"><span class="th" id="line401">401</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;&nbsp;/&nbsp;Inform&nbsp;7&nbsp;build&nbsp;&quot;,&nbsp;(PrintI6Text)&nbsp;NI_BUILD_COUNT,&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line402">402</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;(I6/v&quot;;&nbsp;inversion;</span></span>
<span class="tr"><span class="th" id="line403">403</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;&nbsp;lib&nbsp;&quot;,&nbsp;(PrintI6Text)&nbsp;LibRelease,&nbsp;&quot;)&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line404">404</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;STRICT_MODE;</span></span>
<span class="tr"><span class="th" id="line405">405</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;S&quot;;</span></span>
<span class="tr"><span class="th" id="line406">406</span><span class="td">&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;STRICT_MODE</span></span>
<span class="tr"><span class="th" id="line407">407</span><span class="td">&nbsp;&nbsp;#Ifdef&nbsp;DEBUG;</span></span>
<span class="tr"><span class="th" id="line408">408</span><span class="td">&nbsp;&nbsp;print&nbsp;&quot;D&quot;;</span></span>
<span class="tr"><span class="th" id="line409">409</span><span class="td">&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;DEBUG</span></span>
<span class="tr"><span class="th" id="line410">410</span><span class="td">&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line411">411</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line412">412</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;EndActivity(PRINTING_BANNER_TEXT_ACT);</span></span>
<span class="tr"><span class="th" id="line413">413</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-print-decimal-number">Print Decimal Number.</h3><p><p> <span class="fixed"><a href="./Printing.i6t.html#line423">DecimalNumber</a></span> is a trivial function which just prints a number, in decimal digits. It is left over from the I6 library&#39;s support routines for Glulx, where it was intended as a stub to pass to the Glulx <span class="fixed"><a href="./Glulx.i6t.html#line1661">Glulx_PrintAnything</a></span> routine (which I7 does not use). In I7, however, it&#39;s also used as the default printing routine for new kinds of value.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line423">423</span><span class="td">[&nbsp;DecimalNumber&nbsp;num;&nbsp;print&nbsp;num;&nbsp;];</span></span>
</div><div class='text'>
<h3 id="#printing-print-english-number">Print English Number.</h3><p><p> Another traditional name, this: in fact it prints the number as text in whatever is the current language of play.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line430">430</span><span class="td">[&nbsp;EnglishNumber&nbsp;n;&nbsp;LanguageNumber(n);&nbsp;];</span></span>
</div><div class='text'>
<h3 id="#printing-print-text">Print Text.</h3><p><p> The routine for printing an I7 &quot;text&quot; value, which might be text with or without substitutions.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line437">437</span><span class="td">[&nbsp;PrintI6Text&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line438">438</span><span class="td">&nbsp;if&nbsp;(x&nbsp;ofclass&nbsp;String)&nbsp;print&nbsp;(string)&nbsp;x;</span></span>
<span class="tr"><span class="th" id="line439">439</span><span class="td">&nbsp;if&nbsp;(x&nbsp;ofclass&nbsp;Routine)&nbsp;return&nbsp;(x)();</span></span>
<span class="tr"><span class="th" id="line440">440</span><span class="td">&nbsp;if&nbsp;(x&nbsp;==&nbsp;EMPTY_TEXT_PACKED)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line441">441</span><span class="td">&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line442">442</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line443">443</span><span class="td">[&nbsp;I7_String&nbsp;x;&nbsp;TEXT_TY_Say(x);&nbsp;];&nbsp;!&nbsp;An&nbsp;alternative&nbsp;name&nbsp;now&nbsp;used&nbsp;only&nbsp;by&nbsp;extensions</span></span>
</div><div class='text'>
<h3 id="#printing-print-or-run">Print Or Run.</h3><p><p> This utility remains from the old I6 library: it essentially treats aproperty as textual and prints it where possible. Where the <span class="fixed">no_break</span><br> flag is set, we expect the text to form only a small part of a paragraph, and it&#39;s inappropriate to break here: for instance, for printing the &quot;printed name&quot; of an object. Where the flag is clear, however, the text is expected to form its own paragraph.<p></p><p> Where <span class="fixed"><a href="./Printing.i6t.html#line460">PrintOrRun</a></span> is used in breaking mode, which is only for a very few properties in I7 (indeed at present only <span class="fixed">initial</span> and <span class="fixed">description</span>), the routine called is given the chance to decide whether to print or not. It should return <span class="fixed">true</span> or <span class="fixed">false</span> according to whether it did so; this allows us to divide the paragraph or not accordingly.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line460">460</span><span class="td">[&nbsp;PrintOrRun&nbsp;obj&nbsp;prop&nbsp;no_break&nbsp;&nbsp;pv&nbsp;st&nbsp;routine_return_value;</span></span>
<span class="tr"><span class="th" id="line461">461</span><span class="td">&nbsp;@push&nbsp;self;&nbsp;self&nbsp;=&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line462">462</span><span class="td">&nbsp;if&nbsp;(prop&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line463">463</span><span class="td">&nbsp;&nbsp;print&nbsp;(name)&nbsp;prop;&nbsp;routine_return_value&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line464">464</span><span class="td">&nbsp;}&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line465">465</span><span class="td">&nbsp;&nbsp;routine_return_value&nbsp;=&nbsp;TEXT_TY_Say(obj.prop);</span></span>
<span class="tr"><span class="th" id="line466">466</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line467">467</span><span class="td">&nbsp;@pull&nbsp;self;</span></span>
<span class="tr"><span class="th" id="line468">468</span><span class="td">&nbsp;if&nbsp;(routine_return_value)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line469">469</span><span class="td">&nbsp;&nbsp;say__p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line470">470</span><span class="td">&nbsp;&nbsp;if&nbsp;(no_break&nbsp;==&nbsp;false)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line471">471</span><span class="td">&nbsp;&nbsp;&nbsp;new_line;</span></span>
<span class="tr"><span class="th" id="line472">472</span><span class="td">&nbsp;&nbsp;&nbsp;DivideParagraphPoint();</span></span>
<span class="tr"><span class="th" id="line473">473</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line474">474</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line475">475</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line476">476</span><span class="td">&nbsp;return&nbsp;routine_return_value;</span></span>
<span class="tr"><span class="th" id="line477">477</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-short-name-storage">Short Name Storage.</h3><p><p> None of the following functions should be called for the Z-machine if the short name exceeds the size of the following buffer: whereas the Glulx implementation of <span class="fixed"><a href="./Glulx.i6t.html#line1363">VM_PrintToBuffer</a></span> will safely truncate overlong text, that&#39;s impossible for the Z-machine, and horrible results will follow.<p></p><p> <span class="fixed"><a href="./Printing.i6t.html#line493">CPrintOrRun</a></span> is a variation on <span class="fixed"><a href="./Printing.i6t.html#line460">PrintOrRun</a></span>, simplified by not needing to handle entire paragraphs (so, no fuss about dividing) but complicated by having to capitalise the first letter. We do this by writing to the buffer and then altering the first character.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line491">491</span><span class="td">Array&nbsp;StorageForShortName&nbsp;buffer&nbsp;250;</span></span>
<span class="tr"><span class="th" id="line492">492</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line493">493</span><span class="td">[&nbsp;CPrintOrRun&nbsp;obj&nbsp;prop&nbsp;&nbsp;v&nbsp;length&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line494">494</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;ofclass&nbsp;String&nbsp;or&nbsp;Routine)&nbsp;||&nbsp;(prop&nbsp;==&nbsp;0))</span></span>
<span class="tr"><span class="th" id="line495">495</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_PrintToBuffer&nbsp;(StorageForShortName,&nbsp;160,&nbsp;obj);</span></span>
<span class="tr"><span class="th" id="line496">496</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line497">497</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj.prop&nbsp;==&nbsp;NULL)&nbsp;rfalse;</span></span>
<span class="tr"><span class="th" id="line498">498</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(metaclass(obj.prop)&nbsp;==&nbsp;Routine&nbsp;or&nbsp;String)</span></span>
<span class="tr"><span class="th" id="line499">499</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VM_PrintToBuffer(StorageForShortName,&nbsp;160,&nbsp;obj,&nbsp;prop);</span></span>
<span class="tr"><span class="th" id="line500">500</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;return&nbsp;RunTimeError(2,&nbsp;obj,&nbsp;prop);</span></span>
<span class="tr"><span class="th" id="line501">501</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line502">502</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line503">503</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;=&nbsp;StorageForShortName--&gt;0;</span></span>
<span class="tr"><span class="th" id="line504">504</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line505">505</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;StorageForShortName-&gt;WORDSIZE&nbsp;=&nbsp;VM_LowerToUpperCase(StorageForShortName-&gt;WORDSIZE);</span></span>
<span class="tr"><span class="th" id="line506">506</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i=WORDSIZE:&nbsp;i&lt;length+WORDSIZE:&nbsp;i++)&nbsp;print&nbsp;(char)&nbsp;StorageForShortName-&gt;i;</span></span>
<span class="tr"><span class="th" id="line507">507</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&gt;WORDSIZE)&nbsp;say__p&nbsp;=&nbsp;1;</span></span>
<span class="tr"><span class="th" id="line508">508</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line509">509</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line510">510</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line511">511</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line512">512</span><span class="td">[&nbsp;Cap&nbsp;str&nbsp;nocaps;</span></span>
<span class="tr"><span class="th" id="line513">513</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nocaps)&nbsp;print&nbsp;(string)&nbsp;str;</span></span>
<span class="tr"><span class="th" id="line514">514</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;CPrintOrRun(str,&nbsp;0);</span></span>
<span class="tr"><span class="th" id="line515">515</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-object-names-i">Object Names I.</h3><p><p> We now begin the work of printing object names. In the lowest level of this process we print just the name itself (without articles attached), and we do it by carrying out an activity.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line523">523</span><span class="td">[&nbsp;PSN__&nbsp;o;</span></span>
<span class="tr"><span class="th" id="line524">524</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(o&nbsp;==&nbsp;0)&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;Y&#39;);&nbsp;rtrue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line525">525</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(metaclass(o))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line526">526</span><span class="td">&nbsp;&nbsp;Routine:&nbsp;&nbsp;print&nbsp;&quot;&lt;routine&nbsp;&quot;,&nbsp;o,&nbsp;&quot;&gt;&quot;;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line527">527</span><span class="td">&nbsp;&nbsp;String:&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&lt;string&nbsp;~&quot;,&nbsp;(string)&nbsp;o,&nbsp;&quot;~&gt;&quot;;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line528">528</span><span class="td">&nbsp;&nbsp;nothing:&nbsp;&nbsp;print&nbsp;&quot;&lt;illegal&nbsp;object&nbsp;number&nbsp;&quot;,&nbsp;o,&nbsp;&quot;&gt;&quot;;&nbsp;rtrue;</span></span>
<span class="tr"><span class="th" id="line529">529</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line530">530</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;RegardingSingleObject(o);</span></span>
<span class="tr"><span class="th" id="line531">531</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;CarryOutActivity(PRINTING_THE_NAME_ACT,&nbsp;o);</span></span>
<span class="tr"><span class="th" id="line532">532</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-standard-name-printing-rule">Standard Name Printing Rule.</h3><p><p> In its initial state, the &quot;printing the name of&quot; activity has just one rule: the following &quot;for&quot; rule.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line539">539</span><span class="td">Global&nbsp;caps_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line540">540</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line541">541</span><span class="td">[&nbsp;STANDARD_NAME_PRINTING_R&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line542">542</span><span class="td">&nbsp;obj&nbsp;=&nbsp;parameter_value;</span></span>
<span class="tr"><span class="th" id="line543">543</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line544">544</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line545">545</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIST_WRITER_INTERNAL_RM(&#39;Y&#39;);&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line546">546</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line547">547</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(metaclass(obj))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line548">548</span><span class="td">&nbsp;&nbsp;Routine:&nbsp;&nbsp;print&nbsp;&quot;&lt;routine&nbsp;&quot;,&nbsp;obj,&nbsp;&quot;&gt;&quot;;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line549">549</span><span class="td">&nbsp;&nbsp;String:&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&lt;string&nbsp;~&quot;,&nbsp;(string)&nbsp;obj,&nbsp;&quot;~&gt;&quot;;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line550">550</span><span class="td">&nbsp;&nbsp;nothing:&nbsp;&nbsp;print&nbsp;&quot;&lt;illegal&nbsp;object&nbsp;number&nbsp;&quot;,&nbsp;obj,&nbsp;&quot;&gt;&quot;;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line551">551</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line552">552</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;==&nbsp;player)&nbsp;{&nbsp;</span></span>
<span class="tr"><span class="th" id="line553">553</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;==&nbsp;NULL&nbsp;&amp;&amp;&nbsp;caps_mode)&nbsp;PRINT_PROTAGONIST_INTERNAL_RM(&#39;A&#39;);</span></span>
<span class="tr"><span class="th" id="line554">554</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;PRINT_PROTAGONIST_INTERNAL_RM(&#39;B&#39;);</span></span>
<span class="tr"><span class="th" id="line555">555</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line556">556</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line557">557</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;LanguagePrintShortName;</span></span>
<span class="tr"><span class="th" id="line558">558</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(LanguagePrintShortName(obj))&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line559">559</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguagePrintShortName</span></span>
<span class="tr"><span class="th" id="line560">560</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(indef_mode&nbsp;&amp;&amp;&nbsp;obj.&amp;short_name_indef&nbsp;~=&nbsp;0&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line561">561</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintOrRun(obj,&nbsp;short_name_indef,&nbsp;true)&nbsp;~=&nbsp;0)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line562">562</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(caps_mode&nbsp;&amp;&amp;</span></span>
<span class="tr"><span class="th" id="line563">563</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj.&amp;cap_short_name&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;PrintOrRun(obj,&nbsp;cap_short_name,&nbsp;true)&nbsp;~=&nbsp;0)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line564">564</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caps_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line565">565</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line566">566</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line567">567</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj.&amp;short_name&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;PrintOrRun(obj,&nbsp;short_name,&nbsp;true)&nbsp;~=&nbsp;0)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line568">568</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(object)&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line569">569</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-internal-rule">Internal Rule.</h3><p><p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line574">574</span><span class="td">[&nbsp;PRINT_PROTAGONIST_INTERNAL_R;&nbsp;];</span></span>
</div><div class='text'>
<h3 id="#printing-object-names-ii">Object Names II.</h3><p><p> The second level of the system for printing object names handles the placing of articles in front of them: <em> the</em> red herring, <em> an</em> elephant, <em> Some</em> bread. The following routine allows us to choose:<p></p><p> (a) <span class="fixed">obj</span>, the object whose name is to be printed; (b) <span class="fixed">acode</span>, the kind of article needed: capitalised definite (0), lower case uncapitalised definite (1), or uncapitalised indefinite (2); (c) <span class="fixed">pluralise</span>, a flag forcing to a plural form (e.g., &quot;some&quot; being the pluralised form of an indefinite article in English); (d) <span class="fixed">capitalise</span>, a flag forcing us to capitalise the article &ndash; it&#39;s by setting this that we can achieve the fourth option missing from (b), viz., capitalised indefinite. (All of this is a legacy design from a time when the I6 library did not support capitalised indefinite articles.)<p></p><p> The routine then looks after issues such as which contraction form to use: for instance, in English, whether to use &quot;a&quot; or &quot;an&quot; for the indefinite singular depends on the text of the object&#39;s name.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line596">596</span><span class="td">Global&nbsp;short_name_case;</span></span>
<span class="tr"><span class="th" id="line597">597</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line598">598</span><span class="td">[&nbsp;PrefaceByArticle&nbsp;obj&nbsp;acode&nbsp;pluralise&nbsp;capitalise&nbsp;&nbsp;i&nbsp;artform&nbsp;findout&nbsp;artval;</span></span>
<span class="tr"><span class="th" id="line599">599</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;provides&nbsp;articles)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line600">600</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;artval=(obj.&amp;articles)--&gt;(acode+short_name_case*LanguageCases);</span></span>
<span class="tr"><span class="th" id="line601">601</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(capitalise)</span></span>
<span class="tr"><span class="th" id="line602">602</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(Cap)&nbsp;artval,&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line603">603</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line604">604</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(string)&nbsp;artval,&nbsp;&quot;&nbsp;&quot;;</span></span>
<span class="tr"><span class="th" id="line605">605</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pluralise)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line606">606</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(PSN__)&nbsp;obj;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line607">607</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line608">608</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line609">609</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;GetGNAOfObject(obj);</span></span>
<span class="tr"><span class="th" id="line610">610</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pluralise)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line611">611</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(i&nbsp;&lt;&nbsp;3&nbsp;||&nbsp;(i&nbsp;&gt;=&nbsp;6&nbsp;&amp;&amp;&nbsp;i&nbsp;&lt;&nbsp;9))&nbsp;i&nbsp;=&nbsp;i&nbsp;+&nbsp;3;</span></span>
<span class="tr"><span class="th" id="line612">612</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line613">613</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;LanguageGNAsToArticles--&gt;i;</span></span>
<span class="tr"><span class="th" id="line614">614</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line615">615</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;artform&nbsp;=&nbsp;LanguageArticles</span></span>
<span class="tr"><span class="th" id="line616">616</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;3*WORDSIZE*LanguageContractionForms*(short_name_case&nbsp;+&nbsp;i*LanguageCases);</span></span>
<span class="tr"><span class="th" id="line617">617</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line618">618</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Iftrue&nbsp;(LanguageContractionForms&nbsp;==&nbsp;2);</span></span>
<span class="tr"><span class="th" id="line619">619</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(artform--&gt;acode&nbsp;~=&nbsp;artform--&gt;(acode+3))&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line620">620</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line621">621</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Iftrue&nbsp;(LanguageContractionForms&nbsp;==&nbsp;3);</span></span>
<span class="tr"><span class="th" id="line622">622</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(artform--&gt;acode&nbsp;~=&nbsp;artform--&gt;(acode+3))&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line623">623</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(artform--&gt;(acode+3)&nbsp;~=&nbsp;artform--&gt;(acode+6))&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line624">624</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line625">625</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Iftrue&nbsp;(LanguageContractionForms&nbsp;==&nbsp;4);</span></span>
<span class="tr"><span class="th" id="line626">626</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(artform--&gt;acode&nbsp;~=&nbsp;artform--&gt;(acode+3))&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line627">627</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(artform--&gt;(acode+3)&nbsp;~=&nbsp;artform--&gt;(acode+6))&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line628">628</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(artform--&gt;(acode+6)&nbsp;~=&nbsp;artform--&gt;(acode+9))&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line629">629</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line630">630</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Iftrue&nbsp;(LanguageContractionForms&nbsp;&gt;&nbsp;4);</span></span>
<span class="tr"><span class="th" id="line631">631</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;findout&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line632">632</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;LanguageContractionForms</span></span>
<span class="tr"><span class="th" id="line633">633</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line634">634</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifdef&nbsp;TARGET_ZCODE;</span></span>
<span class="tr"><span class="th" id="line635">635</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(standard_interpreter&nbsp;~=&nbsp;0&nbsp;&amp;&amp;&nbsp;findout)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line636">636</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StorageForShortName--&gt;0&nbsp;=&nbsp;160;</span></span>
<span class="tr"><span class="th" id="line637">637</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@output_stream&nbsp;3&nbsp;StorageForShortName;</span></span>
<span class="tr"><span class="th" id="line638">638</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pluralise)&nbsp;print&nbsp;(number)&nbsp;pluralise;&nbsp;else&nbsp;print&nbsp;(PSN__)&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line639">639</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@output_stream&nbsp;-3;</span></span>
<span class="tr"><span class="th" id="line640">640</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acode&nbsp;=&nbsp;acode&nbsp;+&nbsp;3*LanguageContraction(StorageForShortName&nbsp;+&nbsp;2);</span></span>
<span class="tr"><span class="th" id="line641">641</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line642">642</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Ifnot;&nbsp;!&nbsp;TARGET_GLULX</span></span>
<span class="tr"><span class="th" id="line643">643</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(findout)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line644">644</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pluralise)</span></span>
<span class="tr"><span class="th" id="line645">645</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Glulx_PrintAnyToArray(StorageForShortName,&nbsp;160,&nbsp;EnglishNumber,&nbsp;pluralise);</span></span>
<span class="tr"><span class="th" id="line646">646</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</span></span>
<span class="tr"><span class="th" id="line647">647</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Glulx_PrintAnyToArray(StorageForShortName,&nbsp;160,&nbsp;PSN__,&nbsp;obj);</span></span>
<span class="tr"><span class="th" id="line648">648</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acode&nbsp;=&nbsp;acode&nbsp;+&nbsp;3*LanguageContraction(StorageForShortName);</span></span>
<span class="tr"><span class="th" id="line649">649</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line650">650</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;#Endif;&nbsp;!&nbsp;TARGET_</span></span>
<span class="tr"><span class="th" id="line651">651</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line652">652</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;Cap&nbsp;(artform--&gt;acode,&nbsp;~~capitalise);&nbsp;!&nbsp;print&nbsp;article</span></span>
<span class="tr"><span class="th" id="line653">653</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pluralise)&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line654">654</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(PSN__)&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line655">655</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-object-names-iii">Object Names III.</h3><p><p> The routines accessible from outside this segment.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line661">661</span><span class="td">[&nbsp;IndefArt&nbsp;obj&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line662">662</span><span class="td">&nbsp;if&nbsp;(obj&nbsp;==&nbsp;0)&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;Y&#39;);&nbsp;rtrue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line663">663</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;indef_mode;&nbsp;indef_mode&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line664">664</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;proper)&nbsp;{&nbsp;indef_mode&nbsp;=&nbsp;NULL;&nbsp;print&nbsp;(PSN__)&nbsp;obj;&nbsp;indef_mode&nbsp;=&nbsp;i;&nbsp;return;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line665">665</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;provides&nbsp;article)&nbsp;&amp;&amp;&nbsp;(TEXT_TY_Compare(obj.article,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line666">666</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintOrRun(obj,&nbsp;article,&nbsp;true);&nbsp;print&nbsp;&quot;&nbsp;&quot;,&nbsp;(PSN__)&nbsp;obj;&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line667">667</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line668">668</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line669">669</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;PrefaceByArticle(obj,&nbsp;2);&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line670">670</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line671">671</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line672">672</span><span class="td">[&nbsp;CIndefArt&nbsp;obj&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line673">673</span><span class="td">&nbsp;if&nbsp;(obj&nbsp;==&nbsp;0)&nbsp;{&nbsp;LIST_WRITER_INTERNAL_RM(&#39;X&#39;);&nbsp;rtrue;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line674">674</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;indef_mode;&nbsp;indef_mode&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line675">675</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(obj&nbsp;has&nbsp;proper)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line676">676</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line677">677</span><span class="td">&nbsp;&nbsp;caps_mode&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line678">678</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(PSN__)&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line679">679</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line680">680</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caps_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line681">681</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line682">682</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line683">683</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;provides&nbsp;article)&nbsp;&amp;&amp;&nbsp;(TEXT_TY_Compare(obj.article,&nbsp;EMPTY_TEXT_VALUE)&nbsp;~=&nbsp;0))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line684">684</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_TY_Say_Capitalised(obj.article);&nbsp;print&nbsp;&quot;&nbsp;&quot;,&nbsp;(PSN__)&nbsp;obj;&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line685">685</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line686">686</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line687">687</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;PrefaceByArticle(obj,&nbsp;2,&nbsp;0,&nbsp;1);&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line688">688</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line689">689</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line690">690</span><span class="td">[&nbsp;DefArt&nbsp;obj&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line691">691</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;indef_mode;&nbsp;indef_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line692">692</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((~~obj&nbsp;ofclass&nbsp;Object)&nbsp;||&nbsp;obj&nbsp;has&nbsp;proper)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line693">693</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;NULL;&nbsp;print&nbsp;(PSN__)&nbsp;obj;&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line694">694</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line695">695</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line696">696</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;PrefaceByArticle(obj,&nbsp;1);&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line697">697</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line698">698</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line699">699</span><span class="td">[&nbsp;CDefArt&nbsp;obj&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line700">700</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;indef_mode;&nbsp;indef_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line701">701</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((obj&nbsp;ofclass&nbsp;Object)&nbsp;&amp;&amp;&nbsp;(obj&nbsp;has&nbsp;proper&nbsp;||&nbsp;obj&nbsp;==&nbsp;player))&nbsp;{</span></span>
<span class="tr"><span class="th" id="line702">702</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line703">703</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caps_mode&nbsp;=&nbsp;true;</span></span>
<span class="tr"><span class="th" id="line704">704</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;(PSN__)&nbsp;obj;</span></span>
<span class="tr"><span class="th" id="line705">705</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line706">706</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caps_mode&nbsp;=&nbsp;false;</span></span>
<span class="tr"><span class="th" id="line707">707</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line708">708</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line709">709</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((~~obj&nbsp;ofclass&nbsp;Object)&nbsp;||&nbsp;obj&nbsp;has&nbsp;proper)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line710">710</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indef_mode&nbsp;=&nbsp;NULL;&nbsp;print&nbsp;(PSN__)&nbsp;obj;&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line711">711</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span>
<span class="tr"><span class="th" id="line712">712</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line713">713</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;PrefaceByArticle(obj,&nbsp;0);&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line714">714</span><span class="td">];</span></span>
<span class="tr"><span class="th" id="line715">715</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line716">716</span><span class="td">[&nbsp;PrintShortName&nbsp;obj&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line717">717</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;indef_mode;&nbsp;indef_mode&nbsp;=&nbsp;NULL;</span></span>
<span class="tr"><span class="th" id="line718">718</span><span class="td">&nbsp;&nbsp;&nbsp;&nbsp;PSN__(obj);&nbsp;indef_mode&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line719">719</span><span class="td">];</span></span>
</div><div class='text'>
<h3 id="#printing-say-one-of">Say One Of.</h3><p><p> These routines are described in the Extensions chapter of the Inform documentation.<p></p><p></div><div class="pre">
<span class="tr"><span class="th" id="line726">726</span><span class="td">[&nbsp;I7_SOO_PAR&nbsp;oldval&nbsp;count;&nbsp;if&nbsp;(count&nbsp;&lt;=&nbsp;1)&nbsp;return&nbsp;count;&nbsp;return&nbsp;random(count);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line727">727</span><span class="td">[&nbsp;I7_SOO_RAN&nbsp;oldval&nbsp;count&nbsp;v;&nbsp;if&nbsp;(count&nbsp;&lt;=&nbsp;1)&nbsp;return&nbsp;count;</span></span>
<span class="tr"><span class="th" id="line728">728</span><span class="td">&nbsp;v&nbsp;=&nbsp;oldval;&nbsp;while&nbsp;(v&nbsp;==&nbsp;oldval)&nbsp;v&nbsp;=&nbsp;random(count);&nbsp;return&nbsp;v;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line729">729</span><span class="td">[&nbsp;I7_SOO_STI&nbsp;oldval&nbsp;count&nbsp;v;&nbsp;if&nbsp;(oldval)&nbsp;return&nbsp;oldval;&nbsp;return&nbsp;I7_SOO_PAR(oldval,&nbsp;count);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line730">730</span><span class="td">[&nbsp;I7_SOO_CYC&nbsp;oldval&nbsp;count;&nbsp;oldval++;&nbsp;if&nbsp;(oldval&nbsp;&gt;&nbsp;count)&nbsp;oldval&nbsp;=&nbsp;1;&nbsp;return&nbsp;oldval;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line731">731</span><span class="td">[&nbsp;I7_SOO_STOP&nbsp;oldval&nbsp;count;&nbsp;oldval++;&nbsp;if&nbsp;(oldval&nbsp;&gt;&nbsp;count)&nbsp;oldval&nbsp;=&nbsp;count;&nbsp;return&nbsp;oldval;&nbsp;];</span></span>
<span class="tr"><span class="th" id="line732">732</span><span class="td">[&nbsp;I7_SOO_TAP&nbsp;oldval&nbsp;count&nbsp;tn&nbsp;rn&nbsp;c;&nbsp;if&nbsp;(count&nbsp;&lt;=&nbsp;1)&nbsp;return&nbsp;count;&nbsp;tn&nbsp;=&nbsp;count*(count+1)/2;</span></span>
<span class="tr"><span class="th" id="line733">733</span><span class="td">&nbsp;rn&nbsp;=&nbsp;random(tn);&nbsp;for&nbsp;(c=1:c&lt;=count:c++)&nbsp;{&nbsp;rn&nbsp;=&nbsp;rn&nbsp;-&nbsp;c;&nbsp;if&nbsp;(rn&lt;=0)&nbsp;return&nbsp;(count-c+1);&nbsp;}&nbsp;];</span></span>
<span class="tr"><span class="th" id="line734">734</span><span class="td">[&nbsp;I7_SOO_TRAN&nbsp;oldval&nbsp;count;&nbsp;if&nbsp;(oldval&lt;count)&nbsp;return&nbsp;oldval+1;&nbsp;</span></span>
<span class="tr"><span class="th" id="line735">735</span><span class="td">&nbsp;return&nbsp;count&nbsp;+&nbsp;1&nbsp;+&nbsp;I7_SOO_RAN(oldval%(count+1),&nbsp;count);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line736">736</span><span class="td">[&nbsp;I7_SOO_TPAR&nbsp;oldval&nbsp;count;&nbsp;if&nbsp;(oldval&lt;count)&nbsp;return&nbsp;oldval+1;&nbsp;</span></span>
<span class="tr"><span class="th" id="line737">737</span><span class="td">&nbsp;return&nbsp;count&nbsp;+&nbsp;1&nbsp;+&nbsp;I7_SOO_PAR(oldval%(count+1),&nbsp;count);&nbsp;];</span></span>
<span class="tr"><span class="th" id="line738">738</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line739">739</span><span class="td">Array&nbsp;I7_SOO_SHUF-&gt;32;</span></span>
<span class="tr"><span class="th" id="line740">740</span><span class="td"></span></span>
<span class="tr"><span class="th" id="line741">741</span><span class="td">[&nbsp;I7_SOO_SHU&nbsp;oldval&nbsp;count&nbsp;sd&nbsp;ct&nbsp;v&nbsp;i&nbsp;j&nbsp;s&nbsp;ssd&nbsp;scope&nbsp;cc&nbsp;base;</span></span>
<span class="tr"><span class="th" id="line742">742</span><span class="td">&nbsp;base&nbsp;=&nbsp;count+1;</span></span>
<span class="tr"><span class="th" id="line743">743</span><span class="td">&nbsp;v&nbsp;=&nbsp;oldval%base;&nbsp;oldval&nbsp;=&nbsp;oldval/base;&nbsp;ct&nbsp;=&nbsp;oldval%base;&nbsp;sd&nbsp;=&nbsp;oldval/base;</span></span>
<span class="tr"><span class="th" id="line744">744</span><span class="td">&nbsp;if&nbsp;(count&nbsp;&gt;&nbsp;32)&nbsp;return&nbsp;I7_SOO_PAR(oldval,&nbsp;count);</span></span>
<span class="tr"><span class="th" id="line745">745</span><span class="td">&nbsp;if&nbsp;(count&nbsp;&lt;=&nbsp;1)&nbsp;v&nbsp;=&nbsp;count;</span></span>
<span class="tr"><span class="th" id="line746">746</span><span class="td">&nbsp;else&nbsp;{</span></span>
<span class="tr"><span class="th" id="line747">747</span><span class="td">&nbsp;&nbsp;!print&nbsp;&quot;^In&nbsp;v=&quot;,&nbsp;v,&nbsp;&quot;&nbsp;ct=&quot;,&nbsp;ct,&nbsp;&quot;&nbsp;sd=&quot;,&nbsp;sd,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line748">748</span><span class="td">&nbsp;&nbsp;cc&nbsp;=&nbsp;base*base;</span></span>
<span class="tr"><span class="th" id="line749">749</span><span class="td">&nbsp;&nbsp;scope&nbsp;=&nbsp;(MAX_POSITIVE_NUMBER-1)/cc;</span></span>
<span class="tr"><span class="th" id="line750">750</span><span class="td">&nbsp;&nbsp;!print&nbsp;&quot;Scope&nbsp;=&nbsp;&quot;,&nbsp;scope,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line751">751</span><span class="td">&nbsp;&nbsp;if&nbsp;(sd&nbsp;==&nbsp;0)&nbsp;{&nbsp;sd&nbsp;=&nbsp;random(scope);&nbsp;ct=0;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line752">752</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=0:i&lt;count:i++)&nbsp;I7_SOO_SHUF-&gt;i&nbsp;=&nbsp;i;</span></span>
<span class="tr"><span class="th" id="line753">753</span><span class="td">&nbsp;&nbsp;ssd&nbsp;=&nbsp;sd;</span></span>
<span class="tr"><span class="th" id="line754">754</span><span class="td">&nbsp;&nbsp;for&nbsp;(i=0:i&lt;count-1:i++)&nbsp;{</span></span>
<span class="tr"><span class="th" id="line755">755</span><span class="td">&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;(sd)%(count-i)+i;&nbsp;sd&nbsp;=&nbsp;(sd*31973)+17;&nbsp;if&nbsp;(sd&lt;0)&nbsp;sd=-sd;</span></span>
<span class="tr"><span class="th" id="line756">756</span><span class="td">&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;I7_SOO_SHUF-&gt;j;&nbsp;I7_SOO_SHUF-&gt;j&nbsp;=&nbsp;I7_SOO_SHUF-&gt;i;&nbsp;I7_SOO_SHUF-&gt;i&nbsp;=&nbsp;s;</span></span>
<span class="tr"><span class="th" id="line757">757</span><span class="td">&nbsp;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line758">758</span><span class="td">&nbsp;&nbsp;!for&nbsp;(i=0:i&lt;count:i++)&nbsp;print&nbsp;I7_SOO_SHUF-&gt;i,&nbsp;&quot;&nbsp;&quot;;&nbsp;print&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line759">759</span><span class="td">&nbsp;&nbsp;v&nbsp;=&nbsp;(I7_SOO_SHUF-&gt;ct)+1;</span></span>
<span class="tr"><span class="th" id="line760">760</span><span class="td">&nbsp;&nbsp;ct++;&nbsp;if&nbsp;(ct&nbsp;&gt;=&nbsp;count)&nbsp;{&nbsp;ct&nbsp;=&nbsp;0;&nbsp;ssd&nbsp;=&nbsp;0;&nbsp;}</span></span>
<span class="tr"><span class="th" id="line761">761</span><span class="td">&nbsp;}</span></span>
<span class="tr"><span class="th" id="line762">762</span><span class="td">&nbsp;!print&nbsp;&quot;Out&nbsp;v=&quot;,&nbsp;v,&nbsp;&quot;&nbsp;ct=&quot;,&nbsp;ct,&nbsp;&quot;&nbsp;ssd=&quot;,&nbsp;sd,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line763">763</span><span class="td">&nbsp;!print&nbsp;&quot;Return&nbsp;&quot;,&nbsp;v&nbsp;+&nbsp;ct*base&nbsp;+&nbsp;ssd*base*base,&nbsp;&quot;^&quot;;</span></span>
<span class="tr"><span class="th" id="line764">764</span><span class="td">&nbsp;return&nbsp;v&nbsp;+&nbsp;ct*base&nbsp;+&nbsp;ssd*base*base;</span></span>
<span class="tr"><span class="th" id="line765">765</span><span class="td">];</span></span>
</div><footer><hr><p><em>From I6T lib 6/12N &copy; Graham Nelson and published under the <a href="https://github.com/zedlopez/standard_rules/blob/main/LICENSE.md">Artistic License 2.0</a>. Distributed with <a href="http://inform7.com/">Inform 7 6M62</a>.</em></p></footer></body></html>
